/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var Cw=Object.create;var Ys=Object.defineProperty;var Lw=Object.getOwnPropertyDescriptor;var Tw=Object.getOwnPropertyNames;var Aw=Object.getPrototypeOf,Mw=Object.prototype.hasOwnProperty;var Ew=(o,e,t)=>e in o?Ys(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var Sc=(o,e)=>()=>(e||o((e={exports:{}}).exports,e),e.exports),kc=(o,e)=>{for(var t in e)Ys(o,t,{get:e[t],enumerable:!0})},um=(o,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Tw(e))!Mw.call(o,n)&&n!==t&&Ys(o,n,{get:()=>e[n],enumerable:!(r=Lw(e,n))||r.enumerable});return o};var zn=(o,e,t)=>(t=o!=null?Cw(Aw(o)):{},um(e||!o||!o.__esModule?Ys(t,"default",{value:o,enumerable:!0}):t,o)),Pw=o=>um(Ys({},"__esModule",{value:!0}),o);var ct=(o,e,t)=>(Ew(o,typeof e!="symbol"?e+"":e,t),t);var Qs=Sc((GM,pm)=>{"use strict";function zr(o){if(typeof o!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(o))}function dm(o,e){for(var t="",r=0,n=-1,s=0,i,a=0;a<=o.length;++a){if(a<o.length)i=o.charCodeAt(a);else{if(i===47)break;i=47}if(i===47){if(!(n===a-1||s===1))if(n!==a-1&&s===2){if(t.length<2||r!==2||t.charCodeAt(t.length-1)!==46||t.charCodeAt(t.length-2)!==46){if(t.length>2){var l=t.lastIndexOf("/");if(l!==t.length-1){l===-1?(t="",r=0):(t=t.slice(0,l),r=t.length-1-t.lastIndexOf("/")),n=a,s=0;continue}}else if(t.length===2||t.length===1){t="",r=0,n=a,s=0;continue}}e&&(t.length>0?t+="/..":t="..",r=2)}else t.length>0?t+="/"+o.slice(n+1,a):t=o.slice(n+1,a),r=a-n-1;n=a,s=0}else i===46&&s!==-1?++s:s=-1}return t}function Dw(o,e){var t=e.dir||e.root,r=e.base||(e.name||"")+(e.ext||"");return t?t===e.root?t+r:t+o+r:r}var Wn={resolve:function(){for(var e="",t=!1,r,n=arguments.length-1;n>=-1&&!t;n--){var s;n>=0?s=arguments[n]:(r===void 0&&(r=process.cwd()),s=r),zr(s),s.length!==0&&(e=s+"/"+e,t=s.charCodeAt(0)===47)}return e=dm(e,!t),t?e.length>0?"/"+e:"/":e.length>0?e:"."},normalize:function(e){if(zr(e),e.length===0)return".";var t=e.charCodeAt(0)===47,r=e.charCodeAt(e.length-1)===47;return e=dm(e,!t),e.length===0&&!t&&(e="."),e.length>0&&r&&(e+="/"),t?"/"+e:e},isAbsolute:function(e){return zr(e),e.length>0&&e.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var e,t=0;t<arguments.length;++t){var r=arguments[t];zr(r),r.length>0&&(e===void 0?e=r:e+="/"+r)}return e===void 0?".":Wn.normalize(e)},relative:function(e,t){if(zr(e),zr(t),e===t||(e=Wn.resolve(e),t=Wn.resolve(t),e===t))return"";for(var r=1;r<e.length&&e.charCodeAt(r)===47;++r);for(var n=e.length,s=n-r,i=1;i<t.length&&t.charCodeAt(i)===47;++i);for(var a=t.length,l=a-i,c=s<l?s:l,f=-1,u=0;u<=c;++u){if(u===c){if(l>c){if(t.charCodeAt(i+u)===47)return t.slice(i+u+1);if(u===0)return t.slice(i+u)}else s>c&&(e.charCodeAt(r+u)===47?f=u:u===0&&(f=0));break}var d=e.charCodeAt(r+u),m=t.charCodeAt(i+u);if(d!==m)break;d===47&&(f=u)}var p="";for(u=r+f+1;u<=n;++u)(u===n||e.charCodeAt(u)===47)&&(p.length===0?p+="..":p+="/..");return p.length>0?p+t.slice(i+f):(i+=f,t.charCodeAt(i)===47&&++i,t.slice(i))},_makeLong:function(e){return e},dirname:function(e){if(zr(e),e.length===0)return".";for(var t=e.charCodeAt(0),r=t===47,n=-1,s=!0,i=e.length-1;i>=1;--i)if(t=e.charCodeAt(i),t===47){if(!s){n=i;break}}else s=!1;return n===-1?r?"/":".":r&&n===1?"//":e.slice(0,n)},basename:function(e,t){if(t!==void 0&&typeof t!="string")throw new TypeError('"ext" argument must be a string');zr(e);var r=0,n=-1,s=!0,i;if(t!==void 0&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";var a=t.length-1,l=-1;for(i=e.length-1;i>=0;--i){var c=e.charCodeAt(i);if(c===47){if(!s){r=i+1;break}}else l===-1&&(s=!1,l=i+1),a>=0&&(c===t.charCodeAt(a)?--a===-1&&(n=i):(a=-1,n=l))}return r===n?n=l:n===-1&&(n=e.length),e.slice(r,n)}else{for(i=e.length-1;i>=0;--i)if(e.charCodeAt(i)===47){if(!s){r=i+1;break}}else n===-1&&(s=!1,n=i+1);return n===-1?"":e.slice(r,n)}},extname:function(e){zr(e);for(var t=-1,r=0,n=-1,s=!0,i=0,a=e.length-1;a>=0;--a){var l=e.charCodeAt(a);if(l===47){if(!s){r=a+1;break}continue}n===-1&&(s=!1,n=a+1),l===46?t===-1?t=a:i!==1&&(i=1):t!==-1&&(i=-1)}return t===-1||n===-1||i===0||i===1&&t===n-1&&t===r+1?"":e.slice(t,n)},format:function(e){if(e===null||typeof e!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return Dw("/",e)},parse:function(e){zr(e);var t={root:"",dir:"",base:"",ext:"",name:""};if(e.length===0)return t;var r=e.charCodeAt(0),n=r===47,s;n?(t.root="/",s=1):s=0;for(var i=-1,a=0,l=-1,c=!0,f=e.length-1,u=0;f>=s;--f){if(r=e.charCodeAt(f),r===47){if(!c){a=f+1;break}continue}l===-1&&(c=!1,l=f+1),r===46?i===-1?i=f:u!==1&&(u=1):i!==-1&&(u=-1)}return i===-1||l===-1||u===0||u===1&&i===l-1&&i===a+1?l!==-1&&(a===0&&n?t.base=t.name=e.slice(1,l):t.base=t.name=e.slice(a,l)):(a===0&&n?(t.name=e.slice(1,i),t.base=e.slice(1,l)):(t.name=e.slice(a,i),t.base=e.slice(a,l)),t.ext=e.slice(i,l)),a>0?t.dir=e.slice(0,a-1):n&&(t.dir="/"),t},sep:"/",delimiter:":",win32:null,posix:null};Wn.posix=Wn;pm.exports=Wn});var zf=Sc(($P,Ss)=>{var ne=function(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32},Xe=-1,tt=1,$e=0;ne.Diff=function(o,e){return[o,e]};ne.prototype.diff_main=function(o,e,t,r){typeof r=="undefined"&&(this.Diff_Timeout<=0?r=Number.MAX_VALUE:r=new Date().getTime()+this.Diff_Timeout*1e3);var n=r;if(o==null||e==null)throw new Error("Null input. (diff_main)");if(o==e)return o?[new ne.Diff($e,o)]:[];typeof t=="undefined"&&(t=!0);var s=t,i=this.diff_commonPrefix(o,e),a=o.substring(0,i);o=o.substring(i),e=e.substring(i),i=this.diff_commonSuffix(o,e);var l=o.substring(o.length-i);o=o.substring(0,o.length-i),e=e.substring(0,e.length-i);var c=this.diff_compute_(o,e,s,n);return a&&c.unshift(new ne.Diff($e,a)),l&&c.push(new ne.Diff($e,l)),this.diff_cleanupMerge(c),c};ne.prototype.diff_compute_=function(o,e,t,r){var n;if(!o)return[new ne.Diff(tt,e)];if(!e)return[new ne.Diff(Xe,o)];var s=o.length>e.length?o:e,i=o.length>e.length?e:o,a=s.indexOf(i);if(a!=-1)return n=[new ne.Diff(tt,s.substring(0,a)),new ne.Diff($e,i),new ne.Diff(tt,s.substring(a+i.length))],o.length>e.length&&(n[0][0]=n[2][0]=Xe),n;if(i.length==1)return[new ne.Diff(Xe,o),new ne.Diff(tt,e)];var l=this.diff_halfMatch_(o,e);if(l){var c=l[0],f=l[1],u=l[2],d=l[3],m=l[4],p=this.diff_main(c,u,t,r),y=this.diff_main(f,d,t,r);return p.concat([new ne.Diff($e,m)],y)}return t&&o.length>100&&e.length>100?this.diff_lineMode_(o,e,r):this.diff_bisect_(o,e,r)};ne.prototype.diff_lineMode_=function(o,e,t){var r=this.diff_linesToChars_(o,e);o=r.chars1,e=r.chars2;var n=r.lineArray,s=this.diff_main(o,e,!1,t);this.diff_charsToLines_(s,n),this.diff_cleanupSemantic(s),s.push(new ne.Diff($e,""));for(var i=0,a=0,l=0,c="",f="";i<s.length;){switch(s[i][0]){case tt:l++,f+=s[i][1];break;case Xe:a++,c+=s[i][1];break;case $e:if(a>=1&&l>=1){s.splice(i-a-l,a+l),i=i-a-l;for(var u=this.diff_main(c,f,!1,t),d=u.length-1;d>=0;d--)s.splice(i,0,u[d]);i=i+u.length}l=0,a=0,c="",f="";break}i++}return s.pop(),s};ne.prototype.diff_bisect_=function(o,e,t){for(var r=o.length,n=e.length,s=Math.ceil((r+n)/2),i=s,a=2*s,l=new Array(a),c=new Array(a),f=0;f<a;f++)l[f]=-1,c[f]=-1;l[i+1]=0,c[i+1]=0;for(var u=r-n,d=u%2!=0,m=0,p=0,y=0,g=0,v=0;v<s&&!(new Date().getTime()>t);v++){for(var C=-v+m;C<=v-p;C+=2){var L=i+C,T;C==-v||C!=v&&l[L-1]<l[L+1]?T=l[L+1]:T=l[L-1]+1;for(var E=T-C;T<r&&E<n&&o.charAt(T)==e.charAt(E);)T++,E++;if(l[L]=T,T>r)p+=2;else if(E>n)m+=2;else if(d){var O=i+u-C;if(O>=0&&O<a&&c[O]!=-1){var I=r-c[O];if(T>=I)return this.diff_bisectSplit_(o,e,T,E,t)}}}for(var A=-v+y;A<=v-g;A+=2){var O=i+A,I;A==-v||A!=v&&c[O-1]<c[O+1]?I=c[O+1]:I=c[O-1]+1;for(var U=I-A;I<r&&U<n&&o.charAt(r-I-1)==e.charAt(n-U-1);)I++,U++;if(c[O]=I,I>r)g+=2;else if(U>n)y+=2;else if(!d){var L=i+u-A;if(L>=0&&L<a&&l[L]!=-1){var T=l[L],E=i+T-L;if(I=r-I,T>=I)return this.diff_bisectSplit_(o,e,T,E,t)}}}}return[new ne.Diff(Xe,o),new ne.Diff(tt,e)]};ne.prototype.diff_bisectSplit_=function(o,e,t,r,n){var s=o.substring(0,t),i=e.substring(0,r),a=o.substring(t),l=e.substring(r),c=this.diff_main(s,i,!1,n),f=this.diff_main(a,l,!1,n);return c.concat(f)};ne.prototype.diff_linesToChars_=function(o,e){var t=[],r={};t[0]="";function n(l){for(var c="",f=0,u=-1,d=t.length;u<l.length-1;){u=l.indexOf(`
`,f),u==-1&&(u=l.length-1);var m=l.substring(f,u+1);(r.hasOwnProperty?r.hasOwnProperty(m):r[m]!==void 0)?c+=String.fromCharCode(r[m]):(d==s&&(m=l.substring(f),u=l.length),c+=String.fromCharCode(d),r[m]=d,t[d++]=m),f=u+1}return c}var s=4e4,i=n(o);s=65535;var a=n(e);return{chars1:i,chars2:a,lineArray:t}};ne.prototype.diff_charsToLines_=function(o,e){for(var t=0;t<o.length;t++){for(var r=o[t][1],n=[],s=0;s<r.length;s++)n[s]=e[r.charCodeAt(s)];o[t][1]=n.join("")}};ne.prototype.diff_commonPrefix=function(o,e){if(!o||!e||o.charAt(0)!=e.charAt(0))return 0;for(var t=0,r=Math.min(o.length,e.length),n=r,s=0;t<n;)o.substring(s,n)==e.substring(s,n)?(t=n,s=t):r=n,n=Math.floor((r-t)/2+t);return n};ne.prototype.diff_commonSuffix=function(o,e){if(!o||!e||o.charAt(o.length-1)!=e.charAt(e.length-1))return 0;for(var t=0,r=Math.min(o.length,e.length),n=r,s=0;t<n;)o.substring(o.length-n,o.length-s)==e.substring(e.length-n,e.length-s)?(t=n,s=t):r=n,n=Math.floor((r-t)/2+t);return n};ne.prototype.diff_commonOverlap_=function(o,e){var t=o.length,r=e.length;if(t==0||r==0)return 0;t>r?o=o.substring(t-r):t<r&&(e=e.substring(0,t));var n=Math.min(t,r);if(o==e)return n;for(var s=0,i=1;;){var a=o.substring(n-i),l=e.indexOf(a);if(l==-1)return s;i+=l,(l==0||o.substring(n-i)==e.substring(0,i))&&(s=i,i++)}};ne.prototype.diff_halfMatch_=function(o,e){if(this.Diff_Timeout<=0)return null;var t=o.length>e.length?o:e,r=o.length>e.length?e:o;if(t.length<4||r.length*2<t.length)return null;var n=this;function s(p,y,g){for(var v=p.substring(g,g+Math.floor(p.length/4)),C=-1,L="",T,E,O,I;(C=y.indexOf(v,C+1))!=-1;){var A=n.diff_commonPrefix(p.substring(g),y.substring(C)),U=n.diff_commonSuffix(p.substring(0,g),y.substring(0,C));L.length<U+A&&(L=y.substring(C-U,C)+y.substring(C,C+A),T=p.substring(0,g-U),E=p.substring(g+A),O=y.substring(0,C-U),I=y.substring(C+A))}return L.length*2>=p.length?[T,E,O,I,L]:null}var i=s(t,r,Math.ceil(t.length/4)),a=s(t,r,Math.ceil(t.length/2)),l;if(!i&&!a)return null;a?i?l=i[4].length>a[4].length?i:a:l=a:l=i;var c,f,u,d;o.length>e.length?(c=l[0],f=l[1],u=l[2],d=l[3]):(u=l[0],d=l[1],c=l[2],f=l[3]);var m=l[4];return[c,f,u,d,m]};ne.prototype.diff_cleanupSemantic=function(o){for(var e=!1,t=[],r=0,n=null,s=0,i=0,a=0,l=0,c=0;s<o.length;)o[s][0]==$e?(t[r++]=s,i=l,a=c,l=0,c=0,n=o[s][1]):(o[s][0]==tt?l+=o[s][1].length:c+=o[s][1].length,n&&n.length<=Math.max(i,a)&&n.length<=Math.max(l,c)&&(o.splice(t[r-1],0,new ne.Diff(Xe,n)),o[t[r-1]+1][0]=tt,r--,r--,s=r>0?t[r-1]:-1,i=0,a=0,l=0,c=0,n=null,e=!0)),s++;for(e&&this.diff_cleanupMerge(o),this.diff_cleanupSemanticLossless(o),s=1;s<o.length;){if(o[s-1][0]==Xe&&o[s][0]==tt){var f=o[s-1][1],u=o[s][1],d=this.diff_commonOverlap_(f,u),m=this.diff_commonOverlap_(u,f);d>=m?(d>=f.length/2||d>=u.length/2)&&(o.splice(s,0,new ne.Diff($e,u.substring(0,d))),o[s-1][1]=f.substring(0,f.length-d),o[s+1][1]=u.substring(d),s++):(m>=f.length/2||m>=u.length/2)&&(o.splice(s,0,new ne.Diff($e,f.substring(0,m))),o[s-1][0]=tt,o[s-1][1]=u.substring(0,u.length-m),o[s+1][0]=Xe,o[s+1][1]=f.substring(m),s++),s++}s++}};ne.prototype.diff_cleanupSemanticLossless=function(o){function e(m,p){if(!m||!p)return 6;var y=m.charAt(m.length-1),g=p.charAt(0),v=y.match(ne.nonAlphaNumericRegex_),C=g.match(ne.nonAlphaNumericRegex_),L=v&&y.match(ne.whitespaceRegex_),T=C&&g.match(ne.whitespaceRegex_),E=L&&y.match(ne.linebreakRegex_),O=T&&g.match(ne.linebreakRegex_),I=E&&m.match(ne.blanklineEndRegex_),A=O&&p.match(ne.blanklineStartRegex_);return I||A?5:E||O?4:v&&!L&&T?3:L||T?2:v||C?1:0}for(var t=1;t<o.length-1;){if(o[t-1][0]==$e&&o[t+1][0]==$e){var r=o[t-1][1],n=o[t][1],s=o[t+1][1],i=this.diff_commonSuffix(r,n);if(i){var a=n.substring(n.length-i);r=r.substring(0,r.length-i),n=a+n.substring(0,n.length-i),s=a+s}for(var l=r,c=n,f=s,u=e(r,n)+e(n,s);n.charAt(0)===s.charAt(0);){r+=n.charAt(0),n=n.substring(1)+s.charAt(0),s=s.substring(1);var d=e(r,n)+e(n,s);d>=u&&(u=d,l=r,c=n,f=s)}o[t-1][1]!=l&&(l?o[t-1][1]=l:(o.splice(t-1,1),t--),o[t][1]=c,f?o[t+1][1]=f:(o.splice(t+1,1),t--))}t++}};ne.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/;ne.whitespaceRegex_=/\s/;ne.linebreakRegex_=/[\r\n]/;ne.blanklineEndRegex_=/\n\r?\n$/;ne.blanklineStartRegex_=/^\r?\n\r?\n/;ne.prototype.diff_cleanupEfficiency=function(o){for(var e=!1,t=[],r=0,n=null,s=0,i=!1,a=!1,l=!1,c=!1;s<o.length;)o[s][0]==$e?(o[s][1].length<this.Diff_EditCost&&(l||c)?(t[r++]=s,i=l,a=c,n=o[s][1]):(r=0,n=null),l=c=!1):(o[s][0]==Xe?c=!0:l=!0,n&&(i&&a&&l&&c||n.length<this.Diff_EditCost/2&&i+a+l+c==3)&&(o.splice(t[r-1],0,new ne.Diff(Xe,n)),o[t[r-1]+1][0]=tt,r--,n=null,i&&a?(l=c=!0,r=0):(r--,s=r>0?t[r-1]:-1,l=c=!1),e=!0)),s++;e&&this.diff_cleanupMerge(o)};ne.prototype.diff_cleanupMerge=function(o){o.push(new ne.Diff($e,""));for(var e=0,t=0,r=0,n="",s="",i;e<o.length;)switch(o[e][0]){case tt:r++,s+=o[e][1],e++;break;case Xe:t++,n+=o[e][1],e++;break;case $e:t+r>1?(t!==0&&r!==0&&(i=this.diff_commonPrefix(s,n),i!==0&&(e-t-r>0&&o[e-t-r-1][0]==$e?o[e-t-r-1][1]+=s.substring(0,i):(o.splice(0,0,new ne.Diff($e,s.substring(0,i))),e++),s=s.substring(i),n=n.substring(i)),i=this.diff_commonSuffix(s,n),i!==0&&(o[e][1]=s.substring(s.length-i)+o[e][1],s=s.substring(0,s.length-i),n=n.substring(0,n.length-i))),e-=t+r,o.splice(e,t+r),n.length&&(o.splice(e,0,new ne.Diff(Xe,n)),e++),s.length&&(o.splice(e,0,new ne.Diff(tt,s)),e++),e++):e!==0&&o[e-1][0]==$e?(o[e-1][1]+=o[e][1],o.splice(e,1)):e++,r=0,t=0,n="",s="";break}o[o.length-1][1]===""&&o.pop();var a=!1;for(e=1;e<o.length-1;)o[e-1][0]==$e&&o[e+1][0]==$e&&(o[e][1].substring(o[e][1].length-o[e-1][1].length)==o[e-1][1]?(o[e][1]=o[e-1][1]+o[e][1].substring(0,o[e][1].length-o[e-1][1].length),o[e+1][1]=o[e-1][1]+o[e+1][1],o.splice(e-1,1),a=!0):o[e][1].substring(0,o[e+1][1].length)==o[e+1][1]&&(o[e-1][1]+=o[e+1][1],o[e][1]=o[e][1].substring(o[e+1][1].length)+o[e+1][1],o.splice(e+1,1),a=!0)),e++;a&&this.diff_cleanupMerge(o)};ne.prototype.diff_xIndex=function(o,e){var t=0,r=0,n=0,s=0,i;for(i=0;i<o.length&&(o[i][0]!==tt&&(t+=o[i][1].length),o[i][0]!==Xe&&(r+=o[i][1].length),!(t>e));i++)n=t,s=r;return o.length!=i&&o[i][0]===Xe?s:s+(e-n)};ne.prototype.diff_prettyHtml=function(o){for(var e=[],t=/&/g,r=/</g,n=/>/g,s=/\n/g,i=0;i<o.length;i++){var a=o[i][0],l=o[i][1],c=l.replace(t,"&amp;").replace(r,"&lt;").replace(n,"&gt;").replace(s,"&para;<br>");switch(a){case tt:e[i]='<ins style="background:#e6ffe6;">'+c+"</ins>";break;case Xe:e[i]='<del style="background:#ffe6e6;">'+c+"</del>";break;case $e:e[i]="<span>"+c+"</span>";break}}return e.join("")};ne.prototype.diff_text1=function(o){for(var e=[],t=0;t<o.length;t++)o[t][0]!==tt&&(e[t]=o[t][1]);return e.join("")};ne.prototype.diff_text2=function(o){for(var e=[],t=0;t<o.length;t++)o[t][0]!==Xe&&(e[t]=o[t][1]);return e.join("")};ne.prototype.diff_levenshtein=function(o){for(var e=0,t=0,r=0,n=0;n<o.length;n++){var s=o[n][0],i=o[n][1];switch(s){case tt:t+=i.length;break;case Xe:r+=i.length;break;case $e:e+=Math.max(t,r),t=0,r=0;break}}return e+=Math.max(t,r),e};ne.prototype.diff_toDelta=function(o){for(var e=[],t=0;t<o.length;t++)switch(o[t][0]){case tt:e[t]="+"+encodeURI(o[t][1]);break;case Xe:e[t]="-"+o[t][1].length;break;case $e:e[t]="="+o[t][1].length;break}return e.join("	").replace(/%20/g," ")};ne.prototype.diff_fromDelta=function(o,e){for(var t=[],r=0,n=0,s=e.split(/\t/g),i=0;i<s.length;i++){var a=s[i].substring(1);switch(s[i].charAt(0)){case"+":try{t[r++]=new ne.Diff(tt,decodeURI(a))}catch(f){throw new Error("Illegal escape in diff_fromDelta: "+a)}break;case"-":case"=":var l=parseInt(a,10);if(isNaN(l)||l<0)throw new Error("Invalid number in diff_fromDelta: "+a);var c=o.substring(n,n+=l);s[i].charAt(0)=="="?t[r++]=new ne.Diff($e,c):t[r++]=new ne.Diff(Xe,c);break;default:if(s[i])throw new Error("Invalid diff operation in diff_fromDelta: "+s[i])}}if(n!=o.length)throw new Error("Delta length ("+n+") does not equal source text length ("+o.length+").");return t};ne.prototype.match_main=function(o,e,t){if(o==null||e==null||t==null)throw new Error("Null input. (match_main)");return t=Math.max(0,Math.min(t,o.length)),o==e?0:o.length?o.substring(t,t+e.length)==e?t:this.match_bitap_(o,e,t):-1};ne.prototype.match_bitap_=function(o,e,t){if(e.length>this.Match_MaxBits)throw new Error("Pattern too long for this browser.");var r=this.match_alphabet_(e),n=this;function s(T,E){var O=T/e.length,I=Math.abs(t-E);return n.Match_Distance?O+I/n.Match_Distance:I?1:O}var i=this.Match_Threshold,a=o.indexOf(e,t);a!=-1&&(i=Math.min(s(0,a),i),a=o.lastIndexOf(e,t+e.length),a!=-1&&(i=Math.min(s(0,a),i)));var l=1<<e.length-1;a=-1;for(var c,f,u=e.length+o.length,d,m=0;m<e.length;m++){for(c=0,f=u;c<f;)s(m,t+f)<=i?c=f:u=f,f=Math.floor((u-c)/2+c);u=f;var p=Math.max(1,t-f+1),y=Math.min(t+f,o.length)+e.length,g=Array(y+2);g[y+1]=(1<<m)-1;for(var v=y;v>=p;v--){var C=r[o.charAt(v-1)];if(m===0?g[v]=(g[v+1]<<1|1)&C:g[v]=(g[v+1]<<1|1)&C|((d[v+1]|d[v])<<1|1)|d[v+1],g[v]&l){var L=s(m,v-1);if(L<=i)if(i=L,a=v-1,a>t)p=Math.max(1,2*t-a);else break}}if(s(m+1,t)>i)break;d=g}return a};ne.prototype.match_alphabet_=function(o){for(var e={},t=0;t<o.length;t++)e[o.charAt(t)]=0;for(var t=0;t<o.length;t++)e[o.charAt(t)]|=1<<o.length-t-1;return e};ne.prototype.patch_addContext_=function(o,e){if(e.length!=0){if(o.start2===null)throw Error("patch not initialized");for(var t=e.substring(o.start2,o.start2+o.length1),r=0;e.indexOf(t)!=e.lastIndexOf(t)&&t.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)r+=this.Patch_Margin,t=e.substring(o.start2-r,o.start2+o.length1+r);r+=this.Patch_Margin;var n=e.substring(o.start2-r,o.start2);n&&o.diffs.unshift(new ne.Diff($e,n));var s=e.substring(o.start2+o.length1,o.start2+o.length1+r);s&&o.diffs.push(new ne.Diff($e,s)),o.start1-=n.length,o.start2-=n.length,o.length1+=n.length+s.length,o.length2+=n.length+s.length}};ne.prototype.patch_make=function(o,e,t){var r,n;if(typeof o=="string"&&typeof e=="string"&&typeof t=="undefined")r=o,n=this.diff_main(r,e,!0),n.length>2&&(this.diff_cleanupSemantic(n),this.diff_cleanupEfficiency(n));else if(o&&typeof o=="object"&&typeof e=="undefined"&&typeof t=="undefined")n=o,r=this.diff_text1(n);else if(typeof o=="string"&&e&&typeof e=="object"&&typeof t=="undefined")r=o,n=e;else if(typeof o=="string"&&typeof e=="string"&&t&&typeof t=="object")r=o,n=t;else throw new Error("Unknown call format to patch_make.");if(n.length===0)return[];for(var s=[],i=new ne.patch_obj,a=0,l=0,c=0,f=r,u=r,d=0;d<n.length;d++){var m=n[d][0],p=n[d][1];switch(!a&&m!==$e&&(i.start1=l,i.start2=c),m){case tt:i.diffs[a++]=n[d],i.length2+=p.length,u=u.substring(0,c)+p+u.substring(c);break;case Xe:i.length1+=p.length,i.diffs[a++]=n[d],u=u.substring(0,c)+u.substring(c+p.length);break;case $e:p.length<=2*this.Patch_Margin&&a&&n.length!=d+1?(i.diffs[a++]=n[d],i.length1+=p.length,i.length2+=p.length):p.length>=2*this.Patch_Margin&&a&&(this.patch_addContext_(i,f),s.push(i),i=new ne.patch_obj,a=0,f=u,l=c);break}m!==tt&&(l+=p.length),m!==Xe&&(c+=p.length)}return a&&(this.patch_addContext_(i,f),s.push(i)),s};ne.prototype.patch_deepCopy=function(o){for(var e=[],t=0;t<o.length;t++){var r=o[t],n=new ne.patch_obj;n.diffs=[];for(var s=0;s<r.diffs.length;s++)n.diffs[s]=new ne.Diff(r.diffs[s][0],r.diffs[s][1]);n.start1=r.start1,n.start2=r.start2,n.length1=r.length1,n.length2=r.length2,e[t]=n}return e};ne.prototype.patch_apply=function(o,e){if(o.length==0)return[e,[]];o=this.patch_deepCopy(o);var t=this.patch_addPadding(o);e=t+e+t,this.patch_splitMax(o);for(var r=0,n=[],s=0;s<o.length;s++){var i=o[s].start2+r,a=this.diff_text1(o[s].diffs),l,c=-1;if(a.length>this.Match_MaxBits?(l=this.match_main(e,a.substring(0,this.Match_MaxBits),i),l!=-1&&(c=this.match_main(e,a.substring(a.length-this.Match_MaxBits),i+a.length-this.Match_MaxBits),(c==-1||l>=c)&&(l=-1))):l=this.match_main(e,a,i),l==-1)n[s]=!1,r-=o[s].length2-o[s].length1;else{n[s]=!0,r=l-i;var f;if(c==-1?f=e.substring(l,l+a.length):f=e.substring(l,c+this.Match_MaxBits),a==f)e=e.substring(0,l)+this.diff_text2(o[s].diffs)+e.substring(l+a.length);else{var u=this.diff_main(a,f,!1);if(a.length>this.Match_MaxBits&&this.diff_levenshtein(u)/a.length>this.Patch_DeleteThreshold)n[s]=!1;else{this.diff_cleanupSemanticLossless(u);for(var d=0,m,p=0;p<o[s].diffs.length;p++){var y=o[s].diffs[p];y[0]!==$e&&(m=this.diff_xIndex(u,d)),y[0]===tt?e=e.substring(0,l+m)+y[1]+e.substring(l+m):y[0]===Xe&&(e=e.substring(0,l+m)+e.substring(l+this.diff_xIndex(u,d+y[1].length))),y[0]!==Xe&&(d+=y[1].length)}}}}}return e=e.substring(t.length,e.length-t.length),[e,n]};ne.prototype.patch_addPadding=function(o){for(var e=this.Patch_Margin,t="",r=1;r<=e;r++)t+=String.fromCharCode(r);for(var r=0;r<o.length;r++)o[r].start1+=e,o[r].start2+=e;var n=o[0],s=n.diffs;if(s.length==0||s[0][0]!=$e)s.unshift(new ne.Diff($e,t)),n.start1-=e,n.start2-=e,n.length1+=e,n.length2+=e;else if(e>s[0][1].length){var i=e-s[0][1].length;s[0][1]=t.substring(s[0][1].length)+s[0][1],n.start1-=i,n.start2-=i,n.length1+=i,n.length2+=i}if(n=o[o.length-1],s=n.diffs,s.length==0||s[s.length-1][0]!=$e)s.push(new ne.Diff($e,t)),n.length1+=e,n.length2+=e;else if(e>s[s.length-1][1].length){var i=e-s[s.length-1][1].length;s[s.length-1][1]+=t.substring(0,i),n.length1+=i,n.length2+=i}return t};ne.prototype.patch_splitMax=function(o){for(var e=this.Match_MaxBits,t=0;t<o.length;t++)if(!(o[t].length1<=e)){var r=o[t];o.splice(t--,1);for(var n=r.start1,s=r.start2,i="";r.diffs.length!==0;){var a=new ne.patch_obj,l=!0;for(a.start1=n-i.length,a.start2=s-i.length,i!==""&&(a.length1=a.length2=i.length,a.diffs.push(new ne.Diff($e,i)));r.diffs.length!==0&&a.length1<e-this.Patch_Margin;){var c=r.diffs[0][0],f=r.diffs[0][1];c===tt?(a.length2+=f.length,s+=f.length,a.diffs.push(r.diffs.shift()),l=!1):c===Xe&&a.diffs.length==1&&a.diffs[0][0]==$e&&f.length>2*e?(a.length1+=f.length,n+=f.length,l=!1,a.diffs.push(new ne.Diff(c,f)),r.diffs.shift()):(f=f.substring(0,e-a.length1-this.Patch_Margin),a.length1+=f.length,n+=f.length,c===$e?(a.length2+=f.length,s+=f.length):l=!1,a.diffs.push(new ne.Diff(c,f)),f==r.diffs[0][1]?r.diffs.shift():r.diffs[0][1]=r.diffs[0][1].substring(f.length))}i=this.diff_text2(a.diffs),i=i.substring(i.length-this.Patch_Margin);var u=this.diff_text1(r.diffs).substring(0,this.Patch_Margin);u!==""&&(a.length1+=u.length,a.length2+=u.length,a.diffs.length!==0&&a.diffs[a.diffs.length-1][0]===$e?a.diffs[a.diffs.length-1][1]+=u:a.diffs.push(new ne.Diff($e,u))),l||o.splice(++t,0,a)}}};ne.prototype.patch_toText=function(o){for(var e=[],t=0;t<o.length;t++)e[t]=o[t];return e.join("")};ne.prototype.patch_fromText=function(o){var e=[];if(!o)return e;for(var t=o.split(`
`),r=0,n=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;r<t.length;){var s=t[r].match(n);if(!s)throw new Error("Invalid patch string: "+t[r]);var i=new ne.patch_obj;for(e.push(i),i.start1=parseInt(s[1],10),s[2]===""?(i.start1--,i.length1=1):s[2]=="0"?i.length1=0:(i.start1--,i.length1=parseInt(s[2],10)),i.start2=parseInt(s[3],10),s[4]===""?(i.start2--,i.length2=1):s[4]=="0"?i.length2=0:(i.start2--,i.length2=parseInt(s[4],10)),r++;r<t.length;){var a=t[r].charAt(0);try{var l=decodeURI(t[r].substring(1))}catch(c){throw new Error("Illegal escape in patch_fromText: "+l)}if(a=="-")i.diffs.push(new ne.Diff(Xe,l));else if(a=="+")i.diffs.push(new ne.Diff(tt,l));else if(a==" ")i.diffs.push(new ne.Diff($e,l));else{if(a=="@")break;if(a!=="")throw new Error('Invalid patch mode "'+a+'" in: '+l)}r++}}return e};ne.patch_obj=function(){this.diffs=[],this.start1=null,this.start2=null,this.length1=0,this.length2=0};ne.patch_obj.prototype.toString=function(){var o,e;this.length1===0?o=this.start1+",0":this.length1==1?o=this.start1+1:o=this.start1+1+","+this.length1,this.length2===0?e=this.start2+",0":this.length2==1?e=this.start2+1:e=this.start2+1+","+this.length2;for(var t=["@@ -"+o+" +"+e+` @@
`],r,n=0;n<this.diffs.length;n++){switch(this.diffs[n][0]){case tt:r="+";break;case Xe:r="-";break;case $e:r=" ";break}t[n+1]=r+encodeURI(this.diffs[n][1])+`
`}return t.join("").replace(/%20/g," ")};Ss.exports=ne;Ss.exports.diff_match_patch=ne;Ss.exports.DIFF_DELETE=Xe;Ss.exports.DIFF_INSERT=tt;Ss.exports.DIFF_EQUAL=$e});var jg=Sc((ID,Wg)=>{var Vg=require("url").parse,pS=require("events"),mS=require("https"),hS=require("http"),gS=require("util"),yS=["pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","secureProtocol","servername","checkServerIdentity"],zg=[239,187,191],xS=58,bS=32,Hg=10,vS=13,qg=1024*256,wS=/^(cookie|authorization)$/i;function _S(o){return zg.every(function(e,t){return o[t]===e})}function dt(o,e){var t=dt.CONNECTING,r=e&&e.headers,n=!1;Object.defineProperty(this,"readyState",{get:function(){return t}}),Object.defineProperty(this,"url",{get:function(){return o}});var s=this;s.reconnectInterval=1e3,s.connectionInProgress=!1;function i(g){t!==dt.CLOSED&&(t=dt.CONNECTING,p("error",new Ci("error",{message:g})),d&&(o=d,d=null,n=!1),setTimeout(function(){t!==dt.CONNECTING||s.connectionInProgress||(s.connectionInProgress=!0,m())},s.reconnectInterval))}var a,l="";r&&r["Last-Event-ID"]&&(l=r["Last-Event-ID"],delete r["Last-Event-ID"]);var c=!1,f="",u="",d=null;function m(){var g=Vg(o),v=g.protocol==="https:";if(g.headers={"Cache-Control":"no-cache",Accept:"text/event-stream"},l&&(g.headers["Last-Event-ID"]=l),r){var C=n?kS(r):r;for(var L in C){var T=C[L];T&&(g.headers[L]=T)}}g.rejectUnauthorized=!(e&&!e.rejectUnauthorized),e&&e.createConnection!==void 0&&(g.createConnection=e.createConnection);var E=e&&e.proxy;if(E){var O=Vg(e.proxy);v=O.protocol==="https:",g.protocol=v?"https:":"http:",g.path=o,g.headers.Host=g.host,g.hostname=O.hostname,g.host=O.host,g.port=O.port}if(e&&e.https){for(var I in e.https)if(yS.indexOf(I)!==-1){var A=e.https[I];A!==void 0&&(g[I]=A)}}e&&e.withCredentials!==void 0&&(g.withCredentials=e.withCredentials),a=(v?mS:hS).request(g,function(U){if(s.connectionInProgress=!1,U.statusCode===500||U.statusCode===502||U.statusCode===503||U.statusCode===504){p("error",new Ci("error",{status:U.statusCode,message:U.statusMessage})),i();return}if(U.statusCode===301||U.statusCode===302||U.statusCode===307){var W=U.headers.location;if(!W){p("error",new Ci("error",{status:U.statusCode,message:U.statusMessage}));return}var J=new URL(o).origin,H=new URL(W).origin;n=J!==H,U.statusCode===307&&(d=o),o=W,process.nextTick(m);return}if(U.statusCode!==200)return p("error",new Ci("error",{status:U.statusCode,message:U.statusMessage})),s.close();t=dt.OPEN,U.on("close",function(){U.removeAllListeners("close"),U.removeAllListeners("end"),i()}),U.on("end",function(){U.removeAllListeners("close"),U.removeAllListeners("end"),i()}),p("open",new Ci("open"));var P,V,fe=0,de=-1,le=0,ee=0;U.on("data",function(re){P?(re.length>P.length-ee&&(le=P.length*2+re.length,le>qg&&(le=P.length+re.length+qg),V=Buffer.alloc(le),P.copy(V,0,0,ee),P=V),re.copy(P,ee),ee+=re.length):(P=re,_S(P)&&(P=P.slice(zg.length)),ee=P.length);for(var $=0,N=ee;$<N;){c&&(P[$]===Hg&&++$,c=!1);for(var pe=-1,Q=de,Ie,Ue=fe;pe<0&&Ue<N;++Ue)Ie=P[Ue],Ie===xS?Q<0&&(Q=Ue-$):Ie===vS?(c=!0,pe=Ue-$):Ie===Hg&&(pe=Ue-$);if(pe<0){fe=N-$,de=Q;break}else fe=0,de=-1;y(P,$,Q,pe),$+=pe+1}$===N?(P=void 0,ee=0):$>0&&(P=P.slice($,ee),ee=P.length)})}),a.on("error",function(U){s.connectionInProgress=!1,i(U.message)}),a.setNoDelay&&a.setNoDelay(!0),a.end()}m();function p(){s.listeners(arguments[0]).length>0&&s.emit.apply(s,arguments)}this._close=function(){t!==dt.CLOSED&&(t=dt.CLOSED,a.abort&&a.abort(),a.xhr&&a.xhr.abort&&a.xhr.abort())};function y(g,v,C,L){if(L===0){if(f.length>0){var T=u||"message";p(T,new SS(T,{data:f.slice(0,-1),lastEventId:l,origin:new URL(o).origin})),f=""}u=void 0}else if(C>0){var E=C<0,O=0,I=g.slice(v,v+(E?L:C)).toString();E?O=L:g[v+C+1]!==bS?O=C+1:O=C+2,v+=O;var A=L-O,U=g.slice(v,v+A).toString();if(I==="data")f+=U+`
`;else if(I==="event")u=U;else if(I==="id")l=U;else if(I==="retry"){var W=parseInt(U,10);Number.isNaN(W)||(s.reconnectInterval=W)}}}}Wg.exports=dt;gS.inherits(dt,pS.EventEmitter);dt.prototype.constructor=dt;["open","error","message"].forEach(function(o){Object.defineProperty(dt.prototype,"on"+o,{get:function(){var t=this.listeners(o)[0];return t?t._listener?t._listener:t:void 0},set:function(t){this.removeAllListeners(o),this.addEventListener(o,t)}})});Object.defineProperty(dt,"CONNECTING",{enumerable:!0,value:0});Object.defineProperty(dt,"OPEN",{enumerable:!0,value:1});Object.defineProperty(dt,"CLOSED",{enumerable:!0,value:2});dt.prototype.CONNECTING=0;dt.prototype.OPEN=1;dt.prototype.CLOSED=2;dt.prototype.close=function(){this._close()};dt.prototype.addEventListener=function(e,t){typeof t=="function"&&(t._listener=t,this.on(e,t))};dt.prototype.dispatchEvent=function(e){if(!e.type)throw new Error("UNSPECIFIED_EVENT_TYPE_ERR");this.emit(e.type,e.detail)};dt.prototype.removeEventListener=function(e,t){typeof t=="function"&&(t._listener=void 0,this.removeListener(e,t))};function Ci(o,e){if(Object.defineProperty(this,"type",{writable:!1,value:o,enumerable:!0}),e)for(var t in e)e.hasOwnProperty(t)&&Object.defineProperty(this,t,{writable:!1,value:e[t],enumerable:!0})}function SS(o,e){Object.defineProperty(this,"type",{writable:!1,value:o,enumerable:!0});for(var t in e)e.hasOwnProperty(t)&&Object.defineProperty(this,t,{writable:!1,value:e[t],enumerable:!0})}function kS(o){var e={};for(var t in o)wS.test(t)||(e[t]=o[t]);return e}});var jM={};kc(jM,{default:()=>vc});module.exports=Pw(jM);var Ke=require("obsidian"),vw=require("obsidian"),ww=zn(Qs());var je=require("obsidian");var St=()=>new Map,Qi=o=>{let e=St();return o.forEach((t,r)=>{e.set(r,t)}),e},Ar=(o,e,t)=>{let r=o.get(e);return r===void 0&&o.set(e,r=t()),r},mm=(o,e)=>{let t=[];for(let[r,n]of o)t.push(e(n,r));return t},hm=(o,e)=>{for(let[t,r]of o)if(e(r,t))return!0;return!1};var Wr=()=>new Set;var Zi=o=>o[o.length-1];var gm=(o,e)=>{for(let t=0;t<e.length;t++)o.push(e[t])},Mr=Array.from;var Cc=Array.isArray;var Xi=class{constructor(){this._observers=St()}on(e,t){return Ar(this._observers,e,Wr).add(t),t}once(e,t){let r=(...n)=>{this.off(e,r),t(...n)};this.on(e,r)}off(e,t){let r=this._observers.get(e);r!==void 0&&(r.delete(t),r.size===0&&this._observers.delete(e))}emit(e,t){return Mr((this._observers.get(e)||St()).values()).forEach(r=>r(...t))}destroy(){this._observers=St()}},jn=class{constructor(){this._observers=St()}on(e,t){Ar(this._observers,e,Wr).add(t)}once(e,t){let r=(...n)=>{this.off(e,r),t(...n)};this.on(e,r)}off(e,t){let r=this._observers.get(e);r!==void 0&&(r.delete(t),r.size===0&&this._observers.delete(e))}emit(e,t){return Mr((this._observers.get(e)||St()).values()).forEach(r=>r(...t))}destroy(){this._observers=St()}};var Jt=Math.floor;var Kn=Math.abs;var Gn=(o,e)=>o<e?o:e,Er=(o,e)=>o>e?o:e,YM=Number.isNaN;var ea=o=>o!==0?o<0:1/o<0;var Tc=Number.MAX_SAFE_INTEGER,QM=Number.MIN_SAFE_INTEGER,ZM=1<<31;var ym=Number.isInteger||(o=>typeof o=="number"&&isFinite(o)&&Jt(o)===o),XM=Number.isNaN,eE=Number.parseInt;var Fw=String.fromCharCode,tE=String.fromCodePoint,rE=Fw(65535),Rw=o=>o.toLowerCase(),Uw=/^\s*/g,Ow=o=>o.replace(Uw,""),$w=/([A-Z])/g,Ac=(o,e)=>Ow(o.replace($w,t=>`${e}${Rw(t)}`));var Nw=o=>{let e=unescape(encodeURIComponent(o)),t=e.length,r=new Uint8Array(t);for(let n=0;n<t;n++)r[n]=e.codePointAt(n);return r},Qn=typeof TextEncoder!="undefined"?new TextEncoder:null,Bw=o=>Qn.encode(o),bm=Qn?Bw:Nw;var Yn=typeof TextDecoder=="undefined"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Yn&&Yn.decode(new Uint8Array).length===1&&(Yn=null);var dn=class{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}},mn=()=>new dn;var Vw=o=>{let e=o.cpos;for(let t=0;t<o.bufs.length;t++)e+=o.bufs[t].length;return e};var sr=o=>{let e=new Uint8Array(Vw(o)),t=0;for(let r=0;r<o.bufs.length;r++){let n=o.bufs[r];e.set(n,t),t+=n.length}return e.set(new Uint8Array(o.cbuf.buffer,0,o.cpos),t),e},Hw=(o,e)=>{let t=o.cbuf.length;t-o.cpos<e&&(o.bufs.push(new Uint8Array(o.cbuf.buffer,0,o.cpos)),o.cbuf=new Uint8Array(Er(t,e)*2),o.cpos=0)},kt=(o,e)=>{let t=o.cbuf.length;o.cpos===t&&(o.bufs.push(o.cbuf),o.cbuf=new Uint8Array(t*2),o.cpos=0),o.cbuf[o.cpos++]=e};var ra=kt;var De=(o,e)=>{for(;e>127;)kt(o,128|127&e),e=Jt(e/128);kt(o,127&e)},oa=(o,e)=>{let t=ea(e);for(t&&(e=-e),kt(o,(e>63?128:0)|(t?64:0)|63&e),e=Jt(e/64);e>0;)kt(o,(e>127?128:0)|127&e),e=Jt(e/128)},Ec=new Uint8Array(3e4),qw=Ec.length/3,zw=(o,e)=>{if(e.length<qw){let t=Qn.encodeInto(e,Ec).written||0;De(o,t);for(let r=0;r<t;r++)kt(o,Ec[r])}else It(o,bm(e))},Ww=(o,e)=>{let t=unescape(encodeURIComponent(e)),r=t.length;De(o,r);for(let n=0;n<r;n++)kt(o,t.codePointAt(n))},co=Qn&&Qn.encodeInto?zw:Ww;var ei=(o,e)=>{let t=o.cbuf.length,r=o.cpos,n=Gn(t-r,e.length),s=e.length-n;o.cbuf.set(e.subarray(0,n),r),o.cpos+=n,s>0&&(o.bufs.push(o.cbuf),o.cbuf=new Uint8Array(Er(t*2,s)),o.cbuf.set(e.subarray(n)),o.cpos=s)},It=(o,e)=>{De(o,e.byteLength),ei(o,e)},Pc=(o,e)=>{Hw(o,e);let t=new DataView(o.cbuf.buffer,o.cpos,e);return o.cpos+=e,t},jw=(o,e)=>Pc(o,4).setFloat32(0,e,!1),Kw=(o,e)=>Pc(o,8).setFloat64(0,e,!1),Gw=(o,e)=>Pc(o,8).setBigInt64(0,e,!1);var wm=new DataView(new ArrayBuffer(4)),Jw=o=>(wm.setFloat32(0,o),wm.getFloat32(0)===o),Xn=(o,e)=>{switch(typeof e){case"string":kt(o,119),co(o,e);break;case"number":ym(e)&&Kn(e)<=2147483647?(kt(o,125),oa(o,e)):Jw(e)?(kt(o,124),jw(o,e)):(kt(o,123),Kw(o,e));break;case"bigint":kt(o,122),Gw(o,e);break;case"object":if(e===null)kt(o,126);else if(Cc(e)){kt(o,117),De(o,e.length);for(let t=0;t<e.length;t++)Xn(o,e[t])}else if(e instanceof Uint8Array)kt(o,116),It(o,e);else{kt(o,118);let t=Object.keys(e);De(o,t.length);for(let r=0;r<t.length;r++){let n=t[r];co(o,n),Xn(o,e[n])}}break;case"boolean":kt(o,e?120:121);break;default:kt(o,127)}},Xs=class extends dn{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&De(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}};var _m=o=>{o.count>0&&(oa(o.encoder,o.count===1?o.s:-o.s),o.count>1&&De(o.encoder,o.count-2))},pn=class{constructor(){this.encoder=new dn,this.s=0,this.count=0}write(e){this.s===e?this.count++:(_m(this),this.count=1,this.s=e)}toUint8Array(){return _m(this),sr(this.encoder)}};var Sm=o=>{if(o.count>0){let e=o.diff*2+(o.count===1?0:1);oa(o.encoder,e),o.count>1&&De(o.encoder,o.count-2)}},es=class{constructor(){this.encoder=new dn,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(Sm(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return Sm(this),sr(this.encoder)}},ta=class{constructor(){this.sarr=[],this.s="",this.lensE=new pn}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){let e=new dn;return this.sarr.push(this.s),this.s="",co(e,this.sarr.join("")),ei(e,this.lensE.toUint8Array()),sr(e)}};var mr=o=>new Error(o),Pr=()=>{throw mr("Method unimplemented")},hr=()=>{throw mr("Unexpected case")};var km=mr("Unexpected end of array"),Im=mr("Integer out of Range"),ts=class{constructor(e){this.arr=e,this.pos=0}},Fr=o=>new ts(o),Cm=o=>o.pos!==o.arr.length;var Yw=(o,e)=>{let t=new Uint8Array(o.arr.buffer,o.pos+o.arr.byteOffset,e);return o.pos+=e,t},Mt=o=>Yw(o,Le(o));var hn=o=>o.arr[o.pos++];var Le=o=>{let e=0,t=1,r=o.arr.length;for(;o.pos<r;){let n=o.arr[o.pos++];if(e=e+(n&127)*t,t*=128,n<128)return e;if(e>Tc)throw Im}throw km},sa=o=>{let e=o.arr[o.pos++],t=e&63,r=64,n=(e&64)>0?-1:1;if(!(e&128))return n*t;let s=o.arr.length;for(;o.pos<s;){if(e=o.arr[o.pos++],t=t+(e&127)*r,r*=128,e<128)return n*t;if(t>Tc)throw Im}throw km};var Qw=o=>{let e=Le(o);if(e===0)return"";{let t=String.fromCodePoint(hn(o));if(--e<100)for(;e--;)t+=String.fromCodePoint(hn(o));else for(;e>0;){let r=e<1e4?e:1e4,n=o.arr.subarray(o.pos,o.pos+r);o.pos+=r,t+=String.fromCodePoint.apply(null,n),e-=r}return decodeURIComponent(escape(t))}},Zw=o=>Yn.decode(Mt(o)),Dr=Yn?Zw:Qw;var Rc=(o,e)=>{let t=new DataView(o.arr.buffer,o.arr.byteOffset+o.pos,e);return o.pos+=e,t},Xw=o=>Rc(o,4).getFloat32(0,!1),e_=o=>Rc(o,8).getFloat64(0,!1),t_=o=>Rc(o,8).getBigInt64(0,!1);var r_=[o=>{},o=>null,sa,Xw,e_,t_,o=>!1,o=>!0,Dr,o=>{let e=Le(o),t={};for(let r=0;r<e;r++){let n=Dr(o);t[n]=rs(o)}return t},o=>{let e=Le(o),t=[];for(let r=0;r<e;r++)t.push(rs(o));return t},Mt],rs=o=>r_[127-hn(o)](o),ti=class extends ts{constructor(e,t){super(e),this.reader=t,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),Cm(this)?this.count=Le(this)+1:this.count=-1),this.count--,this.s}};var gn=class extends ts{constructor(e){super(e),this.s=0,this.count=0}read(){if(this.count===0){this.s=sa(this);let e=ea(this.s);this.count=1,e&&(this.s=-this.s,this.count=Le(this)+2)}return this.count--,this.s}};var os=class extends ts{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){let e=sa(this),t=e&1;this.diff=Jt(e/2),this.count=1,t&&(this.count=Le(this)+2)}return this.s+=this.diff,this.count--,this.s}},na=class{constructor(e){this.decoder=new gn(e),this.str=Dr(this.decoder),this.spos=0}read(){let e=this.spos+this.decoder.read(),t=this.str.slice(this.spos,e);return this.spos=e,t}};var sE=crypto.subtle,Lm=crypto.getRandomValues.bind(crypto);var ri=()=>Lm(new Uint32Array(1))[0];var o_=[1e7]+-1e3+-4e3+-8e3+-1e11,ns=()=>o_.replace(/[018]/g,o=>(o^ri()&15>>o/4).toString(16));var yn=Date.now;var fo=o=>new Promise(o);var n_=Promise.all.bind(Promise);var Oc=o=>o===void 0?null:o;var $c=class{constructor(){this.map=new Map}setItem(e,t){this.map.set(e,t)}getItem(e){return this.map.get(e)}},Mm=new $c,i_=!0;try{typeof localStorage!="undefined"&&localStorage&&(Mm=localStorage,i_=!1)}catch(o){}var Em=Mm;var Pm=Object.assign,l_=Object.keys,Dm=(o,e)=>{for(let t in o)e(o[t],t)};var oi=o=>l_(o).length;var Fm=o=>{for(let e in o)return!1;return!0},c_=(o,e)=>{for(let t in o)if(!e(o[t],t))return!1;return!0},Nc=(o,e)=>Object.prototype.hasOwnProperty.call(o,e),Bc=(o,e)=>o===e||oi(o)===oi(e)&&c_(o,(t,r)=>(t!==void 0||Nc(e,r))&&e[r]===t);var ni=(o,e,t=0)=>{try{for(;t<o.length;t++)o[t](...e)}finally{t<o.length&&ni(o,e,t+1)}};var Um=o=>o,f_=(o,e)=>o===e;var ss=(o,e)=>{if(o==null||e==null)return f_(o,e);if(o.constructor!==e.constructor)return!1;if(o===e)return!0;switch(o.constructor){case ArrayBuffer:o=new Uint8Array(o),e=new Uint8Array(e);case Uint8Array:{if(o.byteLength!==e.byteLength)return!1;for(let t=0;t<o.length;t++)if(o[t]!==e[t])return!1;break}case Set:{if(o.size!==e.size)return!1;for(let t of o)if(!e.has(t))return!1;break}case Map:{if(o.size!==e.size)return!1;for(let t of o.keys())if(!e.has(t)||!ss(o.get(t),e.get(t)))return!1;break}case Object:if(oi(o)!==oi(e))return!1;for(let t in o)if(!Nc(o,t)||!ss(o[t],e[t]))return!1;break;case Array:if(o.length!==e.length)return!1;for(let t=0;t<o.length;t++)if(!ss(o[t],e[t]))return!1;break;default:return!1}return!0},Om=(o,e)=>e.includes(o);var si=typeof process!="undefined"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process!="undefined"?process:0)==="[object process]";var lE=typeof navigator!="undefined"?/Mac/.test(navigator.platform):!1,jr,u_=[],d_=()=>{if(jr===void 0)if(si){jr=St();let o=process.argv,e=null;for(let t=0;t<o.length;t++){let r=o[t];r[0]==="-"?(e!==null&&jr.set(e,""),e=r):e!==null?(jr.set(e,r),e=null):u_.push(r)}e!==null&&jr.set(e,"")}else typeof location=="object"?(jr=St(),(location.search||"?").slice(1).split("&").forEach(o=>{if(o.length!==0){let[e,t]=o.split("=");jr.set(`--${Ac(e,"-")}`,t),jr.set(`-${Ac(e,"-")}`,t)}})):jr=St();return jr},Hc=o=>d_().has(o);var qc=o=>si?Oc(process.env[o.toUpperCase().replaceAll("-","_")]):Oc(Em.getItem(o));var p_=o=>Hc("--"+o)||qc(o)!==null,cE=p_("production"),$m=si&&Om(process.env.FORCE_COLOR,["true","1","2"]),Nm=!Hc("no-colors")&&(!si||process.stdout.isTTY||$m)&&(!si||Hc("color")||$m||qc("COLORTERM")!==null||(qc("TERM")||"").includes("color"));var h_=o=>new Uint8Array(o);var Bm=o=>{let e=h_(o.byteLength);return e.set(o),e};var zc=class{constructor(e,t){this.left=e,this.right=t}},Nt=(o,e)=>new zc(o,e);var Vm=(o,e)=>o.forEach(t=>e(t.left,t.right));var Kr=typeof document!="undefined"?document:{},y_=o=>Kr.createElement(o),x_=()=>Kr.createDocumentFragment(),b_=o=>Kr.createTextNode(o),fE=typeof DOMParser!="undefined"?new DOMParser:null;var v_=(o,e)=>(Vm(e,(t,r)=>{r===!1?o.removeAttribute(t):r===!0?o.setAttribute(t,""):o.setAttribute(t,r)}),o);var w_=o=>{let e=x_();for(let t=0;t<o.length;t++)zm(e,o[t]);return e},Hm=(o,e)=>(zm(o,w_(e)),o);var ii=(o,e=[],t=[])=>Hm(v_(y_(o),e),t);var is=b_;var qm=o=>mm(o,(e,t)=>`${t}:${e};`).join("");var zm=(o,e)=>o.appendChild(e),uE=Kr.ELEMENT_NODE,dE=Kr.TEXT_NODE,pE=Kr.CDATA_SECTION_NODE,mE=Kr.COMMENT_NODE,hE=Kr.DOCUMENT_NODE,gE=Kr.DOCUMENT_TYPE_NODE,yE=Kr.DOCUMENT_FRAGMENT_NODE;var Gr=Symbol;var ai=Gr(),li=Gr(),jc=Gr(),Kc=Gr(),Gc=Gr(),ci=Gr(),Jc=Gr(),fi=Gr(),Yc=Gr(),jm=o=>{var n;o.length===1&&((n=o[0])==null?void 0:n.constructor)===Function&&(o=o[0]());let e=[],t=[],r=0;for(;r<o.length;r++){let s=o[r];s===void 0?e.push("undefined"):s.constructor===String||s.constructor===Number?e.push(s):s.constructor===Object&&t.push(JSON.stringify(s))}return t};var xE=yn();var k_={[ai]:Nt("font-weight","bold"),[li]:Nt("font-weight","normal"),[jc]:Nt("color","blue"),[Gc]:Nt("color","green"),[Kc]:Nt("color","grey"),[ci]:Nt("color","red"),[Jc]:Nt("color","purple"),[fi]:Nt("color","orange"),[Yc]:Nt("color","black")},I_=o=>{var i;o.length===1&&((i=o[0])==null?void 0:i.constructor)===Function&&(o=o[0]());let e=[],t=[],r=St(),n=[],s=0;for(;s<o.length;s++){let a=o[s],l=k_[a];if(l!==void 0)r.set(l.left,l.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){let c=qm(r);s>0||c.length>0?(e.push("%c"+a),t.push(c)):e.push(a)}else break}}for(s>0&&(n=t,n.unshift(e.join("")));s<o.length;s++){let a=o[s];a instanceof Symbol||n.push(a)}return n},C_=Nm?I_:jm,Km=(...o)=>{console.log(...C_(o)),L_.forEach(e=>e.print(o))};var L_=Wr();var Gm=o=>({[Symbol.iterator](){return this},next:o}),Jm=(o,e)=>Gm(()=>{let t;do t=o.next();while(!t.done&&!e(t.value));return t}),aa=(o,e)=>Gm(()=>{let{done:t,value:r}=o.next();return{done:t,value:t?void 0:e(r)}});var di=class{constructor(e,t){this.clock=e,this.len=t}},xn=class{constructor(){this.clients=new Map}},fh=(o,e,t)=>e.clients.forEach((r,n)=>{let s=o.doc.store.clients.get(n);for(let i=0;i<r.length;i++){let a=r[i];bh(o,s,a.clock,a.len,t)}}),P_=(o,e)=>{let t=0,r=o.length-1;for(;t<=r;){let n=Jt((t+r)/2),s=o[n],i=s.clock;if(i<=e){if(e<i+s.len)return n;t=n+1}else r=n-1}return null},pf=(o,e)=>{let t=o.clients.get(e.client);return t!==void 0&&P_(t,e.clock)!==null},mf=o=>{o.clients.forEach(e=>{e.sort((n,s)=>n.clock-s.clock);let t,r;for(t=1,r=1;t<e.length;t++){let n=e[r-1],s=e[t];n.clock+n.len>=s.clock?n.len=Er(n.len,s.clock+s.len-n.clock):(r<t&&(e[r]=s),r++)}e.length=r})},Zc=o=>{let e=new xn;for(let t=0;t<o.length;t++)o[t].clients.forEach((r,n)=>{if(!e.clients.has(n)){let s=r.slice();for(let i=t+1;i<o.length;i++)gm(s,o[i].clients.get(n)||[]);e.clients.set(n,s)}});return mf(e),e},ma=(o,e,t,r)=>{Ar(o.clients,e,()=>[]).push(new di(t,r))},hf=()=>new xn,D_=o=>{let e=hf();return o.clients.forEach((t,r)=>{let n=[];for(let s=0;s<t.length;s++){let i=t[s];if(i.deleted){let a=i.id.clock,l=i.length;if(s+1<t.length)for(let c=t[s+1];s+1<t.length&&c.deleted;c=t[++s+1])l+=c.length;n.push(new di(a,l))}}n.length>0&&e.clients.set(r,n)}),e},Bo=(o,e)=>{De(o.restEncoder,e.clients.size),Mr(e.clients.entries()).sort((t,r)=>r[0]-t[0]).forEach(([t,r])=>{o.resetDsCurVal(),De(o.restEncoder,t);let n=r.length;De(o.restEncoder,n);for(let s=0;s<n;s++){let i=r[s];o.writeDsClock(i.clock),o.writeDsLen(i.len)}})},pi=o=>{let e=new xn,t=Le(o.restDecoder);for(let r=0;r<t;r++){o.resetDsCurVal();let n=Le(o.restDecoder),s=Le(o.restDecoder);if(s>0){let i=Ar(e.clients,n,()=>[]);for(let a=0;a<s;a++)i.push(new di(o.readDsClock(),o.readDsLen()))}}return e},Zm=(o,e,t)=>{let r=new xn,n=Le(o.restDecoder);for(let s=0;s<n;s++){o.resetDsCurVal();let i=Le(o.restDecoder),a=Le(o.restDecoder),l=t.clients.get(i)||[],c=gt(t,i);for(let f=0;f<a;f++){let u=o.readDsClock(),d=u+o.readDsLen();if(u<c){c<d&&ma(r,i,c,d-c);let m=Yr(l,u),p=l[m];for(!p.deleted&&p.id.clock<u&&(l.splice(m+1,0,Sa(e,p,u-p.id.clock)),m++);m<l.length&&(p=l[m++],p.id.clock<d);)p.deleted||(d<p.id.clock+p.length&&l.splice(m,0,Sa(e,p,d-p.id.clock)),p.delete(e))}else ma(r,i,u,d-u)}}if(r.clients.size>0){let s=new uo;return De(s.restEncoder,0),Bo(s,r),s.toUint8Array()}return null};var uh=ri,ir=class extends Xi{constructor({guid:e=ns(),collectionid:t=null,gc:r=!0,gcFilter:n=()=>!0,meta:s=null,autoLoad:i=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=n,this.clientID=uh(),this.guid=e,this.collectionid=t,this.share=new Map,this.store=new ba,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=i,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.whenLoaded=fo(c=>{this.on("load",()=>{this.isLoaded=!0,c(this)})});let l=()=>fo(c=>{let f=u=>{(u===void 0||u===!0)&&(this.off("sync",f),c())};this.on("sync",f)});this.on("sync",c=>{c===!1&&this.isSynced&&(this.whenSynced=l()),this.isSynced=c===void 0||c===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=l()}load(){let e=this._item;e!==null&&!this.shouldLoad&&Ge(e.parent.doc,t=>{t.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(Mr(this.subdocs).map(e=>e.guid))}transact(e,t=null){return Ge(this,e,t)}get(e,t=_t){let r=Ar(this.share,e,()=>{let s=new t;return s._integrate(this,null),s}),n=r.constructor;if(t!==_t&&n!==t)if(n===_t){let s=new t;s._map=r._map,r._map.forEach(i=>{for(;i!==null;i=i.left)i.parent=s}),s._start=r._start;for(let i=s._start;i!==null;i=i.right)i.parent=s;return s._length=r._length,this.share.set(e,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,Jr)}getText(e=""){return this.get(e,qo)}getMap(e=""){return this.get(e,po)}getXmlElement(e=""){return this.get(e,zo)}getXmlFragment(e=""){return this.get(e,mo)}toJSON(){let e={};return this.share.forEach((t,r)=>{e[r]=t.toJSON()}),e}destroy(){Mr(this.subdocs).forEach(t=>t.destroy());let e=this._item;if(e!==null){this._item=null;let t=e.content;t.doc=new ir({guid:this.guid,...t.opts,shouldLoad:!1}),t.doc._item=e,Ge(e.parent.doc,r=>{let n=t.doc;e.deleted||r.subdocsAdded.add(n),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}},cs=class{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return Le(this.restDecoder)}readDsLen(){return Le(this.restDecoder)}},ha=class extends cs{readLeftID(){return Be(Le(this.restDecoder),Le(this.restDecoder))}readRightID(){return Be(Le(this.restDecoder),Le(this.restDecoder))}readClient(){return Le(this.restDecoder)}readInfo(){return hn(this.restDecoder)}readString(){return Dr(this.restDecoder)}readParentInfo(){return Le(this.restDecoder)===1}readTypeRef(){return Le(this.restDecoder)}readLen(){return Le(this.restDecoder)}readAny(){return rs(this.restDecoder)}readBuf(){return Bm(Mt(this.restDecoder))}readJSON(){return JSON.parse(Dr(this.restDecoder))}readKey(){return Dr(this.restDecoder)}},Xc=class{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=Le(this.restDecoder),this.dsCurrVal}readDsLen(){let e=Le(this.restDecoder)+1;return this.dsCurrVal+=e,e}},Vo=class extends Xc{constructor(e){super(e),this.keys=[],Le(e),this.keyClockDecoder=new os(Mt(e)),this.clientDecoder=new gn(Mt(e)),this.leftClockDecoder=new os(Mt(e)),this.rightClockDecoder=new os(Mt(e)),this.infoDecoder=new ti(Mt(e),hn),this.stringDecoder=new na(Mt(e)),this.parentInfoDecoder=new ti(Mt(e),hn),this.typeRefDecoder=new gn(Mt(e)),this.lenDecoder=new gn(Mt(e))}readLeftID(){return new No(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new No(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return rs(this.restDecoder)}readBuf(){return Mt(this.restDecoder)}readJSON(){return rs(this.restDecoder)}readKey(){let e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{let t=this.stringDecoder.read();return this.keys.push(t),t}}},fs=class{constructor(){this.restEncoder=mn()}toUint8Array(){return sr(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){De(this.restEncoder,e)}writeDsLen(e){De(this.restEncoder,e)}},bn=class extends fs{writeLeftID(e){De(this.restEncoder,e.client),De(this.restEncoder,e.clock)}writeRightID(e){De(this.restEncoder,e.client),De(this.restEncoder,e.clock)}writeClient(e){De(this.restEncoder,e)}writeInfo(e){ra(this.restEncoder,e)}writeString(e){co(this.restEncoder,e)}writeParentInfo(e){De(this.restEncoder,e?1:0)}writeTypeRef(e){De(this.restEncoder,e)}writeLen(e){De(this.restEncoder,e)}writeAny(e){Xn(this.restEncoder,e)}writeBuf(e){It(this.restEncoder,e)}writeJSON(e){co(this.restEncoder,JSON.stringify(e))}writeKey(e){co(this.restEncoder,e)}},ga=class{constructor(){this.restEncoder=mn(),this.dsCurrVal=0}toUint8Array(){return sr(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){let t=e-this.dsCurrVal;this.dsCurrVal=e,De(this.restEncoder,t)}writeDsLen(e){e===0&&hr(),De(this.restEncoder,e-1),this.dsCurrVal+=e}},uo=class extends ga{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new es,this.clientEncoder=new pn,this.leftClockEncoder=new es,this.rightClockEncoder=new es,this.infoEncoder=new Xs(ra),this.stringEncoder=new ta,this.parentInfoEncoder=new Xs(ra),this.typeRefEncoder=new pn,this.lenEncoder=new pn}toUint8Array(){let e=mn();return De(e,0),It(e,this.keyClockEncoder.toUint8Array()),It(e,this.clientEncoder.toUint8Array()),It(e,this.leftClockEncoder.toUint8Array()),It(e,this.rightClockEncoder.toUint8Array()),It(e,sr(this.infoEncoder)),It(e,this.stringEncoder.toUint8Array()),It(e,sr(this.parentInfoEncoder)),It(e,this.typeRefEncoder.toUint8Array()),It(e,this.lenEncoder.toUint8Array()),ei(e,sr(this.restEncoder)),sr(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){Xn(this.restEncoder,e)}writeBuf(e){It(this.restEncoder,e)}writeJSON(e){Xn(this.restEncoder,e)}writeKey(e){let t=this.keyMap.get(e);t===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(t)}},F_=(o,e,t,r)=>{r=Er(r,e[0].id.clock);let n=Yr(e,r);De(o.restEncoder,e.length-n),o.writeClient(t),De(o.restEncoder,r);let s=e[n];s.write(o,r-s.id.clock);for(let i=n+1;i<e.length;i++)e[i].write(o,0)},gf=(o,e,t)=>{let r=new Map;t.forEach((n,s)=>{gt(e,s)>n&&r.set(s,n)}),ka(e).forEach((n,s)=>{t.has(s)||r.set(s,0)}),De(o.restEncoder,r.size),Mr(r.entries()).sort((n,s)=>s[0]-n[0]).forEach(([n,s])=>{F_(o,e.clients.get(n),n,s)})},R_=(o,e)=>{let t=St(),r=Le(o.restDecoder);for(let n=0;n<r;n++){let s=Le(o.restDecoder),i=new Array(s),a=o.readClient(),l=Le(o.restDecoder);t.set(a,{i:0,refs:i});for(let c=0;c<s;c++){let f=o.readInfo();switch(31&f){case 0:{let u=o.readLen();i[c]=new Yt(Be(a,l),u),l+=u;break}case 10:{let u=Le(o.restDecoder);i[c]=new Qt(Be(a,l),u),l+=u;break}default:{let u=(f&192)===0,d=new it(Be(a,l),null,(f&128)===128?o.readLeftID():null,null,(f&64)===64?o.readRightID():null,u?o.readParentInfo()?e.get(o.readString()):o.readLeftID():null,u&&(f&32)===32?o.readString():null,$h(o,f));i[c]=d,l+=d.length}}}}return t},U_=(o,e,t)=>{let r=[],n=Mr(t.keys()).sort((m,p)=>m-p);if(n.length===0)return null;let s=()=>{if(n.length===0)return null;let m=t.get(n[n.length-1]);for(;m.refs.length===m.i;)if(n.pop(),n.length>0)m=t.get(n[n.length-1]);else return null;return m},i=s();if(i===null)return null;let a=new ba,l=new Map,c=(m,p)=>{let y=l.get(m);(y==null||y>p)&&l.set(m,p)},f=i.refs[i.i++],u=new Map,d=()=>{for(let m of r){let p=m.id.client,y=t.get(p);y?(y.i--,a.clients.set(p,y.refs.slice(y.i)),t.delete(p),y.i=0,y.refs=[]):a.clients.set(p,[m]),n=n.filter(g=>g!==p)}r.length=0};for(;;){if(f.constructor!==Qt){let p=Ar(u,f.id.client,()=>gt(e,f.id.client))-f.id.clock;if(p<0)r.push(f),c(f.id.client,f.id.clock-1),d();else{let y=f.getMissing(o,e);if(y!==null){r.push(f);let g=t.get(y)||{refs:[],i:0};if(g.refs.length===g.i)c(y,gt(e,y)),d();else{f=g.refs[g.i++];continue}}else(p===0||p<f.length)&&(f.integrate(o,p),u.set(f.id.client,f.id.clock+f.length))}}if(r.length>0)f=r.pop();else if(i!==null&&i.i<i.refs.length)f=i.refs[i.i++];else{if(i=s(),i===null)break;f=i.refs[i.i++]}}if(a.clients.size>0){let m=new uo;return gf(m,a,new Map),De(m.restEncoder,0),{missing:l,update:m.toUint8Array()}}return null},O_=(o,e)=>gf(o,e.doc.store,e.beforeState),$_=(o,e,t,r=new Vo(o))=>Ge(e,n=>{n.local=!1;let s=!1,i=n.doc,a=i.store,l=R_(r,i),c=U_(n,a,l),f=a.pendingStructs;if(f){for(let[d,m]of f.missing)if(m<gt(a,d)){s=!0;break}if(c){for(let[d,m]of c.missing){let p=f.missing.get(d);(p==null||p>m)&&f.missing.set(d,m)}f.update=va([f.update,c.update])}}else a.pendingStructs=c;let u=Zm(r,n,a);if(a.pendingDs){let d=new Vo(Fr(a.pendingDs));Le(d.restDecoder);let m=Zm(d,n,a);u&&m?a.pendingDs=va([u,m]):a.pendingDs=u||m}else a.pendingDs=u;if(s){let d=a.pendingStructs.update;a.pendingStructs=null,dh(n.doc,d)}},t,!1);var dh=(o,e,t,r=Vo)=>{let n=Fr(e);$_(n,o,t,new r(n))},xr=(o,e,t)=>dh(o,e,t,ha),N_=(o,e,t=new Map)=>{gf(o,e.store,t),Bo(o,D_(e.store))},B_=(o,e=new Uint8Array([0]),t=new uo)=>{let r=ph(e);N_(t,o,r);let n=[t.toUint8Array()];if(o.store.pendingDs&&n.push(o.store.pendingDs),o.store.pendingStructs&&n.push(X_(o.store.pendingStructs.update,e)),n.length>1){if(t.constructor===bn)return Q_(n.map((s,i)=>i===0?s:t1(s)));if(t.constructor===uo)return va(n)}return n[0]},Sn=(o,e)=>B_(o,e,new bn),V_=o=>{let e=new Map,t=Le(o.restDecoder);for(let r=0;r<t;r++){let n=Le(o.restDecoder),s=Le(o.restDecoder);e.set(n,s)}return e},ph=o=>V_(new cs(Fr(o))),mh=(o,e)=>(De(o.restEncoder,e.size),Mr(e.entries()).sort((t,r)=>r[0]-t[0]).forEach(([t,r])=>{De(o.restEncoder,t),De(o.restEncoder,r)}),o),H_=(o,e)=>mh(o,ka(e.store)),q_=(o,e=new ga)=>(o instanceof Map?mh(e,o):H_(e,o),e.toUint8Array()),hh=o=>q_(o,new fs),ef=class{constructor(){this.l=[]}},Xm=()=>new ef,eh=(o,e)=>o.l.push(e),th=(o,e)=>{let t=o.l,r=t.length;o.l=t.filter(n=>e!==n),r===o.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},gh=(o,e,t)=>ni(o.l,[e,t]),No=class{constructor(e,t){this.client=e,this.clock=t}},ls=(o,e)=>o===e||o!==null&&e!==null&&o.client===e.client&&o.clock===e.clock,Be=(o,e)=>new No(o,e);var yh=o=>{for(let[e,t]of o.doc.share.entries())if(t===o)return e;throw hr()};var ya=class{constructor(e,t=e.getMap("users")){let r=new Map;this.yusers=t,this.doc=e,this.clients=new Map,this.dss=r;let n=(s,i)=>{let a=s.get("ds"),l=s.get("ids"),c=f=>this.clients.set(f,i);a.observe(f=>{f.changes.added.forEach(u=>{u.content.getContent().forEach(d=>{d instanceof Uint8Array&&this.dss.set(i,Zc([this.dss.get(i)||hf(),pi(new cs(Fr(d)))]))})})}),this.dss.set(i,Zc(a.map(f=>pi(new cs(Fr(f)))))),l.observe(f=>f.changes.added.forEach(u=>u.content.getContent().forEach(c))),l.forEach(c)};t.observe(s=>{s.keysChanged.forEach(i=>n(t.get(i),i))}),t.forEach(n)}setUserMapping(e,t,r,{filter:n=()=>!0}={}){let s=this.yusers,i=s.get(r);i||(i=new po,i.set("ids",new Jr),i.set("ds",new Jr),s.set(r,i)),i.get("ids").push([t]),s.observe(a=>{setTimeout(()=>{let l=s.get(r);if(l!==i){i=l,this.clients.forEach((u,d)=>{r===u&&i.get("ids").push([d])});let c=new fs,f=this.dss.get(r);f&&(Bo(c,f),i.get("ds").push([c.toUint8Array()]))}},0)}),e.on("afterTransaction",a=>{setTimeout(()=>{let l=i.get("ds"),c=a.deleteSet;if(a.local&&c.clients.size>0&&n(a,c)){let f=new fs;Bo(f,c),l.push([f.toUint8Array()])}})})}getUserByClientId(e){return this.clients.get(e)||null}getUserByDeletedId(e){for(let[t,r]of this.dss.entries())if(pf(r,e))return t;return null}},xa=class{constructor(e,t,r,n=0){this.type=e,this.tname=t,this.item=r,this.assoc=n}};var yf=o=>new xa(o.type==null?null:Be(o.type.client,o.type.clock),o.tname||null,o.item==null?null:Be(o.item.client,o.item.clock),o.assoc==null?0:o.assoc),tf=class{constructor(e,t,r=0){this.type=e,this.index=t,this.assoc=r}},z_=(o,e,t=0)=>new tf(o,e,t),la=(o,e,t)=>{let r=null,n=null;return o._item===null?n=yh(o):r=Be(o._item.id.client,o._item.id.clock),new xa(r,n,e,t)},xf=(o,e,t=0)=>{let r=o._start;if(t<0){if(e===0)return la(o,null,t);e--}for(;r!==null;){if(!r.deleted&&r.countable){if(r.length>e)return la(o,Be(r.id.client,r.id.clock+e),t);e-=r.length}if(r.right===null&&t<0)return la(o,r.lastId,t);r=r.right}return la(o,null,t)};var bf=(o,e)=>{let t=e.store,r=o.item,n=o.type,s=o.tname,i=o.assoc,a=null,l=0;if(r!==null){if(gt(t,r.client)<=r.clock)return null;let c=ch(t,r),f=c.item;if(!(f instanceof it))return null;if(a=f.parent,a._item===null||!a._item.deleted){l=f.deleted||!f.countable?0:c.diff+(i>=0?0:1);let u=f.left;for(;u!==null;)!u.deleted&&u.countable&&(l+=u.length),u=u.left}}else{if(s!==null)a=e.get(s);else if(n!==null){if(gt(t,n.client)<=n.clock)return null;let{item:c}=ch(t,n);if(c instanceof it&&c.content instanceof yr)a=c.content.type;else return null}else throw hr();i>=0?l=a._length:l=0}return z_(a,l,o.assoc)},vf=(o,e)=>o===e||o!==null&&e!==null&&o.tname===e.tname&&ls(o.item,e.item)&&ls(o.type,e.type)&&o.assoc===e.assoc,rf=class{constructor(e,t){this.ds=e,this.sv=t}};var W_=(o,e)=>new rf(o,e),TE=W_(hf(),new Map);var as=(o,e)=>e===void 0?!o.deleted:e.sv.has(o.id.client)&&(e.sv.get(o.id.client)||0)>o.id.clock&&!pf(e.ds,o.id),of=(o,e)=>{let t=Ar(o.meta,of,Wr),r=o.doc.store;t.has(e)||(e.sv.forEach((n,s)=>{n<gt(r,s)&&Ho(o,Be(s,n))}),fh(o,e.ds,n=>{}),t.add(e))};var ba=class{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}},ka=o=>{let e=new Map;return o.clients.forEach((t,r)=>{let n=t[t.length-1];e.set(r,n.id.clock+n.length)}),e},gt=(o,e)=>{let t=o.clients.get(e);if(t===void 0)return 0;let r=t[t.length-1];return r.id.clock+r.length},xh=(o,e)=>{let t=o.clients.get(e.id.client);if(t===void 0)t=[],o.clients.set(e.id.client,t);else{let r=t[t.length-1];if(r.id.clock+r.length!==e.id.clock)throw hr()}t.push(e)},Yr=(o,e)=>{let t=0,r=o.length-1,n=o[r],s=n.id.clock;if(s===e)return r;let i=Jt(e/(s+n.length-1)*r);for(;t<=r;){if(n=o[i],s=n.id.clock,s<=e){if(e<s+n.length)return i;t=i+1}else r=i-1;i=Jt((t+r)/2)}throw hr()},j_=(o,e)=>{let t=o.clients.get(e.client);return t[Yr(t,e.clock)]},ua=j_,nf=(o,e,t)=>{let r=Yr(e,t),n=e[r];return n.id.clock<t&&n instanceof it?(e.splice(r+1,0,Sa(o,n,t-n.id.clock)),r+1):r},Ho=(o,e)=>{let t=o.doc.store.clients.get(e.client);return t[nf(o,t,e.clock)]},rh=(o,e,t)=>{let r=e.clients.get(t.client),n=Yr(r,t.clock),s=r[n];return t.clock!==s.id.clock+s.length-1&&s.constructor!==Yt&&r.splice(n+1,0,Sa(o,s,t.clock-s.id.clock+1)),s},K_=(o,e,t)=>{let r=o.clients.get(e.id.client);r[Yr(r,e.id.clock)]=t},bh=(o,e,t,r,n)=>{if(r===0)return;let s=t+r,i=nf(o,e,t),a;do a=e[i++],s<a.id.clock+a.length&&nf(o,e,s),n(a);while(i<e.length&&e[i].id.clock<s)},sf=class{constructor(e,t,r){this.doc=e,this.deleteSet=new xn,this.beforeState=ka(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=t,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}},oh=(o,e)=>e.deleteSet.clients.size===0&&!hm(e.afterState,(t,r)=>e.beforeState.get(r)!==t)?!1:(mf(e.deleteSet),O_(o,e),Bo(o,e.deleteSet),!0),nh=(o,e,t)=>{let r=e._item;(r===null||r.id.clock<(o.beforeState.get(r.id.client)||0)&&!r.deleted)&&Ar(o.changed,e,Wr).add(t)},da=(o,e)=>{let t=o[e],r=o[e-1],n=e;for(;n>0;t=r,r=o[--n-1]){if(r.deleted===t.deleted&&r.constructor===t.constructor&&r.mergeWith(t)){t instanceof it&&t.parentSub!==null&&t.parent._map.get(t.parentSub)===t&&t.parent._map.set(t.parentSub,r);continue}break}let s=e-n;return s&&o.splice(e+1-s,s),s},G_=(o,e,t)=>{for(let[r,n]of o.clients.entries()){let s=e.clients.get(r);for(let i=n.length-1;i>=0;i--){let a=n[i],l=a.clock+a.len;for(let c=Yr(s,a.clock),f=s[c];c<s.length&&f.id.clock<l;f=s[++c]){let u=s[c];if(a.clock+a.len<=u.id.clock)break;u instanceof it&&u.deleted&&!u.keep&&t(u)&&u.gc(e,!1)}}}},J_=(o,e)=>{o.clients.forEach((t,r)=>{let n=e.clients.get(r);for(let s=t.length-1;s>=0;s--){let i=t[s],a=Gn(n.length-1,1+Yr(n,i.clock+i.len-1));for(let l=a,c=n[l];l>0&&c.id.clock>=i.clock;c=n[l])l-=1+da(n,l)}})};var vh=(o,e)=>{if(e<o.length){let t=o[e],r=t.doc,n=r.store,s=t.deleteSet,i=t._mergeStructs;try{mf(s),t.afterState=ka(t.doc.store),r.emit("beforeObserverCalls",[t,r]);let a=[];t.changed.forEach((l,c)=>a.push(()=>{(c._item===null||!c._item.deleted)&&c._callObserver(t,l)})),a.push(()=>{t.changedParentTypes.forEach((l,c)=>{c._dEH.l.length>0&&(c._item===null||!c._item.deleted)&&(l=l.filter(f=>f.target._item===null||!f.target._item.deleted),l.forEach(f=>{f.currentTarget=c,f._path=null}),l.sort((f,u)=>f.path.length-u.path.length),gh(c._dEH,l,t))})}),a.push(()=>r.emit("afterTransaction",[t,r])),ni(a,[]),t._needFormattingCleanup&&d1(t)}finally{r.gc&&G_(s,n,r.gcFilter),J_(s,n),t.afterState.forEach((f,u)=>{let d=t.beforeState.get(u)||0;if(d!==f){let m=n.clients.get(u),p=Er(Yr(m,d),1);for(let y=m.length-1;y>=p;)y-=1+da(m,y)}});for(let f=i.length-1;f>=0;f--){let{client:u,clock:d}=i[f].id,m=n.clients.get(u),p=Yr(m,d);p+1<m.length&&da(m,p+1)>1||p>0&&da(m,p)}if(!t.local&&t.afterState.get(r.clientID)!==t.beforeState.get(r.clientID)&&(Km(fi,ai,"[yjs] ",li,ci,"Changed the client-id because another client seems to be using it."),r.clientID=uh()),r.emit("afterTransactionCleanup",[t,r]),r._observers.has("update")){let f=new bn;oh(f,t)&&r.emit("update",[f.toUint8Array(),t.origin,r,t])}if(r._observers.has("updateV2")){let f=new uo;oh(f,t)&&r.emit("updateV2",[f.toUint8Array(),t.origin,r,t])}let{subdocsAdded:a,subdocsLoaded:l,subdocsRemoved:c}=t;(a.size>0||c.size>0||l.size>0)&&(a.forEach(f=>{f.clientID=r.clientID,f.collectionid==null&&(f.collectionid=r.collectionid),r.subdocs.add(f)}),c.forEach(f=>r.subdocs.delete(f)),r.emit("subdocs",[{loaded:l,added:a,removed:c},r,t]),c.forEach(f=>f.destroy())),o.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,o])):vh(o,e+1)}}},Ge=(o,e,t=null,r=!0)=>{let n=o._transactionCleanups,s=!1,i=null;o._transaction===null&&(s=!0,o._transaction=new sf(o,t,r),n.push(o._transaction),n.length===1&&o.emit("beforeAllTransactions",[o]),o.emit("beforeTransaction",[o._transaction,o]));try{i=e(o._transaction)}finally{if(s){let a=o._transaction===n[0];o._transaction=null,a&&vh(n,0)}}return i};function*Y_(o){let e=Le(o.restDecoder);for(let t=0;t<e;t++){let r=Le(o.restDecoder),n=o.readClient(),s=Le(o.restDecoder);for(let i=0;i<r;i++){let a=o.readInfo();if(a===10){let l=Le(o.restDecoder);yield new Qt(Be(n,s),l),s+=l}else if(31&a){let l=(a&192)===0,c=new it(Be(n,s),null,(a&128)===128?o.readLeftID():null,null,(a&64)===64?o.readRightID():null,l?o.readParentInfo()?o.readString():o.readLeftID():null,l&&(a&32)===32?o.readString():null,$h(o,a));yield c,s+=c.length}else{let l=o.readLen();yield new Yt(Be(n,s),l),s+=l}}}}var mi=class{constructor(e,t){this.gen=Y_(e),this.curr=null,this.done=!1,this.filterSkips=t,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===Qt);return this.curr}};var hi=class{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}},Q_=o=>va(o,ha,bn);var Z_=(o,e)=>{if(o.constructor===Yt){let{client:t,clock:r}=o.id;return new Yt(Be(t,r+e),o.length-e)}else if(o.constructor===Qt){let{client:t,clock:r}=o.id;return new Qt(Be(t,r+e),o.length-e)}else{let t=o,{client:r,clock:n}=t.id;return new it(Be(r,n+e),null,Be(r,n+e-1),null,t.rightOrigin,t.parent,t.parentSub,t.content.splice(e))}},va=(o,e=Vo,t=uo)=>{if(o.length===1)return o[0];let r=o.map(f=>new e(Fr(f))),n=r.map(f=>new mi(f,!0)),s=null,i=new t,a=new hi(i);for(;n=n.filter(d=>d.curr!==null),n.sort((d,m)=>{if(d.curr.id.client===m.curr.id.client){let p=d.curr.id.clock-m.curr.id.clock;return p===0?d.curr.constructor===m.curr.constructor?0:d.curr.constructor===Qt?1:-1:p}else return m.curr.id.client-d.curr.id.client}),n.length!==0;){let f=n[0],u=f.curr.id.client;if(s!==null){let d=f.curr,m=!1;for(;d!==null&&d.id.clock+d.length<=s.struct.id.clock+s.struct.length&&d.id.client>=s.struct.id.client;)d=f.next(),m=!0;if(d===null||d.id.client!==u||m&&d.id.clock>s.struct.id.clock+s.struct.length)continue;if(u!==s.struct.id.client)Oo(a,s.struct,s.offset),s={struct:d,offset:0},f.next();else if(s.struct.id.clock+s.struct.length<d.id.clock)if(s.struct.constructor===Qt)s.struct.length=d.id.clock+d.length-s.struct.id.clock;else{Oo(a,s.struct,s.offset);let p=d.id.clock-s.struct.id.clock-s.struct.length;s={struct:new Qt(Be(u,s.struct.id.clock+s.struct.length),p),offset:0}}else{let p=s.struct.id.clock+s.struct.length-d.id.clock;p>0&&(s.struct.constructor===Qt?s.struct.length-=p:d=Z_(d,p)),s.struct.mergeWith(d)||(Oo(a,s.struct,s.offset),s={struct:d,offset:0},f.next())}}else s={struct:f.curr,offset:0},f.next();for(let d=f.curr;d!==null&&d.id.client===u&&d.id.clock===s.struct.id.clock+s.struct.length&&d.constructor!==Qt;d=f.next())Oo(a,s.struct,s.offset),s={struct:d,offset:0}}s!==null&&(Oo(a,s.struct,s.offset),s=null),wf(a);let l=r.map(f=>pi(f)),c=Zc(l);return Bo(i,c),i.toUint8Array()},X_=(o,e,t=Vo,r=uo)=>{let n=ph(e),s=new r,i=new hi(s),a=new t(Fr(o)),l=new mi(a,!1);for(;l.curr;){let f=l.curr,u=f.id.client,d=n.get(u)||0;if(l.curr.constructor===Qt){l.next();continue}if(f.id.clock+f.length>d)for(Oo(i,f,Er(d-f.id.clock,0)),l.next();l.curr&&l.curr.id.client===u;)Oo(i,l.curr,0),l.next();else for(;l.curr&&l.curr.id.client===u&&l.curr.id.clock+l.curr.length<=d;)l.next()}wf(i);let c=pi(a);return Bo(s,c),s.toUint8Array()};var wh=o=>{o.written>0&&(o.clientStructs.push({written:o.written,restEncoder:sr(o.encoder.restEncoder)}),o.encoder.restEncoder=mn(),o.written=0)},Oo=(o,e,t)=>{o.written>0&&o.currClient!==e.id.client&&wh(o),o.written===0&&(o.currClient=e.id.client,o.encoder.writeClient(e.id.client),De(o.encoder.restEncoder,e.id.clock+t)),e.write(o.encoder,t),o.written++},wf=o=>{wh(o);let e=o.encoder.restEncoder;De(e,o.clientStructs.length);for(let t=0;t<o.clientStructs.length;t++){let r=o.clientStructs[t];De(e,r.written),ei(e,r.restEncoder)}},e1=(o,e,t,r)=>{let n=new t(Fr(o)),s=new mi(n,!1),i=new r,a=new hi(i);for(let c=s.curr;c!==null;c=s.next())Oo(a,e(c),0);wf(a);let l=pi(n);return Bo(i,l),i.toUint8Array()};var t1=o=>e1(o,Um,Vo,bn),sh="You must not compute changes after the event-handler fired.",us=class{constructor(e,t){this.target=e,this.currentTarget=e,this.transaction=t,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=r1(this.currentTarget,this.target))}deletes(e){return pf(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw mr(sh);let e=new Map,t=this.target;this.transaction.changed.get(t).forEach(n=>{if(n!==null){let s=t._map.get(n),i,a;if(this.adds(s)){let l=s.left;for(;l!==null&&this.adds(l);)l=l.left;if(this.deletes(s))if(l!==null&&this.deletes(l))i="delete",a=Zi(l.content.getContent());else return;else l!==null&&this.deletes(l)?(i="update",a=Zi(l.content.getContent())):(i="add",a=void 0)}else if(this.deletes(s))i="delete",a=Zi(s.content.getContent());else return;e.set(n,{action:i,oldValue:a})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw mr(sh);let t=this.target,r=Wr(),n=Wr(),s=[];if(e={added:r,deleted:n,delta:s,keys:this.keys},this.transaction.changed.get(t).has(null)){let a=null,l=()=>{a&&s.push(a)};for(let c=t._start;c!==null;c=c.right)c.deleted?this.deletes(c)&&!this.adds(c)&&((a===null||a.delete===void 0)&&(l(),a={delete:0}),a.delete+=c.length,n.add(c)):this.adds(c)?((a===null||a.insert===void 0)&&(l(),a={insert:[]}),a.insert=a.insert.concat(c.content.getContent()),r.add(c)):((a===null||a.retain===void 0)&&(l(),a={retain:0}),a.retain+=c.length);a!==null&&a.retain===void 0&&l()}this._changes=e}return e}},r1=(o,e)=>{let t=[];for(;e._item!==null&&e!==o;){if(e._item.parentSub!==null)t.unshift(e._item.parentSub);else{let r=0,n=e._item.parent._start;for(;n!==e._item&&n!==null;)n.deleted||r++,n=n.right;t.unshift(r)}e=e._item.parent}return t},_h=80,_f=0,af=class{constructor(e,t){e.marker=!0,this.p=e,this.index=t,this.timestamp=_f++}},o1=o=>{o.timestamp=_f++},Sh=(o,e,t)=>{o.p.marker=!1,o.p=e,e.marker=!0,o.index=t,o.timestamp=_f++},n1=(o,e,t)=>{if(o.length>=_h){let r=o.reduce((n,s)=>n.timestamp<s.timestamp?n:s);return Sh(r,e,t),r}else{let r=new af(e,t);return o.push(r),r}},Ia=(o,e)=>{if(o._start===null||e===0||o._searchMarker===null)return null;let t=o._searchMarker.length===0?null:o._searchMarker.reduce((s,i)=>Kn(e-s.index)<Kn(e-i.index)?s:i),r=o._start,n=0;for(t!==null&&(r=t.p,n=t.index,o1(t));r.right!==null&&n<e;){if(!r.deleted&&r.countable){if(e<n+r.length)break;n+=r.length}r=r.right}for(;r.left!==null&&n>e;)r=r.left,!r.deleted&&r.countable&&(n-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(n-=r.length);return t!==null&&Kn(t.index-n)<r.parent.length/_h?(Sh(t,r,n),t):n1(o._searchMarker,r,n)},gi=(o,e,t)=>{for(let r=o.length-1;r>=0;r--){let n=o[r];if(t>0){let s=n.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(n.index-=s.length);if(s===null||s.marker===!0){o.splice(r,1);continue}n.p=s,s.marker=!0}(e<n.index||t>0&&e===n.index)&&(n.index=Er(e,n.index+t))}};var Ca=(o,e,t)=>{let r=o,n=e.changedParentTypes;for(;Ar(n,o,()=>[]).push(t),o._item!==null;)o=o._item.parent;gh(r._eH,t,e)},_t=class{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=Xm(),this._dEH=Xm(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,t){this.doc=e,this._item=t}_copy(){throw Pr()}clone(){throw Pr()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,t){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){eh(this._eH,e)}observeDeep(e){eh(this._dEH,e)}unobserve(e){th(this._eH,e)}unobserveDeep(e){th(this._dEH,e)}toJSON(){}},kh=(o,e,t)=>{e<0&&(e=o._length+e),t<0&&(t=o._length+t);let r=t-e,n=[],s=o._start;for(;s!==null&&r>0;){if(s.countable&&!s.deleted){let i=s.content.getContent();if(i.length<=e)e-=i.length;else{for(let a=e;a<i.length&&r>0;a++)n.push(i[a]),r--;e=0}}s=s.right}return n},Ih=o=>{let e=[],t=o._start;for(;t!==null;){if(t.countable&&!t.deleted){let r=t.content.getContent();for(let n=0;n<r.length;n++)e.push(r[n])}t=t.right}return e};var yi=(o,e)=>{let t=0,r=o._start;for(;r!==null;){if(r.countable&&!r.deleted){let n=r.content.getContent();for(let s=0;s<n.length;s++)e(n[s],t++,o)}r=r.right}},Ch=(o,e)=>{let t=[];return yi(o,(r,n)=>{t.push(e(r,n,o))}),t},s1=o=>{let e=o._start,t=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(t===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};t=e.content.getContent(),r=0,e=e.right}let n=t[r++];return t.length<=r&&(t=null),{done:!1,value:n}}}},Lh=(o,e)=>{let t=Ia(o,e),r=o._start;for(t!==null&&(r=t.p,e-=t.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},wa=(o,e,t,r)=>{let n=t,s=o.doc,i=s.clientID,a=s.store,l=t===null?e._start:t.right,c=[],f=()=>{c.length>0&&(n=new it(Be(i,gt(a,i)),n,n&&n.lastId,l,l&&l.id,e,null,new go(c)),n.integrate(o,0),c=[])};r.forEach(u=>{if(u===null)c.push(u);else switch(u.constructor){case Number:case Object:case Boolean:case Array:case String:c.push(u);break;default:switch(f(),u.constructor){case Uint8Array:case ArrayBuffer:n=new it(Be(i,gt(a,i)),n,n&&n.lastId,l,l&&l.id,e,null,new vn(new Uint8Array(u))),n.integrate(o,0);break;case ir:n=new it(Be(i,gt(a,i)),n,n&&n.lastId,l,l&&l.id,e,null,new _n(u)),n.integrate(o,0);break;default:if(u instanceof _t)n=new it(Be(i,gt(a,i)),n,n&&n.lastId,l,l&&l.id,e,null,new yr(u)),n.integrate(o,0);else throw new Error("Unexpected content type in insert operation")}}}),f()},Th=()=>mr("Length exceeded!"),Ah=(o,e,t,r)=>{if(t>e._length)throw Th();if(t===0)return e._searchMarker&&gi(e._searchMarker,t,r.length),wa(o,e,null,r);let n=t,s=Ia(e,t),i=e._start;for(s!==null&&(i=s.p,t-=s.index,t===0&&(i=i.prev,t+=i&&i.countable&&!i.deleted?i.length:0));i!==null;i=i.right)if(!i.deleted&&i.countable){if(t<=i.length){t<i.length&&Ho(o,Be(i.id.client,i.id.clock+t));break}t-=i.length}return e._searchMarker&&gi(e._searchMarker,n,r.length),wa(o,e,i,r)},i1=(o,e,t)=>{let n=(e._searchMarker||[]).reduce((s,i)=>i.index>s.index?i:s,{index:0,p:e._start}).p;if(n)for(;n.right;)n=n.right;return wa(o,e,n,t)},Mh=(o,e,t,r)=>{if(r===0)return;let n=t,s=r,i=Ia(e,t),a=e._start;for(i!==null&&(a=i.p,t-=i.index);a!==null&&t>0;a=a.right)!a.deleted&&a.countable&&(t<a.length&&Ho(o,Be(a.id.client,a.id.clock+t)),t-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&Ho(o,Be(a.id.client,a.id.clock+r)),a.delete(o),r-=a.length),a=a.right;if(r>0)throw Th();e._searchMarker&&gi(e._searchMarker,n,-s+r)},_a=(o,e,t)=>{let r=e._map.get(t);r!==void 0&&r.delete(o)},Sf=(o,e,t,r)=>{let n=e._map.get(t)||null,s=o.doc,i=s.clientID,a;if(r==null)a=new go([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:a=new go([r]);break;case Uint8Array:a=new vn(r);break;case ir:a=new _n(r);break;default:if(r instanceof _t)a=new yr(r);else throw new Error("Unexpected content type")}new it(Be(i,gt(s.store,i)),n,n&&n.lastId,null,null,e,t,a).integrate(o,0)},kf=(o,e)=>{let t=o._map.get(e);return t!==void 0&&!t.deleted?t.content.getContent()[t.length-1]:void 0},Eh=o=>{let e={};return o._map.forEach((t,r)=>{t.deleted||(e[r]=t.content.getContent()[t.length-1])}),e},Ph=(o,e)=>{let t=o._map.get(e);return t!==void 0&&!t.deleted};var a1=(o,e)=>{let t={};return o._map.forEach((r,n)=>{let s=r;for(;s!==null&&(!e.sv.has(s.id.client)||s.id.clock>=(e.sv.get(s.id.client)||0));)s=s.left;s!==null&&as(s,e)&&(t[n]=s.content.getContent()[s.length-1])}),t},ca=o=>Jm(o.entries(),e=>!e[1].deleted),lf=class extends us{constructor(e,t){super(e,t),this._transaction=t}},Jr=class extends _t{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){let t=new Jr;return t.push(e),t}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Jr}clone(){let e=new Jr;return e.insert(0,this.toArray().map(t=>t instanceof _t?t.clone():t)),e}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}_callObserver(e,t){super._callObserver(e,t),Ca(this,e,new lf(this,e))}insert(e,t){this.doc!==null?Ge(this.doc,r=>{Ah(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}push(e){this.doc!==null?Ge(this.doc,t=>{i1(t,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,t=1){this.doc!==null?Ge(this.doc,r=>{Mh(r,this,e,t)}):this._prelimContent.splice(e,t)}get(e){return Lh(this,e)}toArray(){return Ih(this)}slice(e=0,t=this.length){return kh(this,e,t)}toJSON(){return this.map(e=>e instanceof _t?e.toJSON():e)}map(e){return Ch(this,e)}forEach(e){yi(this,e)}[Symbol.iterator](){return s1(this)}_write(e){e.writeTypeRef(T1)}},l1=o=>new Jr,cf=class extends us{constructor(e,t,r){super(e,t),this.keysChanged=r}},po=class extends _t{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,t){super._integrate(e,t),this._prelimContent.forEach((r,n)=>{this.set(n,r)}),this._prelimContent=null}_copy(){return new po}clone(){let e=new po;return this.forEach((t,r)=>{e.set(r,t instanceof _t?t.clone():t)}),e}_callObserver(e,t){Ca(this,e,new cf(this,e,t))}toJSON(){let e={};return this._map.forEach((t,r)=>{if(!t.deleted){let n=t.content.getContent()[t.length-1];e[r]=n instanceof _t?n.toJSON():n}}),e}get size(){return[...ca(this._map)].length}keys(){return aa(ca(this._map),e=>e[0])}values(){return aa(ca(this._map),e=>e[1].content.getContent()[e[1].length-1])}entries(){return aa(ca(this._map),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this._map.forEach((t,r)=>{t.deleted||e(t.content.getContent()[t.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?Ge(this.doc,t=>{_a(t,this,e)}):this._prelimContent.delete(e)}set(e,t){return this.doc!==null?Ge(this.doc,r=>{Sf(r,this,e,t)}):this._prelimContent.set(e,t),t}get(e){return kf(this,e)}has(e){return Ph(this,e)}clear(){this.doc!==null?Ge(this.doc,e=>{this.forEach(function(t,r,n){_a(e,n,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(A1)}},c1=o=>new po,$o=(o,e)=>o===e||typeof o=="object"&&typeof e=="object"&&o&&e&&Bc(o,e),xi=class{constructor(e,t,r,n){this.left=e,this.right=t,this.index=r,this.currentAttributes=n}forward(){switch(this.right===null&&hr(),this.right.content.constructor){case mt:this.right.deleted||hs(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}},ih=(o,e,t)=>{for(;e.right!==null&&t>0;){switch(e.right.content.constructor){case mt:e.right.deleted||hs(e.currentAttributes,e.right.content);break;default:e.right.deleted||(t<e.right.length&&Ho(o,Be(e.right.id.client,e.right.id.clock+t)),e.index+=e.right.length,t-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},fa=(o,e,t,r)=>{let n=new Map,s=r?Ia(e,t):null;if(s){let i=new xi(s.p.left,s.p,s.index,n);return ih(o,i,t-s.index)}else{let i=new xi(null,e._start,0,n);return ih(o,i,t)}},Dh=(o,e,t,r)=>{for(;t.right!==null&&(t.right.deleted===!0||t.right.content.constructor===mt&&$o(r.get(t.right.content.key),t.right.content.value));)t.right.deleted||r.delete(t.right.content.key),t.forward();let n=o.doc,s=n.clientID;r.forEach((i,a)=>{let l=t.left,c=t.right,f=new it(Be(s,gt(n.store,s)),l,l&&l.lastId,c,c&&c.id,e,null,new mt(a,i));f.integrate(o,0),t.right=f,t.forward()})},hs=(o,e)=>{let{key:t,value:r}=e;r===null?o.delete(t):o.set(t,r)},Fh=(o,e)=>{var t;for(;o.right!==null;){if(!(o.right.deleted||o.right.content.constructor===mt&&$o((t=e[o.right.content.key])!=null?t:null,o.right.content.value)))break;o.forward()}},Rh=(o,e,t,r)=>{var a;let n=o.doc,s=n.clientID,i=new Map;for(let l in r){let c=r[l],f=(a=t.currentAttributes.get(l))!=null?a:null;if(!$o(f,c)){i.set(l,f);let{left:u,right:d}=t;t.right=new it(Be(s,gt(n.store,s)),u,u&&u.lastId,d,d&&d.id,e,null,new mt(l,c)),t.right.integrate(o,0),t.forward()}}return i},Qc=(o,e,t,r,n)=>{t.currentAttributes.forEach((d,m)=>{n[m]===void 0&&(n[m]=null)});let s=o.doc,i=s.clientID;Fh(t,n);let a=Rh(o,e,t,n),l=r.constructor===String?new gr(r):r instanceof _t?new yr(r):new ho(r),{left:c,right:f,index:u}=t;e._searchMarker&&gi(e._searchMarker,t.index,l.getLength()),f=new it(Be(i,gt(s.store,i)),c,c&&c.lastId,f,f&&f.id,e,null,l),f.integrate(o,0),t.right=f,t.index=u,t.forward(),Dh(o,e,t,a)},ah=(o,e,t,r,n)=>{let s=o.doc,i=s.clientID;Fh(t,n);let a=Rh(o,e,t,n);e:for(;t.right!==null&&(r>0||a.size>0&&(t.right.deleted||t.right.content.constructor===mt));){if(!t.right.deleted)switch(t.right.content.constructor){case mt:{let{key:l,value:c}=t.right.content,f=n[l];if(f!==void 0){if($o(f,c))a.delete(l);else{if(r===0)break e;a.set(l,c)}t.right.delete(o)}else t.currentAttributes.set(l,c);break}default:r<t.right.length&&Ho(o,Be(t.right.id.client,t.right.id.clock+r)),r-=t.right.length;break}t.forward()}if(r>0){let l="";for(;r>0;r--)l+=`
`;t.right=new it(Be(i,gt(s.store,i)),t.left,t.left&&t.left.lastId,t.right,t.right&&t.right.id,e,null,new gr(l)),t.right.integrate(o,0),t.forward()}Dh(o,e,t,a)},Uh=(o,e,t,r,n)=>{var c,f;let s=e,i=St();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===mt){let u=s.content;i.set(u.key,u)}s=s.right}let a=0,l=!1;for(;e!==s;){if(t===e&&(l=!0),!e.deleted){let u=e.content;switch(u.constructor){case mt:{let{key:d,value:m}=u,p=(c=r.get(d))!=null?c:null;(i.get(d)!==u||p===m)&&(e.delete(o),a++,!l&&((f=n.get(d))!=null?f:null)===m&&p!==m&&(p===null?n.delete(d):n.set(d,p))),!l&&!e.deleted&&hs(n,u);break}}}e=e.right}return a},f1=(o,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;let t=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===mt){let r=e.content.key;t.has(r)?e.delete(o):t.add(r)}e=e.left}},u1=o=>{let e=0;return Ge(o.doc,t=>{let r=o._start,n=o._start,s=St(),i=Qi(s);for(;n;){if(n.deleted===!1)switch(n.content.constructor){case mt:hs(i,n.content);break;default:e+=Uh(t,r,n,s,i),s=Qi(i),r=n;break}n=n.right}}),e},d1=o=>{let e=new Set,t=o.doc;for(let[r,n]of o.afterState.entries()){let s=o.beforeState.get(r)||0;n!==s&&bh(o,t.store.clients.get(r),s,n,i=>{!i.deleted&&i.content.constructor===mt&&i.constructor!==Yt&&e.add(i.parent)})}Ge(t,r=>{fh(o,o.deleteSet,n=>{if(n instanceof Yt||!n.parent._hasFormatting||e.has(n.parent))return;let s=n.parent;n.content.constructor===mt?e.add(s):f1(r,n)});for(let n of e)u1(n)})},lh=(o,e,t)=>{let r=t,n=Qi(e.currentAttributes),s=e.right;for(;t>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case yr:case ho:case gr:t<e.right.length&&Ho(o,Be(e.right.id.client,e.right.id.clock+t)),t-=e.right.length,e.right.delete(o);break}e.forward()}s&&Uh(o,s,e.right,n,e.currentAttributes);let i=(e.left||e.right).parent;return i._searchMarker&&gi(i._searchMarker,e.index,-r+t),e},ff=class extends us{constructor(e,t,r){super(e,t),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(n=>{n===null?this.childListChanged=!0:this.keysChanged.add(n)})}get changes(){if(this._changes===null){let e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){let e=this.target.doc,t=[];Ge(e,r=>{var m,p,y;let n=new Map,s=new Map,i=this.target._start,a=null,l={},c="",f=0,u=0,d=()=>{if(a!==null){let g=null;switch(a){case"delete":u>0&&(g={delete:u}),u=0;break;case"insert":(typeof c=="object"||c.length>0)&&(g={insert:c},n.size>0&&(g.attributes={},n.forEach((v,C)=>{v!==null&&(g.attributes[C]=v)}))),c="";break;case"retain":f>0&&(g={retain:f},Fm(l)||(g.attributes=Pm({},l))),f=0;break}g&&t.push(g),a=null}};for(;i!==null;){switch(i.content.constructor){case yr:case ho:this.adds(i)?this.deletes(i)||(d(),a="insert",c=i.content.getContent()[0],d()):this.deletes(i)?(a!=="delete"&&(d(),a="delete"),u+=1):i.deleted||(a!=="retain"&&(d(),a="retain"),f+=1);break;case gr:this.adds(i)?this.deletes(i)||(a!=="insert"&&(d(),a="insert"),c+=i.content.str):this.deletes(i)?(a!=="delete"&&(d(),a="delete"),u+=i.length):i.deleted||(a!=="retain"&&(d(),a="retain"),f+=i.length);break;case mt:{let{key:g,value:v}=i.content;if(this.adds(i)){if(!this.deletes(i)){let C=(m=n.get(g))!=null?m:null;$o(C,v)?v!==null&&i.delete(r):(a==="retain"&&d(),$o(v,(p=s.get(g))!=null?p:null)?delete l[g]:l[g]=v)}}else if(this.deletes(i)){s.set(g,v);let C=(y=n.get(g))!=null?y:null;$o(C,v)||(a==="retain"&&d(),l[g]=C)}else if(!i.deleted){s.set(g,v);let C=l[g];C!==void 0&&($o(C,v)?C!==null&&i.delete(r):(a==="retain"&&d(),v===null?delete l[g]:l[g]=v))}i.deleted||(a==="insert"&&d(),hs(n,i.content));break}}i=i.right}for(d();t.length>0;){let g=t[t.length-1];if(g.retain!==void 0&&g.attributes===void 0)t.pop();else break}}),this._delta=t}return this._delta}},qo=class extends _t{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this._length}_integrate(e,t){super._integrate(e,t);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new qo}clone(){let e=new qo;return e.applyDelta(this.toDelta()),e}_callObserver(e,t){super._callObserver(e,t);let r=new ff(this,e,t);Ca(this,e,r),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){let e="",t=this._start;for(;t!==null;)!t.deleted&&t.countable&&t.content.constructor===gr&&(e+=t.content.str),t=t.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:t=!0}={}){this.doc!==null?Ge(this.doc,r=>{let n=new xi(null,this._start,0,new Map);for(let s=0;s<e.length;s++){let i=e[s];if(i.insert!==void 0){let a=!t&&typeof i.insert=="string"&&s===e.length-1&&n.right===null&&i.insert.slice(-1)===`
`?i.insert.slice(0,-1):i.insert;(typeof a!="string"||a.length>0)&&Qc(r,this,n,a,i.attributes||{})}else i.retain!==void 0?ah(r,this,n,i.retain,i.attributes||{}):i.delete!==void 0&&lh(r,n,i.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,t,r){let n=[],s=new Map,i=this.doc,a="",l=this._start;function c(){if(a.length>0){let u={},d=!1;s.forEach((p,y)=>{d=!0,u[y]=p});let m={insert:a};d&&(m.attributes=u),n.push(m),a=""}}let f=()=>{for(;l!==null;){if(as(l,e)||t!==void 0&&as(l,t))switch(l.content.constructor){case gr:{let u=s.get("ychange");e!==void 0&&!as(l,e)?(u===void 0||u.user!==l.id.client||u.type!=="removed")&&(c(),s.set("ychange",r?r("removed",l.id):{type:"removed"})):t!==void 0&&!as(l,t)?(u===void 0||u.user!==l.id.client||u.type!=="added")&&(c(),s.set("ychange",r?r("added",l.id):{type:"added"})):u!==void 0&&(c(),s.delete("ychange")),a+=l.content.str;break}case yr:case ho:{c();let u={insert:l.content.getContent()[0]};if(s.size>0){let d={};u.attributes=d,s.forEach((m,p)=>{d[p]=m})}n.push(u);break}case mt:as(l,e)&&(c(),hs(s,l.content));break}l=l.right}c()};return e||t?Ge(i,u=>{e&&of(u,e),t&&of(u,t),f()},"cleanup"):f(),n}insert(e,t,r){if(t.length<=0)return;let n=this.doc;n!==null?Ge(n,s=>{let i=fa(s,this,e,!r);r||(r={},i.currentAttributes.forEach((a,l)=>{r[l]=a})),Qc(s,this,i,t,r)}):this._pending.push(()=>this.insert(e,t,r))}insertEmbed(e,t,r){let n=this.doc;n!==null?Ge(n,s=>{let i=fa(s,this,e,!r);Qc(s,this,i,t,r||{})}):this._pending.push(()=>this.insertEmbed(e,t,r||{}))}delete(e,t){if(t===0)return;let r=this.doc;r!==null?Ge(r,n=>{lh(n,fa(n,this,e,!0),t)}):this._pending.push(()=>this.delete(e,t))}format(e,t,r){if(t===0)return;let n=this.doc;n!==null?Ge(n,s=>{let i=fa(s,this,e,!1);i.right!==null&&ah(s,this,i,t,r)}):this._pending.push(()=>this.format(e,t,r))}removeAttribute(e){this.doc!==null?Ge(this.doc,t=>{_a(t,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,t){this.doc!==null?Ge(this.doc,r=>{Sf(r,this,e,t)}):this._pending.push(()=>this.setAttribute(e,t))}getAttribute(e){return kf(this,e)}getAttributes(){return Eh(this)}_write(e){e.writeTypeRef(M1)}},p1=o=>new qo,ui=class{constructor(e,t=()=>!0){this._filter=t,this._root=e,this._currentNode=e._start,this._firstCall=!0}[Symbol.iterator](){return this}next(){let e=this._currentNode,t=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(t)))do if(t=e.content.type,!e.deleted&&(t.constructor===zo||t.constructor===mo)&&t._start!==null)e=t._start;else for(;e!==null;)if(e.right!==null){e=e.right;break}else e.parent===this._root?e=null:e=e.parent._item;while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}},mo=class extends _t{constructor(){super(),this._prelimContent=[]}get firstChild(){let e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new mo}clone(){let e=new mo;return e.insert(0,this.toArray().map(t=>t instanceof _t?t.clone():t)),e}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new ui(this,e)}querySelector(e){e=e.toUpperCase();let r=new ui(this,n=>n.nodeName&&n.nodeName.toUpperCase()===e).next();return r.done?null:r.value}querySelectorAll(e){return e=e.toUpperCase(),Mr(new ui(this,t=>t.nodeName&&t.nodeName.toUpperCase()===e))}_callObserver(e,t){Ca(this,e,new uf(this,t,e))}toString(){return Ch(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,t={},r){let n=e.createDocumentFragment();return r!==void 0&&r._createAssociation(n,this),yi(this,s=>{n.insertBefore(s.toDOM(e,t,r),null)}),n}insert(e,t){this.doc!==null?Ge(this.doc,r=>{Ah(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}insertAfter(e,t){if(this.doc!==null)Ge(this.doc,r=>{let n=e&&e instanceof _t?e._item:e;wa(r,this,n,t)});else{let r=this._prelimContent,n=e===null?0:r.findIndex(s=>s===e)+1;if(n===0&&e!==null)throw mr("Reference item not found");r.splice(n,0,...t)}}delete(e,t=1){this.doc!==null?Ge(this.doc,r=>{Mh(r,this,e,t)}):this._prelimContent.splice(e,t)}toArray(){return Ih(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return Lh(this,e)}slice(e=0,t=this.length){return kh(this,e,t)}forEach(e){yi(this,e)}_write(e){e.writeTypeRef(P1)}},m1=o=>new mo,zo=class extends mo{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){let e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){let e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,t){super._integrate(e,t),this._prelimAttrs.forEach((r,n)=>{this.setAttribute(n,r)}),this._prelimAttrs=null}_copy(){return new zo(this.nodeName)}clone(){let e=new zo(this.nodeName),t=this.getAttributes();return Dm(t,(r,n)=>{typeof r=="string"&&e.setAttribute(n,r)}),e.insert(0,this.toArray().map(r=>r instanceof _t?r.clone():r)),e}toString(){let e=this.getAttributes(),t=[],r=[];for(let a in e)r.push(a);r.sort();let n=r.length;for(let a=0;a<n;a++){let l=r[a];t.push(l+'="'+e[l]+'"')}let s=this.nodeName.toLocaleLowerCase(),i=t.length>0?" "+t.join(" "):"";return`<${s}${i}>${super.toString()}</${s}>`}removeAttribute(e){this.doc!==null?Ge(this.doc,t=>{_a(t,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,t){this.doc!==null?Ge(this.doc,r=>{Sf(r,this,e,t)}):this._prelimAttrs.set(e,t)}getAttribute(e){return kf(this,e)}hasAttribute(e){return Ph(this,e)}getAttributes(e){return e?a1(this,e):Eh(this)}toDOM(e=document,t={},r){let n=e.createElement(this.nodeName),s=this.getAttributes();for(let i in s){let a=s[i];typeof a=="string"&&n.setAttribute(i,a)}return yi(this,i=>{n.appendChild(i.toDOM(e,t,r))}),r!==void 0&&r._createAssociation(n,this),n}_write(e){e.writeTypeRef(E1),e.writeKey(this.nodeName)}},h1=o=>new zo(o.readKey()),uf=class extends us{constructor(e,t,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,t.forEach(n=>{n===null?this.childListChanged=!0:this.attributesChanged.add(n)})}},ds=class extends po{constructor(e){super(),this.hookName=e}_copy(){return new ds(this.hookName)}clone(){let e=new ds(this.hookName);return this.forEach((t,r)=>{e.set(r,t)}),e}toDOM(e=document,t={},r){let n=t[this.hookName],s;return n!==void 0?s=n.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(s,this),s}_write(e){e.writeTypeRef(D1),e.writeKey(this.hookName)}},g1=o=>new ds(o.readKey()),ps=class extends qo{get nextSibling(){let e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){let e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new ps}clone(){let e=new ps;return e.applyDelta(this.toDelta()),e}toDOM(e=document,t,r){let n=e.createTextNode(this.toString());return r!==void 0&&r._createAssociation(n,this),n}toString(){return this.toDelta().map(e=>{let t=[];for(let n in e.attributes){let s=[];for(let i in e.attributes[n])s.push({key:i,value:e.attributes[n][i]});s.sort((i,a)=>i.key<a.key?-1:1),t.push({nodeName:n,attrs:s})}t.sort((n,s)=>n.nodeName<s.nodeName?-1:1);let r="";for(let n=0;n<t.length;n++){let s=t[n];r+=`<${s.nodeName}`;for(let i=0;i<s.attrs.length;i++){let a=s.attrs[i];r+=` ${a.key}="${a.value}"`}r+=">"}r+=e.insert;for(let n=t.length-1;n>=0;n--)r+=`</${t[n].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(F1)}},y1=o=>new ps,bi=class{constructor(e,t){this.id=e,this.length=t}get deleted(){throw Pr()}mergeWith(e){return!1}write(e,t,r){throw Pr()}integrate(e,t){throw Pr()}},x1=0,Yt=class extends bi{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,t){t>0&&(this.id.clock+=t,this.length-=t),xh(e.doc.store,this)}write(e,t){e.writeInfo(x1),e.writeLen(this.length-t)}getMissing(e,t){return null}},vn=class{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new vn(this.content)}splice(e){throw Pr()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeBuf(this.content)}getRef(){return 3}},b1=o=>new vn(o.readBuf()),wn=class{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new wn(this.len)}splice(e){let t=new wn(this.len-e);return this.len=e,t}mergeWith(e){return this.len+=e.len,!0}integrate(e,t){ma(e.deleteSet,t.id.client,t.id.clock,this.len),t.markDeleted()}delete(e){}gc(e){}write(e,t){e.writeLen(this.len-t)}getRef(){return 1}},v1=o=>new wn(o.readLen()),Oh=(o,e)=>new ir({guid:o,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1}),_n=class{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;let t={};this.opts=t,e.gc||(t.gc=!1),e.autoLoad&&(t.autoLoad=!0),e.meta!==null&&(t.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new _n(Oh(this.doc.guid,this.opts))}splice(e){throw Pr()}mergeWith(e){return!1}integrate(e,t){this.doc._item=t,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,t){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}},w1=o=>new _n(Oh(o.readString(),o.readAny())),ho=class{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new ho(this.embed)}splice(e){throw Pr()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeJSON(this.embed)}getRef(){return 5}},_1=o=>new ho(o.readJSON()),mt=class{constructor(e,t){this.key=e,this.value=t}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new mt(this.key,this.value)}splice(e){throw Pr()}mergeWith(e){return!1}integrate(e,t){let r=t.parent;r._searchMarker=null,r._hasFormatting=!0}delete(e){}gc(e){}write(e,t){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}},S1=o=>new mt(o.readKey(),o.readJSON()),ms=class{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new ms(this.arr)}splice(e){let t=new ms(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){let r=this.arr.length;e.writeLen(r-t);for(let n=t;n<r;n++){let s=this.arr[n];e.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}},k1=o=>{let e=o.readLen(),t=[];for(let r=0;r<e;r++){let n=o.readString();n==="undefined"?t.push(void 0):t.push(JSON.parse(n))}return new ms(t)},go=class{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new go(this.arr)}splice(e){let t=new go(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){let r=this.arr.length;e.writeLen(r-t);for(let n=t;n<r;n++){let s=this.arr[n];e.writeAny(s)}}getRef(){return 8}},I1=o=>{let e=o.readLen(),t=[];for(let r=0;r<e;r++)t.push(o.readAny());return new go(t)},gr=class{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new gr(this.str)}splice(e){let t=new gr(this.str.slice(e));this.str=this.str.slice(0,e);let r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"\uFFFD",t.str="\uFFFD"+t.str.slice(1)),t}mergeWith(e){return this.str+=e.str,!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeString(t===0?this.str:this.str.slice(t))}getRef(){return 4}},C1=o=>new gr(o.readString()),L1=[l1,c1,p1,h1,m1,g1,y1],T1=0,A1=1,M1=2,E1=3,P1=4,D1=5,F1=6,yr=class{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new yr(this.type._copy())}splice(e){throw Pr()}mergeWith(e){return!1}integrate(e,t){this.type._integrate(e.doc,t)}delete(e){let t=this.type._start;for(;t!==null;)t.deleted?t.id.clock<(e.beforeState.get(t.id.client)||0)&&e._mergeStructs.push(t):t.delete(e),t=t.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(e.beforeState.get(r.id.client)||0)&&e._mergeStructs.push(r):r.delete(e)}),e.changed.delete(this.type)}gc(e){let t=this.type._start;for(;t!==null;)t.gc(e,!0),t=t.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(e,!0),r=r.left}),this.type._map=new Map}write(e,t){this.type._write(e)}getRef(){return 7}},R1=o=>new yr(L1[o.readTypeRef()](o)),ch=(o,e)=>{let t=e,r=0,n;do r>0&&(t=Be(t.client,t.clock+r)),n=ua(o,t),r=t.clock-n.id.clock,t=n.redone;while(t!==null&&n instanceof it);return{item:n,diff:r}};var Sa=(o,e,t)=>{let{client:r,clock:n}=e.id,s=new it(Be(r,n+t),e,Be(r,n+t-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(t));return e.deleted&&s.markDeleted(),e.keep&&(s.keep=!0),e.redone!==null&&(s.redone=Be(e.redone.client,e.redone.clock+t)),e.right=s,s.right!==null&&(s.right.left=s),o._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),e.length=t,s};var it=class extends bi{constructor(e,t,r,n,s,i,a,l){super(e,l.getLength()),this.origin=r,this.left=t,this.right=n,this.rightOrigin=s,this.parent=i,this.parentSub=a,this.redone=null,this.content=l,this.info=this.content.isCountable()?2:0}set marker(e){(this.info&8)>0!==e&&(this.info^=8)}get marker(){return(this.info&8)>0}get keep(){return(this.info&1)>0}set keep(e){this.keep!==e&&(this.info^=1)}get countable(){return(this.info&2)>0}get deleted(){return(this.info&4)>0}set deleted(e){this.deleted!==e&&(this.info^=4)}markDeleted(){this.info|=4}getMissing(e,t){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=gt(t,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=gt(t,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===No&&this.id.client!==this.parent.client&&this.parent.clock>=gt(t,this.parent.client))return this.parent.client;if(this.origin&&(this.left=rh(e,t,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=Ho(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===Yt||this.right&&this.right.constructor===Yt)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===it&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===it&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===No){let r=ua(t,this.parent);r.constructor===Yt?this.parent=null:this.parent=r.content.type}return null}integrate(e,t){if(t>0&&(this.id.clock+=t,this.left=rh(e,e.doc.store,Be(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(t),this.length-=t),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,n;if(r!==null)n=r.right;else if(this.parentSub!==null)for(n=this.parent._map.get(this.parentSub)||null;n!==null&&n.left!==null;)n=n.left;else n=this.parent._start;let s=new Set,i=new Set;for(;n!==null&&n!==this.right;){if(i.add(n),s.add(n),ls(this.origin,n.origin)){if(n.id.client<this.id.client)r=n,s.clear();else if(ls(this.rightOrigin,n.rightOrigin))break}else if(n.origin!==null&&i.has(ua(e.doc.store,n.origin)))s.has(ua(e.doc.store,n.origin))||(r=n,s.clear());else break;n=n.right}this.left=r}if(this.left!==null){let r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),xh(e.doc.store,this),this.content.integrate(e,this),nh(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new Yt(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:Be(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&ls(e.origin,this.lastId)&&this.right===e&&ls(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){let t=this.parent._searchMarker;return t&&t.forEach(r=>{r.p===e&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){let t=this.parent;this.countable&&this.parentSub===null&&(t._length-=this.length),this.markDeleted(),ma(e.deleteSet,this.id.client,this.id.clock,this.length),nh(e,t,this.parentSub),this.content.delete(e)}}gc(e,t){if(!this.deleted)throw hr();this.content.gc(e),t?K_(e,this,new Yt(this.id,this.length)):this.content=new wn(this.length)}write(e,t){let r=t>0?Be(this.id.client,this.id.clock+t-1):this.origin,n=this.rightOrigin,s=this.parentSub,i=this.content.getRef()&31|(r===null?0:128)|(n===null?0:64)|(s===null?0:32);if(e.writeInfo(i),r!==null&&e.writeLeftID(r),n!==null&&e.writeRightID(n),r===null&&n===null){let a=this.parent;if(a._item!==void 0){let l=a._item;if(l===null){let c=yh(a);e.writeParentInfo(!0),e.writeString(c)}else e.writeParentInfo(!1),e.writeLeftID(l.id)}else a.constructor===String?(e.writeParentInfo(!0),e.writeString(a)):a.constructor===No?(e.writeParentInfo(!1),e.writeLeftID(a)):hr();s!==null&&e.writeString(s)}this.content.write(e,t)}},$h=(o,e)=>U1[e&31](o),U1=[()=>{hr()},v1,k1,b1,C1,_1,S1,R1,I1,w1,()=>{hr()}],O1=10,Qt=class extends bi{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,t){hr()}write(e,t){e.writeInfo(O1),De(e.restEncoder,this.length-t)}getMissing(e,t){return null}},Nh=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:{},Bh="__ $YJS$ __";Nh[Bh]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");Nh[Bh]=!0;var In=o=>fo((e,t)=>{o.onerror=r=>t(new Error(r.target.error)),o.onsuccess=r=>e(r.target.result)}),Vh=(o,e)=>fo((t,r)=>{let n=indexedDB.open(o);n.onupgradeneeded=s=>e(s.target.result),n.onerror=s=>r(mr(s.target.error)),n.onsuccess=s=>{let i=s.target.result;i.onversionchange=()=>{i.close()},t(i)}}),Hh=o=>In(indexedDB.deleteDatabase(o)),qh=(o,e)=>e.forEach(t=>o.createObjectStore.apply(o,t)),br=(o,e,t="readwrite")=>{let r=o.transaction(e,t);return e.map(n=>V1(r,n))},yo=(o,e)=>In(o.count(e)),zh=(o,e)=>In(o.get(e)),If=(o,e)=>In(o.delete(e)),Wh=(o,e,t)=>In(o.put(e,t));var La=(o,e)=>In(o.add(e)),jh=(o,e,t)=>In(o.getAll(e,t));var $1=(o,e,t)=>{let r=null;return B1(o,e,n=>(r=n,!1),t).then(()=>r)},Kh=(o,e=null)=>$1(o,e,"prev");var N1=(o,e)=>fo((t,r)=>{o.onerror=r,o.onsuccess=async n=>{let s=n.target.result;if(s===null||await e(s)===!1)return t();s.continue()}});var B1=(o,e,t,r="next")=>N1(o.openKeyCursor(e,r),n=>t(n.key)),V1=(o,e)=>o.objectStore(e);var Gh=(o,e)=>IDBKeyRange.upperBound(o,e),Jh=(o,e)=>IDBKeyRange.lowerBound(o,e);var Cf="custom",Yh="updates",Qh=500,Zh=(o,e=()=>{},t=()=>{})=>{let[r]=br(o.db,[Yh]);return jh(r,Jh(o._dbref,!1)).then(n=>{o._destroyed||(e(r),Ge(o.doc,()=>{n.forEach(s=>xr(o.doc,s))},o,!1),t(r))}).then(()=>Kh(r).then(n=>{o._dbref=n+1})).then(()=>yo(r).then(n=>{o._dbsize=n})).then(()=>r)},H1=(o,e=!0)=>Zh(o).then(t=>{(e||o._dbsize>=Qh)&&La(t,Sn(o.doc)).then(()=>If(t,Gh(o._dbref,!0))).then(()=>yo(t).then(r=>{o._dbsize=r}))});var Wo=class extends jn{constructor(e,t){super(),this.doc=t,this.name=e,this._dbref=0,this._dbsize=0,this._destroyed=!1,this.db=null,this.synced=!1,this._db=Vh(e,r=>qh(r,[["updates",{autoIncrement:!0}],["custom"]])),this.whenSynced=fo(r=>this.on("synced",()=>r(this))),this._db.then(r=>{this.db=r,Zh(this,i=>La(i,Sn(t)),()=>{if(this._destroyed)return this;this.synced=!0,this.emit("synced",[this])})}),this._storeTimeout=1e3,this._storeTimeoutId=null,this._storeUpdate=(r,n)=>{if(this.db&&n!==this){let[s]=br(this.db,[Yh]);La(s,r),++this._dbsize>=Qh&&(this._storeTimeoutId!==null&&clearTimeout(this._storeTimeoutId),this._storeTimeoutId=setTimeout(()=>{H1(this,!1),this._storeTimeoutId=null},this._storeTimeout))}},t.on("update",this._storeUpdate),this.destroy=this.destroy.bind(this),t.on("destroy",this.destroy)}destroy(){return this._storeTimeoutId&&clearTimeout(this._storeTimeoutId),this.doc.off("update",this._storeUpdate),this.doc.off("destroy",this.destroy),this._destroyed=!0,this._db.then(e=>{e.close()})}clearData(){return this.destroy().then(()=>{Hh(this.name)})}get(e){return this._db.then(t=>{let[r]=br(t,[Cf],"readonly");return zh(r,e)})}set(e,t){return this._db.then(r=>{let[n]=br(r,[Cf]);return Wh(n,t,e)})}del(e){return this._db.then(t=>{let[r]=br(t,[Cf]);return If(r,e)})}};var fr=zn(Qs());var Xh=0,Aa=1,eg=2,Ma=(o,e)=>{De(o,Xh);let t=hh(e);It(o,t)},Lf=(o,e,t)=>{De(o,Aa),It(o,Sn(e,t))},q1=(o,e,t)=>Lf(e,t,Mt(o)),tg=(o,e,t)=>{try{xr(e,Mt(o),t)}catch(r){console.error("Caught error while handling a Yjs update",r)}},rg=(o,e)=>{De(o,eg),It(o,e)},z1=tg,og=(o,e,t,r)=>{let n=Le(o);switch(n){case Xh:q1(o,e,t);break;case Aa:tg(o,t,r);break;case eg:z1(o,t,r);break;default:throw new Error("Unknown message type")}return n};var j1=0;var ng=(o,e,t)=>{switch(Le(o)){case j1:t(e,Dr(o))}};var Tf=3e4,Ea=class extends jn{constructor(e){super(),this.doc=e,this.clientID=e.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{let t=yn();this.getLocalState()!==null&&Tf/2<=t-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());let r=[];this.meta.forEach((n,s)=>{s!==this.clientID&&Tf<=t-n.lastUpdated&&this.states.has(s)&&r.push(s)}),r.length>0&&Pa(this,r,"timeout")},Jt(Tf/10)),e.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(e){let t=this.clientID,r=this.meta.get(t),n=r===void 0?0:r.clock+1,s=this.states.get(t);e===null?this.states.delete(t):this.states.set(t,e),this.meta.set(t,{clock:n,lastUpdated:yn()});let i=[],a=[],l=[],c=[];e===null?c.push(t):s==null?e!=null&&i.push(t):(a.push(t),ss(s,e)||l.push(t)),(i.length>0||l.length>0||c.length>0)&&this.emit("change",[{added:i,updated:l,removed:c},"local"]),this.emit("update",[{added:i,updated:a,removed:c},"local"])}setLocalStateField(e,t){let r=this.getLocalState();r!==null&&this.setLocalState({...r,[e]:t})}getStates(){return this.states}},Pa=(o,e,t)=>{let r=[];for(let n=0;n<e.length;n++){let s=e[n];if(o.states.has(s)){if(o.states.delete(s),s===o.clientID){let i=o.meta.get(s);o.meta.set(s,{clock:i.clock+1,lastUpdated:yn()})}r.push(s)}}r.length>0&&(o.emit("change",[{added:[],updated:[],removed:r},t]),o.emit("update",[{added:[],updated:[],removed:r},t]))},gs=(o,e,t=o.states)=>{let r=e.length,n=mn();De(n,r);for(let s=0;s<r;s++){let i=e[s],a=t.get(i)||null,l=o.meta.get(i).clock;De(n,i),De(n,l),co(n,JSON.stringify(a))}return sr(n)};var sg=(o,e,t)=>{let r=Fr(e),n=yn(),s=[],i=[],a=[],l=[],c=Le(r);for(let f=0;f<c;f++){let u=Le(r),d=Le(r),m=JSON.parse(Dr(r)),p=o.meta.get(u),y=o.states.get(u),g=p===void 0?0:p.clock;(g<d||g===d&&m===null&&o.states.has(u))&&(m===null?u===o.clientID&&o.getLocalState()!=null?d++:o.states.delete(u):o.states.set(u,m),o.meta.set(u,{clock:d,lastUpdated:n}),p===void 0&&m!==null?s.push(u):p!==void 0&&m===null?l.push(u):m!==null&&(ss(m,y)||a.push(u),i.push(u)))}(s.length>0||a.length>0||l.length>0)&&o.emit("change",[{added:s,updated:a,removed:l},t]),(s.length>0||i.length>0||l.length>0)&&o.emit("update",[{added:s,updated:i,removed:l},t])};var xs=()=>new Map,fg=(o,e,t)=>{let r=o.get(e);return r===void 0&&o.set(e,r=t()),r},ug=()=>new Set,J1=Array.from,PE=Array.isArray,dg=String.fromCharCode,DE=String.fromCodePoint,FE=dg(65535),Y1=o=>o.toLowerCase(),Q1=/^\s*/g,Z1=o=>o.replace(Q1,""),X1=/([A-Z])/g,ig=(o,e)=>Z1(o.replace(X1,t=>`${e}${Y1(t)}`)),e0=o=>{let e=unescape(encodeURIComponent(o)),t=e.length,r=new Uint8Array(t);for(let n=0;n<t;n++)r[n]=e.codePointAt(n);return r},vi=typeof TextEncoder!="undefined"?new TextEncoder:null,t0=o=>vi.encode(o),r0=vi?t0:e0,Af=typeof TextDecoder=="undefined"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Af&&Af.decode(new Uint8Array).length===1&&(Af=null);var ag=o=>o===void 0?null:o,o0=class{constructor(){this.map=new Map}setItem(o,e){this.map.set(o,e)}getItem(o){return this.map.get(o)}},pg=new o0,Rf=!0;try{typeof localStorage!="undefined"&&(pg=localStorage,Rf=!1)}catch(o){}var mg=pg,n0=o=>Rf||addEventListener("storage",o),s0=o=>Rf||removeEventListener("storage",o),i0=(o,e)=>{let t=[];for(let r in o)t.push(e(o[r],r));return t},a0=(o,e)=>e.includes(o),ws=typeof process!="undefined"&&process.release&&/node|io\.js/.test(process.release.name),hg=typeof window!="undefined"&&typeof document!="undefined"&&!ws,RE=typeof navigator!="undefined"?/Mac/.test(navigator.platform):!1,Qr,l0=[],c0=()=>{if(Qr===void 0)if(ws){Qr=xs();let o=process.argv,e=null;for(let t=0;t<o.length;t++){let r=o[t];r[0]==="-"?(e!==null&&Qr.set(e,""),e=r):e!==null?(Qr.set(e,r),e=null):l0.push(r)}e!==null&&Qr.set(e,"")}else typeof location=="object"?(Qr=xs(),(location.search||"?").slice(1).split("&").forEach(o=>{if(o.length!==0){let[e,t]=o.split("=");Qr.set(`--${ig(e,"-")}`,t),Qr.set(`-${ig(e,"-")}`,t)}})):Qr=xs();return Qr},Ef=o=>c0().has(o),Pf=o=>ag(ws?process.env[o.toUpperCase()]:mg.getItem(o)),f0=o=>Ef("--"+o)||Pf(o)!==null,UE=f0("production"),lg=ws&&a0(process.env.FORCE_COLOR,["true","1","2"]),OE=!Ef("no-colors")&&(!ws||process.stdout.isTTY||lg)&&(!ws||Ef("color")||lg||Pf("COLORTERM")!==null||(Pf("TERM")||"").includes("color")),gg=Math.floor,yg=(o,e)=>o<e?o:e,u0=(o,e)=>o>e?o:e,$E=Number.isNaN,d0=Math.pow,xg=128,p0=1<<17,m0=1<<18,h0=1<<19,g0=1<<20,y0=1<<21,x0=1<<22,b0=1<<23,v0=1<<24,w0=1<<25,_0=1<<26,S0=1<<27,k0=1<<28,I0=1<<29,C0=1<<30,NE=1<<31,Da=127,BE=p0-1,VE=m0-1,HE=h0-1,qE=g0-1,zE=y0-1,WE=x0-1,jE=b0-1,KE=v0-1,GE=w0-1,JE=_0-1,YE=S0-1,QE=k0-1,ZE=I0-1,XE=C0-1,L0=Number.MAX_SAFE_INTEGER,eP=Number.MIN_SAFE_INTEGER,tP=1<<31,rP=Number.isInteger||(o=>typeof o=="number"&&isFinite(o)&&gg(o)===o),oP=Number.isNaN,nP=Number.parseInt,T0=class{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}},Rr=()=>new T0,Uf=o=>{let e=o.cpos;for(let t=0;t<o.bufs.length;t++)e+=o.bufs[t].length;return e},vr=o=>{let e=new Uint8Array(Uf(o)),t=0;for(let r=0;r<o.bufs.length;r++){let n=o.bufs[r];e.set(n,t),t+=n.length}return e.set(wg(o.cbuf.buffer,0,o.cpos),t),e},Fa=(o,e)=>{let t=o.cbuf.length;o.cpos===t&&(o.bufs.push(o.cbuf),o.cbuf=new Uint8Array(t*2),o.cpos=0),o.cbuf[o.cpos++]=e},Bt=(o,e)=>{for(;e>Da;)Fa(o,xg|Da&e),e=gg(e/128);Fa(o,Da&e)},Df=new Uint8Array(3e4),A0=Df.length/3,M0=(o,e)=>{if(e.length<A0){let t=vi.encodeInto(e,Df).written||0;Bt(o,t);for(let r=0;r<t;r++)Fa(o,Df[r])}else bs(o,r0(e))},E0=(o,e)=>{let t=unescape(encodeURIComponent(e)),r=t.length;Bt(o,r);for(let n=0;n<r;n++)Fa(o,t.codePointAt(n))},sP=vi&&vi.encodeInto?M0:E0,P0=(o,e)=>{let t=o.cbuf.length,r=o.cpos,n=yg(t-r,e.length),s=e.length-n;o.cbuf.set(e.subarray(0,n),r),o.cpos+=n,s>0&&(o.bufs.push(o.cbuf),o.cbuf=new Uint8Array(u0(t*2,s)),o.cbuf.set(e.subarray(n)),o.cpos=s)},bs=(o,e)=>{Bt(o,e.byteLength),P0(o,e)},iP=new DataView(new ArrayBuffer(4)),bg=o=>new Error(o),D0=bg("Unexpected end of array"),F0=bg("Integer out of Range"),R0=class{constructor(o){this.arr=o,this.pos=0}},U0=o=>new R0(o),O0=(o,e)=>{let t=wg(o.arr.buffer,o.pos+o.arr.byteOffset,e);return o.pos+=e,t},$0=o=>O0(o,vg(o)),vg=o=>{let e=0,t=1,r=o.arr.length;for(;o.pos<r;){let n=o.arr[o.pos++];if(e=e+(n&Da)*t,t*=128,n<xg)return e;if(e>L0)throw F0}throw D0},N0=o=>new Uint8Array(o),wg=(o,e,t)=>new Uint8Array(o,e,t),B0=o=>new Uint8Array(o),V0=o=>{let e="";for(let t=0;t<o.byteLength;t++)e+=dg(o[t]);return btoa(e)},H0=o=>Buffer.from(o.buffer,o.byteOffset,o.byteLength).toString("base64"),q0=o=>{let e=atob(o),t=N0(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t},z0=o=>{let e=Buffer.from(o,"base64");return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)},W0=hg?V0:H0,j0=hg?q0:z0,_g=new Map,K0=class{constructor(o){this.room=o,this.onmessage=null,this._onChange=e=>e.key===o&&this.onmessage!==null&&this.onmessage({data:j0(e.newValue||"")}),n0(this._onChange)}postMessage(o){mg.setItem(this.room,W0(B0(o)))}close(){s0(this._onChange)}},G0=typeof BroadcastChannel=="undefined"?K0:BroadcastChannel,Of=o=>fg(_g,o,()=>{let e=ug(),t=new G0(o);return t.onmessage=r=>e.forEach(n=>n(r.data,"broadcastchannel")),{bc:t,subs:e}}),J0=(o,e)=>(Of(o).subs.add(e),e),Y0=(o,e)=>{let t=Of(o),r=t.subs.delete(e);return r&&t.subs.size===0&&(t.bc.close(),_g.delete(o)),r},ys=(o,e,t=null)=>{let r=Of(o);r.bc.postMessage(e),r.subs.forEach(n=>n(e,t))},Ff=Date.now,Q0=class{constructor(){this._observers=xs()}on(o,e){fg(this._observers,o,ug).add(e)}once(o,e){let t=(...r)=>{this.off(o,t),e(...r)};this.on(o,t)}off(o,e){let t=this._observers.get(o);t!==void 0&&(t.delete(e),t.size===0&&this._observers.delete(o))}emit(o,e){return J1((this._observers.get(o)||xs()).values()).forEach(t=>t(...e))}destroy(){this._observers=xs()}},Z0=o=>i0(o,(e,t)=>`${encodeURIComponent(t)}=${encodeURIComponent(e)}`).join("&"),Cn=0,Sg=3,vs=1,X0=2,wi=[];wi[Cn]=(o,e,t,r,n)=>{Bt(o,Cn);let s=og(e,o,t.doc,t);r&&s===Aa&&!t.synced&&(t.synced=!0)};wi[Sg]=(o,e,t,r,n)=>{Bt(o,vs),bs(o,gs(t.awareness,Array.from(t.awareness.getStates().keys())))};wi[vs]=(o,e,t,r,n)=>{sg(t.awareness,$0(e),t)};wi[X0]=(o,e,t,r,n)=>{ng(e,t.doc,(s,i)=>eS(t,i))};var cg=3e4,eS=(o,e)=>console.warn(`Permission denied to access ${o.url}.
${e}`),kg=(o,e,t)=>{let r=U0(e),n=Rr(),s=vg(r),i=o.messageHandlers[s];return i?i(n,r,o,t,s):console.error("Unable to compute message"),n},Ig=o=>{if(o.shouldConnect&&o.ws===null){let e=new o._WS(o.url);e.binaryType="arraybuffer",o.ws=e,o.wsconnecting=!0,o.wsconnected=!1,o.synced=!1,e.onmessage=t=>{o.wsLastMessageReceived=Ff();let r=kg(o,new Uint8Array(t.data),!0);Uf(r)>1&&e.send(vr(r))},e.onerror=t=>{o.emit("connection-error",[t,o])},e.onclose=t=>{o.emit("connection-close",[t,o]),o.ws=null,o.wsconnecting=!1,o.wsconnected?(o.wsconnected=!1,o.synced=!1,Pa(o.awareness,Array.from(o.awareness.getStates().keys()).filter(r=>r!==o.doc.clientID),o),o.emit("status",[{status:"disconnected"}])):o.wsUnsuccessfulReconnects++,setTimeout(Ig,yg(d0(2,o.wsUnsuccessfulReconnects)*100,o.maxBackoffTime),o)},e.onopen=()=>{o.wsLastMessageReceived=Ff(),o.wsconnecting=!1,o.wsconnected=!0,o.wsUnsuccessfulReconnects=0,o.emit("status",[{status:"connected"}]);let t=Rr();if(Bt(t,Cn),Ma(t,o.doc),e.send(vr(t)),o.awareness.getLocalState()!==null){let r=Rr();Bt(r,vs),bs(r,gs(o.awareness,[o.doc.clientID])),e.send(vr(r))}},o.emit("status",[{status:"connecting"}])}},Mf=(o,e)=>{let t=o.ws;o.wsconnected&&t&&t.readyState===t.OPEN&&t.send(e),o.bcconnected&&ys(o.bcChannel,e,o)},Cg=class extends Q0{constructor(o,e,t,{connect:r=!0,awareness:n=new Ea(t),params:s={},WebSocketPolyfill:i=WebSocket,resyncInterval:a=-1,maxBackoffTime:l=2500,disableBc:c=!1}={}){for(super();o[o.length-1]==="/";)o=o.slice(0,o.length-1);let f=Z0(s);this.maxBackoffTime=l,this.bcChannel=o+"/"+e,this.url=o+"/"+e+(f.length===0?"":"?"+f),this.roomname=e,this.doc=t,this._WS=i,this.awareness=n,this.wsconnected=!1,this.wsconnecting=!1,this.bcconnected=!1,this.disableBc=c,this.wsUnsuccessfulReconnects=0,this.messageHandlers=wi.slice(),this._synced=!1,this.ws=null,this.wsLastMessageReceived=0,this.shouldConnect=r,this._resyncInterval=0,a>0&&(this._resyncInterval=setInterval(()=>{if(this.ws&&this.ws.readyState===WebSocket.OPEN){let u=Rr();Bt(u,Cn),Ma(u,t),this.ws.send(vr(u))}},a)),this._bcSubscriber=(u,d)=>{if(d!==this){let m=kg(this,new Uint8Array(u),!1);Uf(m)>1&&ys(this.bcChannel,vr(m),this)}},this._updateHandler=(u,d)=>{if(d!==this){let m=Rr();Bt(m,Cn),rg(m,u),Mf(this,vr(m))}},this.doc.on("update",this._updateHandler),this._awarenessUpdateHandler=({added:u,updated:d,removed:m},p)=>{let y=u.concat(d).concat(m),g=Rr();Bt(g,vs),bs(g,gs(n,y)),Mf(this,vr(g))},this._unloadHandler=()=>{Pa(this.awareness,[t.clientID],"window unload")},typeof window!="undefined"?window.addEventListener("unload",this._unloadHandler):typeof process!="undefined"&&process.on("exit",this._unloadHandler),n.on("update",this._awarenessUpdateHandler),this._checkInterval=setInterval(()=>{var u;this.wsconnected&&cg<Ff()-this.wsLastMessageReceived&&((u=this.ws)==null||u.close())},cg/10),r&&this.connect()}get synced(){return this._synced}set synced(o){this._synced!==o&&(this._synced=o,this.emit("synced",[o]),this.emit("sync",[o]))}destroy(){this._resyncInterval!==0&&clearInterval(this._resyncInterval),clearInterval(this._checkInterval),this.disconnect(),typeof window!="undefined"?window.removeEventListener("unload",this._unloadHandler):typeof process!="undefined"&&process.off("exit",this._unloadHandler),this.awareness.off("update",this._awarenessUpdateHandler),this.doc.off("update",this._updateHandler),super.destroy()}connectBc(){if(this.disableBc)return;this.bcconnected||(J0(this.bcChannel,this._bcSubscriber),this.bcconnected=!0);let o=Rr();Bt(o,Cn),Ma(o,this.doc),ys(this.bcChannel,vr(o),this);let e=Rr();Bt(e,Cn),Lf(e,this.doc),ys(this.bcChannel,vr(e),this);let t=Rr();Bt(t,Sg),ys(this.bcChannel,vr(t),this);let r=Rr();Bt(r,vs),bs(r,gs(this.awareness,[this.doc.clientID])),ys(this.bcChannel,vr(r),this)}disconnectBc(){let o=Rr();Bt(o,vs),bs(o,gs(this.awareness,[this.doc.clientID],new Map)),Mf(this,vr(o)),this.bcconnected&&(Y0(this.bcChannel,this._bcSubscriber),this.bcconnected=!1)}disconnect(){this.shouldConnect=!1,this.disconnectBc(),this.ws!==null&&this.ws.close()}connect(){this.shouldConnect=!0,!this.wsconnected&&this.ws===null&&(Ig(this),this.connectBc())}};var Ct=new WeakMap,Lg=!1;function Ua(o){Lg=o}var wr={maxFileSize:1024*1024,maxBackups:5,disableConsole:!1,batchInterval:1e3,maxRetries:3,allowStackTraces:!1},Vt,Ht,Ra=[];function Tg(o,e,t,r){Ht=o,Vt=t,r&&(wr={...wr,...r}),e.setInterval(Nf,wr.batchInterval)}async function Nf(){if(Ra.length===0)return;let o=[...Ra];Ra.length=0;for(let e=0;e<wr.maxRetries;e++)try{await tS();let t=o.map($f).join(`
`)+`
`;await Ht.append(Vt,t);return}catch(t){console.error(`Failed to write logs (attempt ${e+1}):`,t),e===wr.maxRetries-1&&console.error("Max retries reached. Discarding log entries.")}}async function tS(){let o=await Ht.stat(Vt);if(o&&o.size>wr.maxFileSize){for(let e=wr.maxBackups;e>0;e--){let t=`${Vt}.${e}`,r=`${Vt}.${e+1}`;await Ht.exists(t)&&(e===wr.maxBackups?await Ht.remove(t):await Ht.rename(t,r))}await Ht.exists(Vt)&&await Ht.rename(Vt,`${Vt}.1`),await Ht.write(Vt,"")}}function $f(o){return`[${o.timestamp}] [${o.level.toUpperCase()}] ${o.message}
    at ${o.callerInfo}`}var rS=["token","authorization","email","key"];function oS(o){if(typeof o=="object"&&o!==null){let e=new WeakSet;try{return JSON.stringify(o,(t,r)=>{var n;if(typeof r=="object"&&r!==null){if(e.has(r))return"[Circular]";e.add(r)}return typeof t=="string"&&rS.some(s=>t.toLowerCase().includes(s.toLowerCase()))?"[REDACTED]":r instanceof Error?{name:r.name,message:r.message,stack:(n=r.stack)==null?void 0:n.split(`
`).map(s=>s.trim()).join(" ")}:r},2)}catch(t){return t instanceof Error?t instanceof RangeError?`[Complex Object: ${Object.prototype.toString.call(o)}]`:`[Unserializable: ${t.message}]`:"[Unknown Error]"}}return String(o)}function ke(o,e="log"){return(...t)=>{if(Lg){let r=new Date().toISOString(),n=new Error().stack,s=n?n.split(`
`)[2].trim():"",i=t.map(oS).join(" "),a={timestamp:r,level:e,message:`${o}: ${i}`,callerInfo:s};if(!wr.disableConsole)if(wr.allowStackTraces||e==="debug"||e==="log")console[e]($f(a));else{let l={warn:"color: #ff8c00; background: rgba(255, 140, 0, 0.1); font-weight: normal; padding: 1px 4px; border-radius: 2px;",error:"color: #ff5555; background: rgba(255, 85, 85, 0.1); font-weight: normal; padding: 1px 4px; border-radius: 2px;"};console.log(`%c${$f(a)}`,l[e])}Ra.push(a)}}}async function Oa(){let o=[];await Ht.exists(Vt)&&o.push(Vt);for(let e=1;e<=wr.maxBackups;e++){let t=`${Vt}.${e}`;await Ht.exists(t)&&o.push(t)}return o}async function Ag(){let o=[];if(await Ht.exists(Vt)){let e=await Ht.read(Vt);o.push(e)}for(let e=1;e<=wr.maxBackups;e++){let t=`${Vt}.${e}`;if(await Ht.exists(t)){let r=await Ht.read(t);o.push(r)}}return o.reverse().join(`
`)}var yt=class{constructor(e){let t=e||this.constructor.name;this.debug=ke(`[${t}]`,"debug"),this.log=ke(`[${t}]`,"log"),this.warn=ke(`[${t}]`,"warn"),this.error=ke(`[${t}]`,"error")}setLoggers(e){this.debug=ke(`[${e}]`,"debug"),this.log=ke(`[${e}]`,"log"),this.warn=ke(`[${e}]`,"warn"),this.error=ke(`[${e}]`,"error")}};var Bf=class{constructor(){this.platform="s3rn";this.product="relay"}},Vf=class{constructor(e){this.relayId=e;this.platform="s3rn";this.product="relay"}},xo=class{constructor(e,t){this.relayId=e;this.folderId=t;this.platform="s3rn";this.product="relay"}},Ur=class{constructor(e,t,r){this.relayId=e;this.folderId=t;this.documentId=r;this.platform="s3rn";this.product="relay"}},Zt=class{constructor(e,t,r){this.relayId=e;this.folderId=t;this.canvasId=r;this.platform="s3rn";this.product="relay"}},bo=class{constructor(e,t,r){this.relayId=e;this.folderId=t;this.fileId=r;this.platform="s3rn";this.product="relay"}},Hf=class{constructor(e,t,r,n,s,i){this.relayId=e;this.folderId=t;this.fileId=r;this.hash=n;this.contentType=s;this.contentLength=i;this.platform="s3rn";this.product="relay"}},_r=class{constructor(e){this.folderId=e;this.platform="s3rn";this.product="relay"}},vo=class{constructor(e,t){this.folderId=e;this.documentId=t;this.platform="s3rn";this.product="relay"}},Ln=class{constructor(e,t){this.folderId=e;this.canvasId=t;this.platform="s3rn";this.product="relay"}},_i=class{constructor(e,t){this.folderId=e;this.fileId=t;this.platform="s3rn";this.product="relay"}},at=class{static validateUUID(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e)}static encode(e){let t=`${e.platform}:${e.product}`;if("relayId"in e){if(!this.validateUUID(e.relayId))throw new Error("Invalid relay UUID");t+=`:relay:${e.relayId}`}if("folderId"in e){if(!this.validateUUID(e.folderId))throw new Error("Invalid folder UUID");t+=`:folder:${e.folderId}`}if("documentId"in e){if(!this.validateUUID(e.documentId))throw new Error("Invalid document UUID");t+=`:doc:${e.documentId}`}if("canvasId"in e){if(!this.validateUUID(e.canvasId))throw new Error("Invalid document UUID");t+=`:canvas:${e.canvasId}`}if("fileId"in e){if(!this.validateUUID(e.fileId))throw new Error("Invalid document UUID");if(t+=`:file:${e.fileId}`,"hash"in e&&e.hash&&"contentType"in e&&"contentLength"in e){if(!this.validateUUID(e.fileId))throw new Error("Invalid document UUID");t+=`:sha256:${e.hash}`,t+=`:contentType:${e.contentType}`,t+=`:contentLength:${e.contentLength}`}}return t}static decode(e){let t=e.split(":");if(t.length<3)throw new Error("Invalid s3rn format");let[,r,n,s,i,a,l,c,f,u,d,m,p,y]=t;if(!this.validateUUID(s))throw new Error("Invalid UUID");if(a&&!this.validateUUID(a))throw new Error("Invalid UUID");if(c&&!this.validateUUID(c))throw new Error("Invalid UUID");if(r==="relay"&&n==="relay"&&i==="folder"&&l==="doc")return new Ur(s,a,c);if(r==="relay"&&n==="relay"&&i==="folder"&&l==="canvas")return new Zt(s,a,c);if(r==="relay"&&n==="relay"&&i==="folder"&&l==="file"&&f==="hash"&&d==="contentType"&&p==="contentLength")return new Hf(s,a,c,u,m,y);if(r==="relay"&&n==="relay"&&i==="folder"&&l==="file")return new bo(s,a,c);if(r==="relay"&&n==="relay"&&i=="folder")return new xo(s,a);if(r==="relay"&&n==="folder"&&i==="document")return new vo(s,a);if(r==="relay"&&n==="folder"&&i==="canvas")return new Ln(s,a);if(r==="relay"&&n==="folder")return new _r(s);if(r==="relay"&&n==="relay")return new Vf(s);if(n===void 0)return new Bf;throw new Error("Invalid s3rn format for the given product type")}};function nS(o){if(typeof window!="undefined"&&window.btoa)return window.btoa(o);if(typeof Buffer!="undefined")return Buffer.from(o).toString("base64");throw new Error("Unable to encode to Base64")}function Mg(o){let e=JSON.stringify(o),t=nS(e);return t=t.replace("+","-").replace("/","_").replace(/=+$/,""),t}var Si={enableDocumentStatus:!1,enableNewLinkFormat:!1,enableDeltaLogging:!1,enableHTTPSync:!1,enableSyncMenu:!0,enableDocumentHistory:!1,enableEditorTweens:!1,enableSyncModal:!1,enableAttachmentSync:!0,enableNetworkLogging:!1,enableCanvasSync:!1,enableVerifyUploads:!1,enableAutomaticDiffResolution:!1,enableDiscordLogin:!1,enableOIDCLogin:!1,enableGitHubLogin:!1,enableSelfManageHosts:!1};function $a(o){return o in Si}function sS(){return new Proxy({},{get:(o,e)=>e})}var wo=sS();var _s=class{constructor(){this.timeouts=[],this.intervals=[]}getTime(){return Date.now()}setInterval(e,t){let r=window.setInterval(e,t);return this.intervals.push(r),r}clearInterval(e){window.clearInterval(e)}setTimeout(e,t){let r=window.setTimeout(()=>{this.timeouts.remove(r),e()},t);return this.timeouts.push(r),r}clearTimeout(e){window.clearTimeout(e)}destroy(){for(let e of this.timeouts)this.clearTimeout(e);this.timeouts=[];for(let e of this.intervals)this.clearInterval(e);this.intervals=[]}debounce(e,t=500){let r;return(...n)=>{r&&clearTimeout(r),r=setTimeout(()=>{e(...n)},t)}}};var Et=class{constructor(e,t=20){this.timeProvider=e;this.deliveryWindow=t;this.mailboxes=new Map;this.allMailLog=[];this.deliveredMailLog=[];this.isDelivering=!1;this.deliveryInterval=null;this.currentTransactionId=0;this.isInTransaction=!1}static getInstance(){if(this._destroyed)throw new Error("tried to access postie during teardown");return Et.instance||(Et.instance=new Et(new _s),Ct.set(this.instance,"postie")),Et.instance}beginTransaction(){this.isInTransaction=!0,this.currentTransactionId++}commitTransaction(){this.isInTransaction=!1,this.isDelivering||this.scheduleDelivery()}send(e,t,r=!1){let n={sender:e,recipient:t,transactionId:this.currentTransactionId,timestamp:Date.now(),recipientOrigin:this.getFunctionOrigin(t)};this.allMailLog.push(n),this.mailboxes.has(t)||this.mailboxes.set(t,new Set),this.mailboxes.get(t).add(e),r?this.deliverImmediate(e,t):!this.isInTransaction&&!this.isDelivering&&this.scheduleDelivery()}deliverImmediate(e,t){t(e),this.deliveredMailLog.push({sender:e,recipient:t,transactionId:this.currentTransactionId,timestamp:Date.now(),recipientOrigin:this.getFunctionOrigin(t)})}scheduleDelivery(){this.isDelivering=!0,this.deliveryInterval=this.timeProvider.setTimeout(()=>{this.deliver(),this.deliveryInterval=null,this.isDelivering=!1,this.mailboxes.size>0&&!this.isInTransaction&&this.scheduleDelivery()},this.deliveryWindow)}deliver(){let e=ke("[postie]","debug");for(let[t,r]of this.mailboxes){for(let n of r)t(n),e("send",n.constructor.name,t),this.deliveredMailLog.push({sender:n,recipient:t,transactionId:this.currentTransactionId,timestamp:Date.now(),recipientOrigin:this.getFunctionOrigin(t)});r.clear()}}getAllMailLog(){return[...this.allMailLog]}getDeliveredMailLog(){return[...this.deliveredMailLog]}prettyPrintAllMailLog(){ke("[postie]","warn")(`All Mail Log:
`+this.prettyPrintMailLog(this.allMailLog))}prettyPrintDeliveredMailLog(){ke("[postie]","warn")(`Delivered Mail Log:
`+this.prettyPrintMailLog(this.deliveredMailLog))}prettyPrintMailLog(e){let t="",r=n=>{t+=`${n}
`};return e.forEach((n,s)=>{r(`Mail #${s+1}:`),r(`  Timestamp: ${new Date(n.timestamp).toISOString()}`),r(`  Transaction ID: ${n.transactionId}`),r(`  Sender: ${n.sender.observableName||n.sender.constructor.name}`),r(`  Recipient: ${n.recipient.name||"Anonymous function"}`),r(`  Recipient Origin: ${n.recipientOrigin||"Unknown"}`),r("---")}),t}getFunctionOrigin(e){if(e.name)return e.name;let t=e.toString(),r=t.match(/^(function|class)?\s*([^\s(]*)/);if(r&&r[2])return r[2];let n=200,s=t.replace(/\s+/g," ").slice(0,n);return s.length===n&&(s+="..."),`AnonymousFunction(${s})`}static destroy(){Et.instance&&(Et.instance.mailboxes=null,Et.instance.allMailLog=[],Et.instance.deliveredMailLog=[],Et.instance.timeProvider.destroy(),Et.instance.timeProvider=null,Et.instance.isDelivering=!1,Et.instance.isInTransaction=!1,Et.instance.currentTransactionId=0,Et._destroyed=!0,Et.instance=void 0)}},Sr=Et;Sr._destroyed=!1;var qf=new Map;function Eg(){for(let[,o]of qf)o();qf.clear()}var et=class extends yt{constructor(t){super();this.observableName=t;this.destroyed=!1;qf.set(this,()=>{this._listeners&&this._listeners.size>0&&this.warn(`Missing tear down of ${this._listeners.size} listeners on ${this.observableName}`)}),this._listeners=new Set,this.unsubscribes=[]}notifyListeners(){for(let t of this._listeners)Sr.getInstance().send(this,t)}on(t){return this._listeners.add(t),()=>{this.off(t)}}subscribe(t){return this._listeners.add(t),Sr.getInstance().send(this,t,!0),()=>{this.unsubscribe(t)}}off(t){this._listeners.delete(t)}unsubscribe(t){this._listeners&&this._listeners.delete(t)}destroy(){var t;this.destroyed=!0,this.unsubscribes&&this.unsubscribes.forEach(r=>{r()}),(t=this._listeners)==null||t.clear(),this._listeners=null}};function Ve(){return{...xt.getInstance().flags}}function jo(o,e,t=()=>{}){xt.getInstance().flags[o]?e():t()}function Pg(o,e,t=()=>{}){o.forEach(r=>{if(xt.getInstance().flags[r]){e();return}}),t()}var xt=class extends et{constructor(){super();this.flags=Si}async applyServerFlags(t){if(!this.settings)return;let n=t.filter(s=>s.override).reduce((s,i)=>(s[i.name]=i.value,s),{});this.log("applying server flags",n),await this.settings.update(s=>({...s,...n}),!0)}static getInstance(){return xt.instance||(xt.instance=new xt),xt.instance}setSettings(t){this.settings=t,this.settings.subscribe(r=>{this.flags={...this.flags,...r},this.notifyListeners()})}getFlag(t){return this.flags[t]}setFlag(t,r){this.settings&&this.settings.update(n=>({...n,[t]:r}))}static destroy(){xt.instance=null}};var iS={3:"disconnected",2:"disconnected",1:"connected",0:"connecting"};function Dg(o,e,t){let r={token:o.token},n=new Cg(o.url,o.docId,e,{connect:!1,params:r,disableBc:!0});return t&&n.awareness.setLocalStateField("user",{name:t.name,id:t.id,color:t.color.color,colorLight:t.color.light}),n}var _o=class extends yt{constructor(t,r,n,s){var c;super();this.guid=t;this._s3rn=r;this.tokenStore=n;this.loginManager=s;this._providerSynced=!1;this.PROVIDER_MAX_ERRORS=3;this.listeners=new Map,this.loginManager=s;let i=(c=this.loginManager)==null?void 0:c.user;this.ydoc=new ir,Ve().enableDocumentHistory&&(this.ydoc.gc=!1),i&&new ya(this.ydoc).setUserMapping(this.ydoc,this.ydoc.clientID,i.id),this.tokenStore=n,this.clientToken=this.tokenStore.getTokenSync(at.encode(this.s3rn))||{token:"",url:"",docId:"-",expiryTime:0},this._provider=Dg(this.clientToken,this.ydoc,i);let a=this.providerConnectionErrorSubscription(f=>{this.log(`[${this.path}] disconnection event`,f);let u=this._provider.url&&this._provider.shouldConnect&&this._provider.wsUnsuccessfulReconnects<this.PROVIDER_MAX_ERRORS;this.disconnect(),u&&this.connect()});a.on(),this._offConnectionError=a.off;let l=this.providerStateSubscription(f=>{this.notifyListeners()});l.on(),this._offState=l.off}get s3rn(){return this._s3rn}set s3rn(t){this._s3rn=t,this.refreshProvider(this.clientToken)}get debuggerUrl(){return`https://debugger.y-sweet.dev/?payload=${Mg(this.clientToken)}`}notifyListeners(){this.debug("[Provider State]",this.path,this.state),this.listeners.forEach(t=>{t(this.state)})}subscribe(t,r){return this.listeners.set(t,r),()=>{this.unsubscribe(t)}}unsubscribe(t){this.listeners.delete(t)}async getProviderToken(){return this.log("get provider token"),this.tokenStore.getToken(at.encode(this.s3rn),this.path||"unknown",this.refreshProvider.bind(this))}providerActive(){var t;if(this.clientToken){let r=this._provider.url==this.clientToken.url,n=Date.now()>(((t=this.clientToken)==null?void 0:t.expiryTime)||0);return r&&!n}return!1}refreshProvider(t){var i;this.clientToken=t;let r=new ir,n=Dg(t,r),s=n.url;if(this._provider){if(this._provider.url!==s){this._provider.url=s,this._provider.wsUnsuccessfulReconnects=0;let a=this._provider.url.replace(/token=[^&]+/,"token=[REDACTED]");this.log(`Token Refreshed: setting new provider url, ${a}`),(i=this._provider.ws)==null||i.close()}}else throw new Error("missing provider!");n.awareness.destroy(),n.destroy(),r.destroy()}get connected(){return this.state.status==="connected"}connect(){return this.connected?Promise.resolve(!0):this.getProviderToken().then(t=>(this.refreshProvider(t),this._provider.connect(),this.notifyListeners(),!0)).catch(t=>!1)}get state(){var t;return{status:iS[((t=this._provider.ws)==null?void 0:t.readyState)||3],intent:this.intent}}get intent(){return this._provider.shouldConnect?"connected":"disconnected"}get synced(){return this._providerSynced}disconnect(){var t;this._provider.shouldConnect=!1,(t=this._provider.ws)==null||t.close(),this._provider.ws=null,this.tokenStore.removeFromRefreshQueue(this.guid),this.notifyListeners()}withActiveProvider(){return this.providerActive()?new Promise(t=>{t(this)}):this.getProviderToken().then(t=>this)}onceConnected(){return new Promise(t=>{let r=n=>{n.status==="connected"&&t()};this._provider.on("status",r)})}onceProviderSynced(){return this.synced?new Promise(t=>{t()}):new Promise(t=>{this._provider.once("synced",()=>{this._providerSynced=!0,t()})})}reset(){this.disconnect(),this.clientToken={token:"",url:"",docId:"-",expiryTime:0}}_injectIntent(t){return n=>{t({status:n.status,intent:this.intent})}}providerConnectionErrorSubscription(t){return{on:()=>{this._provider.on("connection-error",t)},off:()=>{this._provider.off("connection-error",t)}}}providerStateSubscription(t){return{on:()=>{this._provider.on("status",this._injectIntent(t))},off:()=>{this._provider.off("status",this._injectIntent(t))}}}destroy(){this._offConnectionError&&this._offConnectionError(),this._offState&&this._offState(),this._provider&&(this._provider.ws&&(this._provider.ws.onopen=null,this._provider.ws.onmessage=null,this._provider.ws.onerror=null,this._provider.ws.onclose=null,(this._provider.ws.readyState===WebSocket.OPEN||this._provider.ws.readyState===WebSocket.CONNECTING)&&this._provider.ws.close(1e3,"Destroyed"),this._provider.ws=null),this._provider.disconnect(),this._provider.awareness.destroy(),this._provider._observers.clear(),this._provider.destroy(),window.clearInterval(this._provider.awareness._checkInterval)),this.loginManager=null}};var So=class{constructor(e,t,r){this.vault=e;this.contents=r;this.parent=null;this.path=t,this.name=t.split("/").pop()||"",this.extension=this.name.includes(".")&&this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.stat={ctime:Date.now(),mtime:Date.now(),size:0}}delete(){return Promise.resolve()}rename(e){return this.path=e,this.name=e.split("/").pop()||"",this.extension=this.name.includes(".")&&this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),Promise.resolve()}getBasePath(){return this.path.substring(0,this.path.lastIndexOf("/"))}},Na=class{constructor(){this.dbName="RelayDiskBuffer";this.storeName="diskBuffers";this.dbPromise=null}async getDB(){return this.dbPromise||(this.dbPromise=this.openDB()),this.dbPromise}async openDB(){return new Promise((e,t)=>{let r=indexedDB.open(this.dbName,1);r.onerror=()=>t(r.error),r.onsuccess=()=>e(r.result),r.onupgradeneeded=n=>{n.target.result.createObjectStore(this.storeName,{keyPath:"guid"})}})}async saveDiskBuffer(e,t){let r=await this.getDB();return new Promise((n,s)=>{try{let l=r.transaction(this.storeName,"readwrite").objectStore(this.storeName).put({guid:e,contents:t});l.onerror=()=>s(l.error),l.onsuccess=()=>n()}catch(i){s(i)}})}async loadDiskBuffer(e){let t=await this.getDB();return new Promise((r,n)=>{try{let a=t.transaction(this.storeName,"readonly").objectStore(this.storeName).get(e);a.onerror=()=>n(a.error),a.onsuccess=()=>r(a.result?a.result.contents:null)}catch(s){n(s)}})}async removeDiskBuffer(e){let t=await this.getDB();return new Promise((r,n)=>{try{let a=t.transaction(this.storeName,"readwrite").objectStore(this.storeName).delete(e);a.onerror=()=>n(a.error),a.onsuccess=()=>r()}catch(s){n(s)}})}};var Or=class{constructor(e,t){this.currentPromise=null;this.promiseFunction=e,this.checkFunction=t}getPromise(){let[e,t]=this.checkFunction(),r=n=>{if(this.currentPromise&&this.resolver){let s=this.resolver;s(n),this.timeoutId&&clearTimeout(this.timeoutId),this.resolver=void 0}return this.currentPromise};if(e){let n=r(t);if(n)return n}return this.currentPromise||(this.currentPromise=new Promise((n,s)=>{this.resolver=n,this.timeoutId=window.setTimeout(()=>{ke("[Promise]","debug")("Dependency stuck after 3s. Checking.",this.promiseFunction.toString());let[i,a]=this.checkFunction();i&&r(a)},3e3),this.promiseFunction().then(i=>{this.timeoutId&&clearTimeout(this.timeoutId),n(i)},i=>{this.timeoutId&&clearTimeout(this.timeoutId),this.currentPromise=null,s(i)})})),this.currentPromise}destroy(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=void 0),this.currentPromise=null,this.resolver=void 0}},Ba=class{constructor(e){this.currentPromise=null;this.promiseFunction=e}getPromise(){return this.currentPromise||(this.currentPromise=new Promise((e,t)=>{this.timeoutId=window.setTimeout(()=>{ke("[Promise]","error")("SharedPromise stuck after 3s:",this.promiseFunction.toString())},3e3),this.promiseFunction().then(r=>{this.timeoutId&&clearTimeout(this.timeoutId),this.currentPromise=null,e(r)},r=>{this.timeoutId&&clearTimeout(this.timeoutId),this.currentPromise=null,t(r)})})),this.currentPromise}destroy(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=void 0),this.currentPromise=null}};function Fg(o,...e){return new Promise((t,r)=>{let n=window.setTimeout(()=>{ke("[Promise]","debug")("Promise stuck after 3s:",...e)},3e3);o.then(s=>{clearTimeout(n),t(s)},s=>{clearTimeout(n),r(s)})})}var aS={md:"text/markdown",txt:"text/plain",json:"application/json",js:"application/javascript",ts:"application/typescript",html:"text/html",css:"text/css",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",svg:"image/svg+xml",pdf:"application/pdf",canvas:"application/canvas+json",webp:"image/webp",avif:"image/avif",bmp:"image/bmp",mp3:"audio/mpeg",wav:"audio/wav",m4a:"audio/x-m4a",flac:"audio/flac",ogg:"audio/ogg",oga:"audio/ogg",opus:"audio/opus",mp4:"video/mp4",webm:"video/webm",ogv:"video/ogg",mov:"video/quicktime",mkv:"video/x-matroska","3gp":"video/3gpp"};function Ko(o){var t;let e=((t=o.split(".").pop())==null?void 0:t.toLowerCase())||"";return aS[e]||"application/octet-stream"}var Rg=zn(zf());function ks(o,e,t){let r=o.getText("contents"),n=r.toString(),s=new Rg.diff_match_patch,i=s.diff_main(n,e);s.diff_cleanupSemantic(i);let a=0,l=Ve().enableDeltaLogging?ke("[diffMatchPatch]","debug"):(...c)=>{};l("Updating YDoc:"),l("Current content length:",n.length),l("Disk buffer length:",e.length),i.length!=0&&(o.transact(()=>{for(let[c,f]of i){switch(c){case 1:l(`Inserting "${f}" at position ${a}`),r.insert(a,f),a+=f.length;break;case 0:l(`Keeping "${f}" (length: ${f.length})`),a+=f.length;break;case-1:l(`Deleting "${f}" at position ${a}`),r.delete(a,f.length);break}l("intermediate",r.toString())}},t),l("result",r.toString()),l("Update complete. New content length:",r.toString().length))}function ar(o){return o instanceof bt}var bt=class extends _o{constructor(t,r,n,s){let i=s.relayId?new Ur(s.relayId,s.guid,r):new vo(s.guid,r);super(r,i,s.tokenStore,n);this.whenSyncedPromise=null;this.persistenceSynced=!1;this.userLock=!1;this.unsubscribes=[];this.pendingOps=[];this._parent=s,this.path=t,this.name="[CRDT] "+t.split("/").pop()||"",this.setLoggers(this.name),this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.vault=this._parent.vault,this.stat={ctime:Date.now(),mtime:Date.now(),size:0},this._diskBufferStore=this.sharedFolder.diskBufferStore,this.unsubscribes.push(this._parent.subscribe(this.path,a=>{a.intent==="disconnected"&&this.disconnect()})),this.setLoggers(`[SharedDoc](${this.path})`);try{let a=`${this.sharedFolder.appId}-relay-doc-${this.guid}`;this._persistence=new Wo(a,this.ydoc)}catch(a){throw this.warn("Unable to open persistence.",this.guid),console.error(a),a}this.whenSynced().then(()=>{let a=l=>{let c=l.transaction.origin;l.changes.keys.size!==0&&c!=this&&this.updateStats()};this.ytext.observe(a),this.unsubscribes.push(()=>{var l;(l=this.ytext)==null||l.unobserve(a)}),this.updateStats();try{this._persistence.set("path",this.path),this._persistence.set("relay",this.sharedFolder.relayId||""),this._persistence.set("appId",this.sharedFolder.appId),this._persistence.set("s3rn",at.encode(this.s3rn))}catch(l){}(async()=>(await this.getServerSynced()||(await this.onceProviderSynced(),await this.markSynced()),this.sharedFolder.markUploaded(this)))()}),jo(wo.enableDeltaLogging,()=>{let a=l=>{var f,u;let c="";c+=`Transaction origin: ${l.transaction.origin} ${(u=(f=l.transaction.origin)==null?void 0:f.constructor)==null?void 0:u.name}
`;for(let d of l.changes.delta)c+=`insert: ${d.insert}

retain: ${d.retain}

delete: ${d.delete}
`;this.debug(c)};this.ytext.observe(a),this.unsubscribes.push(()=>{this.ytext.unobserve(a)})}),this._tfile=null}move(t,r){this.path=t,this._parent=r,this.name=t.split("/").pop()||"",this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.updateStats()}async process(t){this.tfile&&Ve().enableAutomaticDiffResolution&&this.pendingOps.push(t)}get parent(){var t;return((t=this.tfile)==null?void 0:t.parent)||null}get sharedFolder(){return this._parent}get tfile(){return this._tfile||(this._tfile=this._parent.getTFile(this)),this._tfile}get ytext(){return this.ydoc.getText("contents")}get text(){return this.ytext?this.ytext.toString():""}async diskBuffer(t=!1){if(t||this._diskBuffer===void 0){let r;try{let n=await this._parent.diskBufferStore.loadDiskBuffer(this.guid).catch(s=>null);return n!==null&&n!==""?r=n:r=await this._parent.read(this),this.setDiskBuffer(r.replace(`\r
`,`
`))}catch(n){throw console.error(n),n}}return this._diskBuffer}setDiskBuffer(t){return this._diskBuffer?this._diskBuffer.contents=t:this._diskBuffer=new So(this._parent.vault,"local disk",t),this._parent.diskBufferStore.saveDiskBuffer(this.guid,t).catch(r=>{}),this._diskBuffer}async clearDiskBuffer(){this._diskBuffer&&(this._diskBuffer.contents="",this._diskBuffer=void 0),await this._parent.diskBufferStore.removeDiskBuffer(this.guid).catch(t=>{})}async checkStale(){await this.whenSynced();let r=(await this.diskBuffer(!0)).contents,n=await this.sharedFolder.backgroundSync.downloadItem(this),s=new Uint8Array(n.arrayBuffer);xr(this.ydoc,s);let i=this.text!==r,a=this.text,l=a,c=[];for(let f of this.pendingOps)if(l=f(l),c.push(f),l==r){if(this.clearDiskBuffer(),a==this.text)ks(this.ydoc,l,this);else return Ve().enableDeltaLogging?this.warn("diffMatchPatch solution is stale an cannot be applied",l,this.text):this.log("diffMatchPatch solution is stale an cannot be applied"),!0;return this.pendingOps=[],!0}return this.pendingOps=[],i||this.clearDiskBuffer(),i}async connect(){return this.sharedFolder.s3rn instanceof _r?!1:(this.s3rn instanceof vo&&(this.sharedFolder.relayId?this.s3rn=new Ur(this.sharedFolder.relayId,this.sharedFolder.guid,this.guid):this.s3rn=new vo(this.sharedFolder.guid,this.guid)),this.sharedFolder.shouldConnect&&this.sharedFolder.connect().then(t=>super.connect()))}get ready(){return this._persistence.synced&&(this.synced||!!this._serverSynced||this._origin==="local")}hasLocalDB(){return!!this._serverSynced||this._persistence._dbsize>3||!!(this._dbsize&&this._dbsize>3)}async awaitingUpdates(){return await this.whenSynced(),await this.getServerSynced(),this._awaitingUpdates?(this._awaitingUpdates=!this.hasLocalDB(),this._awaitingUpdates):!1}async whenReady(){let t=async()=>await this.awaitingUpdates()?(this.log("awaiting updates"),this.connect(),await this.onceConnected(),this.log("connected"),await this.onceProviderSynced(),this.log("synced"),this):this;return this.readyPromise=this.readyPromise||new Or(t,()=>[this.ready,this]),this.readyPromise.getPromise()}whenSynced(){let t=async()=>(await this.sharedFolder.whenSynced(),this._persistence.synced&&!this.persistenceSynced?(await this.count(),this.persistenceSynced=!0,Promise.resolve()):new Promise(r=>{this.persistenceSynced&&r(),this._persistence.once("synced",async()=>{await this.count(),this.persistenceSynced=!0,r()})}));return this.whenSyncedPromise=this.whenSyncedPromise||new Or(t,()=>[this.persistenceSynced,void 0]),this.whenSyncedPromise.getPromise()}async hasKnownPeers(){return await this.whenSynced(),this.hasLocalDB()}get mimetype(){return Ko(this.path)}async markOrigin(t){this._origin=t,await this._persistence.set("origin",t)}async getOrigin(){return this._origin!==void 0?this._origin:(this._origin=await this._persistence.get("origin"),this._origin)}async markSynced(){this._serverSynced=!0,await this._persistence.set("serverSync",1)}async getServerSynced(){return this._serverSynced!==void 0?this._serverSynced:await this._persistence.get("serverSync")===1?(this._serverSynced=!0,this._serverSynced):!1}async count(){if(this._persistence.db===null)throw new Error("database not ready yet");if(this._dbsize)return this._dbsize;if(this._persistence._dbsize>3)return this._dbsize=this._persistence._dbsize,this._dbsize;let[t]=br(this._persistence.db,["updates"],"readonly"),r=await yo(t);return this._dbsize=r,this._dbsize}get dbsize(){if(!this._dbsize)throw new Error("dbsize accessed before count");return this._persistence._dbsize===0&&this._dbsize?this._dbsize:this._persistence._dbsize}static checkExtension(t){return t.endsWith(".md")}destroy(){var t,r;this.unsubscribes.forEach(n=>{n()}),super.destroy(),this.ydoc.destroy(),this._diskBuffer&&(this._diskBuffer.contents="",this._diskBuffer=void 0),this._diskBufferStore=null,(t=this.whenSyncedPromise)==null||t.destroy(),this.whenSyncedPromise=null,(r=this.readyPromise)==null||r.destroy(),this.readyPromise=null}async read(){return this.text}async cleanup(){var t;(t=this._diskBufferStore)==null||t.removeDiskBuffer(this.guid)}updateStats(){this.stat.mtime=Date.now(),this.stat.size=this.text.length}async write(t){this.ytext.delete(0,this.ytext.length),this.ytext.insert(0,t),this.updateStats()}async append(t){this.ytext.insert(this.ytext.length,t),this.updateStats()}};var Go=class extends et{constructor(){super();this._set=new Set}add(t){let r=this._set.size;return this._set.add(t),this._set.size>r&&this.notifyListeners(),this}delete(t){let r=this._set.delete(t);return r&&this.notifyListeners(),r}clear(){this._set.clear(),this.notifyListeners()}has(t){return this._set.has(t)}items(){return[...this._set]}get size(){return this._set.size}map(t){return this.items().map(t)}forEach(t){this.items().forEach(t)}find(t){return this.items().find(t)}some(t){for(let r of this._set)if(t(r))return!0;return!1}filter(t){let r=[];for(let n of this._set)t(n)&&r.push(n);return r}};var ko=class{constructor(e){this.seperator="/";this.namespace=e}fullKey(e){return`${this.namespace}${this.seperator}${e}`}get size(){return Object.keys(localStorage).filter(e=>e.startsWith(this.namespace+this.seperator)).length}clear(){Object.keys(localStorage).filter(e=>e.startsWith(this.namespace+this.seperator)).forEach(e=>localStorage.removeItem(e))}delete(e){let t=this.fullKey(e),r=localStorage.getItem(t)!==null;return localStorage.removeItem(t),r}forEach(e,t){Object.keys(localStorage).filter(r=>r.startsWith(this.namespace+this.seperator)).forEach(r=>{let n=r.split(`${this.namespace}${this.seperator}`)[1],s=this.get(n);e.call(t,s,n,this)})}get(e){let t=this.fullKey(e),r=localStorage.getItem(t);return r?JSON.parse(r):void 0}has(e){let t=this.fullKey(e);return localStorage.getItem(t)!==null}set(e,t){let r=this.fullKey(e);return localStorage.setItem(r,JSON.stringify(t)),this}keys(){return Object.keys(localStorage).filter(t=>t.startsWith(this.namespace+this.seperator)).map(t=>t.split(`${this.namespace}${this.seperator}`)[1]).values()}values(){return Array.from(this.keys()).map(t=>this.get(t)).values()}entries(){return Array.from(this.keys()).map(t=>[t,this.get(t)]).values()}[Symbol.iterator](){return this.entries()}get[Symbol.toStringTag](){return"LocalStorage"}};var Wf=require("obsidian");function jf(o){return o instanceof Jo}var Jo=class extends yt{constructor(t,r,n){super();this.path=t;this.guid=r;this._tfolder=null;this.ready=!1;this.createPromise=null;this.connected=!0;this._parent=n,this.name=this.path.split("/").pop()||"",this.vault=this._parent.vault;let s=()=>{let i=this.vault.getAbstractFileByPath(this.sharedFolder.getPath(t));return i instanceof Wf.TFolder?(this._tfolder=i,this.ready=!0,!0):!1};s()||(this.createPromise=this.vault.createFolder(this.sharedFolder.getPath(t)),this.createPromise.then(i=>{this._tfolder=i,this.ready=!0}).catch(()=>{s()})),this.synctime=0,this.setLoggers(`[SyncFolder](${this.path})`),this.offFolderStatusListener=this._parent.subscribe(this.path,i=>{i.intent==="disconnected"&&this.disconnect()}),(async()=>(this.createPromise&&await this.createPromise,n.markUploaded(this)))(),this.log("created")}static fromTFolder(t,r){return console.log("virtualpath for new syncfolder",t.getVirtualPath(r.path)),new Jo(t.getVirtualPath(r.path),ns(),t)}disconnect(){this.connected=!1}move(t,r){t!==this.path&&(this._parent=r,this.log("setting new path",t),this.path=t,this.name=t.split("/").pop()||"",this.setLoggers(`[SharedFolder](${this.path})`))}get tfolder(){let t=this.vault.getAbstractFileByPath(this.sharedFolder.getPath(this.path));if(t instanceof Wf.TFolder)return t;throw new Error("TFolder API used before file existed")}get parent(){var t;return((t=this.tfolder)==null?void 0:t.parent)||null}get sharedFolder(){return this._parent}async connect(){return this.sharedFolder.shouldConnect&&this.sharedFolder.connect().then(t=>(this.connected=!0,this.connected))}async delete(){return this.vault.delete(this.tfolder)}cleanup(){}destroy(){var t;(t=this.offFolderStatusListener)==null||t.call(this),this.offFolderStatusListener=null,this._parent=null,this._tfolder=null}};var Zr=zn(Qs());var Va,lS=new Uint8Array(16);function Kf(){if(!Va&&(Va=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Va))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Va(lS)}var Pt=[];for(let o=0;o<256;++o)Pt.push((o+256).toString(16).slice(1));function Ug(o,e=0){return Pt[o[e+0]]+Pt[o[e+1]]+Pt[o[e+2]]+Pt[o[e+3]]+"-"+Pt[o[e+4]]+Pt[o[e+5]]+"-"+Pt[o[e+6]]+Pt[o[e+7]]+"-"+Pt[o[e+8]]+Pt[o[e+9]]+"-"+Pt[o[e+10]]+Pt[o[e+11]]+Pt[o[e+12]]+Pt[o[e+13]]+Pt[o[e+14]]+Pt[o[e+15]]}var cS=typeof crypto!="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Gf={randomUUID:cS};function fS(o,e,t){if(Gf.randomUUID&&!e&&!o)return Gf.randomUUID();o=o||{};let r=o.random||(o.rng||Kf)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(let n=0;n<16;++n)e[t+n]=r[n];return e}return Ug(r)}var Is=fS;var uS={images:"image",audio:"audio",videos:"video",pdfs:"pdf",otherTypes:"file"};function Ha(o){return(o==null?void 0:o.type)==="markdown"}function Og(o){return(o==null?void 0:o.type)==="folder"}function Ii(o){return{version:0,id:o,type:"markdown"}}function $g(o){return{version:0,id:o,type:"canvas"}}function qa(o){return{version:0,id:o,type:"folder"}}function Ng(o,e,t,r,n){return n||(n=Date.now()),{version:0,id:e,type:o,mimetype:t,synctime:n,hash:r}}var Jf=class extends et{constructor(t,r){super();this.syncSettings=t;this.configs=r;this.protocols=new Map;r=r||Jf.defaults,r.forEach(([n,s])=>this.protocols.set(n,s)),this.unsubscribes.push(t.subscribe(n=>{this.updateFromSettings(n)}))}setEnabled(t,r){let n=this.protocols.get(t);n&&this.protocols.set(t,{...n,enabled:r})}canSync(t,r){var i,a;if(t.endsWith(".md")||Ve().enableCanvasSync&&t.endsWith(".canvas")||!((i=t.split("/").pop())==null?void 0:i.includes(".")))return!0;if(!Ve().enableAttachmentSync)return!1;if(r){let l=this.protocols.get(r.type);return l?l.enabled&&r.version<=l.maxVersion:!1}let s=this.getTypeForPath(t);return!!((a=this.protocols.get(s))!=null&&a.enabled)}updateFromSettings(t){Object.entries(uS).forEach(([r,n])=>{this.setEnabled(n,t[r])})}getEnabledFileSyncTypes(){if(!Ve().enableAttachmentSync)return["markdown","canvas"];let t=[];return this.protocols.forEach((r,n)=>{r!=null&&r.enabled&&n!=="folder"&&t.push(n)}),t}getTypeForPath(t){let r=Ko(t);for(let[n,s]of this.protocols)if(s.mimetypes.includes(r))return!Ve().enableCanvasSync&&n==="canvas"?"file":n;return"file"}},ki=Jf;ki.defaults=[["folder",{maxVersion:0,mimetypes:[],enabled:!0}],["markdown",{maxVersion:0,mimetypes:["text/markdown"],enabled:!0}],["image",{maxVersion:0,mimetypes:["image/png","image/jpeg","image/gif","image/svg+xml","image/webp","image/avif","image/bmp"],enabled:!0}],["pdf",{maxVersion:0,mimetypes:["application/pdf"],enabled:!0}],["audio",{maxVersion:0,mimetypes:["audio/mpeg","audio/wav","audio/flac","audio/mp4","audio/x-m4a","audio/ogg","audio/opus"],enabled:!0}],["video",{maxVersion:0,mimetypes:["video/mp4","video/webm","video/ogg","video/quicktime","video/x-matroska"],enabled:!0}],["canvas",{maxVersion:0,mimetypes:["application/canvas+json"],enabled:!0}],["file",{maxVersion:0,mimetypes:["application/octet-stream"],enabled:!1}]];var za=class extends et{constructor(t,r,n,s){super();this.ydoc=t;this.namespace=r;this.pendingUpload=n;this.syncSettingsManager=s;this.legacyIds=this.ydoc.getMap("docs"),this.meta=this.ydoc.getMap("filemeta_v0"),this.overlay=new Map,this.renames=new Map,this.deleteSet=new Set,this.typeRegistry=new ki(this.syncSettingsManager)}assertVPath(t){if(t.startsWith(this.namespace+Zr.sep))throw new Error("Expected virtual path"+t)}print(){this.log("files",Array.from(this.meta.entries()).map(([t,r])=>({path:t,...r}))),this.log("pending...",Array.from(this.pendingUpload.entries()).map(([t,r])=>({path:t,guid:r})))}canSync(t){let r=this.getMeta(t);return this.typeRegistry.canSync(t,r)}resolveMove(t){this.log("resolving alias",t),this.renames.delete(t)}resolveAll(){this.renames.clear()}move(t,r){this.log("moving file",t,"to",r),this.assertVPath(t),this.assertVPath(r),this.renames.set(t,r);let n=this.pendingUpload.get(t);n&&(this.pendingUpload.set(r,n),this.pendingUpload.delete(t)),this.deleteSet.has(t)&&(this.deleteSet.add(r),this.deleteSet.delete(t));let s=this.overlay.get(t);s&&(this.overlay.set(r,s),this.overlay.delete(t));let i=this.meta.get(t);Og(i)?this.moveFolder(t,r):i&&(this.set(r,i),this.delete(t))}new(t){this.assertVPath(t);let r=Is();return this.pendingUpload.set(t,r),r}forEach(t){this.meta.forEach((r,n)=>{this.deleteSet.has(n)||t(r,n)}),this.overlay.forEach((r,n)=>{this.deleteSet.has(n)||t(r,n)})}has(t){return this.renames.has(t)&&(t=this.renames.get(t)),this.deleteSet.has(t)?!1:this.meta.has(t)||this.legacyIds.has(t)||this.overlay.has(t)||this.pendingUpload.has(t)}willSet(t,r){if(this.assertVPath(t),Ha(r)&&this.legacyIds.get(t)!==r.id)return this.log("legacy vpath set to a different ID",this.legacyIds.get(t),r.id),!0;let n=this.meta.get(t);return n&&n.id===r.id&&n.mimetype==r.mimetype&&n.type===r.type&&n.hash===r.hash?!1:(this.log("new meta diff",n,r),!0)}set(t,r){this.assertVPath(t),Ha(r)&&this.legacyIds.get(t)!==r.id&&this.legacyIds.set(t,r.id);let n=this.meta.get(t);n&&n.id===r.id&&n.mimetype==r.mimetype&&n.type===r.type&&n.hash===r.hash||(this.log("metadata write (path, existing, meta)",t,n,r),this.meta.set(t,r),this.pendingUpload.has(t)&&this.pendingUpload.delete(t))}processFolderOperation(t){let r=new Map,n=new Map;t.changes.keys.forEach((s,i)=>{if(s.action==="delete"){let a=s.oldValue;(a==null?void 0:a.type)==="folder"&&r.set(a.id,i)}else if(s.action==="add"||s.action==="update"){let a=this.meta.get(i);(a==null?void 0:a.type)==="folder"&&n.set(a.id,i)}}),r.forEach((s,i)=>{let a=n.get(i);if(a&&s!==a){this.log(`Detected folder move from ${s} to ${a}`);let l=new Map;this.meta.forEach((c,f)=>{f.startsWith(a+Zr.sep)&&l.set(f,c)}),this.renames.set(s,a),this.log("setting alias",s,a),this.log("paths to move",l),l.forEach((c,f)=>{let u=f.slice(a.length),d=s+u;this.renames.set(d,f),this.log("setting alias",d,f)})}})}start(){jo(wo.enableDeltaLogging,()=>{let n=s=>{var a,l;let i="";i+=`Transaction origin: ${s.transaction.origin}${(l=(a=s.transaction.origin)==null?void 0:a.constructor)==null?void 0:l.name}
`,s.changes.keys.forEach((c,f)=>{c.action==="add"&&(i+=`Added ${f}: ${this.get(f)}
`),c.action==="update"&&(i+=`Updated ${f}: ${this.get(f)}
`),c.action==="delete"&&(i+=`Deleted ${f}
`)}),this.debug(i)};this.legacyIds.observe(n),this.meta.observe(n),this.unsubscribes.push(()=>{this.legacyIds.unobserve(n)}),this.unsubscribes.push(()=>{this.meta.unobserve(n)})});let t=async n=>{if(n.changes.keys.size===0){this.log("no changes detected");return}n.transaction.origin!=this&&(this.processFolderOperation(n),this.notifyListeners())},r=async n=>{this.migrateUp(),this.notifyListeners()};this.legacyIds.observe(r),this.meta.observe(t),this.unsubscribes.push(()=>{this.legacyIds.unobserve(r)}),this.unsubscribes.push(()=>{this.meta.unobserve(t)}),this.unsubscribes.push(this.typeRegistry.subscribe(()=>{this.log("type registry change"),this.notifyListeners()}))}get(t){if(this.assertVPath(t),this.renames.has(t)&&(t=this.renames.get(t)),this.deleteSet.has(t))return;let r=this.pendingUpload.get(t);if(r)return r;let n=this.getMeta(t);if(n)return n.id}getMeta(t){if(this.assertVPath(t),this.renames.has(t)&&(t=this.renames.get(t)),this.deleteSet.has(t))return;let r=this.meta.get(t)||this.overlay.get(t),n=this.legacyIds.has(t);if(!r&&this.legacyIds.has(t)){let s=this.legacyIds.get(t),i=Ii(s);return this.overlay.set(t,i),i}if(r){if(Ha(r)&&!n){this.deleteSet.add(t);return}return r}}delete(t){return this.assertVPath(t),this.legacyIds.delete(t),this.pendingUpload.delete(t),this.meta.delete(t)}get remoteIds(){let t=new Set;return this.forEach(r=>{t.add(r.id)}),t}commit(){this.overlay.size>0&&this.log("committing overlay",[...this.overlay.keys()]),this.overlay.forEach((t,r)=>{this.set(r,t),t.type==="markdown"&&this.legacyIds.get(r)!==t.id&&this.legacyIds.set(r,t.id)}),this.overlay=new Map,this.deleteSet.size>0&&this.log("committing deleteSet",[...this.deleteSet]),this.deleteSet.forEach(t=>this.delete(t)),this.deleteSet=new Set}detectFolderMoves(){let t=new Map,r=new Set;this.legacyIds.forEach((s,i)=>{let a;if(this.meta.forEach((l,c)=>{l.type==="markdown"&&l.id===s&&c!==i&&(a=c)}),a){let l=(0,Zr.dirname)(a),c=(0,Zr.dirname)(i);l!==c&&t.set(l,c)}}),Array.from(t.entries()).sort(([s],[i])=>i.length-s.length).forEach(([s,i])=>{r.has(s)||(this.moveFolder(s,i),r.add(s))})}moveFolder(t,r){this.log("moving folder",t,"to",r);let n=new Map;this.meta.forEach((i,a)=>{(a===t||a.startsWith(t+Zr.sep))&&n.set(a,i)}),this.overlay.forEach((i,a)=>{(a===t||a.startsWith(t+Zr.sep))&&n.set(a,i)});let s=this.meta.get(t);s&&(this.meta.set(r,s),this.meta.delete(t)),n.forEach((i,a)=>{if(a===t)return;let l=a.slice(t.length),c=r+l;this.move(a,c)})}markUploaded(t,r){if(!this.has(t))throw new Error(`unexpected vpath ${t} marked uploaded`);this.set(t,r)}migrateFile(t,r){var a;if(this.assertVPath(r),((a=this.meta.get(r))==null?void 0:a.id)===t)return;let n=new Set,s=r.split(Zr.sep),i="";for(let l=0;l<s.length-1;l++)i=s.slice(0,l+1).join(Zr.sep),n.add(i);this.meta.has(r)||this.overlay.has(r)||r.endsWith(".md")&&(this.warn(`migrated legacy key on ${r}`),this.overlay.set(r,Ii(t))),n.forEach(l=>{if(l&&!(this.meta.has(l)||this.overlay.has(l))){let c=Is();console.log("creating folder path",l,c),this.overlay.set(l,qa(c))}})}migrateUp(){this.detectFolderMoves(),this.legacyIds.forEach((t,r)=>{this.migrateFile(t,r)})}destroy(){super.destroy(),this.overlay.clear(),this.deleteSet.clear(),this.renames.clear(),this.legacyIds=null,this.meta=null}};function Bg(o,e,t=(r,n)=>r.substring(n.length).replace(/^\/+/,"")){return new Proxy(o,{get(r,n){let s=r[n];return typeof s=="function"?function(...i){return i.length>0&&typeof i[0]=="string"&&(i[0]=t(i[0],e)),s.apply(r,i)}:s}})}var Kg=require("obsidian"),Gg=require("obsidian");if(globalThis.Response===void 0||globalThis.Headers===void 0)try{if(console.warn("[Relay] Polyfilling Fetch API (Electron Bug: https://github.com/electron/electron/pull/42419)"),globalThis.blinkfetch){globalThis.fetch=globalThis.blinkfetch;let o=["fetch","Response","FormData","Request","Headers"];for(let e of o)globalThis[e]=globalThis[`blink${e}`]}}catch(o){console.error(o)}globalThis.EventSource===void 0&&(Gg.Platform.isMobile?console.warn("[Relay] Polyfilling EventSource API required, but unable to polyfill on Mobile"):(console.warn("[Relay] Polyfilling EventSource API"),globalThis.EventSource=jg()));var ot=async(o,e)=>{let t=o instanceof URL?o.toString():o,r=(e==null?void 0:e.method)||"GET",n=Object.assign({},e==null?void 0:e.headers,{"Relay-Version":"0.5.13"}),s={url:t,method:r,body:e==null?void 0:e.body,headers:n,throw:!1},i;if(i=await(0,Kg.requestUrl)(s),!i.arrayBuffer.byteLength)return new Response(null,{status:i.status,statusText:i.status.toString(),headers:new Headers(i.headers)});let a=new Response(i.arrayBuffer,{status:i.status,statusText:i.status.toString(),headers:new Headers(i.headers)});if(Object.defineProperty(a,"json",{value:async()=>JSON.parse(i.text)}),Ve().enableNetworkLogging){let c=i.status>=500?"error":i.status>=400?"warn":"debug",f=i.text,u;if((i.headers["content-type"]||"").includes("application/json"))try{u=JSON.parse(f)}catch(m){}ke("[CustomFetch]",c)(i.status.toString(),r,t,u||f)}if(i.status>=500)throw new Error(i.text);return a};var qt=class extends Error{constructor(e){var t,r,n,s;super("ClientResponseError"),this.url="",this.status=0,this.response={},this.isAbort=!1,this.originalError=null,Object.setPrototypeOf(this,qt.prototype),e!==null&&typeof e=="object"&&(this.url=typeof e.url=="string"?e.url:"",this.status=typeof e.status=="number"?e.status:0,this.isAbort=!!e.isAbort,this.originalError=e.originalError,e.response!==null&&typeof e.response=="object"?this.response=e.response:e.data!==null&&typeof e.data=="object"?this.response=e.data:this.response={}),this.originalError||e instanceof qt||(this.originalError=e),typeof DOMException!="undefined"&&e instanceof DOMException&&(this.isAbort=!0),this.name="ClientResponseError "+this.status,this.message=(t=this.response)==null?void 0:t.message,this.message||(this.isAbort?this.message="The request was autocancelled. You can find more info in https://github.com/pocketbase/js-sdk#auto-cancellation.":(s=(n=(r=this.originalError)==null?void 0:r.cause)==null?void 0:n.message)!=null&&s.includes("ECONNREFUSED ::1")?this.message="Failed to connect to the PocketBase server. Try changing the SDK URL from localhost to 127.0.0.1 (https://github.com/pocketbase/js-sdk/issues/21).":this.message="Something went wrong while processing your request.")}get data(){return this.response}toJSON(){return{...this}}},Wa=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function IS(o,e){let t={};if(typeof o!="string")return t;let r=Object.assign({},e||{}).decode||CS,n=0;for(;n<o.length;){let s=o.indexOf("=",n);if(s===-1)break;let i=o.indexOf(";",n);if(i===-1)i=o.length;else if(i<s){n=o.lastIndexOf(";",s-1)+1;continue}let a=o.slice(n,s).trim();if(t[a]===void 0){let l=o.slice(s+1,i).trim();l.charCodeAt(0)===34&&(l=l.slice(1,-1));try{t[a]=r(l)}catch(c){t[a]=l}}n=i+1}return t}function Jg(o,e,t){let r=Object.assign({},t||{}),n=r.encode||LS;if(!Wa.test(o))throw new TypeError("argument name is invalid");let s=n(e);if(s&&!Wa.test(s))throw new TypeError("argument val is invalid");let i=o+"="+s;if(r.maxAge!=null){let a=r.maxAge-0;if(isNaN(a)||!isFinite(a))throw new TypeError("option maxAge is invalid");i+="; Max-Age="+Math.floor(a)}if(r.domain){if(!Wa.test(r.domain))throw new TypeError("option domain is invalid");i+="; Domain="+r.domain}if(r.path){if(!Wa.test(r.path))throw new TypeError("option path is invalid");i+="; Path="+r.path}if(r.expires){if(!function(l){return Object.prototype.toString.call(l)==="[object Date]"||l instanceof Date}(r.expires)||isNaN(r.expires.valueOf()))throw new TypeError("option expires is invalid");i+="; Expires="+r.expires.toUTCString()}if(r.httpOnly&&(i+="; HttpOnly"),r.secure&&(i+="; Secure"),r.priority)switch(typeof r.priority=="string"?r.priority.toLowerCase():r.priority){case"low":i+="; Priority=Low";break;case"medium":i+="; Priority=Medium";break;case"high":i+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}if(r.sameSite)switch(typeof r.sameSite=="string"?r.sameSite.toLowerCase():r.sameSite){case!0:i+="; SameSite=Strict";break;case"lax":i+="; SameSite=Lax";break;case"strict":i+="; SameSite=Strict";break;case"none":i+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return i}function CS(o){return o.indexOf("%")!==-1?decodeURIComponent(o):o}function LS(o){return encodeURIComponent(o)}var Zg;function ja(o){if(o)try{let e=decodeURIComponent(Zg(o.split(".")[1]).split("").map(function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(e)||{}}catch(e){}return{}}function Xg(o,e=0){let t=ja(o);return!(Object.keys(t).length>0&&(!t.exp||t.exp-e>Date.now()/1e3))}Zg=typeof atob=="function"?atob:o=>{let e=String(o).replace(/=+$/,"");if(e.length%4==1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(var t,r,n=0,s=0,i="";r=e.charAt(s++);~r&&(t=n%4?64*t+r:r,n++%4)?i+=String.fromCharCode(255&t>>(-2*n&6)):0)r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(r);return i};var Yg="pb_auth",Li=class{constructor(){this.baseToken="",this.baseModel=null,this._onChangeCallbacks=[]}get token(){return this.baseToken}get model(){return this.baseModel}get isValid(){return!Xg(this.token)}get isAdmin(){return ja(this.token).type==="admin"}get isAuthRecord(){return ja(this.token).type==="authRecord"}save(e,t){this.baseToken=e||"",this.baseModel=t||null,this.triggerChange()}clear(){this.baseToken="",this.baseModel=null,this.triggerChange()}loadFromCookie(e,t=Yg){let r=IS(e||"")[t]||"",n={};try{n=JSON.parse(r),(typeof n===null||typeof n!="object"||Array.isArray(n))&&(n={})}catch(s){}this.save(n.token||"",n.model||null)}exportToCookie(e,t=Yg){var l,c;let r={secure:!0,sameSite:!0,httpOnly:!0,path:"/"},n=ja(this.token);r.expires=n!=null&&n.exp?new Date(1e3*n.exp):new Date("1970-01-01"),e=Object.assign({},r,e);let s={token:this.token,model:this.model?JSON.parse(JSON.stringify(this.model)):null},i=Jg(t,JSON.stringify(s),e),a=typeof Blob!="undefined"?new Blob([i]).size:i.length;if(s.model&&a>4096){s.model={id:(l=s==null?void 0:s.model)==null?void 0:l.id,email:(c=s==null?void 0:s.model)==null?void 0:c.email};let f=["collectionId","username","verified"];for(let u in this.model)f.includes(u)&&(s.model[u]=this.model[u]);i=Jg(t,JSON.stringify(s),e)}return i}onChange(e,t=!1){return this._onChangeCallbacks.push(e),t&&e(this.token,this.model),()=>{for(let r=this._onChangeCallbacks.length-1;r>=0;r--)if(this._onChangeCallbacks[r]==e)return delete this._onChangeCallbacks[r],void this._onChangeCallbacks.splice(r,1)}}triggerChange(){for(let e of this._onChangeCallbacks)e&&e(this.token,this.model)}},Qf=class extends Li{constructor(e="pocketbase_auth"){super(),this.storageFallback={},this.storageKey=e,this._bindStorageEvent()}get token(){return(this._storageGet(this.storageKey)||{}).token||""}get model(){return(this._storageGet(this.storageKey)||{}).model||null}save(e,t){this._storageSet(this.storageKey,{token:e,model:t}),super.save(e,t)}clear(){this._storageRemove(this.storageKey),super.clear()}_storageGet(e){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let t=window.localStorage.getItem(e)||"";try{return JSON.parse(t)}catch(r){return t}}return this.storageFallback[e]}_storageSet(e,t){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let r=t;typeof t!="string"&&(r=JSON.stringify(t)),window.localStorage.setItem(e,r)}else this.storageFallback[e]=t}_storageRemove(e){var t;typeof window!="undefined"&&(window!=null&&window.localStorage)&&((t=window.localStorage)==null||t.removeItem(e)),delete this.storageFallback[e]}_bindStorageEvent(){typeof window!="undefined"&&(window!=null&&window.localStorage)&&window.addEventListener&&window.addEventListener("storage",e=>{if(e.key!=this.storageKey)return;let t=this._storageGet(this.storageKey)||{};super.save(t.token||"",t.model||null)})}},Io=class{constructor(e){this.client=e}},Zf=class extends Io{async getAll(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/settings",e)}async update(e,t){return t=Object.assign({method:"PATCH",body:e},t),this.client.send("/api/settings",t)}async testS3(e="storage",t){return t=Object.assign({method:"POST",body:{filesystem:e}},t),this.client.send("/api/settings/test/s3",t).then(()=>!0)}async testEmail(e,t,r){return r=Object.assign({method:"POST",body:{email:e,template:t}},r),this.client.send("/api/settings/test/email",r).then(()=>!0)}async generateAppleClientSecret(e,t,r,n,s,i){return i=Object.assign({method:"POST",body:{clientId:e,teamId:t,keyId:r,privateKey:n,duration:s}},i),this.client.send("/api/settings/apple/generate-client-secret",i)}},Ti=class extends Io{decode(e){return e}async getFullList(e,t){if(typeof e=="number")return this._getFullList(e,t);let r=500;return(t=Object.assign({},e,t)).batch&&(r=t.batch,delete t.batch),this._getFullList(r,t)}async getList(e=1,t=30,r){return(r=Object.assign({method:"GET"},r)).query=Object.assign({page:e,perPage:t},r.query),this.client.send(this.baseCrudPath,r).then(n=>{var s;return n.items=((s=n.items)==null?void 0:s.map(i=>this.decode(i)))||[],n})}async getFirstListItem(e,t){return(t=Object.assign({requestKey:"one_by_filter_"+this.baseCrudPath+"_"+e},t)).query=Object.assign({filter:e,skipTotal:1},t.query),this.getList(1,1,t).then(r=>{var n;if(!((n=r==null?void 0:r.items)!=null&&n.length))throw new qt({status:404,response:{code:404,message:"The requested resource wasn't found.",data:{}}});return r.items[0]})}async getOne(e,t){if(!e)throw new qt({url:this.client.buildUrl(this.baseCrudPath+"/"),status:404,response:{code:404,message:"Missing required record id.",data:{}}});return t=Object.assign({method:"GET"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),t).then(r=>this.decode(r))}async create(e,t){return t=Object.assign({method:"POST",body:e},t),this.client.send(this.baseCrudPath,t).then(r=>this.decode(r))}async update(e,t,r){return r=Object.assign({method:"PATCH",body:t},r),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),r).then(n=>this.decode(n))}async delete(e,t){return t=Object.assign({method:"DELETE"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),t).then(()=>!0)}_getFullList(e=500,t){(t=t||{}).query=Object.assign({skipTotal:1},t.query);let r=[],n=async s=>this.getList(s,e||500,t).then(i=>{let a=i.items;return r=r.concat(a),a.length==i.perPage?n(s+1):r});return n(1)}};function lr(o,e,t,r){let n=r!==void 0;return n||t!==void 0?n?(console.warn(o),e.body=Object.assign({},e.body,t),e.query=Object.assign({},e.query,r),e):Object.assign(e,t):e}function Yf(o){var e;(e=o._resetAutoRefresh)==null||e.call(o)}var Xf=class extends Ti{get baseCrudPath(){return"/api/admins"}async update(e,t,r){return super.update(e,t,r).then(n=>{var s,i;return((s=this.client.authStore.model)==null?void 0:s.id)===n.id&&((i=this.client.authStore.model)==null?void 0:i.collectionId)===void 0&&this.client.authStore.save(this.client.authStore.token,n),n})}async delete(e,t){return super.delete(e,t).then(r=>{var n,s;return r&&((n=this.client.authStore.model)==null?void 0:n.id)===e&&((s=this.client.authStore.model)==null?void 0:s.collectionId)===void 0&&this.client.authStore.clear(),r})}authResponse(e){let t=this.decode((e==null?void 0:e.admin)||{});return e!=null&&e.token&&(e!=null&&e.admin)&&this.client.authStore.save(e.token,t),Object.assign({},e,{token:(e==null?void 0:e.token)||"",admin:t})}async authWithPassword(e,t,r,n){let s={method:"POST",body:{identity:e,password:t}};s=lr("This form of authWithPassword(email, pass, body?, query?) is deprecated. Consider replacing it with authWithPassword(email, pass, options?).",s,r,n);let i=s.autoRefreshThreshold;delete s.autoRefreshThreshold,s.autoRefresh||Yf(this.client);let a=await this.client.send(this.baseCrudPath+"/auth-with-password",s);return a=this.authResponse(a),i&&function(c,f,u,d){Yf(c);let m=c.beforeSend,p=c.authStore.model,y=c.authStore.onChange((g,v)=>{(!g||(v==null?void 0:v.id)!=(p==null?void 0:p.id)||(v!=null&&v.collectionId||p!=null&&p.collectionId)&&(v==null?void 0:v.collectionId)!=(p==null?void 0:p.collectionId))&&Yf(c)});c._resetAutoRefresh=function(){y(),c.beforeSend=m,delete c._resetAutoRefresh},c.beforeSend=async(g,v)=>{var E;let C=c.authStore.token;if((E=v.query)!=null&&E.autoRefresh)return m?m(g,v):{url:g,sendOptions:v};let L=c.authStore.isValid;if(L&&Xg(c.authStore.token,f))try{await u()}catch(O){L=!1}L||await d();let T=v.headers||{};for(let O in T)if(O.toLowerCase()=="authorization"&&C==T[O]&&c.authStore.token){T[O]=c.authStore.token;break}return v.headers=T,m?m(g,v):{url:g,sendOptions:v}}}(this.client,i,()=>this.authRefresh({autoRefresh:!0}),()=>this.authWithPassword(e,t,Object.assign({autoRefresh:!0},s))),a}async authRefresh(e,t){let r={method:"POST"};return r=lr("This form of authRefresh(body?, query?) is deprecated. Consider replacing it with authRefresh(options?).",r,e,t),this.client.send(this.baseCrudPath+"/auth-refresh",r).then(this.authResponse.bind(this))}async requestPasswordReset(e,t,r){let n={method:"POST",body:{email:e}};return n=lr("This form of requestPasswordReset(email, body?, query?) is deprecated. Consider replacing it with requestPasswordReset(email, options?).",n,t,r),this.client.send(this.baseCrudPath+"/request-password-reset",n).then(()=>!0)}async confirmPasswordReset(e,t,r,n,s){let i={method:"POST",body:{token:e,password:t,passwordConfirm:r}};return i=lr("This form of confirmPasswordReset(resetToken, password, passwordConfirm, body?, query?) is deprecated. Consider replacing it with confirmPasswordReset(resetToken, password, passwordConfirm, options?).",i,n,s),this.client.send(this.baseCrudPath+"/confirm-password-reset",i).then(()=>!0)}},TS=["requestKey","$cancelKey","$autoCancel","fetch","headers","body","query","params","cache","credentials","headers","integrity","keepalive","method","mode","redirect","referrer","referrerPolicy","signal","window"];function ey(o){if(o){o.query=o.query||{};for(let e in o)TS.includes(e)||(o.query[e]=o[e],delete o[e])}}var Ka=class extends Io{constructor(){super(...arguments),this.clientId="",this.eventSource=null,this.subscriptions={},this.lastSentSubscriptions=[],this.maxConnectTimeout=15e3,this.reconnectAttempts=0,this.maxReconnectAttempts=1/0,this.predefinedReconnectIntervals=[200,300,500,1e3,1200,1500,2e3],this.pendingConnects=[]}get isConnected(){return!!this.eventSource&&!!this.clientId&&!this.pendingConnects.length}async subscribe(e,t,r){var i;if(!e)throw new Error("topic must be set.");let n=e;if(r){ey(r);let a="options="+encodeURIComponent(JSON.stringify({query:r.query,headers:r.headers}));n+=(n.includes("?")?"&":"?")+a}let s=function(a){let l=a,c;try{c=JSON.parse(l==null?void 0:l.data)}catch(f){}t(c||{})};return this.subscriptions[n]||(this.subscriptions[n]=[]),this.subscriptions[n].push(s),this.isConnected?this.subscriptions[n].length===1?await this.submitSubscriptions():(i=this.eventSource)==null||i.addEventListener(n,s):await this.connect(),async()=>this.unsubscribeByTopicAndListener(e,s)}async unsubscribe(e){var r;let t=!1;if(e){let n=this.getSubscriptionsByTopic(e);for(let s in n)if(this.hasSubscriptionListeners(s)){for(let i of this.subscriptions[s])(r=this.eventSource)==null||r.removeEventListener(s,i);delete this.subscriptions[s],t||(t=!0)}}else this.subscriptions={};this.hasSubscriptionListeners()?t&&await this.submitSubscriptions():this.disconnect()}async unsubscribeByPrefix(e){var r;let t=!1;for(let n in this.subscriptions)if((n+"?").startsWith(e)){t=!0;for(let s of this.subscriptions[n])(r=this.eventSource)==null||r.removeEventListener(n,s);delete this.subscriptions[n]}t&&(this.hasSubscriptionListeners()?await this.submitSubscriptions():this.disconnect())}async unsubscribeByTopicAndListener(e,t){var s;let r=!1,n=this.getSubscriptionsByTopic(e);for(let i in n){if(!Array.isArray(this.subscriptions[i])||!this.subscriptions[i].length)continue;let a=!1;for(let l=this.subscriptions[i].length-1;l>=0;l--)this.subscriptions[i][l]===t&&(a=!0,delete this.subscriptions[i][l],this.subscriptions[i].splice(l,1),(s=this.eventSource)==null||s.removeEventListener(i,t));a&&(this.subscriptions[i].length||delete this.subscriptions[i],r||this.hasSubscriptionListeners(i)||(r=!0))}this.hasSubscriptionListeners()?r&&await this.submitSubscriptions():this.disconnect()}hasSubscriptionListeners(e){var t,r;if(this.subscriptions=this.subscriptions||{},e)return!!((t=this.subscriptions[e])!=null&&t.length);for(let n in this.subscriptions)if((r=this.subscriptions[n])!=null&&r.length)return!0;return!1}async submitSubscriptions(){if(this.clientId)return this.addAllSubscriptionListeners(),this.lastSentSubscriptions=this.getNonEmptySubscriptionKeys(),this.client.send("/api/realtime",{method:"POST",body:{clientId:this.clientId,subscriptions:this.lastSentSubscriptions},requestKey:this.getSubscriptionsCancelKey()}).catch(e=>{if(!(e!=null&&e.isAbort))throw e})}getSubscriptionsCancelKey(){return"realtime_"+this.clientId}getSubscriptionsByTopic(e){let t={};e=e.includes("?")?e:e+"?";for(let r in this.subscriptions)(r+"?").startsWith(e)&&(t[r]=this.subscriptions[r]);return t}getNonEmptySubscriptionKeys(){let e=[];for(let t in this.subscriptions)this.subscriptions[t].length&&e.push(t);return e}addAllSubscriptionListeners(){if(this.eventSource){this.removeAllSubscriptionListeners();for(let e in this.subscriptions)for(let t of this.subscriptions[e])this.eventSource.addEventListener(e,t)}}removeAllSubscriptionListeners(){if(this.eventSource)for(let e in this.subscriptions)for(let t of this.subscriptions[e])this.eventSource.removeEventListener(e,t)}async connect(){if(!(this.reconnectAttempts>0))return new Promise((e,t)=>{this.pendingConnects.push({resolve:e,reject:t}),this.pendingConnects.length>1||this.initConnect()})}initConnect(){this.disconnect(!0),clearTimeout(this.connectTimeoutId),this.connectTimeoutId=setTimeout(()=>{this.connectErrorHandler(new Error("EventSource connect took too long."))},this.maxConnectTimeout),this.eventSource=new EventSource(this.client.buildUrl("/api/realtime")),this.eventSource.onerror=e=>{this.connectErrorHandler(new Error("Failed to establish realtime connection."))},this.eventSource.addEventListener("PB_CONNECT",e=>{let t=e;this.clientId=t==null?void 0:t.lastEventId,this.submitSubscriptions().then(async()=>{let r=3;for(;this.hasUnsentSubscriptions()&&r>0;)r--,await this.submitSubscriptions()}).then(()=>{for(let n of this.pendingConnects)n.resolve();this.pendingConnects=[],this.reconnectAttempts=0,clearTimeout(this.reconnectTimeoutId),clearTimeout(this.connectTimeoutId);let r=this.getSubscriptionsByTopic("PB_CONNECT");for(let n in r)for(let s of r[n])s(e)}).catch(r=>{this.clientId="",this.connectErrorHandler(r)})})}hasUnsentSubscriptions(){let e=this.getNonEmptySubscriptionKeys();if(e.length!=this.lastSentSubscriptions.length)return!0;for(let t of e)if(!this.lastSentSubscriptions.includes(t))return!0;return!1}connectErrorHandler(e){if(clearTimeout(this.connectTimeoutId),clearTimeout(this.reconnectTimeoutId),!this.clientId&&!this.reconnectAttempts||this.reconnectAttempts>this.maxReconnectAttempts){for(let r of this.pendingConnects)r.reject(new qt(e));return this.pendingConnects=[],void this.disconnect()}this.disconnect(!0);let t=this.predefinedReconnectIntervals[this.reconnectAttempts]||this.predefinedReconnectIntervals[this.predefinedReconnectIntervals.length-1];this.reconnectAttempts++,this.reconnectTimeoutId=setTimeout(()=>{this.initConnect()},t)}disconnect(e=!1){var t;if(clearTimeout(this.connectTimeoutId),clearTimeout(this.reconnectTimeoutId),this.removeAllSubscriptionListeners(),this.client.cancelRequest(this.getSubscriptionsCancelKey()),(t=this.eventSource)==null||t.close(),this.eventSource=null,this.clientId="",!e){this.reconnectAttempts=0;for(let r of this.pendingConnects)r.resolve();this.pendingConnects=[]}}},eu=class extends Ti{constructor(e,t){super(e),this.collectionIdOrName=t}get baseCrudPath(){return this.baseCollectionPath+"/records"}get baseCollectionPath(){return"/api/collections/"+encodeURIComponent(this.collectionIdOrName)}async subscribe(e,t,r){if(!e)throw new Error("Missing topic.");if(!t)throw new Error("Missing subscription callback.");return this.client.realtime.subscribe(this.collectionIdOrName+"/"+e,t,r)}async unsubscribe(e){return e?this.client.realtime.unsubscribe(this.collectionIdOrName+"/"+e):this.client.realtime.unsubscribeByPrefix(this.collectionIdOrName)}async getFullList(e,t){if(typeof e=="number")return super.getFullList(e,t);let r=Object.assign({},e,t);return super.getFullList(r)}async getList(e=1,t=30,r){return super.getList(e,t,r)}async getFirstListItem(e,t){return super.getFirstListItem(e,t)}async getOne(e,t){return super.getOne(e,t)}async create(e,t){return super.create(e,t)}async update(e,t,r){return super.update(e,t,r).then(n=>{var s,i,a;return((s=this.client.authStore.model)==null?void 0:s.id)!==(n==null?void 0:n.id)||((i=this.client.authStore.model)==null?void 0:i.collectionId)!==this.collectionIdOrName&&((a=this.client.authStore.model)==null?void 0:a.collectionName)!==this.collectionIdOrName||this.client.authStore.save(this.client.authStore.token,n),n})}async delete(e,t){return super.delete(e,t).then(r=>{var n,s,i;return!r||((n=this.client.authStore.model)==null?void 0:n.id)!==e||((s=this.client.authStore.model)==null?void 0:s.collectionId)!==this.collectionIdOrName&&((i=this.client.authStore.model)==null?void 0:i.collectionName)!==this.collectionIdOrName||this.client.authStore.clear(),r})}authResponse(e){let t=this.decode((e==null?void 0:e.record)||{});return this.client.authStore.save(e==null?void 0:e.token,t),Object.assign({},e,{token:(e==null?void 0:e.token)||"",record:t})}async listAuthMethods(e){return e=Object.assign({method:"GET"},e),this.client.send(this.baseCollectionPath+"/auth-methods",e).then(t=>Object.assign({},t,{usernamePassword:!!(t!=null&&t.usernamePassword),emailPassword:!!(t!=null&&t.emailPassword),authProviders:Array.isArray(t==null?void 0:t.authProviders)?t==null?void 0:t.authProviders:[]}))}async authWithPassword(e,t,r,n){let s={method:"POST",body:{identity:e,password:t}};return s=lr("This form of authWithPassword(usernameOrEmail, pass, body?, query?) is deprecated. Consider replacing it with authWithPassword(usernameOrEmail, pass, options?).",s,r,n),this.client.send(this.baseCollectionPath+"/auth-with-password",s).then(i=>this.authResponse(i))}async authWithOAuth2Code(e,t,r,n,s,i,a){let l={method:"POST",body:{provider:e,code:t,codeVerifier:r,redirectUrl:n,createData:s}};return l=lr("This form of authWithOAuth2Code(provider, code, codeVerifier, redirectUrl, createData?, body?, query?) is deprecated. Consider replacing it with authWithOAuth2Code(provider, code, codeVerifier, redirectUrl, createData?, options?).",l,i,a),this.client.send(this.baseCollectionPath+"/auth-with-oauth2",l).then(c=>this.authResponse(c))}async authWithOAuth2(...e){if(e.length>1||typeof(e==null?void 0:e[0])=="string")return console.warn("PocketBase: This form of authWithOAuth2() is deprecated and may get removed in the future. Please replace with authWithOAuth2Code() OR use the authWithOAuth2() realtime form as shown in https://pocketbase.io/docs/authentication/#oauth2-integration."),this.authWithOAuth2Code((e==null?void 0:e[0])||"",(e==null?void 0:e[1])||"",(e==null?void 0:e[2])||"",(e==null?void 0:e[3])||"",(e==null?void 0:e[4])||{},(e==null?void 0:e[5])||{},(e==null?void 0:e[6])||{});let t=(e==null?void 0:e[0])||{},r=(await this.listAuthMethods()).authProviders.find(l=>l.name===t.provider);if(!r)throw new qt(new Error(`Missing or invalid provider "${t.provider}".`));let n=this.client.buildUrl("/api/oauth2-redirect"),s=new Ka(this.client),i=null;function a(){i==null||i.close(),s.unsubscribe()}return t.urlCallback||(i=Qg(void 0)),new Promise(async(l,c)=>{var f;try{await s.subscribe("@oauth2",async p=>{let y=s.clientId;try{if(!p.state||y!==p.state)throw new Error("State parameters don't match.");let g=Object.assign({},t);delete g.provider,delete g.scopes,delete g.createData,delete g.urlCallback;let v=await this.authWithOAuth2Code(r.name,p.code,r.codeVerifier,n,t.createData,g);l(v)}catch(g){c(new qt(g))}a()});let u={state:s.clientId};(f=t.scopes)!=null&&f.length&&(u.scope=t.scopes.join(" "));let d=this._replaceQueryParams(r.authUrl+n,u);await(t.urlCallback||function(p){i?i.location.href=p:i=Qg(p)})(d)}catch(u){a(),c(new qt(u))}})}async authRefresh(e,t){let r={method:"POST"};return r=lr("This form of authRefresh(body?, query?) is deprecated. Consider replacing it with authRefresh(options?).",r,e,t),this.client.send(this.baseCollectionPath+"/auth-refresh",r).then(n=>this.authResponse(n))}async requestPasswordReset(e,t,r){let n={method:"POST",body:{email:e}};return n=lr("This form of requestPasswordReset(email, body?, query?) is deprecated. Consider replacing it with requestPasswordReset(email, options?).",n,t,r),this.client.send(this.baseCollectionPath+"/request-password-reset",n).then(()=>!0)}async confirmPasswordReset(e,t,r,n,s){let i={method:"POST",body:{token:e,password:t,passwordConfirm:r}};return i=lr("This form of confirmPasswordReset(token, password, passwordConfirm, body?, query?) is deprecated. Consider replacing it with confirmPasswordReset(token, password, passwordConfirm, options?).",i,n,s),this.client.send(this.baseCollectionPath+"/confirm-password-reset",i).then(()=>!0)}async requestVerification(e,t,r){let n={method:"POST",body:{email:e}};return n=lr("This form of requestVerification(email, body?, query?) is deprecated. Consider replacing it with requestVerification(email, options?).",n,t,r),this.client.send(this.baseCollectionPath+"/request-verification",n).then(()=>!0)}async confirmVerification(e,t,r){let n={method:"POST",body:{token:e}};return n=lr("This form of confirmVerification(token, body?, query?) is deprecated. Consider replacing it with confirmVerification(token, options?).",n,t,r),this.client.send(this.baseCollectionPath+"/confirm-verification",n).then(()=>!0)}async requestEmailChange(e,t,r){let n={method:"POST",body:{newEmail:e}};return n=lr("This form of requestEmailChange(newEmail, body?, query?) is deprecated. Consider replacing it with requestEmailChange(newEmail, options?).",n,t,r),this.client.send(this.baseCollectionPath+"/request-email-change",n).then(()=>!0)}async confirmEmailChange(e,t,r,n){let s={method:"POST",body:{token:e,password:t}};return s=lr("This form of confirmEmailChange(token, password, body?, query?) is deprecated. Consider replacing it with confirmEmailChange(token, password, options?).",s,r,n),this.client.send(this.baseCollectionPath+"/confirm-email-change",s).then(()=>!0)}async listExternalAuths(e,t){return t=Object.assign({method:"GET"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e)+"/external-auths",t)}async unlinkExternalAuth(e,t,r){return r=Object.assign({method:"DELETE"},r),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e)+"/external-auths/"+encodeURIComponent(t),r).then(()=>!0)}_replaceQueryParams(e,t={}){let r=e,n="";e.indexOf("?")>=0&&(r=e.substring(0,e.indexOf("?")),n=e.substring(e.indexOf("?")+1));let s={},i=n.split("&");for(let a of i){if(a=="")continue;let l=a.split("=");s[decodeURIComponent(l[0].replace(/\+/g," "))]=decodeURIComponent((l[1]||"").replace(/\+/g," "))}for(let a in t)t.hasOwnProperty(a)&&(t[a]==null?delete s[a]:s[a]=t[a]);n="";for(let a in s)s.hasOwnProperty(a)&&(n!=""&&(n+="&"),n+=encodeURIComponent(a.replace(/%20/g,"+"))+"="+encodeURIComponent(s[a].replace(/%20/g,"+")));return n!=""?r+"?"+n:r}};function Qg(o){if(typeof window=="undefined"||!(window!=null&&window.open))throw new qt(new Error("Not in a browser context - please pass a custom urlCallback function."));let e=1024,t=768,r=window.innerWidth,n=window.innerHeight;e=e>r?r:e,t=t>n?n:t;let s=r/2-e/2,i=n/2-t/2;return window.open(o,"popup_window","width="+e+",height="+t+",top="+i+",left="+s+",resizable,menubar=no")}var tu=class extends Ti{get baseCrudPath(){return"/api/collections"}async import(e,t=!1,r){return r=Object.assign({method:"PUT",body:{collections:e,deleteMissing:t}},r),this.client.send(this.baseCrudPath+"/import",r).then(()=>!0)}},ru=class extends Io{async getList(e=1,t=30,r){return(r=Object.assign({method:"GET"},r)).query=Object.assign({page:e,perPage:t},r.query),this.client.send("/api/logs",r)}async getOne(e,t){if(!e)throw new qt({url:this.client.buildUrl("/api/logs/"),status:404,response:{code:404,message:"Missing required log id.",data:{}}});return t=Object.assign({method:"GET"},t),this.client.send("/api/logs/"+encodeURIComponent(e),t)}async getStats(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/logs/stats",e)}},ou=class extends Io{async check(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/health",e)}},nu=class extends Io{getUrl(e,t,r={}){if(!t||!(e!=null&&e.id)||!(e!=null&&e.collectionId)&&!(e!=null&&e.collectionName))return"";let n=[];n.push("api"),n.push("files"),n.push(encodeURIComponent(e.collectionId||e.collectionName)),n.push(encodeURIComponent(e.id)),n.push(encodeURIComponent(t));let s=this.client.buildUrl(n.join("/"));if(Object.keys(r).length){r.download===!1&&delete r.download;let i=new URLSearchParams(r);s+=(s.includes("?")?"&":"?")+i}return s}async getToken(e){return e=Object.assign({method:"POST"},e),this.client.send("/api/files/token",e).then(t=>(t==null?void 0:t.token)||"")}},su=class extends Io{async getFullList(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/backups",e)}async create(e,t){return t=Object.assign({method:"POST",body:{name:e}},t),this.client.send("/api/backups",t).then(()=>!0)}async upload(e,t){return t=Object.assign({method:"POST",body:e},t),this.client.send("/api/backups/upload",t).then(()=>!0)}async delete(e,t){return t=Object.assign({method:"DELETE"},t),this.client.send(`/api/backups/${encodeURIComponent(e)}`,t).then(()=>!0)}async restore(e,t){return t=Object.assign({method:"POST"},t),this.client.send(`/api/backups/${encodeURIComponent(e)}/restore`,t).then(()=>!0)}getDownloadUrl(e,t){return this.client.buildUrl(`/api/backups/${encodeURIComponent(t)}?token=${encodeURIComponent(e)}`)}},Tn=class{constructor(e="/",t,r="en-US"){this.cancelControllers={},this.recordServices={},this.enableAutoCancellation=!0,this.baseUrl=e,this.lang=r,this.authStore=t||new Qf,this.admins=new Xf(this),this.collections=new tu(this),this.files=new nu(this),this.logs=new ru(this),this.settings=new Zf(this),this.realtime=new Ka(this),this.health=new ou(this),this.backups=new su(this)}collection(e){return this.recordServices[e]||(this.recordServices[e]=new eu(this,e)),this.recordServices[e]}autoCancellation(e){return this.enableAutoCancellation=!!e,this}cancelRequest(e){return this.cancelControllers[e]&&(this.cancelControllers[e].abort(),delete this.cancelControllers[e]),this}cancelAllRequests(){for(let e in this.cancelControllers)this.cancelControllers[e].abort();return this.cancelControllers={},this}filter(e,t){if(!t)return e;for(let r in t){let n=t[r];switch(typeof n){case"boolean":case"number":n=""+n;break;case"string":n="'"+n.replace(/'/g,"\\'")+"'";break;default:n=n===null?"null":n instanceof Date?"'"+n.toISOString().replace("T"," ")+"'":"'"+JSON.stringify(n).replace(/'/g,"\\'")+"'"}e=e.replaceAll("{:"+r+"}",n)}return e}getFileUrl(e,t,r={}){return this.files.getUrl(e,t,r)}buildUrl(e){var r;let t=this.baseUrl;return typeof window=="undefined"||!window.location||t.startsWith("https://")||t.startsWith("http://")||(t=(r=window.location.origin)!=null&&r.endsWith("/")?window.location.origin.substring(0,window.location.origin.length-1):window.location.origin||"",this.baseUrl.startsWith("/")||(t+=window.location.pathname||"/",t+=t.endsWith("/")?"":"/"),t+=this.baseUrl),e&&(t+=t.endsWith("/")?"":"/",t+=e.startsWith("/")?e.substring(1):e),t}async send(e,t){t=this.initSendOptions(e,t);let r=this.buildUrl(e);if(this.beforeSend){let n=Object.assign({},await this.beforeSend(r,t));n.url!==void 0||n.options!==void 0?(r=n.url||r,t=n.options||t):Object.keys(n).length&&(t=n,console!=null&&console.warn&&console.warn("Deprecated format of beforeSend return: please use `return { url, options }`, instead of `return options`."))}if(t.query!==void 0){let n=this.serializeQueryParams(t.query);n&&(r+=(r.includes("?")?"&":"?")+n),delete t.query}return this.getHeader(t.headers,"Content-Type")=="application/json"&&t.body&&typeof t.body!="string"&&(t.body=JSON.stringify(t.body)),(t.fetch||fetch)(r,t).then(async n=>{let s={};try{s=await n.json()}catch(i){}if(this.afterSend&&(s=await this.afterSend(n,s)),n.status>=400)throw new qt({url:n.url,status:n.status,data:s});return s}).catch(n=>{throw new qt(n)})}initSendOptions(e,t){if((t=Object.assign({method:"GET"},t)).body=this.convertToFormDataIfNeeded(t.body),ey(t),t.query=Object.assign({},t.params,t.query),t.requestKey===void 0&&(t.$autoCancel===!1||t.query.$autoCancel===!1?t.requestKey=null:(t.$cancelKey||t.query.$cancelKey)&&(t.requestKey=t.$cancelKey||t.query.$cancelKey)),delete t.$autoCancel,delete t.query.$autoCancel,delete t.$cancelKey,delete t.query.$cancelKey,this.getHeader(t.headers,"Content-Type")!==null||this.isFormData(t.body)||(t.headers=Object.assign({},t.headers,{"Content-Type":"application/json"})),this.getHeader(t.headers,"Accept-Language")===null&&(t.headers=Object.assign({},t.headers,{"Accept-Language":this.lang})),this.authStore.token&&this.getHeader(t.headers,"Authorization")===null&&(t.headers=Object.assign({},t.headers,{Authorization:this.authStore.token})),this.enableAutoCancellation&&t.requestKey!==null){let r=t.requestKey||(t.method||"GET")+e;delete t.requestKey,this.cancelRequest(r);let n=new AbortController;this.cancelControllers[r]=n,t.signal=n.signal}return t}convertToFormDataIfNeeded(e){if(typeof FormData=="undefined"||e===void 0||typeof e!="object"||e===null||this.isFormData(e)||!this.hasBlobField(e))return e;let t=new FormData;for(let r in e){let n=this.normalizeFormDataValue(e[r]),s=Array.isArray(n)?n:[n];if(s.length)for(let i of s)t.append(r,i);else t.append(r,"")}return t}normalizeFormDataValue(e){return e===null||typeof e!="object"||e instanceof Date||this.hasBlobField({data:e})||Array.isArray(e)&&!e.filter(t=>typeof t!="string").length?e:JSON.stringify(e)}hasBlobField(e){for(let t in e){let r=Array.isArray(e[t])?e[t]:[e[t]];for(let n of r)if(typeof Blob!="undefined"&&n instanceof Blob||typeof File!="undefined"&&n instanceof File)return!0}return!1}getHeader(e,t){e=e||{},t=t.toLowerCase();for(let r in e)if(r.toLowerCase()==t)return e[r];return null}isFormData(e){return e&&(e.constructor.name==="FormData"||typeof FormData!="undefined"&&e instanceof FormData)}serializeQueryParams(e){let t=[];for(let r in e){if(e[r]===null)continue;let n=e[r],s=encodeURIComponent(r);if(Array.isArray(n))for(let i of n)t.push(s+"="+encodeURIComponent(i));else n instanceof Date?t.push(s+"="+encodeURIComponent(n.toISOString())):typeof n!==null&&typeof n=="object"?t.push(s+"="+encodeURIComponent(JSON.stringify(n))):t.push(s+"="+encodeURIComponent(n))}return t.join("&")}};var Ga=class extends yt{constructor(t){super();this.sharedFolder=t;let r=t.loginManager.getEndpointManager().getAuthUrl();this.pb=new Tn(r,t.loginManager.authStore),this.tokenStore=t.tokenStore}async verify(t){if(!t.meta)throw new Error("cannot head file with missing hash");let r=t.meta.hash,n=await this.tokenStore.getFileToken(at.encode(t.s3rn),r,t.mimetype,0);return(await ot(n.baseUrl,{method:"HEAD",headers:{Authorization:`Bearer ${n.token}`}})).status===200}async readFile(t){if(!t.meta)throw new Error("cannot pull file with missing hash");let r=t.meta.hash,n=await this.tokenStore.getFileToken(at.encode(t.s3rn),r,t.mimetype,0),s=await ot(n.baseUrl+"/download-url",{method:"GET",headers:{Authorization:`Bearer ${n.token}`}});if(s.status===404)throw new Error(`[${this.sharedFolder.path}] File is missing: ${t.guid} ${t.meta.hash} ${t.meta.type}`);let a=(await s.json()).downloadUrl;return(await ot(a)).arrayBuffer()}async writeFile(t){let r=await t.caf.read(),n=await t.caf.hash();if(this.log("writeFile",n),!(r&&n))throw new Error("invalid caf");let s=await this.tokenStore.getFileToken(at.encode(t.s3rn),n,t.mimetype,r.byteLength),i=await ot(s.baseUrl+"/upload-url",{method:"POST",headers:{Authorization:`Bearer ${s.token}`}}),a=await i.json();if(i.status!==200)throw new Error(a.error);let l=a.uploadUrl;await ot(l,{method:"PUT",headers:{"Content-Type":t.mimetype},body:r})}destroy(){this.pb.cancelAllRequests(),this.pb=null,this.tokenStore=null,this.sharedFolder=null}};var Xt=class extends Error{constructor(t,r){super(t);this.path=r;this.name="SettingsError"}};var Ja=class extends et{constructor(t,r){super();this.storage=t;this.defaults=r;this._loaded=!1;this.data={...r}}async load(){let t=await this.storage.loadData();this.data={...this.defaults,...t||{}},this._loaded=!0,this.log("Loaded settings from disk:",this.data)}async save(){if(!this._loaded){this.warn("Attempted to save before loading settings from disk");return}this.log("Saving settings to disk:",this.data),await this.storage.saveData(this.data)}get(){return this.data}async update(t){if(!this._loaded){this.warn("Attempted to update before loading settings from disk");return}let r=t(this.data),n=await this.storage.loadData();if(JSON.stringify(r)===JSON.stringify(n)){this.debug("updated matches disk, no change");return}this.data=r,await this.save(),this.notifyListeners()}notifyListeners(){for(let t of this._listeners)t(this.data)}},zt=class extends et{constructor(t,r){super(`NamespacedSettings[${r}]`);this.settings=t;this.patterns=[];this.validatePath(r),[this.path,this.basePath,this.patterns]=this.processPath(r),this.lastKnown=this.getNestedValue(this.settings.get()),this.setupSubscription()}isWildcardPattern(t){return t.type==="wildcard"}validatePath(t){if(!t)throw new Xt("Path cannot be empty");if(t.startsWith("/")||t.endsWith("/"))throw new Xt(`Invalid path format: ${t}`)}createPatternRegex(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace("\\*",".*")}setupSubscription(){this.unsub=this.settings.subscribe(()=>{let t=this.getNestedValue(this.settings.get());this.lastKnown===void 0&&t===void 0||JSON.stringify(this.lastKnown)!==JSON.stringify(t)&&(this.lastKnown=t,this.notifyListeners())})}hasArrayPatterns(){return this.patterns.some(t=>t.type==="arrayMatch")}destroy(){this.destroyed||(this.unsub&&(this.unsub(),this.unsub=void 0),this._listeners.clear(),this.destroyed=!0)}get(){if(this.destroyed)throw new Xt("Cannot use destroyed settings",this.getPath());let t=this.settings.get();if(!t)return{};let r=this.patterns.find(this.isWildcardPattern);if(r&&this.path.length===1){let s=new RegExp(`^${r.wildcardPattern}$`);return Object.entries(t).filter(([a])=>s.test(a)).reduce((a,[l,c])=>(a[l]=c,a),{})}let n=this.getNestedValue(t);return n===void 0?{}:n}async set(t){if(this.destroyed)throw new Xt("Cannot use destroyed settings",this.getPath());if(t===void 0)throw new Xt("Cannot set undefined value",this.getPath());try{await this.settings.update(r=>{let n=this.patterns.find(this.isWildcardPattern);if(n){if(this.path.length===1){let l=new RegExp(`^${n.wildcardPattern}$`),c={...r};return Object.entries(t).forEach(([f,u])=>{l.test(f)&&(c[f]=u)}),c}let s={...r},i=s;this.path.forEach(l=>{i[l]=i[l]||{},i=i[l]});let a=new RegExp(`^${n.wildcardPattern}$`);return Object.entries(t).forEach(([l,c])=>{a.test(l)&&(i[l]=c)}),s}return this.setNestedValue(r,t)})}catch(r){let n=r instanceof Error?r.message:"Unknown error";throw new Xt(`Failed to set value at path ${this.getPath()}: ${n}`,this.getPath())}}async update(t,r=!1){if(this.destroyed)throw new Xt("Cannot use destroyed settings",this.getPath());let n=this.get(),s=t(n);!r&&JSON.stringify(n)===JSON.stringify(s)||await this.set(s)}async flush(){if(this.destroyed)throw new Xt("Cannot use destroyed settings",this.getPath());await this.update(t=>t,!0)}processPath(t){let r=t.split("/").filter(a=>a),n=[],s=[],i=[];return r.forEach((a,l)=>{let c=a.match(/^\[(\w+)=(.+)\]$/),f=a.match(/^\((.+?)\)$/);if(c){let[,u,d]=c,m=l>0?s[l-1]:a.split("[")[0];i.push({type:"arrayMatch",key:u,value:d,level:l}),n.push(a),s.push(m)}else if(f){let[,u]=f;i.push({type:"wildcard",wildcardPattern:this.createPatternRegex(u),level:l}),n.push(a),s.push(a)}else n.push(a),s.push(a)}),[n,s,i]}getNestedValue(t){let r=t,n=this.patterns.find(this.isWildcardPattern);if(n&&this.path.length===1){let i=new RegExp(`^${n.wildcardPattern}$`);return Object.entries(r).filter(([l])=>i.test(l)).reduce((l,[c,f])=>(l[c]=f,l),{})}let s=this.patterns[0];if((s==null?void 0:s.type)==="arrayMatch"){let i=this.basePath[0];if(!Array.isArray(r[i]))return;let a=r[i].find(c=>c[s.key]===s.value);if(!a)return;let l=this.basePath.slice(s.level+1);if(l.length>0){let c=a;for(let f of l){if(!c||typeof c!="object")return;c=c[f]}return c}return a}for(let i=0;i<this.basePath.length;i++){if(!r)return;r=r[this.basePath[i]]}return r}setNestedValue(t,r){let n={...t},s=this.patterns.find(l=>l.type==="arrayMatch");if(s){let l=this.basePath[0];n[l]||(n[l]=[]);let c=n[l].findIndex(u=>u[s.key]===s.value),f=this.basePath.slice(s.level+1);if(c>=0)if(f.length>0){let u=n[l][c];for(let m=0;m<f.length-1;m++){let p=f[m];u[p]=u[p]||{},u=u[p]}let d=f[f.length-1];u[d]=r}else n[l][c]={...n[l][c],...r,[s.key]:s.value};else if(f.length>0){let u={[s.key]:s.value},d=u;for(let p=0;p<f.length-1;p++){let y=f[p];d[y]={},d=d[y]}let m=f[f.length-1];d[m]=r,n[l].push(u)}else n[l].push({...r,[s.key]:s.value});return n}let i=n;for(let l=0;l<this.basePath.length-1;l++){let c=this.basePath[l];i[c]=i[c]||{},i=i[c]}let a=this.basePath[this.basePath.length-1];return i[a]=r,n}getParent(){if(this.destroyed)throw new Xt("Cannot use destroyed settings",this.getPath());let t=this.path.slice(0,-1).join("/");return new zt(this.settings,t)}getChild(t,r){let n=[...this.path,t].join("/");return r?r(this.settings,n):(this.log("getChild",this.path,t,n,this.patterns),new zt(this.settings,n))}getPath(){return this.path.join("/")}exists(){if(this.destroyed)throw new Xt("Cannot use destroyed settings",this.getPath());let t=this.settings.get();return this.getNestedValue(t)!==void 0}async delete(){if(this.destroyed)throw new Xt("Cannot use destroyed settings",this.getPath());await this.settings.update(t=>{let r={...t},n=this.patterns.find(l=>l.type==="arrayMatch");if(n){let l=this.basePath[0];return Array.isArray(r[l])&&(r[l]=r[l].filter(c=>c[n.key]!==n.value),r[l].length===0&&delete r[l]),r}let s=r,i=this.basePath.slice(0,-1);for(let l of i){if(!s[l])return r;s=s[l]}let a=this.basePath[this.basePath.length-1];return delete s[a],r})}subscribe(t){if(this.destroyed)throw new Xt("Cannot use destroyed settings",this.getPath());return this._listeners.add(t),t(this.get()),()=>{this._listeners.delete(t)}}notifyListeners(){if(this.destroyed)return;let t=this.get();for(let r of this._listeners)r(t)}};var Yo=class extends zt{constructor(t,r,n=!0){super(t,r);this.enabled=n}isExtensionEnabled(t){var s,i;let n=(t.split(".").pop()||"").toLowerCase();if(n==="md"||Ve().enableCanvasSync&&n==="canvas")return!0;if(!this.enabled||!Ve().enableAttachmentSync)return!1;for(let[a,l]of Object.entries(Yo.schema)){let c=a;if(((s=this.get()[c])!=null?s:l.defaultEnabled)&&l.extensions.includes(n))return!0}return(i=this.get().otherTypes)!=null?i:Yo.schema.otherTypes.defaultEnabled}getCategory(t){var s;let r=Yo.schema[t];return{enabled:(s=this.get()[t])!=null?s:r.defaultEnabled,name:r.name,description:r.description,extensions:r.extensions}}getCategories(){return Object.keys(Yo.schema).reduce((t,r)=>(t[r]=this.getCategory(r),t),{})}async toggleCategory(t,r){await this.update(n=>({...n,[t]:r})),this.log(`setting ${t} to ${r}`),this.notifyListeners()}async resetToDefault(){await this.update(()=>({...Yo.defaultFlags}))}},Qo=Yo;Qo.schema={images:{name:"Images",description:"Sync image files (.bmp, .png, .jpg, .jpeg, .gif, .svg, .webp, .avif)",extensions:["bmp","png","jpg","jpeg","gif","svg","webp","avif"],defaultEnabled:!0},audio:{name:"Audio",description:"Sync audio files (.mp3, .wav, .m4a, .3gp, .flac, .ogg, .oga, .opus)",extensions:["mp3","wav","m4a","3gp","flac","ogg","oga","opus"],defaultEnabled:!0},videos:{name:"Videos",description:"Sync video files (.mp4, .webm, .ogv, .mov, .mkv)",extensions:["mp4","webm","ogv","mov","mkv"],defaultEnabled:!0},pdfs:{name:"PDFs",description:"Sync PDF files (.pdf)",extensions:["pdf"],defaultEnabled:!0},otherTypes:{name:"Other files",description:"Sync unsupported file types",extensions:[],defaultEnabled:!1}},Qo.defaultFlags=Object.fromEntries(Object.entries(Yo.schema).map(([t,r])=>[t,r.defaultEnabled]));var Ai=require("obsidian");async function iu(o){let e=await crypto.subtle.digest("SHA-256",o);return Array.from(new Uint8Array(e)).map(r=>r.toString(16).padStart(2,"0")).join("")}function kr(o){return!!o&&o instanceof Zo}var Ya=class extends yt{constructor(t){super();this.db=null;this.setLoggers("[ContentAddressedFileStore]"),this.dbName=`${t}-relay-hashes`,this.ready=this.openDB()}async openDB(){return new Promise((t,r)=>{let n=indexedDB.open(this.dbName,1);n.onupgradeneeded=s=>{let i=n.result;i.objectStoreNames.contains("files")||i.createObjectStore("files",{keyPath:"path"})},n.onsuccess=s=>{this.db=n.result,t()},n.onerror=s=>{this.error("Error opening ContentAddressedFile database:",n.error),r(n.error)}})}async saveHash(t,r,n){if(await this.ready,!!this.db)return new Promise((s,i)=>{if(!this.db)return;let c=this.db.transaction(["files"],"readwrite").objectStore("files").put({path:t,hash:r,modifiedAt:n});c.onsuccess=()=>s(),c.onerror=()=>{this.error("Error saving hash:",c.error),i(c.error)}})}async getHash(t){return await this.ready,this.db?new Promise((r,n)=>{if(!this.db)return null;let a=this.db.transaction(["files"],"readonly").objectStore("files").get(t);a.onsuccess=()=>{r(a.result||null)},a.onerror=()=>{this.error("Error retrieving hash:",a.error),n(a.error)}}):null}async removeHash(t){if(await this.ready,!!this.db)return new Promise((r,n)=>{if(!this.db)return null;let a=this.db.transaction(["files"],"readwrite").objectStore("files").delete(t);a.onsuccess=()=>r(),a.onerror=()=>{this.error("Error removing hash:",a.error),n(a.error)}})}destroy(){this.db&&(this.db.close(),this.db=null)}},au=class extends yt{constructor(t,r,n){super();this.vault=t;this.path=r;this.store=n;this.content=null;this._tfile=null;let s=this.vault.getAbstractFileByPath(r);s&&s instanceof Ai.TFile&&(this._tfile=s)}get tfile(){if(!this._tfile){let t=this.vault.getAbstractFileByPath(this.path);if(t&&t instanceof Ai.TFile)this._tfile=t;else throw new Error(`missing tfile: ${this.path}`)}return this._tfile}async loadHashFromStore(){try{let t=await this.store.getHash(this.path);if(t&&t.modifiedAt===this.tfile.stat.mtime)return t.hash}catch(t){this.warn("Failed to load hash from store:",t)}}get modifiedAt(){if(!this.tfile)throw new Error("missing tfile");return this.tfile.stat.mtime}async read(){this.log("reading content from disk");let t=this.tfile.stat.mtime,r=await this.vault.readBinary(this.tfile),n=await iu(r);try{await this.store.saveHash(this.path,n,t)}catch(s){this.warn("Failed to save hash to store:",s)}return r}async _hash(){let t=this.tfile.stat.mtime,r=await this.vault.readBinary(this.tfile),n=await iu(r);try{await this.store.saveHash(this.path,n,t)}catch(s){this.warn("Failed to save hash to store:",s)}return n}exists(){if(this._tfile)return!0;let t=this.vault.getAbstractFileByPath(this.path);return t&&t instanceof Ai.TFile?(this._tfile=t,!0):!1}async clear(){this._tfile=null,this.store.removeHash(this.path).catch(t=>{this.warn("Failed to remove hash from store:",t)})}async hash(){let t=await this.loadHashFromStore();return t||(t=await this._hash(),t)}destroy(){this.vault=null,this._tfile=null}},Zo=class extends et{constructor(t,r,n,s){super();this.path=t;this.guid=r;this.hashStore=n;this.ready=!1;this.connected=!0;this.offFileInfo=()=>{};this.uploadError=void 0;this.s3rn=s.relayId?new bo(s.relayId,s.guid,r):new _i(s.guid,r),this._parent=s,this.setLoggers(`[SharedFile](${this.path})`),this.name=this.path.split("/").pop()||"",this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.vault=this._parent.vault;let i=this.sharedFolder.syncStore.typeRegistry.getTypeForPath(t);if(!i)throw new Error("unexpected synctype");this.type=i,this.caf=new au(this.vault,this.sharedFolder.getPath(t),this.hashStore),this.log("created")}get mimetype(){return Ko(this.path)}disconnect(){}get inMeta(){return!!this.sharedFolder.syncStore.getMeta(this.path)}get pending(){return!!this.sharedFolder.syncStore.pendingUpload.has(this.path)}get tag(){return this.inMeta?"":this.uploadError?this.uploadError:this.pending?"pending":"unknown"}move(t,r){t!==this.path&&(this._parent=r,this.debug("setting new path",t),this.path=t,this.name=t.split("/").pop()||"",this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.setLoggers(`[SharedFile](${this.path})`))}get lastModified(){return this.stat.mtime}_refreshMeta(){let t=this.sharedFolder.syncStore.getMeta(this.path);return this.meta=t,t}async push(t=!1){if(this.log("push"),!this.sharedFolder.connected){this.log("skipping push -- folder is disconnected");return}if(!this.sharedFolder.syncStore.canSync(this.path)){this.log("skipping push -- filetype is disabled");return}let r=await this.caf.hash();if(this._refreshMeta(),!this.meta||r&&this.meta.hash!==r||t)try{await this.sharedFolder.cas.writeFile(this),await this.sharedFolder.markUploaded(this),this.uploadError=void 0,this.notifyListeners()}catch(n){let s="Failed to push file";try{s=n.toString()}catch(i){}this.uploadError=s.replace(/^Error:/,"").trim(),this.notifyListeners()}}async sync(){var t;if(this.log("sync"),this._refreshMeta(),this.caf.exists()){if(!this.meta){await this.push();return}}else{if(!this.meta)throw new Error("unexpected case");await this.pull();return}try{let r=await this.caf.hash();if(Ve().enableVerifyUploads)try{this.verifyUpload()||(this.warn("file in metadata, but not on the server!"),await this.push())}catch(n){}if(r!==this.meta.hash){if(this.stat.mtime>this.meta.synctime){await this.push();return}this.warn("synctime",this.meta.synctime,(t=this.meta)==null?void 0:t.synctime,this.stat.mtime),await this.pull();return}}catch(r){this.warn("unable to compute hash",r)}}shouldPull(t){return!this.tfile||t.synctime>this.stat.mtime}async verifyUpload(){if(this.log("verify upload"),this._refreshMeta(),!this.meta)throw new Error("cannot verify upload without meta");return this.sharedFolder.cas.verify(this)}async pull(){if(this.log("pull"),this._refreshMeta(),!this.meta)throw new Error("cannot pull without meta");if(!(this.caf.exists()&&await this.caf.hash()===this.meta.hash))try{let t=await this.sharedFolder.cas.readFile(this);await this.vault.adapter.writeBinary(this.sharedFolder.getPath(this.path),t),await this.caf.hash()}catch(t){this.log(t);return}}get tfile(){let t=this.vault.getAbstractFileByPath(this.sharedFolder.getPath(this.path));if(t instanceof Ai.TFile)return t;throw new Error("TFile API used before file existed")}get stat(){return this.tfile.stat}get parent(){var t;return((t=this.tfile)==null?void 0:t.parent)||null}get sharedFolder(){return this._parent}async connect(){return this.sharedFolder.s3rn instanceof _r?!1:(this.s3rn instanceof vo&&(this.sharedFolder.relayId?this.s3rn=new bo(this.sharedFolder.relayId,this.sharedFolder.guid,this.guid):this.s3rn=new _i(this.sharedFolder.guid,this.guid)),this.sharedFolder.shouldConnect&&this.sharedFolder.connect().then(t=>(this.connected=!0,this.connected)))}async read(){return this.vault.read(this.tfile)}async delete(){return await this.caf.clear(),this.vault.delete(this.tfile)}async write(t){this.vault.adapter.write(this.tfile.path,t),await this.caf.hash()}async append(t){this.vault.append(this.tfile,t),await this.caf.hash()}cleanup(){}destroy(){var t;(t=this.offFileInfo)==null||t.call(this),this.offFileInfo=null,this._parent=null,this.caf.destroy()}};function Xr(o,e){if(!o||!e)return!1;for(let t in o)if(typeof o[t]=="object"&&o[t]!==null){if(!Xr(o[t],e[t]))return!1}else if(o[t]!==e[t])return!1;for(let t in e)if(!(t in o))return!1;return!0}function cr(o){return o instanceof lt}var lt=class extends _o{constructor(t,r,n,s){let i=s.relayId?new Zt(s.relayId,s.guid,r):new Ln(s.guid,r);super(r,i,s.tokenStore,n);this.whenSyncedPromise=null;this.persistenceSynced=!1;this.userLock=!1;this.unsubscribes=[];this._parent=s,this.path=t,this.name="[CRDT] "+t.split("/").pop()||"",this.setLoggers(this.name),this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.vault=this._parent.vault,this.stat={ctime:Date.now(),mtime:Date.now(),size:0},this.unsubscribes.push(this._parent.subscribe(this.path,a=>{a.intent==="disconnected"&&this.disconnect()})),this.setLoggers(`[Canvas](${this.path})`);try{let a=`${this.sharedFolder.appId}-relay-canvas-${this.guid}`;this._persistence=new Wo(a,this.ydoc)}catch(a){throw this.warn("Unable to open persistence.",this.guid),console.error(a),a}this.whenSynced().then(()=>{this.updateStats();try{this._persistence.set("path",this.path),this._persistence.set("relay",this.sharedFolder.relayId||""),this._persistence.set("appId",this.sharedFolder.appId),this._persistence.set("s3rn",at.encode(this.s3rn))}catch(a){}(async()=>(await this.getServerSynced()||(await this.onceProviderSynced(),await this.markSynced()),this.sharedFolder.markUploaded(this)))()}),this._tfile=null}get yedges(){return this.ydoc.getMap("edges")}get ynodes(){return this.ydoc.getMap("nodes")}textNode(t){let r=this.ydoc.getText(t.id);return r.toString()===""&&r.insert(0,t.text),r}static exportCanvasData(t){let r=t.getMap("edges"),n=t.getMap("nodes"),s=[],i=[];for(let[,a]of r.entries())s.push({...a});for(let[,a]of n.entries()){let l=t.getText(a.id);i.push({...a,text:l.toString()||a.text})}return{edges:s,nodes:i}}async markSynced(){this._serverSynced=!0,await this._persistence.set("serverSync",1)}async getServerSynced(){return this._serverSynced!==void 0?this._serverSynced:await this._persistence.get("serverSync")===1?(this._serverSynced=!0,this._serverSynced):!1}async connect(){return this.sharedFolder.s3rn instanceof _r?!1:(this.s3rn instanceof Ln&&(this.sharedFolder.relayId?this.s3rn=new Zt(this.sharedFolder.relayId,this.sharedFolder.guid,this.guid):this.s3rn=new Ln(this.sharedFolder.guid,this.guid)),this.sharedFolder.shouldConnect&&this.sharedFolder.connect().then(t=>super.connect()))}async count(){if(this._persistence.db===null)throw new Error("database not ready yet");if(this._dbsize)return this._dbsize;if(this._persistence._dbsize>3)return this._dbsize=this._persistence._dbsize,this._dbsize;let[t]=br(this._persistence.db,["updates"],"readonly"),r=await yo(t);return this._dbsize=r,this._dbsize}get dbsize(){if(!this._dbsize)throw new Error("dbsize accessed before count");return this._persistence._dbsize===0&&this._dbsize?this._dbsize:this._persistence._dbsize}get ready(){return this._persistence.synced&&(this.synced||!!this._serverSynced||this._origin==="local")}hasLocalDB(){return!!this._serverSynced||this._persistence._dbsize>3||!!(this._dbsize&&this._dbsize>3)}async awaitingUpdates(){return await this.whenSynced(),await this.getServerSynced(),this._awaitingUpdates?(this._awaitingUpdates=!this.hasLocalDB(),this._awaitingUpdates):!1}async whenReady(){let t=async()=>await this.awaitingUpdates()?(this.log("awaiting updates"),this.connect(),await this.onceConnected(),this.log("connected"),await this.onceProviderSynced(),this.log("synced"),this):this;return this.readyPromise=this.readyPromise||new Or(t,()=>[this.ready,this]),this.readyPromise.getPromise()}whenSynced(){let t=async()=>(await this.sharedFolder.whenSynced(),this._persistence.synced&&!this.persistenceSynced?(await this.count(),this.persistenceSynced=!0,Promise.resolve()):new Promise(r=>{this.persistenceSynced&&r(),this._persistence.once("synced",async()=>{await this.count(),this.persistenceSynced=!0,r()})}));return this.whenSyncedPromise=this.whenSyncedPromise||new Or(t,()=>[this.persistenceSynced,void 0]),this.whenSyncedPromise.getPromise()}get sharedFolder(){return this._parent}get tfile(){return this._tfile||(this._tfile=this._parent.getTFile(this)),this._tfile}static checkExtension(t){return t.endsWith(".canvas")&&Ve().enableCanvasSync}async markOrigin(t){this._origin=t,await this._persistence.set("origin",t)}async getOrigin(){return this._origin!==void 0?this._origin:(this._origin=await this._persistence.get("origin"),this._origin)}async applyJSON(t){if(t==="")return;let r=JSON.parse(t);return await this.applyData(r)}async importFromView(t){if(t.file&&t.file===this.tfile)return await this.applyData(t.canvas.getData())}async applyData(t){let r=this.yedges,n=this.ynodes,s=new Set,i=new Map,a=new Set,l=new Map,c=new Set;t.nodes.forEach(f=>{s.add(f.id);let u=n.get(f.id);u?Xr(u,f)||i.set(f.id,f):(i.set(f.id,f),f.type==="text"&&this.textNode(f))});for(let f of n.keys())s.has(f)||a.add(f);t.edges.forEach(f=>{s.add(f.id);let u=r.get(f.id);u&&Xr(u,f)||l.set(f.id,f)});for(let f of r.keys())s.has(f)||c.add(f);(i.size>0||a.size>0||l.size>0||c.size>0)&&Ge(this.ydoc,()=>{for(let f of i.values())this.ynodes.set(f.id,f);for(let f of a)this.ynodes.delete(f);for(let f of l.values())this.yedges.set(f.id,f);for(let f of c)this.yedges.delete(f)},this)}move(t,r){this.path=t,this._parent=r,this.name=t.split("/").pop()||"",this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.updateStats()}get mimetype(){return Ko(this.path)}get json(){let t=lt.exportCanvasData(this.ydoc);return JSON.stringify(t)}async cleanup(){}updateStats(){this.stat.mtime=Date.now(),this.stat.size=this.json.length}destroy(){var t,r;this.unsubscribes.forEach(n=>{n()}),super.destroy(),this.ydoc.destroy(),(t=this.whenSyncedPromise)==null||t.destroy(),this.whenSyncedPromise=null,(r=this.readyPromise)==null||r.destroy(),this.readyPromise=null}};var lu=class extends Go{constructor(){super(...arguments);this.notifyListeners=(0,je.debounce)(super.notifyListeners,100)}update(){this.notifyListeners()}add(t,r=!0){let n=this.find(s=>s.guid===t.guid);return n&&n!==t&&(this.error("duplicate guid",n,t),this._set.delete(n)),this._set.add(t),r&&this.notifyListeners(),this}},Qa=class extends _o{constructor(t,r,n,s,i,a,l,c,f,u,d,m,p=!0){var g;let y=m?new xo(m,r):new _r(r);super(r,y,l,s);this.appId=t;this.hashStore=f;this.backgroundSync=u;this._settings=d;this.destroyed=!1;this.readyPromise=null;this.whenSyncedPromise=null;this.persistenceSynced=!1;this.syncFileTreePromise=null;this.syncRequestedDuringSync=!1;this.unsubscribes=[];this.addLocalDocs=()=>{let t=this.getSyncFiles(),r=[],n=this.placeHold(t);t.forEach(s=>{let i=this.getVirtualPath(s.path),a=n.contains(i);if(s instanceof je.TFolder){let l=this.getSyncFolder(i,!1);r.push(l)}else if(bt.checkExtension(i))if(a){let l=this.uploadDoc(i,!1);r.push(l)}else{let l=this.getDoc(i,!1);r.push(l)}else if(lt.checkExtension(i))if(a){let l=this.uploadCanvas(i,!1);r.push(l)}else{let l=this.getCanvas(i,!1);r.push(l)}else if(this.syncStore.canSync(i))if(a){let l=this.uploadSyncFile(i,!1);r.push(l)}else{let l=this.syncFile(i,!1);r.push(l)}}),r.length>0&&this.fset.update()};this.path=n,this.setLoggers(`[SharedFile](${this.path})`),this.fileManager=a,this.vault=i,this.files=new Map,this.fset=new lu,this.pendingUpload=new ko(`${t}-system3-relay/folders/${this.guid}/pendingUploads`),this.pendingUpload.forEach((v,C)=>{this.existsSync(C)||(this.warn("deleting pending upload record because file is missing",C,v),this.pendingUpload.delete(C))}),this.relayManager=c,this.relayId=m,this.diskBufferStore=new Na,this._shouldConnect=(g=this.settings.connect)!=null?g:!0,this.authoritative=!p,this.syncSettingsManager=this._settings.getChild("sync",(v,C)=>new Qo(v,C)),this.syncStore=new za(this.ydoc,this.path,this.pendingUpload,this.syncSettingsManager),this.syncStore.on(async()=>{await this.syncFileTree(this.syncStore)}),this.unsubscribes.push(this.relayManager.remoteFolders.subscribe(v=>{this.remote=v.find(C=>C.guid==this.guid)})),this.unsubscribes.push(this.relayManager.storageQuotas.subscribe(async v=>{let C=v.find(L=>{var T;return L.id===((T=this._remote)==null?void 0:T.relay.storageQuotaId)});C!==void 0&&this.storageQuota!==C.quota&&(this.storageQuota!==void 0&&C.quota!==void 0&&C.quota>this.storageQuota&&(this.debug("storage quota increase",this.storageQuota,C.quota),await this.netSync()),this.debug("storage quota update",this.storageQuota,C.quota),this.storageQuota=C.quota)})),this.proxy=Bg(this,this.path,v=>this.getVirtualPath(v));try{this._persistence=new Wo(this.guid,this.ydoc)}catch(v){throw this.warn("Unable to open persistence.",this.guid),console.error(v),v}s.loggedIn&&this.connect(),this.cas=new Ga(this),this.whenReady().then(()=>{this.destroyed||(this.addLocalDocs(),this.syncFileTree(this.syncStore))}),this.whenSynced().then(async()=>{this.syncStore.start();try{this._persistence.set("path",this.path),this._persistence.set("relay",this.relayId||""),this._persistence.set("appId",this.appId),this._persistence.set("s3rn",at.encode(this.s3rn))}catch(v){}}),(async()=>await this.getServerSynced()||(await this.onceProviderSynced(),await this.markSynced()))(),Ct.set(this,this.path)}get server(){return this._server}set server(t){if(t===this._server)return;this.warn("server changed -- reinitializing all connections");let r=this.shouldConnect;this.reset();let n=[];this.fset.forEach(s=>{s instanceof _o&&(s.connected&&n.push(s),s.reset())}),this.tokenStore.clear(s=>{var i;return!!(this.relayId&&((i=s.token)!=null&&i.docId.startsWith(this.relayId)))}),r&&(this.connect(),n.forEach(s=>{s.connect()})),this._server=t}get tfolder(){let t=this.vault.getAbstractFileByPath(this.path);if(!(t instanceof je.TFolder))throw new Error("tfolder is not a folder");return t}isSyncableTFile(t){let r=this.checkPath(t.path),n=this.getVirtualPath(t.path),s=this.syncStore.canSync(n);if(t instanceof je.TFolder)return r&&s;let i=this.syncSettingsManager.isExtensionEnabled(n);return r&&s&&i}getSyncFiles(){let t=this.vault.getAbstractFileByPath(this.path);if(!(t instanceof je.TFolder))throw new Error(`Could not find shared folders on file system at ${this.path}`);let r=[];return je.Vault.recurseChildren(t,n=>{n!==t&&r.push(n)}),r.filter(n=>this.isSyncableTFile(n))}get shouldConnect(){return this._shouldConnect}set shouldConnect(t){this._settings.update(r=>({...r,connect:t})),this._shouldConnect=t}async netSync(){await this.whenReady(),this.addLocalDocs(),await this.syncFileTree(this.syncStore),this.backgroundSync.enqueueSharedFolderSync(this)}get settings(){return this._settings.get()}async sync(){await this.syncFileTree(this.syncStore)}connect(){return this.s3rn instanceof xo&&(this.connected||this.shouldConnect)?super.connect():Promise.resolve(!1)}get name(){return this.path.split("/").pop()||""}get location(){return this.path.split("/").slice(0,-1).join("/")}get remote(){var t;try{(t=this._remote)==null||t.relay}catch(r){return}return this._remote}set remote(t){var r;this._remote!==t&&(this._remote=t,this.relayId=(r=t==null?void 0:t.relay)==null?void 0:r.guid,this.s3rn=this.relayId?new xo(this.relayId,this.guid):new _r(this.guid),this._settings.update(n=>({...n,relay:this.relayId})),t&&(this._server=t.relay.providerId,this.unsubscribes.push(t.relay.subscribe(n=>{n.guid===this.relayId&&(this.server=n.providerId)}))),this.server=t==null?void 0:t.relay.providerId,this.notifyListeners())}get ready(){return this.persistenceSynced&&(this.authoritative||this._serverSynced||this.synced)}async count(){if(this._persistence.db===null)throw new Error("unexpected missing database");if(this._dbsize)return this._dbsize;if(this._persistence._dbsize>3)return this._dbsize=this._persistence._dbsize,this._dbsize;let[t]=br(this._persistence.db,["updates"],"readonly"),r=await yo(t);return this._dbsize=r,this._dbsize}async markSynced(){this._serverSynced=!0,await this._persistence.set("serverSync",1)}async getServerSynced(){return this._serverSynced!==void 0?this._serverSynced:await this._persistence.get("serverSync")===1?(this._serverSynced=!0,this._serverSynced):!1}hasLocalDB(){return this._persistence._dbsize>3||!!(this._dbsize&&this._dbsize>3)}async awaitingUpdates(){return await this.whenSynced(),this.authoritative||await this.getServerSynced()?!1:!this.hasLocalDB()}whenReady(){let t=async()=>await this.awaitingUpdates()?(this.connect(),await this.onceConnected(),await this.onceProviderSynced(),this):this;return this.readyPromise=this.readyPromise||new Or(t,()=>[this.ready,this]),this.readyPromise.getPromise()}whenSynced(){let t=async()=>{if(this._persistence.synced){await this.count(),this.persistenceSynced=!0;return}return new Promise(r=>{this._persistence.once("synced",async()=>{await this.count(),this.persistenceSynced=!0,r()})})};return this.whenSyncedPromise=this.whenSyncedPromise||new Or(t,()=>(this._persistence.synced&&this._dbsize&&(this.persistenceSynced=!0),[this.persistenceSynced,void 0])),this.whenSyncedPromise.getPromise()}get intent(){return this.shouldConnect?"connected":"disconnected"}async _handleServerRename(t,r,n,s){if(s==null||s.push(`${n.path} was renamed to ${this.getPath(r)}`),n instanceof je.TFile){let i=(0,fr.dirname)(r);this.existsSync(i)||(await this.mkdir(i),s==null||s.push(`creating directory ${i}`))}await this.fileManager.renameFile(n,(0,je.normalizePath)(this.getPath(r))).then(()=>{t.move(r,this)})}async _handleServerCreate(t,r,n){let s=(0,fr.dirname)(t);if(this.existsSync(s)||(await this.mkdir(s),n==null||n.push(`creating directory ${s}`)),r.type==="markdown")return n==null||n.push(`created local .md file for remotely added doc ${t}`),await this.downloadDoc(t,!1);if(r.type==="canvas")return n==null||n.push(`created local .canvas file for remotely added canvas ${t}`),await this.downloadCanvas(t,!1);if(r.type==="folder")return n==null||n.push(`created local folder for remotely added folder ${t}`),this.getSyncFolder(t,!1);if(this.syncStore.canSync(t))return n==null||n.push(`created local file for remotely added file ${t}`),this.downloadSyncFile(t,!1);throw new Error(`${t}: Unexpected file type ${r.type} ${r.mimetype}`)}_assertNamespacing(t){try{this.assertPath(this.path+t)}catch(r){this.error("Deleting doc (somehow moved outside of shared folder)",t),this.syncStore.delete(t);return}}applyRemoteState(t,r,n,s){let i=this.files.get(t),a=this.syncStore.getMeta(r);if(!a)return this.warn("unknown sync type",r),{op:"noop",path:r,promise:Promise.resolve()};if(this.existsSync(r))return i&&kr(i)&&i.shouldPull(a)?{op:"update",path:r,promise:i.pull()}:{op:"noop",path:r,promise:Promise.resolve()};if(n.has(t)&&i){let c=this.getPath(i.path),f=this.vault.getAbstractFileByPath(c);if(f){let u=this._handleServerRename(i,r,f,s);return{op:"rename",path:r,from:c,to:r,promise:u}}}let l=this._handleServerCreate(r,a,s);return{op:"create",path:r,promise:l}}cleanupExtraLocalFiles(t,r){let n=this.getSyncFiles(),s=[],i=n.filter(c=>c instanceof je.TFolder),a=n.filter(c=>c instanceof je.TFile),l=c=>{var g,v;let f=this.isSyncableTFile(c),u=this.checkPath(c.path),d=t.contains(c.path.slice(this.path.length)),m=this.pendingUpload.has(this.getVirtualPath(c.path)),p=this.getVirtualPath(c.path),y=((g=this._provider)==null?void 0:g.synced)&&((v=this._persistence)==null?void 0:v.synced);if(u&&f&&!d&&!m&&y){r.push(`deleted local file ${p} for remotely deleted doc`);let C=this.vault.adapter.trashLocal(c.path);s.push({op:"delete",path:p,promise:C})}};return a.forEach(l),i.forEach(l),s}syncByType(t,r,n,s){t.forEach((i,a)=>{this._assertNamespacing(a),s.contains(i.type)&&(this._assertNamespacing(a),n.push(this.applyRemoteState(i.id,a,t.remoteIds,r)))})}syncFileTree(t){if(this.syncFileTreePromise){this.syncRequestedDuringSync=!0;let n=this.syncFileTreePromise.getPromise();return n.then(()=>{if(this.syncRequestedDuringSync)return this.syncRequestedDuringSync=!1,this.syncFileTree(t)}),n}let r=async()=>{try{let n=[],s=[];this.ydoc.transact(async()=>{this.syncStore.migrateUp(),this.syncByType(t,s,n,["folder"])},this),await Promise.all(n.map(f=>f.promise)),this.ydoc.transact(async()=>{this.syncByType(t,s,n,this.syncStore.typeRegistry.getEnabledFileSyncTypes()),this.syncStore.commit()},this);let i=n.filter(f=>f.op==="create"),a=n.filter(f=>f.op==="rename"),l=n.map(f=>f.path);await Promise.all([...i,...a].map(f=>Fg(f.promise,f)));let c=this.cleanupExtraLocalFiles(l,s);[...n,...c].every(f=>f.op==="noop")?this.debug("sync: noop"):(this.log("remote paths",l),this.log("operations",[...n,...c])),(a.length>0||i.length>0||c.length>0)&&this.fset.update(),s.length>0&&this.log(`syncFileTree diff:
`+s.join(`
`))}finally{this.syncFileTreePromise=null}};return this.syncFileTreePromise=new Ba(r),this.syncFileTreePromise.getPromise()}move(t){this.path=t,this.setLoggers(`[SharedFile](${this.path})`),this._settings.update(r=>({...r,path:t}))}read(t){let r=(0,fr.join)(this.path,t.path);return this.vault.adapter.read((0,je.normalizePath)(r))}existsSync(t){let r=(0,je.normalizePath)((0,fr.join)(this.path,t));return this.vault.getAbstractFileByPath(r)!==null}exists(t){let r=(0,fr.join)(this.path,t.path);return this.vault.adapter.exists((0,je.normalizePath)(r))}flush(t,r){let n=(0,fr.join)(this.path,t.path);return this.log("writing to ",(0,je.normalizePath)(n)),this.vault.adapter.write((0,je.normalizePath)(n),r)}getPath(t){return(0,fr.join)(this.path,t)}assertPath(t){if(!this.checkPath(t))throw new Error("Path is not in shared folder: "+t)}mkdir(t){let r=(0,fr.join)(this.path,t);return this.vault.adapter.mkdir((0,je.normalizePath)(r))}checkPath(t){return t.startsWith(this.path+fr.sep)}getVirtualPath(t){return this.assertPath(t),t.slice(this.path.length)}getTFile(t){let r=this.vault.getAbstractFileByPath(this.getPath(t.path));return r instanceof je.TFile?r:null}getDoc(t,r=!0){let n=this.syncStore.get(t);if(n!==void 0){let s=this.files.get(n);if(s!==void 0){if(s.move(t,this),!ar(s))throw new Error("unexpected ifile type");return s}else return this.log("[getDoc]: creating doc for shared ID"),this.createDoc(t,r)}else{this.warn("[getDoc]: creating new shared ID for existing tfile");let s=this.vault.getAbstractFileByPath(this.getPath(t));if(!(s instanceof je.TFile))throw new Error("unexpectedly missing tfile or got tfolder");return this.placeHold([s]).length>0?this.uploadDoc(t):this.createDoc(t,r)}}getCanvas(t,r=!0){let n=this.syncStore.get(t);if(n!==void 0){let s=this.files.get(n);if(s!==void 0){if(s.move(t,this),!cr(s))throw new Error("unexpected ifile type");return s}else return this.log("[getCanvas]: creating canvas for shared ID"),this.createCanvas(t,r)}else{this.warn("[getCanvas]: creating new shared ID for existing tfile");let s=this.vault.getAbstractFileByPath(this.getPath(t));if(!(s instanceof je.TFile))throw new Error("unexpectedly missing tfile or got tfolder");return this.placeHold([s]).length>0?this.uploadCanvas(t):this.createCanvas(t,r)}}async markUploaded(t){let r=(n,s)=>{this.syncStore&&this.syncStore.willSet(n.path,s)&&(this.log("new meta",n.path,s),this.ydoc.transact(()=>{this.syncStore.markUploaded(n.path,s)},this))};if(ar(t)){let n=Ii(t.guid);r(t,n);return}if(cr(t)){let n=$g(t.guid);r(t,n);return}if(jf(t)){let n=qa(t.guid);r(t,n);return}if(kr(t)){let n=this.syncStore.typeRegistry.getTypeForPath(t.path);if(!n)throw new Error("unexpected sync type");let s=await t.caf.hash();if(!s)throw new Error("file hash not yet computed");let i=Ng(n,t.guid,t.mimetype,s,t.stat.mtime);r(t,i);return}}getFile(t,r=!0){let n=this.getVirtualPath(t.path),s=this.syncStore.get(n);if(s){let i=this.files.get(s);if(i)return i}if(t instanceof je.TFolder)return this.getSyncFolder(n,r);if(t instanceof je.TFile){if(bt.checkExtension(n))return this.getDoc(n);if(lt.checkExtension(n))return this.getCanvas(n);if(this.syncStore.canSync(n))return this.getSyncFile(n,r)}return null}placeHold(t){let r=[];return this.ydoc.transact(()=>{t.forEach(n=>{let s=this.getVirtualPath(n.path);this.syncStore.has(s)||(this.log("place hold new",s),this.syncStore.new(s),r.push(s))})},this),r}getOrCreateCanvas(t,r){let n=this.files.get(t)||new lt(r,t,this.loginManager,this);if(!cr(n))throw new Error("unexpected ifile type");return n.move(r,this),n}async downloadCanvas(t,r=!0){if(!lt.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error(`called download on item that is not in ids ${t}`);let s=this.getOrCreateCanvas(n,t);return s.markOrigin("remote"),this.backgroundSync.enqueueCanvasDownload(s),this.files.set(n,s),this.fset.add(s,r),s}uploadCanvas(t,r=!0){if(!lt.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error("expected guid");let s=this.getOrCreateCanvas(n,t),i=s.getOrigin(),a=this.awaitingUpdates();return(async()=>{if(!await this.exists(s))throw new Error(`Upload failed, doc does not exist at ${t}`);let[c,f,u]=await Promise.all([this.read(s),i,a]);!u&&f===void 0&&(this.log(`[${s.path}] No Known Peers: Syncing file into ytext.`),this.ydoc.transact(()=>{try{s.applyJSON(c)}catch(d){throw console.warn(c),d}},this._persistence),s.markOrigin("local"),this.log(`[${s.path}] Uploading file`),await this.backgroundSync.enqueueSync(s),this.markUploaded(s))})(),this.files.set(n,s),this.fset.add(s,r),s}createCanvas(t,r){if(!lt.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error("expected guid");let s=this.getOrCreateCanvas(n,t);return(async()=>this.whenReady().then(async()=>{let i=await s.getServerSynced();s.stat.size===0&&!i?this.backgroundSync.enqueueCanvasDownload(s):this.pendingUpload.get(s.path)&&this.backgroundSync.enqueueSync(s)}))(),this.files.set(n,s),this.fset.add(s,r),s}viewDoc(t){let r=this.syncStore.get(t);if(!r)return;let n=this.files.get(r);if(!ar(n))throw new Error("unexpected ifile type");return n}viewSyncFile(t){let r=this.syncStore.get(t);if(!r)return;let n=this.files.get(r);if(!kr(n))throw new Error("unexpected ifile type");return n}getOrCreateDoc(t,r){let n=this.files.get(t)||new bt(r,t,this.loginManager,this);if(!ar(n))throw new Error("unexpected ifile type");return n.move(r,this),n}async downloadDoc(t,r=!0){if(!bt.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error(`called download on item that is not in ids ${t}`);let s=this.getOrCreateDoc(n,t);return s.markOrigin("remote"),this.backgroundSync.enqueueDownload(s),this.files.set(n,s),this.fset.add(s,r),s}uploadDoc(t,r=!0){if(!bt.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error("missing guid");let s=this.getOrCreateDoc(n,t),i=s.getOrigin(),a=this.awaitingUpdates();return(async()=>{if(!await this.exists(s))throw new Error(`Upload failed, doc does not exist at ${t}`);let[c,f,u]=await Promise.all([this.read(s),i,a]),d=s.ydoc.getText("contents");!u&&f===void 0&&(this.log(`[${s.path}] No Known Peers: Syncing file into ytext.`),this.ydoc.transact(()=>{d.insert(0,c)},this._persistence),s.markOrigin("local"),this.log(`[${s.path}] Uploading file`),await this.backgroundSync.enqueueSync(s),this.markUploaded(s))})(),this.files.set(n,s),this.fset.add(s,r),s}createDoc(t,r=!0){if(!bt.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error("expected guid");let s=this.getOrCreateDoc(n,t);return(async()=>this.whenReady().then(async()=>{var a;let i=await s.getServerSynced();((a=s.tfile)==null?void 0:a.stat.size)===0&&!i?this.backgroundSync.enqueueDownload(s):this.pendingUpload.get(s.path)&&this.backgroundSync.enqueueSync(s)}))(),this.files.set(n,s),this.fset.add(s,r),s}getOrCreateSyncFolder(t,r){let n=this.files.get(t)||new Jo(r,t,this);if(!jf(n))throw new Error("unexpected ifile type");return n.move(r,this),n}getSyncFolder(t,r){if(this.log("[getSyncFolder]","getting syncfolder"),!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error("expected guid");let s=this.getOrCreateSyncFolder(n,t);return this.files.set(n,s),this.fset.add(s,r),s}getOrCreateSyncFile(t,r,n){let s=this.files.get(t)||new Zo(r,t,this.hashStore,this);if(!kr(s))throw new Error("unexpected ifile type");return s.move(r,this),this.files.set(t,s),s}syncFile(t,r){if(!this.syncStore.canSync(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error(`called sync on item that is not in ids ${t}`);let s=this.syncStore.getMeta(t);if(!s||!s.hash)return this.uploadSyncFile(t,r);let i=this.getOrCreateSyncFile(n,t,s.hash);return this.backgroundSync.enqueueSync(i),this.files.set(n,i),this.fset.add(i,r),i}downloadSyncFile(t,r){if(!this.syncStore.canSync(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error(`called download on item that is not in ids ${t}`);let s=this.syncStore.getMeta(t);if(!s||!s.hash)return this.uploadSyncFile(t,r);let i=this.getOrCreateSyncFile(n,t,s.hash);return this.backgroundSync.enqueueDownload(i),this.files.set(n,i),this.fset.add(i,r),i}uploadSyncFile(t,r=!0){if(!this.syncStore.canSync(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error("missing guid");let s=this.vault.getAbstractFileByPath(this.getPath(t));if(!s)throw new Error(`Upload failed, file does not exist at ${t}`);if(!(s instanceof je.TFile))throw new Error(`Upload failed, expected file at ${t}`);let i=this.getOrCreateSyncFile(n,t,s);return this.backgroundSync.enqueueSync(i),this.fset.add(i,r),i}getSyncFile(t,r=!0){if(!this.syncStore.canSync(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error("missing guid");let s=this.vault.getAbstractFileByPath(this.getPath(t));if(!s)throw new Error(`Upload failed, file does not exist at ${t}`);if(!(s instanceof je.TFile))throw new Error(`Upload failed, expected file at ${t}`);let i=this.getOrCreateSyncFile(n,t,s);return this.syncStore.getMeta(t)?i.pull():(this.log("get syncfile missing meta"),i.push()),this.files.set(n,i),this.fset.add(i,r),i}uploadFile(t,r=!0){let n=this.getVirtualPath(t.path);if(t instanceof je.TFolder)return this.getSyncFolder(n,r);if(t instanceof je.TFile){if(bt.checkExtension(n))return this.uploadDoc(n,r);if(lt.checkExtension(n))return this.uploadCanvas(n,r);if(this.syncStore.canSync(n))return this.uploadSyncFile(n,r)}throw new Error("unexpectedly unable to upload")}deleteFile(t){let r=this.syncStore.get(t);r&&this.ydoc.transact(()=>{this.syncStore.delete(t);let n=this.files.get(r);n&&(n.cleanup(),this.fset.delete(n)),this.files.delete(r)},this)}renameFile(t,r){let n=t.path,s="",i="";try{s=this.getVirtualPath(n)}catch(a){this.log("Moving out of shared folder")}try{i=this.getVirtualPath(r)}catch(a){this.log("Moving in from outside of shared folder")}if(!(!s&&!i))if(i){let a=this.syncStore.get(i);if(!a)return;let l=this.files.get(a);if(!s)this.ydoc.transact(()=>{this.syncStore.delete(i)},this),l&&(l.cleanup(),l.destroy(),this.fset.delete(l)),this.files.delete(a);else{if(!this.syncStore.get(i))return;let f=[];l instanceof Jo&&this.syncStore.forEach((u,d)=>{if(d.startsWith(i+fr.sep)){let m=d.replace(i,s);f.push([u.id,d,m])}}),this.ydoc.transact(()=>{this.syncStore.move(i,s),l&&l.move(s,this),f.forEach(u=>{let[d,m,p]=u;this.syncStore.move(m,p);let y=this.files.get(d);y&&y.move(p,this)})},this),this.syncStore.resolveMove(i)}}else{if(this.assertPath(n),!this.syncStore.canSync(s))return;this.placeHold([t]),this.uploadFile(t)}}destroy(){var t,r,n;this.destroyed=!0,this.unsubscribes.forEach(s=>{s()}),this.files.forEach(s=>{s.destroy(),this.files.delete(s.guid)}),this.syncStore.destroy(),this.syncSettingsManager.destroy(),super.destroy(),this.ydoc.destroy(),this.fset.clear(),this._settings.destroy(),this._settings=null,this.diskBufferStore=null,this.relayManager=null,this.backgroundSync=null,this.loginManager=null,this.tokenStore=null,this.fileManager=null,this.syncStore=null,this.syncSettingsManager=null,(t=this.whenSyncedPromise)==null||t.destroy(),this.whenSyncedPromise=null,(r=this.readyPromise)==null||r.destroy(),this.readyPromise=null,(n=this.syncFileTreePromise)==null||n.destroy(),this.syncFileTreePromise=null}},Za=class extends Go{constructor(t,r,n,s){super();this.relayManager=t;this.vault=r;this.settings=s;this.update=(0,je.debounce)(this.notifyListeners,100);this.folderBuilder=n,this._offRemoteUpdates||(this._offRemoteUpdates=this.relayManager.remoteFolders.subscribe(i=>{let a=!1;this.items().forEach(l=>{let c=i.find(f=>f.guid==l.guid);l.remote!=c&&(a=!0),l.remote=c}),a&&this.update()}))}delete(t){t==null||t.destroy();let r=super.delete(t);return this.settings.update(n=>n.filter(s=>s.guid!==t.guid)),r}lookup(t){let r=this.find(n=>n.checkPath(t));return r||null}destroy(){this.items().forEach(t=>{t.destroy()}),this.clear(),this._offRemoteUpdates&&this._offRemoteUpdates(),this.unsubscribes.forEach(t=>{t()}),this.relayManager=null,this.folderBuilder=null}load(){this._load(this.settings.get())}_load(t){let r=!1;t.forEach(n=>{if(!this.vault.getFolderByPath(n.path)){this.warn(`Invalid settings, ${n.path} does not exist`);return}this._new(n.path,n.guid,n==null?void 0:n.relay),r=!0}),r&&this.notifyListeners()}_new(t,r,n,s){let i=this.find(f=>f.path==t&&f.guid==r);if(i)return i;let a=this.find(f=>f.guid==r);if(a)throw new Error(`This folder is already mounted at ${a.path}.`);if(this.find(f=>f.path==t))throw new Error("Conflict: Tracked folder exists at this location.");let c=this.folderBuilder(t,r,n,s);return this._set.add(c),c}new(t,r,n,s){let i=this._new(t,r,n,s);return this.notifyListeners(),i}};var kl=require("@codemirror/state"),Fs=require("obsidian");function q(){}var Mi=o=>o;function oe(o,e){for(let t in e)o[t]=e[t];return o}function ty(o){return!!o&&(typeof o=="object"||typeof o=="function")&&typeof o.then=="function"}function cu(o){return o()}function el(){return Object.create(null)}function we(o){o.forEach(cu)}function ze(o){return typeof o=="function"}function j(o,e){return o!=o?e==e:o!==e||o&&typeof o=="object"||typeof o=="function"}var Xa;function Xo(o,e){return o===e?!0:(Xa||(Xa=document.createElement("a")),Xa.href=e,o===Xa.href)}function ry(o){return Object.keys(o).length===0}function Dt(o,...e){if(o==null){for(let r of e)r(void 0);return q}let t=o.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function ce(o,e,t){o.$$.on_destroy.push(Dt(e,t))}function me(o,e,t,r){if(o){let n=oy(o,e,t,r);return o[0](n)}}function oy(o,e,t,r){return o[1]&&r?oe(t.ctx.slice(),o[1](r(e))):t.ctx}function he(o,e,t,r){if(o[2]&&r){let n=o[2](r(t));if(e.dirty===void 0)return n;if(typeof n=="object"){let s=[],i=Math.max(e.dirty.length,n.length);for(let a=0;a<i;a+=1)s[a]=e.dirty[a]|n[a];return s}return e.dirty|n}return e.dirty}function ge(o,e,t,r,n,s){if(n){let i=oy(e,t,r,s);o.p(i,n)}}function ye(o){if(o.ctx.length>32){let e=[],t=o.ctx.length/32;for(let r=0;r<t;r++)e[r]=-1;return e}return-1}function be(o){let e={};for(let t in o)t[0]!=="$"&&(e[t]=o[t]);return e}function fu(o,e){let t={};e=new Set(e);for(let r in o)!e.has(r)&&r[0]!=="$"&&(t[r]=o[r]);return t}function Wt(o){return o==null?"":o}function tl(o,e,t){return o.set(t),e}function rl(o){return o&&ze(o.destroy)?o.destroy:q}var ny=typeof window!="undefined",uu=ny?()=>window.performance.now():()=>Date.now(),Ei=ny?o=>requestAnimationFrame(o):q;var Cs=new Set;function sy(o){Cs.forEach(e=>{e.c(o)||(Cs.delete(e),e.f())}),Cs.size!==0&&Ei(sy)}function du(o){let e;return Cs.size===0&&Ei(sy),{promise:new Promise(t=>{Cs.add(e={c:o,f:t})}),abort(){Cs.delete(e)}}}var An=typeof window!="undefined"?window:typeof globalThis!="undefined"?globalThis:global;var Ls=class{constructor(e){ct(this,"_listeners","WeakMap"in An?new WeakMap:void 0);ct(this,"_observer");ct(this,"options");this.options=e}observe(e,t){return this._listeners.set(e,t),this._getObserver().observe(e,this.options),()=>{this._listeners.delete(e),this._observer.unobserve(e)}}_getObserver(){var e;return(e=this._observer)!=null?e:this._observer=new ResizeObserver(t=>{var r;for(let n of t)Ls.entries.set(n.target,n),(r=this._listeners.get(n.target))==null||r(n)})}};Ls.entries="WeakMap"in An?new WeakMap:void 0;var iy=!1;function ay(){iy=!0}function ly(){iy=!1}function b(o,e){o.appendChild(e)}function _e(o,e,t){let r=ol(o);if(!r.getElementById(e)){let n=S("style");n.id=e,n.textContent=t,fy(r,n)}}function ol(o){if(!o)return document;let e=o.getRootNode?o.getRootNode():o.ownerDocument;return e&&e.host?e:o.ownerDocument}function cy(o){let e=S("style");return e.textContent="/* empty */",fy(ol(o),e),e.sheet}function fy(o,e){return b(o.head||o,e),e.sheet}function _(o,e,t){o.insertBefore(e,t||null)}function w(o){o.parentNode&&o.parentNode.removeChild(o)}function Je(o,e){for(let t=0;t<o.length;t+=1)o[t]&&o[t].d(e)}function S(o){return document.createElement(o)}function $r(o){return document.createElementNS("http://www.w3.org/2000/svg",o)}function B(o){return document.createTextNode(o)}function M(){return B(" ")}function ve(){return B("")}function z(o,e,t,r){return o.addEventListener(e,t,r),()=>o.removeEventListener(e,t,r)}function nl(o){return function(e){return e.stopPropagation(),o.call(this,e)}}function h(o,e,t){t==null?o.removeAttribute(e):o.getAttribute(e)!==t&&o.setAttribute(e,t)}function Pi(o,e){for(let t in e)h(o,t,e[t])}function uy(o){return Array.from(o.childNodes)}function Y(o,e){e=""+e,o.data!==e&&(o.data=e)}function Ft(o,e){o.value=e==null?"":e}function ue(o,e,t,r){t==null?o.style.removeProperty(e):o.style.setProperty(e,t,r?"important":"")}function pu(o,e,t){for(let r=0;r<o.options.length;r+=1){let n=o.options[r];if(n.__value===e){n.selected=!0;return}}(!t||e!==void 0)&&(o.selectedIndex=-1)}function Me(o,e,t){o.classList.toggle(e,!!t)}function Di(o,e,{bubbles:t=!1,cancelable:r=!1}={}){return new CustomEvent(o,{detail:e,bubbles:t,cancelable:r})}var en=class{constructor(e=!1){ct(this,"is_svg",!1);ct(this,"e");ct(this,"n");ct(this,"t");ct(this,"a");this.is_svg=e,this.e=this.n=null}c(e){this.h(e)}m(e,t,r=null){this.e||(this.is_svg?this.e=$r(t.nodeName):this.e=S(t.nodeType===11?"TEMPLATE":t.nodeName),this.t=t.tagName!=="TEMPLATE"?t:t.content,this.c(e)),this.i(r)}h(e){this.e.innerHTML=e,this.n=Array.from(this.e.nodeName==="TEMPLATE"?this.e.content.childNodes:this.e.childNodes)}i(e){for(let t=0;t<this.n.length;t+=1)_(this.t,this.n[t],e)}p(e){this.d(),this.h(e),this.i(this.a)}d(){this.n.forEach(w)}};function dy(o){let e={};return o.childNodes.forEach(t=>{e[t.slot||"default"]=!0}),e}function Ts(o,e){return new o(e)}var sl=new Map,il=0;function MS(o){let e=5381,t=o.length;for(;t--;)e=(e<<5)-e^o.charCodeAt(t);return e>>>0}function ES(o,e){let t={stylesheet:cy(e),rules:{}};return sl.set(o,t),t}function al(o,e,t,r,n,s,i,a=0){let l=16.666/r,c=`{
`;for(let g=0;g<=1;g+=l){let v=e+(t-e)*s(g);c+=g*100+`%{${i(v,1-v)}}
`}let f=c+`100% {${i(t,1-t)}}
}`,u=`__svelte_${MS(f)}_${a}`,d=ol(o),{stylesheet:m,rules:p}=sl.get(d)||ES(d,o);p[u]||(p[u]=!0,m.insertRule(`@keyframes ${u} ${f}`,m.cssRules.length));let y=o.style.animation||"";return o.style.animation=`${y?`${y}, `:""}${u} ${r}ms linear ${n}ms 1 both`,il+=1,u}function mu(o,e){let t=(o.style.animation||"").split(", "),r=t.filter(e?s=>s.indexOf(e)<0:s=>s.indexOf("__svelte")===-1),n=t.length-r.length;n&&(o.style.animation=r.join(", "),il-=n,il||PS())}function PS(){Ei(()=>{il||(sl.forEach(o=>{let{ownerNode:e}=o.stylesheet;e&&w(e)}),sl.clear())})}var tn;function ur(o){tn=o}function Fi(){if(!tn)throw new Error("Function called outside component initialization");return tn}function Rt(o){Fi().$$.on_mount.push(o)}function hu(o){Fi().$$.on_destroy.push(o)}function pt(){let o=Fi();return(e,t,{cancelable:r=!1}={})=>{let n=o.$$.callbacks[e];if(n){let s=Di(e,t,{cancelable:r});return n.slice().forEach(i=>{i.call(o,s)}),!s.defaultPrevented}return!0}}function Ir(o,e){let t=o.$$.callbacks[e.type];t&&t.slice().forEach(r=>r.call(this,e))}var Mn=[];var er=[],Ms=[],yu=[],DS=Promise.resolve(),xu=!1;function py(){xu||(xu=!0,DS.then(Ri))}function eo(o){Ms.push(o)}function my(o){yu.push(o)}var gu=new Set,As=0;function Ri(){if(As!==0)return;let o=tn;do{try{for(;As<Mn.length;){let e=Mn[As];As++,ur(e),FS(e.$$)}}catch(e){throw Mn.length=0,As=0,e}for(ur(null),Mn.length=0,As=0;er.length;)er.pop()();for(let e=0;e<Ms.length;e+=1){let t=Ms[e];gu.has(t)||(gu.add(t),t())}Ms.length=0}while(Mn.length);for(;yu.length;)yu.pop()();xu=!1,gu.clear(),ur(o)}function FS(o){if(o.fragment!==null){o.update(),we(o.before_update);let e=o.dirty;o.dirty=[-1],o.fragment&&o.fragment.p(o.ctx,e),o.after_update.forEach(eo)}}function hy(o){let e=[],t=[];Ms.forEach(r=>o.indexOf(r)===-1?e.push(r):t.push(r)),t.forEach(r=>r()),Ms=e}var Ui;function RS(){return Ui||(Ui=Promise.resolve(),Ui.then(()=>{Ui=null})),Ui}function bu(o,e,t){o.dispatchEvent(Di(`${e?"intro":"outro"}${t}`))}var ll=new Set,Co;function ie(){Co={r:0,c:[],p:Co}}function ae(){Co.r||we(Co.c),Co=Co.p}function x(o,e){o&&o.i&&(ll.delete(o),o.i(e))}function k(o,e,t,r){if(o&&o.o){if(ll.has(o))return;ll.add(o),Co.c.push(()=>{ll.delete(o),r&&(t&&o.d(1),r())}),o.o(e)}else r&&r()}var US={duration:0};function En(o,e,t,r){let s=e(o,t,{direction:"both"}),i=r?0:1,a=null,l=null,c=null,f;function u(){c&&mu(o,c)}function d(p,y){let g=p.b-i;return y*=Math.abs(g),{a:i,b:p.b,d:g,duration:y,start:p.start,end:p.start+y,group:p.group}}function m(p){let{delay:y=0,duration:g=300,easing:v=Mi,tick:C=q,css:L}=s||US,T={start:uu()+y,b:p};p||(T.group=Co,Co.r+=1),"inert"in o&&(p?f!==void 0&&(o.inert=f):(f=o.inert,o.inert=!0)),a||l?l=T:(L&&(u(),c=al(o,i,p,g,y,v,L)),p&&C(0,1),a=d(T,g),eo(()=>bu(o,p,"start")),du(E=>{if(l&&E>l.start&&(a=d(l,g),l=null,bu(o,a.b,"start"),L&&(u(),c=al(o,i,a.b,a.duration,0,v,s.css))),a){if(E>=a.end)C(i=a.b,1-i),bu(o,a.b,"end"),l||(a.b?u():--a.group.r||we(a.group.c)),a=null;else if(E>=a.start){let O=E-a.start;i=a.a+a.d*v(O/a.duration),C(i,1-i)}}return!!(a||l)}))}return{run(p){ze(s)?RS().then(()=>{s=s({direction:p?"in":"out"}),m(p)}):m(p)},end(){u(),a=l=null}}}function Lo(o,e){let t=e.token={};function r(n,s,i,a){if(e.token!==t)return;e.resolved=a;let l=e.ctx;i!==void 0&&(l=l.slice(),l[i]=a);let c=n&&(e.current=n)(l),f=!1;e.block&&(e.blocks?e.blocks.forEach((u,d)=>{d!==s&&u&&(ie(),k(u,1,1,()=>{e.blocks[d]===u&&(e.blocks[d]=null)}),ae())}):e.block.d(1),c.c(),x(c,1),c.m(e.mount(),e.anchor),f=!0),e.block=c,e.blocks&&(e.blocks[s]=c),f&&Ri()}if(ty(o)){let n=Fi();if(o.then(s=>{ur(n),r(e.then,1,e.value,s),ur(null)},s=>{if(ur(n),r(e.catch,2,e.error,s),ur(null),!e.hasCatch)throw s}),e.current!==e.pending)return r(e.pending,0),!0}else{if(e.current!==e.then)return r(e.then,1,e.value,o),!0;e.resolved=o}}function Es(o,e,t){let r=e.slice(),{resolved:n}=o;o.current===o.then&&(r[o.value]=n),o.current===o.catch&&(r[o.error]=n),o.block.p(r,t)}function Se(o){return(o==null?void 0:o.length)!==void 0?o:Array.from(o)}function cl(o,e){o.d(1),e.delete(o.key)}function fl(o,e){k(o,1,1,()=>{e.delete(o.key)})}function Pn(o,e,t,r,n,s,i,a,l,c,f,u){let d=o.length,m=s.length,p=d,y={};for(;p--;)y[o[p].key]=p;let g=[],v=new Map,C=new Map,L=[];for(p=m;p--;){let I=u(n,s,p),A=t(I),U=i.get(A);U?r&&L.push(()=>U.p(I,e)):(U=c(A,I),U.c()),v.set(A,g[p]=U),A in y&&C.set(A,Math.abs(p-y[A]))}let T=new Set,E=new Set;function O(I){x(I,1),I.m(a,f),i.set(I.key,I),f=I.first,m--}for(;d&&m;){let I=g[m-1],A=o[d-1],U=I.key,W=A.key;I===A?(f=I.first,d--,m--):v.has(W)?!i.has(U)||T.has(U)?O(I):E.has(W)?d--:C.get(U)>C.get(W)?(E.add(U),O(I)):(T.add(W),d--):(l(A,i),d--)}for(;d--;){let I=o[d];v.has(I.key)||l(I,i)}for(;m;)O(g[m-1]);return we(L),g}function Te(o,e){let t={},r={},n={$$scope:1},s=o.length;for(;s--;){let i=o[s],a=e[s];if(a){for(let l in i)l in a||(r[l]=1);for(let l in a)n[l]||(t[l]=a[l],n[l]=1);o[s]=a}else for(let l in i)n[l]=1}for(let i in r)i in t||(t[i]=void 0);return t}function Fe(o){return typeof o=="object"&&o!==null?o:{}}var OS=["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],$S=new Set([...OS]);function gy(o,e,t){let r=o.$$.props[e];r!==void 0&&(o.$$.bound[r]=t,t(o.$$.ctx[r]))}function R(o){o&&o.c()}function D(o,e,t){let{fragment:r,after_update:n}=o.$$;r&&r.m(e,t),eo(()=>{let s=o.$$.on_mount.map(cu).filter(ze);o.$$.on_destroy?o.$$.on_destroy.push(...s):we(s),o.$$.on_mount=[]}),n.forEach(eo)}function F(o,e){let t=o.$$;t.fragment!==null&&(hy(t.after_update),we(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function BS(o,e){o.$$.dirty[0]===-1&&(Mn.push(o),py(),o.$$.dirty.fill(0)),o.$$.dirty[e/31|0]|=1<<e%31}function G(o,e,t,r,n,s,i=null,a=[-1]){let l=tn;ur(o);let c=o.$$={fragment:null,ctx:[],props:s,update:q,not_equal:n,bound:el(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:el(),dirty:a,skip_bound:!1,root:e.target||l.$$.root};i&&i(c.root);let f=!1;if(c.ctx=t?t(o,e.props||{},(u,d,...m)=>{let p=m.length?m[0]:d;return c.ctx&&n(c.ctx[u],c.ctx[u]=p)&&(!c.skip_bound&&c.bound[u]&&c.bound[u](p),f&&BS(o,u)),d}):[],c.update(),f=!0,we(c.before_update),c.fragment=r?r(c.ctx):!1,e.target){if(e.hydrate){ay();let u=uy(e.target);c.fragment&&c.fragment.l(u),u.forEach(w)}else c.fragment&&c.fragment.c();e.intro&&x(o.$$.fragment),D(o,e.target,e.anchor),ly(),Ri()}ur(l)}var VS;typeof HTMLElement=="function"&&(VS=class extends HTMLElement{constructor(e,t,r){super();ct(this,"$$ctor");ct(this,"$$s");ct(this,"$$c");ct(this,"$$cn",!1);ct(this,"$$d",{});ct(this,"$$r",!1);ct(this,"$$p_d",{});ct(this,"$$l",{});ct(this,"$$l_u",new Map);this.$$ctor=e,this.$$s=t,r&&this.attachShadow({mode:"open"})}addEventListener(e,t,r){if(this.$$l[e]=this.$$l[e]||[],this.$$l[e].push(t),this.$$c){let n=this.$$c.$on(e,t);this.$$l_u.set(t,n)}super.addEventListener(e,t,r)}removeEventListener(e,t,r){if(super.removeEventListener(e,t,r),this.$$c){let n=this.$$l_u.get(t);n&&(n(),this.$$l_u.delete(t))}}async connectedCallback(){if(this.$$cn=!0,!this.$$c){let e=function(s){return()=>{let i;return{c:function(){i=S("slot"),s!=="default"&&h(i,"name",s)},m:function(c,f){_(c,i,f)},d:function(c){c&&w(i)}}}};if(await Promise.resolve(),!this.$$cn||this.$$c)return;let t={},r=dy(this);for(let s of this.$$s)s in r&&(t[s]=[e(s)]);for(let s of this.attributes){let i=this.$$g_p(s.name);i in this.$$d||(this.$$d[i]=vu(i,s.value,this.$$p_d,"toProp"))}for(let s in this.$$p_d)!(s in this.$$d)&&this[s]!==void 0&&(this.$$d[s]=this[s],delete this[s]);this.$$c=new this.$$ctor({target:this.shadowRoot||this,props:{...this.$$d,$$slots:t,$$scope:{ctx:[]}}});let n=()=>{this.$$r=!0;for(let s in this.$$p_d)if(this.$$d[s]=this.$$c.$$.ctx[this.$$c.$$.props[s]],this.$$p_d[s].reflect){let i=vu(s,this.$$d[s],this.$$p_d,"toAttribute");i==null?this.removeAttribute(this.$$p_d[s].attribute||s):this.setAttribute(this.$$p_d[s].attribute||s,i)}this.$$r=!1};this.$$c.$$.after_update.push(n),n();for(let s in this.$$l)for(let i of this.$$l[s]){let a=this.$$c.$on(s,i);this.$$l_u.set(i,a)}this.$$l={}}}attributeChangedCallback(e,t,r){var n;this.$$r||(e=this.$$g_p(e),this.$$d[e]=vu(e,r,this.$$p_d,"toProp"),(n=this.$$c)==null||n.$set({[e]:this.$$d[e]}))}disconnectedCallback(){this.$$cn=!1,Promise.resolve().then(()=>{!this.$$cn&&this.$$c&&(this.$$c.$destroy(),this.$$c=void 0)})}$$g_p(e){return Object.keys(this.$$p_d).find(t=>this.$$p_d[t].attribute===e||!this.$$p_d[t].attribute&&t.toLowerCase()===e)||e}});function vu(o,e,t,r){var s;let n=(s=t[o])==null?void 0:s.type;if(e=n==="Boolean"&&typeof e!="boolean"?e!=null:e,!r||!t[o])return e;if(r==="toAttribute")switch(n){case"Object":case"Array":return e==null?null:JSON.stringify(e);case"Boolean":return e?"":null;case"Number":return e==null?null:e;default:return e}else switch(n){case"Object":case"Array":return e&&JSON.parse(e);case"Boolean":return e;case"Number":return e!=null?+e:e;default:return e}}var K=class{constructor(){ct(this,"$$");ct(this,"$$set")}$destroy(){F(this,1),this.$destroy=q}$on(e,t){if(!ze(t))return q;let r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(t),()=>{let n=r.indexOf(t);n!==-1&&r.splice(n,1)}}$set(e){this.$$set&&!ry(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}};var yy="4";typeof window!="undefined"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(yy);var HS={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"},wu=HS;function xy(o,e,t){let r=o.slice();return r[11]=e[t][0],r[12]=e[t][1],r}function _u(o){let e,t=[o[12]],r={};for(let n=0;n<t.length;n+=1)r=oe(r,t[n]);return{c(){e=$r(o[11]),Pi(e,r)},m(n,s){_(n,e,s)},p(n,s){Pi(e,r=Te(t,[s&32&&n[12]]))},d(n){n&&w(e)}}}function by(o){let e=o[11],t,r=o[11]&&_u(o);return{c(){r&&r.c(),t=ve()},m(n,s){r&&r.m(n,s),_(n,t,s)},p(n,s){n[11]?e?j(e,n[11])?(r.d(1),r=_u(n),e=n[11],r.c(),r.m(t.parentNode,t)):r.p(n,s):(r=_u(n),e=n[11],r.c(),r.m(t.parentNode,t)):e&&(r.d(1),r=null,e=n[11])},d(n){n&&w(t),r&&r.d(n)}}}function qS(o){let e,t,r,n,s,i=Se(o[5]),a=[];for(let d=0;d<i.length;d+=1)a[d]=by(xy(o,i,d));let l=o[10].default,c=me(l,o,o[9],null),f=[wu,o[7],{width:o[2]},{height:o[2]},{stroke:o[1]},{"stroke-width":r=o[4]?Number(o[3])*24/Number(o[2]):o[3]},{class:n=o[6]("lucide-icon","lucide",o[0]?`lucide-${o[0]}`:"",o[8].class)}],u={};for(let d=0;d<f.length;d+=1)u=oe(u,f[d]);return{c(){e=$r("svg");for(let d=0;d<a.length;d+=1)a[d].c();t=ve(),c&&c.c(),Pi(e,u)},m(d,m){_(d,e,m);for(let p=0;p<a.length;p+=1)a[p]&&a[p].m(e,null);b(e,t),c&&c.m(e,null),s=!0},p(d,[m]){if(m&32){i=Se(d[5]);let p;for(p=0;p<i.length;p+=1){let y=xy(d,i,p);a[p]?a[p].p(y,m):(a[p]=by(y),a[p].c(),a[p].m(e,t))}for(;p<a.length;p+=1)a[p].d(1);a.length=i.length}c&&c.p&&(!s||m&512)&&ge(c,l,d,d[9],s?he(l,d[9],m,null):ye(d[9]),null),Pi(e,u=Te(f,[wu,m&128&&d[7],(!s||m&4)&&{width:d[2]},(!s||m&4)&&{height:d[2]},(!s||m&2)&&{stroke:d[1]},(!s||m&28&&r!==(r=d[4]?Number(d[3])*24/Number(d[2]):d[3]))&&{"stroke-width":r},(!s||m&257&&n!==(n=d[6]("lucide-icon","lucide",d[0]?`lucide-${d[0]}`:"",d[8].class)))&&{class:n}]))},i(d){s||(x(c,d),s=!0)},o(d){k(c,d),s=!1},d(d){d&&w(e),Je(a,d),c&&c.d(d)}}}function zS(o,e,t){let r=["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode","mergeClasses"],n=fu(e,r),{$$slots:s={},$$scope:i}=e,{name:a=void 0}=e,{color:l="currentColor"}=e,{size:c=24}=e,{strokeWidth:f=2}=e,{absoluteStrokeWidth:u=!1}=e,{iconNode:d}=e,m=(...p)=>p.filter((y,g,v)=>Boolean(y)&&v.indexOf(y)===g).join(" ");return o.$$set=p=>{t(8,e=oe(oe({},e),be(p))),t(7,n=fu(e,r)),"name"in p&&t(0,a=p.name),"color"in p&&t(1,l=p.color),"size"in p&&t(2,c=p.size),"strokeWidth"in p&&t(3,f=p.strokeWidth),"absoluteStrokeWidth"in p&&t(4,u=p.absoluteStrokeWidth),"iconNode"in p&&t(5,d=p.iconNode),"$$scope"in p&&t(9,i=p.$$scope)},e=be(e),[a,l,c,f,u,d,m,n,e,i,s]}var Su=class extends K{constructor(e){super(),G(this,e,zS,qS,j,{name:0,color:1,size:2,strokeWidth:3,absoluteStrokeWidth:4,iconNode:5,mergeClasses:6})}get mergeClasses(){return this.$$.ctx[6]}},Re=Su;function WS(o){let e,t=o[2].default,r=me(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ge(r,t,n,n[3],e?he(t,n[3],s,null):ye(n[3]),null)},i(n){e||(x(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function jS(o){let e,t,r=[{name:"arrow-right-left"},o[1],{iconNode:o[0]}],n={$$slots:{default:[WS]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=oe(n,r[s]);return e=new Re({props:n}),{c(){R(e.$$.fragment)},m(s,i){D(e,s,i),t=!0},p(s,[i]){let a=i&3?Te(r,[r[0],i&2&&Fe(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(x(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){F(e,s)}}}function KS(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"m16 3 4 4-4 4"}],["path",{d:"M20 7H4"}],["path",{d:"m8 21-4-4 4-4"}],["path",{d:"M4 17h16"}]];return o.$$set=i=>{t(1,e=oe(oe({},e),be(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=be(e),[s,e,r,n]}var ku=class extends K{constructor(e){super(),G(this,e,KS,jS,j,{})}},Iu=ku;function GS(o){let e,t=o[2].default,r=me(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ge(r,t,n,n[3],e?he(t,n[3],s,null):ye(n[3]),null)},i(n){e||(x(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function JS(o){let e,t,r=[{name:"arrow-up-down"},o[1],{iconNode:o[0]}],n={$$slots:{default:[GS]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=oe(n,r[s]);return e=new Re({props:n}),{c(){R(e.$$.fragment)},m(s,i){D(e,s,i),t=!0},p(s,[i]){let a=i&3?Te(r,[r[0],i&2&&Fe(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(x(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){F(e,s)}}}function YS(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"m21 16-4 4-4-4"}],["path",{d:"M17 20V4"}],["path",{d:"m3 8 4-4 4 4"}],["path",{d:"M7 4v16"}]];return o.$$set=i=>{t(1,e=oe(oe({},e),be(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=be(e),[s,e,r,n]}var Cu=class extends K{constructor(e){super(),G(this,e,YS,JS,j,{})}},Lu=Cu;function QS(o){let e,t=o[2].default,r=me(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ge(r,t,n,n[3],e?he(t,n[3],s,null):ye(n[3]),null)},i(n){e||(x(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function ZS(o){let e,t,r=[{name:"check"},o[1],{iconNode:o[0]}],n={$$slots:{default:[QS]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=oe(n,r[s]);return e=new Re({props:n}),{c(){R(e.$$.fragment)},m(s,i){D(e,s,i),t=!0},p(s,[i]){let a=i&3?Te(r,[r[0],i&2&&Fe(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(x(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){F(e,s)}}}function XS(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M20 6 9 17l-5-5"}]];return o.$$set=i=>{t(1,e=oe(oe({},e),be(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=be(e),[s,e,r,n]}var Tu=class extends K{constructor(e){super(),G(this,e,XS,ZS,j,{})}},Au=Tu;function ek(o){let e,t=o[2].default,r=me(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ge(r,t,n,n[3],e?he(t,n[3],s,null):ye(n[3]),null)},i(n){e||(x(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function tk(o){let e,t,r=[{name:"chevron-left"},o[1],{iconNode:o[0]}],n={$$slots:{default:[ek]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=oe(n,r[s]);return e=new Re({props:n}),{c(){R(e.$$.fragment)},m(s,i){D(e,s,i),t=!0},p(s,[i]){let a=i&3?Te(r,[r[0],i&2&&Fe(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(x(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){F(e,s)}}}function rk(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"m15 18-6-6 6-6"}]];return o.$$set=i=>{t(1,e=oe(oe({},e),be(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=be(e),[s,e,r,n]}var Mu=class extends K{constructor(e){super(),G(this,e,rk,tk,j,{})}},Eu=Mu;function ok(o){let e,t=o[2].default,r=me(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ge(r,t,n,n[3],e?he(t,n[3],s,null):ye(n[3]),null)},i(n){e||(x(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function nk(o){let e,t,r=[{name:"chevron-right"},o[1],{iconNode:o[0]}],n={$$slots:{default:[ok]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=oe(n,r[s]);return e=new Re({props:n}),{c(){R(e.$$.fragment)},m(s,i){D(e,s,i),t=!0},p(s,[i]){let a=i&3?Te(r,[r[0],i&2&&Fe(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(x(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){F(e,s)}}}function sk(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"m9 18 6-6-6-6"}]];return o.$$set=i=>{t(1,e=oe(oe({},e),be(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=be(e),[s,e,r,n]}var Pu=class extends K{constructor(e){super(),G(this,e,sk,nk,j,{})}},Du=Pu;function ik(o){let e,t=o[2].default,r=me(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ge(r,t,n,n[3],e?he(t,n[3],s,null):ye(n[3]),null)},i(n){e||(x(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function ak(o){let e,t,r=[{name:"circle-check-big"},o[1],{iconNode:o[0]}],n={$$slots:{default:[ik]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=oe(n,r[s]);return e=new Re({props:n}),{c(){R(e.$$.fragment)},m(s,i){D(e,s,i),t=!0},p(s,[i]){let a=i&3?Te(r,[r[0],i&2&&Fe(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(x(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){F(e,s)}}}function lk(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}],["path",{d:"m9 11 3 3L22 4"}]];return o.$$set=i=>{t(1,e=oe(oe({},e),be(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=be(e),[s,e,r,n]}var Fu=class extends K{constructor(e){super(),G(this,e,lk,ak,j,{})}},Ru=Fu;function ck(o){let e,t=o[2].default,r=me(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ge(r,t,n,n[3],e?he(t,n[3],s,null):ye(n[3]),null)},i(n){e||(x(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function fk(o){let e,t,r=[{name:"circle-help"},o[1],{iconNode:o[0]}],n={$$slots:{default:[ck]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=oe(n,r[s]);return e=new Re({props:n}),{c(){R(e.$$.fragment)},m(s,i){D(e,s,i),t=!0},p(s,[i]){let a=i&3?Te(r,[r[0],i&2&&Fe(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(x(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){F(e,s)}}}function uk(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}],["path",{d:"M12 17h.01"}]];return o.$$set=i=>{t(1,e=oe(oe({},e),be(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=be(e),[s,e,r,n]}var Uu=class extends K{constructor(e){super(),G(this,e,uk,fk,j,{})}},Oi=Uu;function dk(o){let e,t=o[2].default,r=me(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ge(r,t,n,n[3],e?he(t,n[3],s,null):ye(n[3]),null)},i(n){e||(x(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function pk(o){let e,t,r=[{name:"clock"},o[1],{iconNode:o[0]}],n={$$slots:{default:[dk]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=oe(n,r[s]);return e=new Re({props:n}),{c(){R(e.$$.fragment)},m(s,i){D(e,s,i),t=!0},p(s,[i]){let a=i&3?Te(r,[r[0],i&2&&Fe(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(x(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){F(e,s)}}}function mk(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["circle",{cx:"12",cy:"12",r:"10"}],["polyline",{points:"12 6 12 12 16 14"}]];return o.$$set=i=>{t(1,e=oe(oe({},e),be(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=be(e),[s,e,r,n]}var Ou=class extends K{constructor(e){super(),G(this,e,mk,pk,j,{})}},$i=Ou;function hk(o){let e,t=o[2].default,r=me(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ge(r,t,n,n[3],e?he(t,n[3],s,null):ye(n[3]),null)},i(n){e||(x(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function gk(o){let e,t,r=[{name:"download"},o[1],{iconNode:o[0]}],n={$$slots:{default:[hk]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=oe(n,r[s]);return e=new Re({props:n}),{c(){R(e.$$.fragment)},m(s,i){D(e,s,i),t=!0},p(s,[i]){let a=i&3?Te(r,[r[0],i&2&&Fe(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(x(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){F(e,s)}}}function yk(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}],["polyline",{points:"7 10 12 15 17 10"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3"}]];return o.$$set=i=>{t(1,e=oe(oe({},e),be(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=be(e),[s,e,r,n]}var $u=class extends K{constructor(e){super(),G(this,e,yk,gk,j,{})}},Nu=$u;function xk(o){let e,t=o[2].default,r=me(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ge(r,t,n,n[3],e?he(t,n[3],s,null):ye(n[3]),null)},i(n){e||(x(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function bk(o){let e,t,r=[{name:"folder"},o[1],{iconNode:o[0]}],n={$$slots:{default:[xk]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=oe(n,r[s]);return e=new Re({props:n}),{c(){R(e.$$.fragment)},m(s,i){D(e,s,i),t=!0},p(s,[i]){let a=i&3?Te(r,[r[0],i&2&&Fe(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(x(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){F(e,s)}}}function vk(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"}]];return o.$$set=i=>{t(1,e=oe(oe({},e),be(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=be(e),[s,e,r,n]}var Bu=class extends K{constructor(e){super(),G(this,e,vk,bk,j,{})}},Vu=Bu;function wk(o){let e,t=o[2].default,r=me(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ge(r,t,n,n[3],e?he(t,n[3],s,null):ye(n[3]),null)},i(n){e||(x(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function _k(o){let e,t,r=[{name:"info"},o[1],{iconNode:o[0]}],n={$$slots:{default:[wk]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=oe(n,r[s]);return e=new Re({props:n}),{c(){R(e.$$.fragment)},m(s,i){D(e,s,i),t=!0},p(s,[i]){let a=i&3?Te(r,[r[0],i&2&&Fe(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(x(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){F(e,s)}}}function Sk(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M12 16v-4"}],["path",{d:"M12 8h.01"}]];return o.$$set=i=>{t(1,e=oe(oe({},e),be(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=be(e),[s,e,r,n]}var Hu=class extends K{constructor(e){super(),G(this,e,Sk,_k,j,{})}},qu=Hu;function kk(o){let e,t=o[2].default,r=me(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ge(r,t,n,n[3],e?he(t,n[3],s,null):ye(n[3]),null)},i(n){e||(x(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function Ik(o){let e,t,r=[{name:"layers"},o[1],{iconNode:o[0]}],n={$$slots:{default:[kk]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=oe(n,r[s]);return e=new Re({props:n}),{c(){R(e.$$.fragment)},m(s,i){D(e,s,i),t=!0},p(s,[i]){let a=i&3?Te(r,[r[0],i&2&&Fe(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(x(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){F(e,s)}}}function Ck(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65"}]];return o.$$set=i=>{t(1,e=oe(oe({},e),be(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=be(e),[s,e,r,n]}var zu=class extends K{constructor(e){super(),G(this,e,Ck,Ik,j,{})}},To=zu;function Lk(o){let e,t=o[2].default,r=me(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ge(r,t,n,n[3],e?he(t,n[3],s,null):ye(n[3]),null)},i(n){e||(x(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function Tk(o){let e,t,r=[{name:"lock"},o[1],{iconNode:o[0]}],n={$$slots:{default:[Lk]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=oe(n,r[s]);return e=new Re({props:n}),{c(){R(e.$$.fragment)},m(s,i){D(e,s,i),t=!0},p(s,[i]){let a=i&3?Te(r,[r[0],i&2&&Fe(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(x(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){F(e,s)}}}function Ak(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4"}]];return o.$$set=i=>{t(1,e=oe(oe({},e),be(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=be(e),[s,e,r,n]}var Wu=class extends K{constructor(e){super(),G(this,e,Ak,Tk,j,{})}},ju=Wu;function Mk(o){let e,t=o[2].default,r=me(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ge(r,t,n,n[3],e?he(t,n[3],s,null):ye(n[3]),null)},i(n){e||(x(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function Ek(o){let e,t,r=[{name:"message-square-heart"},o[1],{iconNode:o[0]}],n={$$slots:{default:[Mk]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=oe(n,r[s]);return e=new Re({props:n}),{c(){R(e.$$.fragment)},m(s,i){D(e,s,i),t=!0},p(s,[i]){let a=i&3?Te(r,[r[0],i&2&&Fe(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(x(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){F(e,s)}}}function Pk(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"}],["path",{d:"M14.8 7.5a1.84 1.84 0 0 0-2.6 0l-.2.3-.3-.3a1.84 1.84 0 1 0-2.4 2.8L12 13l2.7-2.7c.9-.9.8-2.1.1-2.8"}]];return o.$$set=i=>{t(1,e=oe(oe({},e),be(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=be(e),[s,e,r,n]}var Ku=class extends K{constructor(e){super(),G(this,e,Pk,Ek,j,{})}},Gu=Ku;function Dk(o){let e,t=o[2].default,r=me(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ge(r,t,n,n[3],e?he(t,n[3],s,null):ye(n[3]),null)},i(n){e||(x(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function Fk(o){let e,t,r=[{name:"pause"},o[1],{iconNode:o[0]}],n={$$slots:{default:[Dk]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=oe(n,r[s]);return e=new Re({props:n}),{c(){R(e.$$.fragment)},m(s,i){D(e,s,i),t=!0},p(s,[i]){let a=i&3?Te(r,[r[0],i&2&&Fe(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(x(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){F(e,s)}}}function Rk(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1"}]];return o.$$set=i=>{t(1,e=oe(oe({},e),be(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=be(e),[s,e,r,n]}var Ju=class extends K{constructor(e){super(),G(this,e,Rk,Fk,j,{})}},Yu=Ju;function Uk(o){let e,t=o[2].default,r=me(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ge(r,t,n,n[3],e?he(t,n[3],s,null):ye(n[3]),null)},i(n){e||(x(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function Ok(o){let e,t,r=[{name:"play"},o[1],{iconNode:o[0]}],n={$$slots:{default:[Uk]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=oe(n,r[s]);return e=new Re({props:n}),{c(){R(e.$$.fragment)},m(s,i){D(e,s,i),t=!0},p(s,[i]){let a=i&3?Te(r,[r[0],i&2&&Fe(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(x(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){F(e,s)}}}function $k(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["polygon",{points:"6 3 20 12 6 21 6 3"}]];return o.$$set=i=>{t(1,e=oe(oe({},e),be(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=be(e),[s,e,r,n]}var Qu=class extends K{constructor(e){super(),G(this,e,$k,Ok,j,{})}},Zu=Qu;function Nk(o){let e,t=o[2].default,r=me(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ge(r,t,n,n[3],e?he(t,n[3],s,null):ye(n[3]),null)},i(n){e||(x(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function Bk(o){let e,t,r=[{name:"refresh-cw"},o[1],{iconNode:o[0]}],n={$$slots:{default:[Nk]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=oe(n,r[s]);return e=new Re({props:n}),{c(){R(e.$$.fragment)},m(s,i){D(e,s,i),t=!0},p(s,[i]){let a=i&3?Te(r,[r[0],i&2&&Fe(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(x(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){F(e,s)}}}function Vk(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"}],["path",{d:"M21 3v5h-5"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"}],["path",{d:"M8 16H3v5"}]];return o.$$set=i=>{t(1,e=oe(oe({},e),be(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=be(e),[s,e,r,n]}var Xu=class extends K{constructor(e){super(),G(this,e,Vk,Bk,j,{})}},ed=Xu;function Hk(o){let e,t=o[2].default,r=me(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ge(r,t,n,n[3],e?he(t,n[3],s,null):ye(n[3]),null)},i(n){e||(x(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function qk(o){let e,t,r=[{name:"satellite"},o[1],{iconNode:o[0]}],n={$$slots:{default:[Hk]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=oe(n,r[s]);return e=new Re({props:n}),{c(){R(e.$$.fragment)},m(s,i){D(e,s,i),t=!0},p(s,[i]){let a=i&3?Te(r,[r[0],i&2&&Fe(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(x(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){F(e,s)}}}function zk(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M13 7 9 3 5 7l4 4"}],["path",{d:"m17 11 4 4-4 4-4-4"}],["path",{d:"m8 12 4 4 6-6-4-4Z"}],["path",{d:"m16 8 3-3"}],["path",{d:"M9 21a6 6 0 0 0-6-6"}]];return o.$$set=i=>{t(1,e=oe(oe({},e),be(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=be(e),[s,e,r,n]}var td=class extends K{constructor(e){super(),G(this,e,zk,qk,j,{})}},Dn=td;function Wk(o){let e,t=o[2].default,r=me(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ge(r,t,n,n[3],e?he(t,n[3],s,null):ye(n[3]),null)},i(n){e||(x(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function jk(o){let e,t,r=[{name:"settings"},o[1],{iconNode:o[0]}],n={$$slots:{default:[Wk]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=oe(n,r[s]);return e=new Re({props:n}),{c(){R(e.$$.fragment)},m(s,i){D(e,s,i),t=!0},p(s,[i]){let a=i&3?Te(r,[r[0],i&2&&Fe(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(x(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){F(e,s)}}}function Kk(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"}],["circle",{cx:"12",cy:"12",r:"3"}]];return o.$$set=i=>{t(1,e=oe(oe({},e),be(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=be(e),[s,e,r,n]}var rd=class extends K{constructor(e){super(),G(this,e,Kk,jk,j,{})}},od=rd;function Gk(o){let e,t=o[2].default,r=me(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ge(r,t,n,n[3],e?he(t,n[3],s,null):ye(n[3]),null)},i(n){e||(x(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function Jk(o){let e,t,r=[{name:"square-pen"},o[1],{iconNode:o[0]}],n={$$slots:{default:[Gk]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=oe(n,r[s]);return e=new Re({props:n}),{c(){R(e.$$.fragment)},m(s,i){D(e,s,i),t=!0},p(s,[i]){let a=i&3?Te(r,[r[0],i&2&&Fe(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(x(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){F(e,s)}}}function Yk(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z"}]];return o.$$set=i=>{t(1,e=oe(oe({},e),be(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=be(e),[s,e,r,n]}var nd=class extends K{constructor(e){super(),G(this,e,Yk,Jk,j,{})}},sd=nd;function Qk(o){let e,t=o[2].default,r=me(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ge(r,t,n,n[3],e?he(t,n[3],s,null):ye(n[3]),null)},i(n){e||(x(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function Zk(o){let e,t,r=[{name:"triangle-alert"},o[1],{iconNode:o[0]}],n={$$slots:{default:[Qk]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=oe(n,r[s]);return e=new Re({props:n}),{c(){R(e.$$.fragment)},m(s,i){D(e,s,i),t=!0},p(s,[i]){let a=i&3?Te(r,[r[0],i&2&&Fe(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(x(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){F(e,s)}}}function Xk(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3"}],["path",{d:"M12 9v4"}],["path",{d:"M12 17h.01"}]];return o.$$set=i=>{t(1,e=oe(oe({},e),be(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=be(e),[s,e,r,n]}var id=class extends K{constructor(e){super(),G(this,e,Xk,Zk,j,{})}},Ni=id;function eI(o){let e,t=o[2].default,r=me(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ge(r,t,n,n[3],e?he(t,n[3],s,null):ye(n[3]),null)},i(n){e||(x(r,n),e=!0)},o(n){k(r,n),e=!1},d(n){r&&r.d(n)}}}function tI(o){let e,t,r=[{name:"upload"},o[1],{iconNode:o[0]}],n={$$slots:{default:[eI]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=oe(n,r[s]);return e=new Re({props:n}),{c(){R(e.$$.fragment)},m(s,i){D(e,s,i),t=!0},p(s,[i]){let a=i&3?Te(r,[r[0],i&2&&Fe(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(x(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){F(e,s)}}}function rI(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}],["polyline",{points:"17 8 12 3 7 8"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15"}]];return o.$$set=i=>{t(1,e=oe(oe({},e),be(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=be(e),[s,e,r,n]}var ad=class extends K{constructor(e){super(),G(this,e,rI,tI,j,{})}},ld=ad;function oI(o){_e(o,"svelte-1gxdage","button.notebook.svelte-1gxdage{color:var(--color-base-30);background-color:transparent}button.notebook-synced.svelte-1gxdage{color:var(--color-accent)}button.system3-connected.svelte-1gxdage{color:var(--color-accent)}button.system3-disconnected.svelte-1gxdage{color:var(--color-base-40)}")}function nI(o){let e,t,r,n,s,i;return t=new To({props:{class:"svg-icon inline-icon"}}),{c(){var a;e=S("button"),R(t.$$.fragment),h(e,"class",r="clickable-icon view-action system3-view-action "+(o[0].tracking?"notebook-synced":"notebook")+" svelte-1gxdage"),h(e,"aria-label",n=o[0].tracking?"Tracking changes: local file and update log are in sync":"Not tracking changes: local file and update log are not in sync"),h(e,"tabindex","0"),h(e,"data-filename",s=(a=o[0].view.file)==null?void 0:a.name)},m(a,l){_(a,e,l),D(t,e,null),i=!0},p(a,l){var c;(!i||l&1&&r!==(r="clickable-icon view-action system3-view-action "+(a[0].tracking?"notebook-synced":"notebook")+" svelte-1gxdage"))&&h(e,"class",r),(!i||l&1&&n!==(n=a[0].tracking?"Tracking changes: local file and update log are in sync":"Not tracking changes: local file and update log are not in sync"))&&h(e,"aria-label",n),(!i||l&1&&s!==(s=(c=a[0].view.file)==null?void 0:c.name))&&h(e,"data-filename",s)},i(a){i||(x(t.$$.fragment,a),i=!0)},o(a){k(t.$$.fragment,a),i=!1},d(a){a&&w(e),F(t)}}}function sI(o){let e,t,r,n,s,i,a,l,c,f,u,d,m;return t=new To({props:{class:"svg-icon inline-icon"}}),l=new Dn({props:{class:"svg-icon inline-icon"}}),{c(){var p;e=S("button"),R(t.$$.fragment),i=M(),a=S("button"),R(l.$$.fragment),h(e,"class",r="clickable-icon view-action system3-view-action "+(o[0].tracking?"notebook-synced":"notebook")+" svelte-1gxdage"),h(e,"aria-label",n=o[0].tracking?"Tracking changes: local file and update log are in sync":"Not tracking changes: local file and update log are not in sync"),h(e,"tabindex","0"),h(e,"data-filename",s=(p=o[0].view.file)==null?void 0:p.name),h(a,"class",c="system3-"+o[1].status+" clickable-icon view-action system3-view-action svelte-1gxdage"),h(a,"aria-label",f=`${o[2].relay.name} (${o[1].status})`),h(a,"tabindex","0")},m(p,y){_(p,e,y),D(t,e,null),_(p,i,y),_(p,a,y),D(l,a,null),u=!0,d||(m=[z(a,"click",o[3]),z(a,"keypress",o[4])],d=!0)},p(p,y){var g;(!u||y&1&&r!==(r="clickable-icon view-action system3-view-action "+(p[0].tracking?"notebook-synced":"notebook")+" svelte-1gxdage"))&&h(e,"class",r),(!u||y&1&&n!==(n=p[0].tracking?"Tracking changes: local file and update log are in sync":"Not tracking changes: local file and update log are not in sync"))&&h(e,"aria-label",n),(!u||y&1&&s!==(s=(g=p[0].view.file)==null?void 0:g.name))&&h(e,"data-filename",s),(!u||y&2&&c!==(c="system3-"+p[1].status+" clickable-icon view-action system3-view-action svelte-1gxdage"))&&h(a,"class",c),(!u||y&6&&f!==(f=`${p[2].relay.name} (${p[1].status})`))&&h(a,"aria-label",f)},i(p){u||(x(t.$$.fragment,p),x(l.$$.fragment,p),u=!0)},o(p){k(t.$$.fragment,p),k(l.$$.fragment,p),u=!1},d(p){p&&(w(e),w(i),w(a)),F(t),F(l),d=!1,we(m)}}}function iI(o){let e,t,r,n,s=[sI,nI],i=[];function a(l,c){return l[2]?0:1}return e=a(o,-1),t=i[e]=s[e](o),{c(){t.c(),r=ve()},m(l,c){i[e].m(l,c),_(l,r,c),n=!0},p(l,[c]){let f=e;e=a(l,c),e===f?i[e].p(l,c):(ie(),k(i[f],1,1,()=>{i[f]=null}),ae(),t=i[e],t?t.p(l,c):(t=i[e]=s[e](l),t.c()),x(t,1),t.m(r.parentNode,r))},i(l){n||(x(t),n=!0)},o(l){k(t),n=!1},d(l){l&&w(r),i[e].d(l)}}}function aI(o,e,t){let{view:r}=e,{state:n}=e,{remote:s}=e,i={connected:"connected: click to go offline",connecting:"connecting...",disconnected:"disconnected: click to go online",unknown:"unknown status"},a=()=>{r.toggleConnection()},l=c=>{c.key==="Enter"&&a()};return o.$$set=c=>{"view"in c&&t(0,r=c.view),"state"in c&&t(1,n=c.state),"remote"in c&&t(2,s=c.remote)},[r,n,s,a,l]}var cd=class extends K{constructor(e){super(),G(this,e,aI,iI,j,{view:0,state:1,remote:2},oI)}},fd=cd;var Fn=class{constructor(e,t,r){this.view=e,this.text=t,this.onClick=r,this.display()}display(){if(!this.view)return!0;let e=this.view.containerEl,t=this.view.containerEl.querySelector(".view-content");if(!e)return;let r=e.querySelector(".system3-banner-box");r||(r=document.createElement("div"),r.classList.add("system3-banner-box"),e.insertBefore(r,t));let n=e.querySelector(".system3-banner");if(!n){n=document.createElement("div"),n.classList.add("system3-banner");let s=n.createSpan();s.setText(this.text),n.appendChild(s),r.appendChild(n);let i=async()=>{await this.onClick()&&this.destroy()};n.addEventListener("click",i)}return!0}destroy(){let e=this.view.containerEl;if(!e)return;let t=e.querySelector(".system3-banner-box");return t&&t.replaceChildren(),!0}};var ul=require("@codemirror/state"),vy=require("@codemirror/view");function Ao(o,e){let t=Object.keys(e).map(r=>lI(o,r,e[r]));return t.length===1?t[0]:function(){t.forEach(r=>r())}}function lI(o,e,t){let r=o[e],n=o.hasOwnProperty(e),s=n?r:function(){return Object.getPrototypeOf(o)[e].apply(this,arguments)},i=t(s);return r&&Object.setPrototypeOf(i,r),Object.setPrototypeOf(a,i),o[e]=a,l;function a(...c){return i===s&&o[e]===a&&l(),i.apply(this,c)}function l(){o[e]===a&&(n?o[e]=s:delete o[e]),i!==s&&(i=s,Object.setPrototypeOf(a,r||Function))}}var wy=zn(zf());var cI=25,FU=ul.Facet.define({combine(o){return o[o.length-1]}}),ud=ul.Annotation.define(),dd=class{constructor(e){this.initialSet=!1;this.destroyed=!1;this.keyFrameCounter=0;this.debug=(...e)=>{};this.log=(...e)=>{};this.warn=(...e)=>{};var n,s,i,a;if(this.unsubscribes=[],this.editor=e,this.connectionManager=this.editor.state.field(to),this.view=(n=this.connectionManager)==null?void 0:n.findView(e),!this.view||(this.log=ke(`[LiveCMPluginValue][${(s=this.view.view.file)==null?void 0:s.path}]`,"log"),this.warn=ke(`[LiveCMPluginValue][${(i=this.view.view.file)==null?void 0:i.path}]`,"warn"),this.debug=ke(`[LiveCMPluginValue][${(a=this.view.view.file)==null?void 0:a.path}]`,"debug"),this.debug("created"),!this.view.document))return;let t=!1,r=this;this.unsubscribes.push(Ao(this.view.view,{setViewData(l){return function(c,f){if(f)Nr(r.view)&&r.view.document.text===c&&(r.view.tracking=!0),r.resync();else if(t){let u=r.incrementalBufferChange(c);e.dispatch({changes:u})}return l.call(this,c,f)}},saveFrontmatter(l){return function(c){t=!0;let f=l.call(this,c);return t=!1,f}}})),this.unsubscribes.push(Ao(this.view.view.previewMode,{edit(l){return function(c){if(Nr(r.view)&&r.view.view.getMode()==="preview"){let f=r.incrementalBufferChange(c);e.dispatch({changes:f})}return l.call(this,c)}}})),this.view.document.connected?this.resync():this.view.document.onceConnected().then(()=>{this.resync()}),this._observer=async(l,c)=>{if(!Nr(this.view)){this.debug("Recived yjs event against a non-live view");return}if(this.destroyed){this.debug("Recived yjs event but editor was destroyed");return}if(c.origin!==this){let f=l.delta,u=[],d=0;for(let m=0;m<f.length;m++){let p=f[m];p.insert!=null?u.push({from:d,to:d,insert:p.insert}):p.delete!=null?(u.push({from:d,to:d+p.delete,insert:""}),d+=p.delete):p.retain!=null&&(d+=p.retain)}!this.view.tracking||Ve().enableEditorTweens&&this.keyFrameCounter>cI?(this.keyFrameCounter=0,u=await this.getKeyFrame(!0),this.debug("dispatch (full)")):(this.keyFrameCounter+=1,this.debug(`dispatch (incremental + ${this.keyFrameCounter})`)),Nr(this.view)&&(e.dispatch({changes:u,annotations:[ud.of(this.editor)]}),this.view.tracking=!0)}this.render()},this.observer=(l,c)=>{var f;try{(f=this._observer)==null||f.call(this,l,c)}catch(u){u instanceof RangeError&&Nr(this.view)&&(this.view.tracking=!1)}},this._ytext=this.view.document.ytext,this._ytext.observe(this.observer)}render(){var e;((e=this.view)==null?void 0:e.view.getMode())==="preview"&&(this.view.view.previewMode.renderer.set(this.editor.state.doc.toString()),this.view.view.onInternalDataChange())}incrementalBufferChange(e){let t=this.editor.state.doc.toString(),r=new wy.default,n=r.diff_main(t,e);r.diff_cleanupSemantic(n);let s=[],i=0;for(let[a,l]of n)switch(a){case 0:i+=l.length;break;case 1:s.push({from:i,to:i,insert:l}),i+=l.length;break;case-1:s.push({from:i,to:i+l.length,insert:""});break}return s}getBufferChange(e,t=!1){return t?this.incrementalBufferChange(e):[{from:0,to:this.editor.state.doc.length,insert:e}]}async resync(){if(Nr(this.view)&&!this.view.tracking&&!this.destroyed){await this.view.document.whenSynced();let e=await this.getKeyFrame();Nr(this.view)&&!this.view.tracking&&!this.destroyed&&this.editor.dispatch({changes:e,annotations:[ud.of(this.editor)]})}}async getKeyFrame(e=!1){return!Nr(this.view)||this.destroyed?[]:this.view.document.text===this.view.view.getViewData()?(this.view.tracking=!0,[]):(this.warn(`|${this.view.document.text}|
|${this.view.view.getViewData()}|`),this.warn("ytext and editor buffer need syncing"),!this.view.document.hasLocalDB()&&this.view.document.text===""?(this.warn("local db missing, not setting buffer"),[]):(this.view.tracking||this.view.checkStale(),Nr(this.view)&&!this.destroyed?[this.getBufferChange(this.view.document.text,e)]:[]))}update(e){var n,s,i,a;if(!e.docChanged||e.transactions.length>0&&e.transactions[0].annotation(ud)===this.editor)return;let t=e.view;this.view=(n=this.connectionManager)==null?void 0:n.findView(t);let r=(i=(s=this.view)==null?void 0:s.document)==null?void 0:i.ytext;r&&((a=r.doc)==null||a.transact(()=>{let l=0;e.changes.iterChanges((c,f,u,d,m)=>{let p=m.sliceString(0,m.length,`
`);c!==f&&r.delete(c+l,f-c),p.length>0&&r.insert(c+l,p),l+=p.length-(f-c)})},this))}destroy(){var e;this.destroyed=!0,this.observer&&((e=this._ytext)==null||e.unobserve(this.observer)),this.unsubscribes.forEach(t=>{t()}),this.unsubscribes.length=0,this.connectionManager=null,this.view=void 0,this._ytext=void 0,this.editor=null}},_y=vy.ViewPlugin.fromClass(dd);var dl=require("@codemirror/state"),tr=require("@codemirror/view");var Sy=tr.EditorView.baseTheme({".cm-ySelection":{},".cm-yLineSelection":{padding:0,margin:"0px 2px 0px 4px"},".cm-ySelectionCaret":{position:"relative",borderLeft:"1px solid black",borderRight:"1px solid black",marginLeft:"-1px",marginRight:"-1px",boxSizing:"border-box",display:"inline"},".cm-ySelectionCaretDot":{borderRadius:"50%",position:"absolute",width:".4em",height:".4em",top:"-.2em",left:"-.2em",backgroundColor:"inherit",transition:"transform .3s ease-in-out",boxSizing:"border-box"},".cm-ySelectionCaret:hover > .cm-ySelectionCaretDot":{transformOrigin:"bottom center",transform:"scale(0)"},".cm-ySelectionInfo":{position:"absolute",top:"-1.05em",left:"-1px",fontSize:".75em",fontFamily:"serif",fontStyle:"normal",fontWeight:"normal",lineHeight:"normal",userSelect:"none",color:"white",paddingLeft:"2px",paddingRight:"2px",zIndex:101,transition:"opacity .3s ease-in-out",backgroundColor:"inherit",opacity:0,transitionDelay:"0s",whiteSpace:"nowrap"},".cm-ySelectionCaret:hover > .cm-ySelectionInfo":{opacity:1,transitionDelay:"0s"}}),fI=dl.Annotation.define(),pd=class extends tr.WidgetType{constructor(t,r){super();this.color=t,this.name=r}toDOM(t){return ii("span",[Nt("class","cm-ySelectionCaret"),Nt("style",`background-color: ${this.color}; border-color: ${this.color}`)],[is("\u2060"),ii("div",[Nt("class","cm-ySelectionCaretDot")]),is("\u2060"),ii("div",[Nt("class","cm-ySelectionInfo")],[is(this.name)]),is("\u2060")])}eq(t){return t.color===this.color}compare(t){return t.color===this.color}updateDOM(){return!1}get estimatedHeight(){return-1}ignoreEvent(){return!0}},md=class{constructor(e){var r,n;this.editor=e,this.decorations=dl.RangeSet.of([]),this.connectionManager=this.editor.state.field(to);let t=(r=this.connectionManager)==null?void 0:r.findView(e);if(t&&t instanceof rn){this.view=t;let s=(n=this.view.document)==null?void 0:n._provider;this._listener=({added:i,updated:a,removed:l},c,f)=>{i.concat(a).concat(l).findIndex(d=>{var m;return d!==((m=this._awareness)==null?void 0:m.doc.clientID)})>=0&&e.dispatch({annotations:[fI.of([])]})},s&&(this._awareness=s.awareness,this._awareness.on("change",this._listener))}}destroy(){var e;this._listener&&((e=this._awareness)==null||e.off("change",this._listener),this._listener=void 0),this.connectionManager=null,this.view=null,this.editor=null}update(e){var c,f,u,d;let t=e.view;this.view=(c=this.connectionManager)==null?void 0:c.findView(t);let r=(u=(f=this.view)==null?void 0:f.document)==null?void 0:u.ytext;if(!(this.view&&r&&r.doc))return;let n=(d=this.view.document)==null?void 0:d._provider;if(!n)return;this._awareness=n.awareness;let s=this._awareness,i=r.doc,a=[],l=this._awareness.getLocalState();if(l!=null){let m=e.view.hasFocus&&e.view.dom.ownerDocument.hasFocus(),p=m?e.state.selection.main:null,y=l.cursor==null?null:yf(l.cursor.anchor),g=l.cursor==null?null:yf(l.cursor.head);if(p!=null){let v=xf(r,p.anchor),C=xf(r,p.head);(l.cursor==null||!vf(y,v)||!vf(g,C))&&s.setLocalStateField("cursor",{anchor:v,head:C})}else l.cursor!=null&&m&&s.setLocalStateField("cursor",null)}s.getStates().forEach((m,p)=>{if(p===s.doc.clientID)return;let y=m.cursor;if(y==null||y.anchor==null||y.head==null)return;let g=bf(y.anchor,i),v=bf(y.head,i);if(g==null||v==null||g.type!==r||v.type!==r)return;if(g.index>e.state.doc.length||v.index>e.state.doc.length){ke("[RemoteSelections]","warn")(`cursor positions (${g.index}, ${v.index}) out of range of document length: ${e.state.doc.length}`),this.decorations=tr.Decoration.none;return}let{color:C="#30bced",name:L="Anonymous"}=m.user||{},T=m.user&&m.user.colorLight||C+"33",E=Gn(g.index,v.index),O=Er(g.index,v.index),I=e.view.state.doc.lineAt(E),A=e.view.state.doc.lineAt(O);if(I.number===A.number)a.push({from:E,to:O,value:tr.Decoration.mark({attributes:{style:`background-color: ${T}`},class:"cm-ySelection"})});else{a.push({from:E,to:I.from+I.length,value:tr.Decoration.mark({attributes:{style:`background-color: ${T}`},class:"cm-ySelection"})}),a.push({from:A.from,to:O,value:tr.Decoration.mark({attributes:{style:`background-color: ${T}`},class:"cm-ySelection"})});for(let U=I.number+1;U<A.number;U++){let W=e.view.state.doc.line(U).from;a.push({from:W,to:W,value:tr.Decoration.line({attributes:{style:`background-color: ${T}`,class:"cm-yLineSelection"}})})}}a.push({from:v.index,to:v.index,value:tr.Decoration.widget({side:v.index-g.index>0?-1:1,block:!1,widget:new pd(C,L)})})}),this.decorations=tr.Decoration.set(a,!0)}},ky=tr.ViewPlugin.fromClass(md,{decorations:o=>o.decorations});var pl=require("@codemirror/state"),Mo=require("@codemirror/view"),Iy=require("@codemirror/view");var GU=pl.Annotation.define(),gd=class extends Iy.WidgetType{toDOM(){let e=document.createElement("span");return e.style.display="inline-flex",e.addClass("invalid-link"),e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-warning"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg>',e.title="This link points outside the shared folder and may not be accessible to other users.",e}},hd=pl.StateEffect.define(),yd=class{constructor(e){this.log=e=>{};var t;if(this.editor=e,this.connectionManager=this.editor.state.field(to),this.decorations=Mo.Decoration.none,this.decorationAnchors=[],this.metadata=new Map,this.cb=(r,n)=>{this.updateFromMetadata(n),this.editor.dispatch({effects:hd.of(null)})},!this.connectionManager){ke("[InvalidLinkPluginValue]","warn")("ConnectionManager not found in InvalidLinkPlugin");return}this.app=this.connectionManager.app,this.view=this.connectionManager.findView(e),this.view&&(this.log=ke(`[InvalidLinkPluginValue][${(t=this.view.view.file)==null?void 0:t.path}]`,"debug"),this.log("created"),this.view.document&&this.view.document.whenSynced().then(()=>{var r,n;if(this.connectionManager&&this.app&&((n=(r=this.view)==null?void 0:r.document)!=null&&n.tfile)){this.connectionManager.onMeta(this.view.document.tfile,this.cb);let s=this.app.metadataCache.getFileCache(this.view.document.tfile);s&&(this.updateFromMetadata(s),this.editor.dispatch({effects:hd.of(null)}))}else this.log("unable to subscribe to metadata updates")}))}findInternalLinks(e){let t=[];return e.state.facet(Mo.EditorView.decorations).forEach(n=>{(typeof n=="function"?n(e):n).between(0,e.state.doc.length,(i,a,l)=>{var u;(((u=l.spec)==null?void 0:u.class)||"").contains("cm-formatting-link-end")&&t.push({from:i,to:a})})}),t}updateFromMetadata(e){var r,n,s,i;if(this.connectionManager&&(this.view=this.connectionManager.findView(this.editor)),!this.view||!this.view.document||!this.app||!((n=(r=this.view)==null?void 0:r.document)!=null&&n.sharedFolder)||!((i=(s=this.view)==null?void 0:s.document)!=null&&i.tfile))return;let t=new Map;for(let a of(e==null?void 0:e.links)||[]){let l=this.app.metadataCache.getFirstLinkpathDest(a.link,this.view.document.path);l&&!this.view.document.sharedFolder.checkPath(l.path)&&t.set(a.position.start.offset,{from:a.position.start.offset,to:a.position.end.offset,link:a.link,original:a.original})}for(let a of(e==null?void 0:e.embeds)||[]){let l=this.app.metadataCache.getFirstLinkpathDest(a.link,this.view.document.path);l&&!this.view.document.sharedFolder.checkPath(l.path)&&t.set(a.position.start.offset,{from:a.position.start.offset,to:a.position.end.offset,link:a.link,original:a.original})}this.metadata=t}updateMetadataPositions(e){for(let[t,r]of this.metadata)try{this.metadata.set(t,{from:e.changes.mapPos(r.from),to:e.changes.mapPos(r.to),link:r.link,original:r.original})}catch(n){this.metadata.delete(t)}}updateFromEditor(e){var s,i,a,l;if(this.connectionManager&&(this.view=this.connectionManager.findView(this.editor)),!this.view||!this.view.document||!this.app||!((i=(s=this.view)==null?void 0:s.document)!=null&&i.sharedFolder)||!((l=(a=this.view)==null?void 0:a.document)!=null&&l.tfile))return;let t=[],r=new Map(this.metadata),n=this.findInternalLinks(this.editor);for(let c of n){let f=null;for(let[m,p]of r)if(c.from<=p.to&&c.to>=p.from){f=p,r.delete(m);break}if(!f)continue;let u=this.app.metadataCache.getFirstLinkpathDest(f.link,this.view.document.path);u&&!this.view.document.sharedFolder.checkPath(u.path)&&t.push(c.from)}t.filter(c=>c<=e.state.doc.length),this.decorationAnchors=t}updateDecorations(){this.decorationAnchors.sort();let e=this.decorationAnchors.map(t=>Mo.Decoration.widget({widget:new gd,side:1}).range(t));e.length>0?this.decorations=Mo.Decoration.set(e,!0):this.decorations=Mo.Decoration.none}update(e){let t=!1;return e.transactions.forEach(r=>{r.effects.some(n=>n.is(hd))&&(t=!0)}),(e.docChanged||e.viewportChanged||t)&&(t||this.updateMetadataPositions(e),this.updateFromEditor(e),this.updateDecorations()),this.decorations}destroy(){var e,t;this.connectionManager&&((t=(e=this.view)==null?void 0:e.document)!=null&&t.tfile)&&this.connectionManager.offMeta(this.view.document.tfile),this.connectionManager=null,this.view=void 0,this.metadata.clear(),this.metadata=null,this.editor=null}},Cy=Mo.ViewPlugin.fromClass(yd,{decorations:o=>o.decorations});function Eo(){}Eo.prototype={diff:function(e,t){var r,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=n.callback;typeof n=="function"&&(s=n,n={}),this.options=n;var i=this;function a(T){return s?(setTimeout(function(){s(void 0,T)},0),!0):T}e=this.castInput(e),t=this.castInput(t),e=this.removeEmpty(this.tokenize(e)),t=this.removeEmpty(this.tokenize(t));var l=t.length,c=e.length,f=1,u=l+c;n.maxEditLength&&(u=Math.min(u,n.maxEditLength));var d=(r=n.timeout)!==null&&r!==void 0?r:1/0,m=Date.now()+d,p=[{oldPos:-1,lastComponent:void 0}],y=this.extractCommon(p[0],t,e,0);if(p[0].oldPos+1>=c&&y+1>=l)return a([{value:this.join(t),count:t.length}]);var g=-1/0,v=1/0;function C(){for(var T=Math.max(g,-f);T<=Math.min(v,f);T+=2){var E=void 0,O=p[T-1],I=p[T+1];O&&(p[T-1]=void 0);var A=!1;if(I){var U=I.oldPos-T;A=I&&0<=U&&U<l}var W=O&&O.oldPos+1<c;if(!A&&!W){p[T]=void 0;continue}if(!W||A&&O.oldPos+1<I.oldPos?E=i.addToPath(I,!0,void 0,0):E=i.addToPath(O,void 0,!0,1),y=i.extractCommon(E,t,e,T),E.oldPos+1>=c&&y+1>=l)return a(uI(i,E.lastComponent,t,e,i.useLongestToken));p[T]=E,E.oldPos+1>=c&&(v=Math.min(v,T-1)),y+1>=l&&(g=Math.max(g,T+1))}f++}if(s)(function T(){setTimeout(function(){if(f>u||Date.now()>m)return s();C()||T()},0)})();else for(;f<=u&&Date.now()<=m;){var L=C();if(L)return L}},addToPath:function(e,t,r,n){var s=e.lastComponent;return s&&s.added===t&&s.removed===r?{oldPos:e.oldPos+n,lastComponent:{count:s.count+1,added:t,removed:r,previousComponent:s.previousComponent}}:{oldPos:e.oldPos+n,lastComponent:{count:1,added:t,removed:r,previousComponent:s}}},extractCommon:function(e,t,r,n){for(var s=t.length,i=r.length,a=e.oldPos,l=a-n,c=0;l+1<s&&a+1<i&&this.equals(t[l+1],r[a+1]);)l++,a++,c++;return c&&(e.lastComponent={count:c,previousComponent:e.lastComponent}),e.oldPos=a,l},equals:function(e,t){return this.options.comparator?this.options.comparator(e,t):e===t||this.options.ignoreCase&&e.toLowerCase()===t.toLowerCase()},removeEmpty:function(e){for(var t=[],r=0;r<e.length;r++)e[r]&&t.push(e[r]);return t},castInput:function(e){return e},tokenize:function(e){return e.split("")},join:function(e){return e.join("")}};function uI(o,e,t,r,n){for(var s=[],i;e;)s.push(e),i=e.previousComponent,delete e.previousComponent,e=i;s.reverse();for(var a=0,l=s.length,c=0,f=0;a<l;a++){var u=s[a];if(u.removed){if(u.value=o.join(r.slice(f,f+u.count)),f+=u.count,a&&s[a-1].added){var m=s[a-1];s[a-1]=s[a],s[a]=m}}else{if(!u.added&&n){var d=t.slice(c,c+u.count);d=d.map(function(y,g){var v=r[f+g];return v.length>y.length?v:y}),u.value=o.join(d)}else u.value=o.join(t.slice(c,c+u.count));c+=u.count,u.added||(f+=u.count)}}var p=s[l-1];return l>1&&typeof p.value=="string"&&(p.added||p.removed)&&o.equals("",p.value)&&(s[l-2].value+=p.value,s.pop()),s}var YU=new Eo;function dI(o,e){if(typeof o=="function")e.callback=o;else if(o)for(var t in o)o.hasOwnProperty(t)&&(e[t]=o[t]);return e}var Ly=/^[A-Za-z\xC0-\u02C6\u02C8-\u02D7\u02DE-\u02FF\u1E00-\u1EFF]+$/,Ty=/\S/,_d=new Eo;_d.equals=function(o,e){return this.options.ignoreCase&&(o=o.toLowerCase(),e=e.toLowerCase()),o===e||this.options.ignoreWhitespace&&!Ty.test(o)&&!Ty.test(e)};_d.tokenize=function(o){for(var e=o.split(/([^\S\r\n]+|[()[\]{}'"\r\n]|\b)/),t=0;t<e.length-1;t++)!e[t+1]&&e[t+2]&&Ly.test(e[t])&&Ly.test(e[t+2])&&(e[t]+=e[t+2],e.splice(t+1,2),t--);return e};function Ay(o,e,t){return t=dI(t,{ignoreWhitespace:!0}),_d.diff(o,e,t)}var Sd=new Eo;Sd.tokenize=function(o){this.options.stripTrailingCr&&(o=o.replace(/\r\n/g,`
`));var e=[],t=o.split(/(\n|\r\n)/);t[t.length-1]||t.pop();for(var r=0;r<t.length;r++){var n=t[r];r%2&&!this.options.newlineIsToken?e[e.length-1]+=n:(this.options.ignoreWhitespace&&(n=n.trim()),e.push(n))}return e};function pI(o,e,t){return Sd.diff(o,e,t)}var mI=new Eo;mI.tokenize=function(o){return o.split(/(\S.+?[.!?])(?=\s+|$)/)};var hI=new Eo;hI.tokenize=function(o){return o.split(/([{}:;,]|\s+)/)};function ml(o){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?ml=function(e){return typeof e}:ml=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ml(o)}function xd(o){return gI(o)||yI(o)||xI(o)||bI()}function gI(o){if(Array.isArray(o))return bd(o)}function yI(o){if(typeof Symbol!="undefined"&&Symbol.iterator in Object(o))return Array.from(o)}function xI(o,e){if(o){if(typeof o=="string")return bd(o,e);var t=Object.prototype.toString.call(o).slice(8,-1);if(t==="Object"&&o.constructor&&(t=o.constructor.name),t==="Map"||t==="Set")return Array.from(o);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return bd(o,e)}}function bd(o,e){(e==null||e>o.length)&&(e=o.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=o[t];return r}function bI(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var vI=Object.prototype.toString,Bi=new Eo;Bi.useLongestToken=!0;Bi.tokenize=Sd.tokenize;Bi.castInput=function(o){var e=this.options,t=e.undefinedReplacement,r=e.stringifyReplacer,n=r===void 0?function(s,i){return typeof i=="undefined"?t:i}:r;return typeof o=="string"?o:JSON.stringify(vd(o,null,null,n),n,"  ")};Bi.equals=function(o,e){return Eo.prototype.equals.call(Bi,o.replace(/,([\r\n])/g,"$1"),e.replace(/,([\r\n])/g,"$1"))};function vd(o,e,t,r,n){e=e||[],t=t||[],r&&(o=r(n,o));var s;for(s=0;s<e.length;s+=1)if(e[s]===o)return t[s];var i;if(vI.call(o)==="[object Array]"){for(e.push(o),i=new Array(o.length),t.push(i),s=0;s<o.length;s+=1)i[s]=vd(o[s],e,t,r,n);return e.pop(),t.pop(),i}if(o&&o.toJSON&&(o=o.toJSON()),ml(o)==="object"&&o!==null){e.push(o),i={},t.push(i);var a=[],l;for(l in o)o.hasOwnProperty(l)&&a.push(l);for(a.sort(),s=0;s<a.length;s+=1)l=a[s],i[l]=vd(o[l],e,t,r,l);e.pop(),t.pop()}else i=o;return i}var wd=new Eo;wd.tokenize=function(o){return o.slice()};wd.join=wd.removeEmpty=function(o){return o};function My(o,e,t,r,n,s,i){i||(i={}),typeof i.context=="undefined"&&(i.context=4);var a=pI(t,r,i);if(!a)return;a.push({value:"",lines:[]});function l(v){return v.map(function(C){return" "+C})}for(var c=[],f=0,u=0,d=[],m=1,p=1,y=function(C){var L=a[C],T=L.lines||L.value.replace(/\n$/,"").split(`
`);if(L.lines=T,L.added||L.removed){var E;if(!f){var O=a[C-1];f=m,u=p,O&&(d=i.context>0?l(O.lines.slice(-i.context)):[],f-=d.length,u-=d.length)}(E=d).push.apply(E,xd(T.map(function(V){return(L.added?"+":"-")+V}))),L.added?p+=T.length:m+=T.length}else{if(f)if(T.length<=i.context*2&&C<a.length-2){var I;(I=d).push.apply(I,xd(l(T)))}else{var A,U=Math.min(T.length,i.context);(A=d).push.apply(A,xd(l(T.slice(0,U))));var W={oldStart:f,oldLines:m-f+U,newStart:u,newLines:p-u+U,lines:d};if(C>=a.length-2&&T.length<=i.context){var J=/\n$/.test(t),H=/\n$/.test(r),P=T.length==0&&d.length>W.oldLines;!J&&P&&t.length>0&&d.splice(W.oldLines,0,"\\ No newline at end of file"),(!J&&!P||!H)&&d.push("\\ No newline at end of file")}c.push(W),f=0,u=0,d=[]}m+=T.length,p+=T.length}},g=0;g<a.length;g++)y(g);return{oldFileName:o,newFileName:e,oldHeader:n,newHeader:s,hunks:c}}var Ey=require("obsidian");var hl=class{constructor(e){this.file1Start=e.file1Start,this.file2Start=e.file2Start,this.file1Lines=e.file1Lines,this.file2Lines=e.file2Lines}};var gl=class{constructor(e){this.file1Name=e.file1Name,this.file2Name=e.file2Name,this.differences=e.differences}static fromParsedDiff(e){let t=[];return e.hunks.forEach(r=>{let n=0,s=0;for(let i=0;i<r.lines.length;i+=1){let a=r.lines[i];if(a.startsWith("+")||a.startsWith("-")){let l=i,c=l;for(;c<r.lines.length-1&&(r.lines[c+1].startsWith("+")||r.lines[c+1].startsWith("-"));)c+=1;let f=r.lines.slice(l,c+1).filter(d=>d.startsWith("-")).map(d=>d.slice(1)),u=r.lines.slice(l,c+1).filter(d=>d.startsWith("+")).map(d=>d.slice(1));t.push(new hl({file1Start:r.oldStart+l-s-1,file2Start:r.newStart+l-n-1,file1Lines:f,file2Lines:u})),n+=f.length,s+=u.length,i+=c-l}}}),new this({file1Name:e.oldFileName,file2Name:e.newFileName,differences:t})}};function kd(o){let e=o.fullText.split(`
`);return e.splice(o.position,0,o.newLine),e.join(`
`)}function Vi(o){let e=o.fullText.split(`
`);return o.newLine===""?e.splice(o.position,o.linesToReplace):e.splice(o.position,o.linesToReplace,o.newLine),e.join(`
`)}function Hi(o){let e=o.fullText.split(`
`);return e.splice(o.position,o.count),e.join(`
`)}function Ps(o){return o!==""?o:"\u200E"}var rr=class{constructor(e){this.text=e.text,this.onClick=e.onClick}build(e){e.createEl("a",{text:this.text,cls:"no-decoration text-xxs file-diff__action-line"}).onClickEvent(this.onClick)}};var ro=class{static build(e){e.createEl("span",{text:"|",cls:"text-xxs file-diff__action-line"})}};var yl=class{constructor(e,t){this.app=e;this.difference=t.difference,this.file1=t.file1,this.file2=t.file2,this.file1Content=t.file1Content,this.file2Content=t.file2Content,this.triggerRebuild=t.triggerRebuild}async modify(e,t){if(e instanceof bt){ks(e.ydoc,t,e);return}else if(e instanceof So){e.contents=t;return}await this.app.vault.modify(e,t)}build(e){let t=e.createDiv({cls:"flex flex-row gap-1 py-0-5"}),r=this.difference.file1Lines.length>0,n=this.difference.file2Lines.length>0;n&&r?(new rr({text:"Accept Top (Editor)",onClick:s=>this.acceptTopClick(s,this.difference)}).build(t),ro.build(t),new rr({text:"Accept Bottom (Local Disk)",onClick:s=>this.acceptBottomClick(s,this.difference)}).build(t),ro.build(t),new rr({text:"Accept All",onClick:s=>this.acceptAllClick(s,this.difference)}).build(t),ro.build(t),new rr({text:"Accept None",onClick:s=>this.acceptNoneClick(s,this.difference)}).build(t)):r?(new rr({text:"Keep in Editor",onClick:s=>this.insertFile1Difference(s,this.difference)}).build(t),ro.build(t),new rr({text:"Discard in Editor",onClick:s=>this.discardFile1Difference(s,this.difference)}).build(t)):n&&(new rr({text:"Accept from Local Disk",onClick:s=>this.insertFile2Difference(s,this.difference)}).build(t),ro.build(t),new rr({text:"Discard on Disk",onClick:s=>this.discardFile2Difference(s,this.difference)}).build(t))}async acceptTopClick(e,t){e.preventDefault();let r=t.file1Lines.join(`
`),n=Vi({fullText:this.file2Content,newLine:r,position:t.file2Start,linesToReplace:t.file2Lines.length});await this.modify(this.file2,n),this.triggerRebuild()}async acceptBottomClick(e,t){e.preventDefault();let r=t.file2Lines.join(`
`),n=Vi({fullText:this.file1Content,newLine:r,position:t.file1Start,linesToReplace:t.file1Lines.length});await this.modify(this.file1,n),this.triggerRebuild()}async acceptAllClick(e,t){e.preventDefault();let r=[...t.file1Lines,...t.file2Lines].join(`
`),n=Vi({fullText:this.file1Content,newLine:r,position:t.file1Start,linesToReplace:t.file1Lines.length});await this.modify(this.file1,n);let s=Vi({fullText:this.file2Content,newLine:r,position:t.file2Start,linesToReplace:t.file2Lines.length});await this.modify(this.file2,s),this.triggerRebuild()}async acceptNoneClick(e,t){e.preventDefault();let r=Hi({fullText:this.file1Content,position:t.file1Start,count:t.file1Lines.length});await this.modify(this.file1,r);let n=Hi({fullText:this.file2Content,position:t.file2Start,count:t.file2Lines.length});await this.modify(this.file2,n),this.triggerRebuild()}async insertFile1Difference(e,t){e.preventDefault();let r=t.file1Lines.join(`
`),n=kd({fullText:this.file2Content,newLine:r,position:t.file2Start});await this.modify(this.file2,n),this.triggerRebuild()}async insertFile2Difference(e,t){e.preventDefault();let r=t.file2Lines.join(`
`),n=kd({fullText:this.file1Content,newLine:r,position:t.file1Start});await this.modify(this.file1,n),this.triggerRebuild()}async discardFile1Difference(e,t){e.preventDefault();let r=Hi({fullText:this.file1Content,position:t.file1Start,count:t.file1Lines.length});await this.modify(this.file1,r),this.triggerRebuild()}async discardFile2Difference(e,t){e.preventDefault();let r=Hi({fullText:this.file2Content,position:t.file2Start,count:t.file2Lines.length});await this.modify(this.file2,r),this.triggerRebuild()}};var Ds="system3-differences-view";async function Py(o,e){o.detachLeavesOfType(Ds);let t=o.getLeaf(!0);t.setViewState({type:Ds,active:!0,state:e}),o.revealLeaf(t)}var xl=class extends Ey.ItemView{constructor(t){super(t);this.file1Lines=[];this.file2Lines=[];let r=this.constructor.name;this.log=ke(`[${r}]`,"log")}async getContent(t){return t instanceof bt?t.text:t instanceof So?t.contents:await this.app.vault.read(t)}getViewType(){return Ds}getDisplayText(){var t,r;return(t=this.state)!=null&&t.file1&&((r=this.state)!=null&&r.file2)?`File Diff: ${this.state.file1.name} and ${this.state.file2.name}`:"File Diff"}async setState(t,r){super.setState(t,r),this.state=t,await this.updateState(),this.build()}async onunload(){var t,r;(r=(t=this.state)==null?void 0:t.onResolve)==null||r.call(t)}async updateState(){var r,n;if(((r=this.state)==null?void 0:r.file1)==null||((n=this.state)==null?void 0:n.file2)==null)return;this.file1Content=await this.getContent(this.state.file1),this.file2Content=await this.getContent(this.state.file2),this.file1Lines=this.file1Content.concat(`
`).split(`
`).map(s=>s.trimEnd()),this.file2Lines=this.file2Content.concat(`
`).split(`
`).map(s=>s.trimEnd());let t=My(this.state.file1.path,this.state.file2.path,this.file1Lines.join(`
`),this.file2Lines.join(`
`));if(this.fileDifferences=gl.fromParsedDiff(t),this.fileDifferences.differences.length===0){if(this.file1Content!==this.file2Content){if(this.log("byte level difference with differ equivalence",this.file1Content.length,this.file2Content.length),Ve().enableDeltaLogging){let s=this.file1Content||"",i=this.file2Content||"",a=Math.max(s.length,i.length);for(let l=0;l<a;l++){let c=l<s.length?s.charCodeAt(l):void 0,f=l<i.length?i.charCodeAt(l):void 0;if(c!==f){let u=c!==void 0?`0x${c.toString(16).padStart(2,"0")}`:"EOF",d=f!==void 0?`0x${f.toString(16).padStart(2,"0")}`:"EOF";this.log(`Byte difference at position ${l}: file1=${c} (${u}), file2=${f} (${d})`)}}}await this.modify(this.state.file2,this.file1Content||"")}this.leaf.detach()}}build(){this.contentEl.empty();let t=this.contentEl.createDiv({cls:"file-diff__container"});this.buildHeader(t),this.buildLines(t),this.scrollToFirstDifference()}update(){let t=this.contentEl.scrollTop;this.contentEl.empty();let r=this.contentEl.createDiv({cls:"file-diff__container"});this.buildHeader(r),this.buildLines(r),this.contentEl.scrollTop=t}buildHeader(t){let r=t.createDiv({cls:"flex flex-row gap-1 py-0-5"});new rr({text:"Keep Editor Contents",onClick:async n=>{n.preventDefault(),await this.acceptAllFromLeft()}}).build(r),ro.build(r),new rr({text:"Accept All from Local Disk",onClick:async n=>{n.preventDefault(),await this.acceptAllFromRight()}}).build(r)}async modify(t,r){if(t instanceof bt){ks(t.ydoc,r,t);return}else if(t instanceof So){t.contents=r;return}await this.app.vault.modify(t,r)}async acceptAllFromLeft(){!this.state||!this.fileDifferences||(await this.modify(this.state.file2,this.file1Content||""),this.leaf.detach())}async acceptAllFromRight(){!this.state||!this.fileDifferences||(await this.modify(this.state.file1,this.file2Content||""),this.leaf.detach())}buildLines(t){var i,a,l;let r=0,n=0,s=Math.max(((i=this.file1Lines)==null?void 0:i.length)||0,((a=this.file2Lines)==null?void 0:a.length)||0);for(;r<=s||n<=s;){let c=(l=this.fileDifferences)==null?void 0:l.differences.find(f=>f.file1Start===r&&f.file2Start===n);if(c!=null){let f=t.createDiv({cls:"difference"});this.buildDifferenceVisualizer(f,c),r+=c.file1Lines.length,n+=c.file2Lines.length}else{let f=r<=n?this.file1Lines[r]:this.file2Lines[n];t.createDiv({text:Ps(f),cls:"file-diff__line"}),r+=1,n+=1}}}buildDifferenceVisualizer(t,r){var n;(n=this.state)!=null&&n.showMergeOption&&new yl(this.app,{difference:r,file1:this.state.file1,file2:this.state.file2,file1Content:this.file1Content||"",file2Content:this.file2Content||"",triggerRebuild:async()=>{await this.updateState(),this.update()}}).build(t);for(let s=0;s<r.file1Lines.length;s+=1){let i=r.file1Lines[s],a=r.file2Lines[s],l=t.createDiv({cls:"file-diff__line file-diff__top-line__bg"}),c=this.buildDiffLine(i,a,"file-diff_top-line__character");(s<r.file1Lines.length-1||r.file2Lines.length!==0)&&l.classList.add("file-diff__no-bottom-border"),s!==0&&l.classList.add("file-diff__no-top-border"),l.appendChild(c)}for(let s=0;s<r.file2Lines.length;s+=1){let i=r.file1Lines[s],a=r.file2Lines[s],l=t.createDiv({cls:"file-diff__line file-diff__bottom-line__bg"}),c=this.buildDiffLine(a,i,"file-diff_bottom-line__character");(s==0&&r.file1Lines.length>0||s>0)&&l.classList.add("file-diff__no-top-border"),s<r.file2Lines.length-1&&l.classList.add("file-diff__no-bottom-border"),l.appendChild(c)}}buildDiffLine(t,r,n){let s=document.createElement("div");if(t!=null&&t.length===0)s.textContent=Ps(t);else if(t!=null&&r!=null){let i=Ay(r,t);for(let a of i){if(a.removed)continue;let l=document.createElement("span");l.textContent=Ps(a.value),a.added&&l.classList.add(n),s.appendChild(l)}}else if(t!=null&&r==null){let i=document.createElement("span");i.textContent=Ps(t),i.classList.add(n),s.appendChild(i)}else s.textContent=Ps(t);return s}scrollToFirstDifference(){var n;if(((n=this.fileDifferences)==null?void 0:n.differences.length)===0)return;let t=this.contentEl.getElementsByClassName("file-diff__container")[0].getBoundingClientRect(),r=this.contentEl.getElementsByClassName("difference")[0].getBoundingClientRect();this.contentEl.scrollTo({top:r.top-t.top-100,behavior:"smooth"})}};var bl=class extends yt{constructor(t){super();this.view=t.view,this.canvas=t.view.canvas,this.relayCanvas=t.canvas,this.unsubscribes=[],this.relayCanvasView=t,this.observedTextNodes=new Set,this.install()}destroy(){this.canvas&&(this.unsubscribes.forEach(t=>t()),this.unsubscribes=[]),this.relayCanvasView.tracking=!1,this.canvas=null,this.relayCanvas=null,this.relayCanvasView=null,this.unsubscribes.length=0}observeNode(t){if(!this.observedTextNodes.has(t.id)&&t.type==="text"){let r=this.relayCanvas.textNode(t),n=t.id,s=i=>{let a=this.canvas.nodes.get(n);a&&(a.setText(r.toString()),this.canvas.markDirty(a))};r.observe(s),this.unsubscribes.push(()=>{this.relayCanvas.textNode(t).unobserve(s),this.observedTextNodes.delete(n)})}}markDirty(t){let r=this.canvas.nodes.get(t.id);r&&this.canvas.markDirty(r)}install(){var c;if(!this.canvas)return;this.debug("connecting canvas view to canvas",(c=this.view.file)==null?void 0:c.path,this.relayCanvas.path);let t=this,r=lt.exportCanvasData(this.relayCanvas.ydoc),n=r.nodes.length>0||r.edges.length>0;this.relayCanvas.hasLocalDB()&&n&&this.canvas.importData(r,!0),this.unsubscribes.push(Ao(this.canvas,{requestSave(f){return function(){let u=f.call(this);try{t.relayCanvas.importFromView(t.view)}catch(d){t.log(d)}return u}},applyHistory(f){return function(u){let d=f.call(this,u);try{t.relayCanvas.importFromView(t.view)}catch(m){t.log(m)}return d}}}));let i=(f,u)=>{var p,y,g,v;let d="";if(d+=`Transaction origin: ${f.transaction.origin} ${(y=(p=f.transaction.origin)==null?void 0:p.constructor)==null?void 0:y.name}
`,this.relayCanvas||this.log("relay canvas is already destroyed"),!this.canvas){this.log("canvas is already destroyed");return}if(!((g=this.view.file)!=null&&g.path.endsWith(this.relayCanvas.path))){this.log("event is for another node");return}if(f.transaction.origin===this.relayCanvas)return;let m=lt.exportCanvasData(this.relayCanvas.ydoc);for(let[C,L]of f.changes.keys)d+=`key: ${C} action: ${L.action}

`;this.debug(d),this.debug("importing data",(v=this.view.file)==null?void 0:v.path,this.relayCanvas.path,m),this.canvas.importData(m,!0),this.canvas.requestSave();for(let C of f.keysChanged){let L=u.get(C);L&&(this.canvas.nodes.has(L.id)&&this.observeNode(L.getData()),this.canvas.markMoved(L),this.canvas.markDirty(L))}},a=f=>i(f,this.canvas.nodes);this.relayCanvas.ynodes.observe(a),this.unsubscribes.push(()=>{this.relayCanvas.ynodes.unobserve(a)});for(let[,f]of this.relayCanvas.ynodes)this.observeNode(f);let l=f=>i(f,this.canvas.edges);this.relayCanvas.yedges.observe(l),this.unsubscribes.push(()=>{this.relayCanvas.yedges.unobserve(l)}),this.relayCanvasView.tracking=!0}};var vl=require("@codemirror/state"),Fy=require("@codemirror/view");var RO=vl.Facet.define({combine(o){return o[o.length-1]}}),Dy=vl.Annotation.define(),Id=class{constructor(e){this.initialSet=!1;this.destroyed=!1;this.keyFrameCounter=0;this.debug=(...e)=>{};this.log=(...e)=>{};this.warn=(...e)=>{};this.embed=!1;var t,r,n,s;this.editor=e,this.connectionManager=this.editor.state.field(to),this.view=(t=this.connectionManager)==null?void 0:t.findCanvas(this.editor),this.node=this.getNode(),this._ytext=this.getYText(),this._ytext&&this.view&&(this.log=ke(`[LiveNodePluginValue][${this.view.canvas.path}#${(r=this.node)==null?void 0:r.id}]`,"log"),this.warn=ke(`[LiveNodePluginValue][${this.view.canvas.path}#${(n=this.node)==null?void 0:n.id}]`,"warn"),this.debug=ke(`[LiveNodePluginValue][${this.view.canvas.path}#${(s=this.node)==null?void 0:s.id}]`,"debug"),this.debug("created"),this._observer=async(i,a)=>{var l;if(this._ytext=this.getYText(),this.destroyed){this.debug("Recived yjs event but editor was destroyed");return}if(a.origin!==this){let c=i.delta,f=[],u=0;for(let d=0;d<c.length;d++){let m=c[d];m.insert!=null?f.push({from:u,to:u,insert:m.insert}):m.delete!=null?(f.push({from:u,to:u+m.delete,insert:""}),u+=m.delete):m.retain!=null&&(u+=m.retain)}(l=this.view)!=null&&l.canvas&&e.dispatch({changes:f,annotations:[Dy.of(this.editor)]})}},this.observer=(i,a)=>{var l;try{(l=this._observer)==null||l.call(this,i,a)}catch(c){c instanceof RangeError&&console.warn("range errors!")}},this._ytext.observe(this.observer))}getNode(){let e=this.editor.state.values.find(t=>{if(t&&t.node)return t.node});if(e)return this.node=e.node,this.node}getYText(){var t,r,n,s,i;this.view=(t=this.connectionManager)==null?void 0:t.findCanvas(this.editor);let e=this.editor.state.values.find(a=>{if(a&&a.node)return a.node});if(!e){this.observer&&((r=this._ytext)==null||r.unobserve(this.observer));return}return e.node.id!==((n=this.node)==null?void 0:n.id)&&this.observer&&((s=this._ytext)==null||s.unobserve(this.observer)),this.node=e.node,(i=this.view)==null?void 0:i.canvas.textNode(e.node)}update(e){var r;if(!e.docChanged||e.transactions.length>0&&e.transactions[0].annotation(Dy)===this.editor)return;let t=this.getYText();t&&((r=t.doc)==null||r.transact(()=>{let n=0;e.changes.iterChanges((s,i,a,l,c)=>{let f=c.sliceString(0,c.length,`
`);s!==i&&t.delete(s+n,i-s),f.length>0&&t.insert(s+n,f),n+=f.length-(i-s)})},this))}destroy(){var e;this.destroyed=!0,this.observer&&((e=this._ytext)==null||e.unobserve(this.observer)),this.connectionManager=null,this.view=void 0,this._ytext=void 0,this.editor=null}},Ry=Fy.ViewPlugin.fromClass(Id);var _I=3;function Cd(o,e){o.iterateAllLeaves(t=>{t.view instanceof Fs.MarkdownView&&e(t.view)})}function Ld(o,e){o.iterateAllLeaves(t=>{t.view.getViewType()==="canvas"&&Ve().enableCanvasSync&&e(t.view)})}function SI(o,e){var t,r,n,s;if(o.length!==e.length)return!1;for(let i=0;i<o.length;i++)if(((t=o[i].view.file)==null?void 0:t.path)!==((r=e[i].view.file)==null?void 0:r.path)||((n=o[i].document)==null?void 0:n.path)!==((s=e[i].document)==null?void 0:s.path))return!1;return!0}var wl=class{constructor(e,t,r){this.document=null;this.canConnect=!1;this._parent=e,this.view=t,this.login=r}attach(){return this.banner=new Fn(this.view,"Login to enable Live edits",async()=>await this.login()),Promise.resolve(this)}release(){var e;(e=this.banner)==null||e.destroy()}destroy(){this.release(),this.banner=void 0,this.view=null}};function Nr(o){return o instanceof rn&&o.document!==void 0&&o.document.text!==void 0}function kI(o){return o instanceof _l&&o.document!==void 0}var _l=class{constructor(e,t,r,n=!0,s=!0){this._parent=e,this.view=t,this.canvas=r,this.document=r,this.tracking=!1,this.shouldConnect=n,this.canConnect=s,e.networkStatus.online||this.offlineBanner()}toggleConnection(){this.shouldConnect=!this.shouldConnect,this.shouldConnect?this.canvas.connect().then(e=>{e||(this.shouldConnect=!1)}):this.canvas.disconnect()}offlineBanner(){if(this.shouldConnect){let e=new Fn(this.view,"You're offline -- click to reconnect",async()=>(this._parent.networkStatus.checkStatus(),this.connect(),this._parent.networkStatus.online));this._parent.networkStatus.onceOnline(()=>{this.connect(),e.destroy()})}return()=>{}}setConnectionDot(){let e=this.view.containerEl.querySelector(".view-actions");e&&e.firstChild&&(this._viewActions||(this.clearViewActions(),this.offConnectionStatusSubscription&&this.offConnectionStatusSubscription(),this._viewActions=new fd({target:e,anchor:e.firstChild,props:{view:this,state:this.canvas.state,remote:this.canvas.sharedFolder.remote}}),this.offConnectionStatusSubscription=this.canvas.subscribe(e,t=>{var r;(r=this._viewActions)==null||r.$set({view:this,state:t,remote:this.canvas.sharedFolder.remote})})),this._viewActions.$set({view:this,state:this.canvas.state,remote:this.canvas.sharedFolder.remote}))}clearViewActions(){let e=this.view.containerEl.querySelector(".view-actions");if(e&&e.firstChild){let t=this.view.containerEl.querySelectorAll(".system3-view-action");t.length>0&&t.forEach(r=>{r.remove()})}}attach(){return this.canvas.userLock=!0,this.setConnectionDot(),this.plugin||(this.plugin=new bl(this)),new Promise(e=>this.canvas.whenReady().then(t=>{this._parent.networkStatus.online&&this.canvas.sharedFolder.shouldConnect&&this.shouldConnect&&this.canConnect?this.connect():this.canvas.disconnect(),e(this)}).catch(()=>{this.offlineBanner()}))}connect(){this.canvas.connect()}release(){var e,t,r;(e=this.plugin)==null||e.destroy(),this.plugin=void 0,(t=this._viewActions)==null||t.$destroy(),this._viewActions=void 0,(r=this._banner)==null||r.destroy(),this._banner=void 0,this.offConnectionStatusSubscription&&(this.offConnectionStatusSubscription(),this.offConnectionStatusSubscription=void 0),this.canvas.disconnect(),this.canvas.userLock=!1}destroy(){var e;(e=this.plugin)==null||e.destroy(),this.plugin=null,this.release(),this.clearViewActions(),this.view.leaf.rebuildView(),this._parent=null,this.view=null,this.canvas=null}},rn=class{constructor(e,t,r,n=!0,s=!0){this._parent=e,this.view=t,this.document=r,this._tracking=!1,this.shouldConnect=n,this.canConnect=s,e.networkStatus.online||this.offlineBanner()}toggleConnection(){this.shouldConnect=!this.shouldConnect,this.shouldConnect?this.document.connect().then(e=>{e||(this.shouldConnect=!1)}):this.document.disconnect()}get tracking(){return this._tracking}set tracking(e){let t=this._tracking;this._tracking=e,this._tracking!==t&&this.attach()}get ytext(){return this.document.ytext}mergeBanner(){return this._banner=new Fn(this.view,"Merge conflict -- click to resolve",async()=>{let e=await this.document.diskBuffer();return await this.document.checkStale()&&this._parent.openDiffView({file1:this.document,file2:e,showMergeOption:!0,onResolve:async()=>{this.document.clearDiskBuffer()}}),!0}),()=>{}}offlineBanner(){if(this.shouldConnect){let e=new Fn(this.view,"You're offline -- click to reconnect",async()=>(this._parent.networkStatus.checkStatus(),this.connect(),this._parent.networkStatus.online));this._parent.networkStatus.onceOnline(()=>{this.connect(),e.destroy()})}return()=>{}}setConnectionDot(){let e=this.view.containerEl.querySelector(".view-actions");e&&e.firstChild&&(this._viewActions||(this.clearViewActions(),this.offConnectionStatusSubscription&&this.offConnectionStatusSubscription(),this._viewActions=new fd({target:e,anchor:e.firstChild,props:{view:this,state:this.document.state,remote:this.document.sharedFolder.remote}}),this.offConnectionStatusSubscription=this.document.subscribe(e,t=>{var r;(r=this._viewActions)==null||r.$set({view:this,state:t,remote:this.document.sharedFolder.remote})})),this._viewActions.$set({view:this,state:this.document.state,remote:this.document.sharedFolder.remote}))}clearViewActions(){let e=this.view.containerEl.querySelector(".view-actions");if(e&&e.firstChild){let t=this.view.containerEl.querySelectorAll(".system3-view-action");t.length>0&&t.forEach(r=>{r.remove()})}}async checkStale(){var t,r;if(this.view.getMode()==="preview")return!1;let e=await this.document.checkStale();return e&&((t=this.document._diskBuffer)!=null&&t.contents)?this.mergeBanner():((r=this._banner)==null||r.destroy(),this._banner=void 0),e}attach(){return this.document.userLock=!0,this.setConnectionDot(),new Promise(e=>this.document.whenReady().then(t=>{this._parent.networkStatus.online&&this.document.sharedFolder.shouldConnect&&this.shouldConnect&&this.canConnect?this.connect():this.document.disconnect(),e(this)}).catch(()=>{this.offlineBanner()}))}connect(){this.document.connect()}release(){var e,t;(e=this._viewActions)==null||e.$destroy(),this._viewActions=void 0,(t=this._banner)==null||t.destroy(),this._banner=void 0,this.offConnectionStatusSubscription&&(this.offConnectionStatusSubscription(),this.offConnectionStatusSubscription=void 0),this.document.disconnect(),this.document.userLock=!1}destroy(){this.release(),this.clearViewActions(),this.view.leaf.rebuildView(),this._parent=null,this.view=null,this.document=null}},Sl=class{constructor(e,t,r,n){this.app=e;this.destroyed=!1;this.offListeners=[];this.folderListeners=new Map;this.workspace=e.workspace,this.sharedFolders=t,this.views=[],this.extensions=[],this._activePromise=null,this.loginManager=r,this.networkStatus=n,this.refreshQueue=[],this._compartment=new kl.Compartment,this.log=ke("[LiveViews]","log"),this.warn=ke("[LiveViews]","warn"),this.metadataListeners=new Map;let s=(l,c,f)=>{let u=this.metadataListeners.get(l);u==null||u(c,f)},i=this.app.metadataCache.on("changed",s);this.offListeners.push(()=>{this.app.metadataCache.offref(i)}),this.offListeners.push(this.loginManager.on(()=>{this.refresh("[LoginManager]")}));let a=l=>(l.ready||(async()=>l.whenReady().then(()=>{this.refresh("[Shared Folder Ready]")}).catch(c=>{this.views.forEach(f=>{var u;((u=f.document)==null?void 0:u.sharedFolder)===l&&f.offlineBanner()})}))(),l.fset.on(()=>{this.refresh("[Docset]")}));this.offListeners.push(this.sharedFolders.subscribe(()=>{this.refresh("[Shared Folders]"),this.folderListeners.forEach((l,c)=>{this.sharedFolders.has(c)||(l(),this.folderListeners.delete(c))}),this.sharedFolders.forEach(l=>{this.folderListeners.has(l)||this.folderListeners.set(l,a(l))})})),Ct.set(this,"LiveViewManager")}reconfigure(e){e.dispatch({effects:this._compartment.reconfigure([to.init(()=>this)])})}onMeta(e,t){this.metadataListeners.set(e,t)}offMeta(e){this.metadataListeners.delete(e)}openDiffView(e){Py(this.workspace,e)}goOffline(){this.log("[System 3][Relay][Live Views] going offline"),this.views.forEach(e=>{var t;return(t=e.document)==null?void 0:t.disconnect()}),this.refresh("[NetworkStatus]")}goOnline(){this.log("[System 3][Relay][Live Views] going online"),this.refresh("[NetworkStatus]"),this.sharedFolders.items().forEach(e=>{e.connect()}),this.viewsAttachedWithConnectionPool(this.views)}docIsOpen(e){return this.views.some(t=>t.document===e)}releaseViews(e){e.forEach(t=>{t.release()})}findFolders(){let e=new Set;return Cd(this.workspace,t=>{var s;let r=(s=t.file)==null?void 0:s.path;if(!r)return;let n=this.sharedFolders.lookup(r);n&&e.add(n)}),Ld(this.workspace,t=>{var s;let r=(s=t.file)==null?void 0:s.path;if(!r)return;let n=this.sharedFolders.lookup(r);n&&e.add(n)}),e.size==0?[]:[...e]}async foldersReady(){let e=new Set;if(Cd(this.workspace,r=>{var i;let n=(i=r.file)==null?void 0:i.path;if(!n)return;let s=this.sharedFolders.lookup(n);s&&e.add(s)}),Ld(this.workspace,r=>{var i;let n=(i=r.file)==null?void 0:i.path;if(!n)return;let s=this.sharedFolders.lookup(n);s&&e.add(s)}),e.size===0)return[];let t=[...e].map(r=>r.whenReady());return Promise.all(t)}async getViews(){let e=[];return Cd(this.workspace,async t=>{var s;let r=(s=t.file)==null?void 0:s.path;if(!r)return;let n=this.sharedFolders.lookup(r);if(n)if(this.loginManager.loggedIn)if(n.ready){let i=n.proxy.getDoc(r),a=new rn(this,t,i);e.push(a)}else this.log(`Folder not ready, skipping views. folder=${n.path}`);else{let i=new wl(this,t,()=>this.loginManager.openLoginPage());e.push(i)}}),Ld(this.workspace,t=>{var s;let r=(s=t.file)==null?void 0:s.path;if(!r)return;let n=this.sharedFolders.lookup(r);if(n)if(this.loginManager.loggedIn)if(n.ready){let i=n.proxy.getCanvas(r),a=new _l(this,t,i);e.push(a)}else this.log(`Folder not ready, skipping views. folder=${n.path}`);else{let i=new wl(this,t,()=>this.loginManager.openLoginPage());e.push(i)}}),e}findView(e){return this.views.filter(Nr).find(t=>t.view.editor.cm===e)}findCanvas(e){let t=e.state.values.find(r=>{if(r&&r.node)return r.node});if(t)return this.views.filter(kI).find(r=>r.view.canvas===t.node.canvas)}async viewsReady(e){return await Promise.all(e.filter(t=>t instanceof rn).map(async t=>t.document.whenReady().then(r=>t)))}async viewsAttachedWithConnectionPool(e,t=_I){let r=this.workspace.getActiveViewOfType(Fs.MarkdownView),n=0,s=e.sort((a,l)=>l.view.leaf.activeTime-a.view.leaf.activeTime),i=new Set;for(let a of s)a instanceof rn&&(a.view===r||i.has(a.document)?(a.canConnect=!0,i.add(a.document)):n<t?(a.canConnect=!0,i.add(a.document),n++):a.canConnect=!1);return n>t&&this.warn(`[System 3][Relay][Live Views] connection pool (max ${t}): rejected connections for ${n-t} views`),this.viewsAttached(e)}async viewsAttached(e){return await Promise.all(e.map(async t=>t.attach()))}deduplicate(e){let t=[],r=[];return this.views.forEach(n=>{let s=e.find(i=>{if(n.document==i.document&&n.view==i.view)return!0});s?(r.push(n),e.remove(s)):t.push(n)}),e.forEach(n=>{r.push(n)}),[r,t]}async _refreshViews(e,t){let r=`[LiveViews][${e}]`,n=ke(r,"debug"),s=(u,d)=>{n(u,d.map(m=>{var p;return{type:m.constructor.name,file:(p=m.document)==null?void 0:p.path,canConnect:m.canConnect}}))};if(n("Refresh"),this.destroyed)return!1;await this.foldersReady();let i=[];try{i=await this.getViews()}catch(u){return this.warn("[System 3][Relay][Live Views] error getting views",u),!1}let a=this.findFolders();if(a.length===0&&i.length===0)return this.extensions.length!==0&&(n("Unexpected plugins loaded."),this.wipe()),s("Releasing Views",this.views),this.releaseViews(this.views),this.views=[],!0;this.loginManager.loggedIn&&this.networkStatus.online?a.forEach(u=>{u.connect()}):this.sharedFolders.forEach(u=>{u.disconnect()});let[l,c]=this.deduplicate(i);if(s("Releasing Views",c),this.releaseViews(c),c.length===0&&SI(l,this.views)){let u=await this.viewsAttachedWithConnectionPool(this.views);s("Attached Views",u)}else{let u=await this.viewsReady(l);s("Ready Views",u);let d=await this.viewsAttachedWithConnectionPool(u);s("Attached Views",d),this.views=l}n("loading plugins"),this.load();let f=Fs.moment.utc();return n(`refresh completed in ${f.diff(t)}ms`,r),!0}async refresh(e){if(this.destroyed)return!1;let t=ke(e,"warn"),r=Fs.moment.utc();if(this.refreshQueue.push(()=>this._refreshViews(e,r)),this._activePromise!==null)return!1;for(;this.refreshQueue.length>0;){if(this.destroyed)return!1;this.refreshQueue.length>2&&t("refreshQueue size:",this.refreshQueue.length);let n=this.refreshQueue.pop();this.refreshQueue.length=0,this._activePromise=n().finally(()=>{this._activePromise=null}),await this._activePromise}return!0}wipe(){this.extensions.length=0,this.workspace.updateOptions()}load(){this.wipe(),this.views.length>0&&(this.extensions.push([this._compartment.of(to.init(()=>this)),_y,Ry,Sy,ky,Cy]),this.workspace.updateOptions())}destroy(){this.destroyed=!0,this.releaseViews(this.views),this.offListeners.forEach(e=>e()),this.offListeners.length=0,this.metadataListeners.clear(),this.metadataListeners=null,this.folderListeners.forEach(e=>e()),this.folderListeners.clear(),this.folderListeners=null,this.views.forEach(e=>e.destroy()),this.views=[],this.wipe(),this.sharedFolders=null,this.refreshQueue=null,this.networkStatus=null,this._activePromise=null,this.loginManager=null,this.app=null,this.workspace=null}},to=kl.StateField.define({create(o){},update(o,e){return o}});var Rs=require("obsidian");function II(o){_e(o,"svelte-1siabfk",".system3-folder-icons.svelte-1siabfk{display:inline-flex;align-items:center;vertical-align:middle;border-radius:var(--radius-m);transition:width 0.3s ease;margin-right:0.6em;padding-left:0.2em;padding-right:0.2em;background-color:var(--color-base-05);position:relative}.system3-icon.svelte-1siabfk{margin-right:0.2em;margin-left:0.2em;width:1em;display:flex;transition:display 0.3s ease}span.system3-connected.svelte-1siabfk{color:var(--color-accent)}span.system3-disconnected.svelte-1siabfk{color:var(--color-base-40)}span.notebook.svelte-1siabfk{color:var(--color-accent)}span.hidden.svelte-1siabfk{display:none}.system3-progress-text.svelte-1siabfk{margin-right:0.4em;font-size:0.8em;color:var(--color-accent);opacity:1;transition:opacity 0.3s ease}.system3-progress-text.completed.svelte-1siabfk{animation:svelte-1siabfk-fadeOutDelay 0.3s ease forwards}.system3-progress-text.failed.svelte-1siabfk{color:var(--color-red)}@keyframes svelte-1siabfk-fadeOutDelay{0%,50%{opacity:1}100%{opacity:0;display:none}}")}function Uy(o){let e,t,r,n;return{c(){e=S("span"),t=B(o[3]),r=B("%"),h(e,"class",n="system3-progress-text system3-"+o[4]+" svelte-1siabfk"),ue(e,"opacity","1")},m(s,i){_(s,e,i),b(e,t),b(e,r)},p(s,i){i&8&&Y(t,s[3]),i&16&&n!==(n="system3-progress-text system3-"+s[4]+" svelte-1siabfk")&&h(e,"class",n)},d(s){s&&w(e)}}}function CI(o){let e,t,r;return t=new To({props:{class:"inline-icon",style:"width: 0.8em"}}),{c(){e=S("span"),R(t.$$.fragment),h(e,"class","notebook system3-icon svelte-1siabfk"),h(e,"aria-label","Tracking Changes")},m(n,s){_(n,e,s),D(t,e,null),r=!0},p:q,i(n){r||(x(t.$$.fragment,n),r=!0)},o(n){k(t.$$.fragment,n),r=!1},d(n){n&&w(e),F(t)}}}function LI(o){let e,t,r,n,s,i,a,l;return t=new To({props:{class:"inline-icon",style:"width: 0.8em"}}),s=new Dn({props:{class:"inline-icon"}}),{c(){var c;e=S("span"),R(t.$$.fragment),r=M(),n=S("span"),R(s.$$.fragment),h(e,"class","notebook system3-icon hidden svelte-1siabfk"),h(e,"aria-label","Tracking Changes"),h(n,"class",i="satellite system3-icon system3-"+o[0]+" svelte-1siabfk"),h(n,"aria-label",a=`${((c=o[2])==null?void 0:c.relay.name)||"Relay Server"} (${o[0]})`)},m(c,f){_(c,e,f),D(t,e,null),_(c,r,f),_(c,n,f),D(s,n,null),l=!0},p(c,f){var u;(!l||f&1&&i!==(i="satellite system3-icon system3-"+c[0]+" svelte-1siabfk"))&&h(n,"class",i),(!l||f&5&&a!==(a=`${((u=c[2])==null?void 0:u.relay.name)||"Relay Server"} (${c[0]})`))&&h(n,"aria-label",a)},i(c){l||(x(t.$$.fragment,c),x(s.$$.fragment,c),l=!0)},o(c){k(t.$$.fragment,c),k(s.$$.fragment,c),l=!1},d(c){c&&(w(e),w(r),w(n)),F(t),F(s)}}}function TI(o){let e,t,r,n,s,i=o[5]&&Uy(o),a=[LI,CI],l=[];function c(f,u){return f[1]?0:1}return r=c(o,-1),n=l[r]=a[r](o),{c(){e=S("div"),i&&i.c(),t=M(),n.c(),h(e,"class","system3-folder-icons svelte-1siabfk")},m(f,u){_(f,e,u),i&&i.m(e,null),b(e,t),l[r].m(e,null),s=!0},p(f,[u]){f[5]?i?i.p(f,u):(i=Uy(f),i.c(),i.m(e,t)):i&&(i.d(1),i=null);let d=r;r=c(f,u),r===d?l[r].p(f,u):(ie(),k(l[d],1,1,()=>{l[d]=null}),ae(),n=l[r],n?n.p(f,u):(n=l[r]=a[r](f),n.c()),x(n,1),n.m(e,null))},i(f){s||(x(n),s=!0)},o(f){k(n),s=!1},d(f){f&&w(e),i&&i.d(),l[r].d()}}}function AI(o,e,t){let r,{status:n="disconnected"}=e,{relayId:s}=e,{remote:i}=e,{progress:a=0}=e,{syncStatus:l="pending"}=e;return o.$$set=c=>{"status"in c&&t(0,n=c.status),"relayId"in c&&t(1,s=c.relayId),"remote"in c&&t(2,i=c.remote),"progress"in c&&t(3,a=c.progress),"syncStatus"in c&&t(4,l=c.syncStatus)},o.$$.update=()=>{if(o.$$.dirty&24){e:t(5,r=(l!=="completed"||a<100)&&a>0)}},[n,s,i,a,l,r]}var Td=class extends K{constructor(e){super(),G(this,e,AI,TI,j,{status:0,relayId:1,remote:2,progress:3,syncStatus:4},II)}},Oy=Td;function MI(o){_e(o,"svelte-1swndfj",".system3-filepill.svelte-1swndfj{text-wrap:nowrap}")}function EI(o){let e,t,r;return{c(){e=S("div"),t=S("span"),r=B(o[0]),h(e,"class","nav-file-tag system3-filepill svelte-1swndfj"),h(e,"aria-label",o[1])},m(n,s){_(n,e,s),b(e,t),b(t,r)},p(n,[s]){s&1&&Y(r,n[0]),s&2&&h(e,"aria-label",n[1])},i:q,o:q,d(n){n&&w(e)}}}function PI(o,e,t){let{text:r}=e,{label:n}=e;return o.$$set=s=>{"text"in s&&t(0,r=s.text),"label"in s&&t(1,n=s.label)},[r,n]}var Ad=class extends K{constructor(e){super(),G(this,e,PI,EI,j,{text:0,label:1},MI)}},$y=Ad;function DI(o){_e(o,"svelte-1ljf67u",".system3-uploadpill.svelte-1ljf67u{text-wrap:nowrap}")}function FI(o){let e,t,r,n;return{c(){e=S("div"),t=S("span"),r=B(o[0]),h(e,"class","nav-file-tag system3-uploadpill svelte-1ljf67u"),h(e,"aria-label",o[1]),h(e,"style",n=o[2]?`color:${o[2]}`:"")},m(s,i){_(s,e,i),b(e,t),b(t,r)},p(s,[i]){i&1&&Y(r,s[0]),i&2&&h(e,"aria-label",s[1]),i&4&&n!==(n=s[2]?`color:${s[2]}`:"")&&h(e,"style",n)},i:q,o:q,d(s){s&&w(e)}}}function RI(o,e,t){let{text:r}=e,{label:n}=e,{color:s}=e;return o.$$set=i=>{"text"in i&&t(0,r=i.text),"label"in i&&t(1,n=i.label),"color"in i&&t(2,s=i.color)},[r,n,s]}var Md=class extends K{constructor(e){super(),G(this,e,RI,FI,j,{text:0,label:1,color:2},DI)}},Ny=Md;var Ed=class{constructor(e,t){this.el=e,this.mutationObserver=new MutationObserver((r,n)=>{for(let s of r)s.type==="childList"&&e.nextSibling&&(t(e),n.disconnect())}),this.mutationObserver.observe(e.parentElement,{childList:!0,subtree:!0})}destroy(){var e;(e=this.mutationObserver)==null||e.disconnect(),this.mutationObserver=null}},on=class{visitFolder(e,t,r,n){return null}visitFile(e,t,r,n){return null}},Pd=class{constructor(e,t){this.el=e,this.sharedFolder=t,this.siblingWatcher=new Ed(this.el,r=>{this.add()}),this.add()}add(){var e;(e=this.el.nextSibling)==null||e.addClass("system3-live")}remove(){var e;(e=this.el.nextSibling)==null||e.removeClass("system3-live")}destroy(){this.siblingWatcher.destroy(),this.remove()}},Dd=class extends on{visitFolder(e,t,r,n){return n&&n.path===e.path?r||new Pd(t.selfEl,n):(r&&r.destroy(),null)}},Fd=class{constructor(e,t){this.sharedFolder=t;let r=e.querySelectorAll(".system3-folder-icons");r.length>1&&(r==null||r.forEach(s=>{s.remove()})),this.el=e,this.el.addClass("system3-pill"),this.pill=new Oy({target:this.el,props:{status:this.sharedFolder.state.status,relayId:this.sharedFolder.relayId,remote:this.sharedFolder.remote,progress:0,syncStatus:"pending"}});let n=[];n.push(this.sharedFolder.subscribe(this.el,s=>{this.pill.$set({status:s.status,relayId:this.sharedFolder.relayId,remote:this.sharedFolder.remote})})),n.push(this.sharedFolder.backgroundSync.subscribeToGroupProgress(this.sharedFolder,s=>{s&&this.pill.$set({progress:s.percent,syncStatus:s.status})})),this.unsubscribe=()=>n.forEach(s=>s())}destroy(){this.pill.$destroy(),this.unsubscribe(),this.el.removeClass("system3-pill")}},Rd=class extends on{visitFolder(e,t,r,n){return n&&n.path===e.path?r||new Fd(t.selfEl,n):(r&&r.destroy(),null)}},Ud=class{constructor(e,t,r,n){this.el=e;this.path=t;this.activeSync=r;this.activeDownloads=n;this.unsubscribers=[];this.titleEl=e.querySelector(".nav-file-title")||e,this.unsubscribers.push(this.activeSync.subscribe(()=>this.checkStatus()),this.activeDownloads.subscribe(()=>this.checkStatus())),this.checkStatus()}checkStatus(){let e=this.activeSync.some(r=>r.path===this.path),t=this.activeDownloads.some(r=>r.path===this.path);e?this.titleEl.addClass("system3-syncing"):this.titleEl.removeClass("system3-syncing"),t?this.titleEl.addClass("system3-downloading"):this.titleEl.removeClass("system3-downloading")}destroy(){this.titleEl.removeClass("system3-uploading"),this.titleEl.removeClass("system3-downloading"),this.unsubscribers.forEach(e=>e())}},Od=class extends on{constructor(t,r){super();this.activeSync=t;this.activeDownloads=r}visitFile(t,r,n,s){return s&&s.ready&&s.checkPath(t.path)&&bt.checkExtension(t.path)?n||new Ud(r.el,t.path,this.activeSync,this.activeDownloads):(n&&n.destroy(),null)}},$d=class{constructor(e,t){this.el=e;this.file=t;this.unsubscribes=[];this.el.querySelectorAll(".system3-uploadpill").forEach(r=>{r.remove()}),this.unsubscribes.push(this.file.subscribe(()=>{this.setText()}))}setText(){var e;if(this.file){if(this.file.inMeta){(e=this.pill)==null||e.$destroy();return}this.pill?this.pill.$set({text:this.file.tag}):this.pill=new Ny({target:this.el,props:{text:this.file.tag}})}}destroy(){var e;this.unsubscribes.forEach(t=>t()),this.el.querySelectorAll(".system3-uploadpill").forEach(t=>{t.remove()}),(e=this.pill)==null||e.$destroy(),this.file=null}},Nd=class extends on{visitFile(e,t,r,n){if(n&&!bt.checkExtension(e.path)&&!lt.checkExtension(e.path)&&n.isSyncableTFile(e)&&n.ready&&n.connected){let s=n.proxy.viewSyncFile(e.path);if(s&&kr(s))return r&&r.file===s?r:new $d(t.selfEl,s)}return r&&r.destroy(),null}},Bd=class{constructor(e){this.el=e;this.el.querySelectorAll(".system3-filepill").forEach(t=>{t.remove()}),this.pill=new $y({target:this.el,props:{text:"NOT SYNCED",label:"Syncing this file type is disabled"}})}destroy(){this.pill.$destroy(),this.el.querySelectorAll(".system3-filepill").forEach(e=>{e.remove()})}},Vd=class extends on{visitFile(e,t,r,n){return n&&n.checkPath(e.path)&&!n.isSyncableTFile(e)?r||new Bd(t.selfEl):(r&&r.destroy(),null)}},Hd=class{constructor(e,t,r){this.el=e,this.document=t,this.document.subscribe(e,n=>{this.docStatus(n)}),this.docStatus(this.document.state)}docStatus(e){(e==null?void 0:e.status)==="connected"?(this.el.removeClass("system3-connecting"),this.el.addClass("system3-connected"),this.el.addClass("system3-live")):(e==null?void 0:e.status)==="connecting"?(this.el.removeClass("system3-connected"),this.el.addClass("system3-connecting"),this.el.addClass("system3-live")):(e==null?void 0:e.status)==="disconnected"?(this.el.addClass("system3-live"),this.el.removeClass("system3-connected"),this.el.removeClass("system3-connecting")):(this.el.removeClass("system3-connected"),this.el.removeClass("system3-connecting"),this.el.removeClass("system3-live"))}destroy(){var e;(e=this.document)==null||e.unsubscribe(this.el),this.docStatus()}},qd=class extends on{visitFile(e,t,r,n){if(n)try{let s=n.getVirtualPath(e.path),i=n.syncStore.get(s);if(!i)return null;let a=n.files.get(i);return!(a instanceof bt)||!a?null:r||new Hd(t.el,a,e)}catch(s){return null}return r&&r.destroy(),null}},Il=class{constructor(e,t,r){this.fileExplorer=e,this.sharedFolders=t,this.visitors=r,this.storage=new Map;for(let n of this.visitors)this.storage.set(n,new Map)}_getFileExplorerItem(e){try{return this.fileExplorer.view.fileItems[e]}catch(t){return null}}getFileExplorerItem(e,t){return typeof t=="string"?this._getFileExplorerItem(t):this._getFileExplorerItem(t.path)}walk(e,t){if(this.fileExplorer.view.getViewType()!=="file-explorer")return;let r=this.sharedFolders.find(s=>s.path===e.path)||t,n=this.getFileExplorerItem(this.fileExplorer,e);n&&this.storage.forEach((s,i)=>{let a=s.get(n),l=i.visitFolder(e,n,a,r);a&&!l?s.delete(n):l&&s.set(n,l)}),e.children.forEach(s=>{if(s instanceof Rs.TFolder)this.walk(s,r);else if(s instanceof Rs.TFile){let i=this.getFileExplorerItem(this.fileExplorer,s);if(!i)return;this.storage.forEach((a,l)=>{let c=a.get(i),f=l.visitFile(s,i,c,r);c&&!f?a.delete(i):f&&a.set(i,f)})}})}destroy(){this.storage.forEach(e=>{e.forEach(t=>{t.destroy()})})}},Cl=class{constructor(e,t,r,n){this.layoutReady=!1;this.vault=e,this.workspace=t,this.sharedFolders=r,this.backgroundSync=n,this.treeState=new Map,this.workspace.onLayoutReady(()=>{this.layoutReady=!0,this.refresh()}),this.unsubscribes=[],this.unsubscribes.push(n.activeSync.subscribe(()=>this.quickRefresh()),n.activeDownloads.subscribe(()=>this.quickRefresh()),n.syncGroups.subscribe(()=>this.quickRefresh())),this.offDocumentListeners=new Map,this.offFolderListener=this.sharedFolders.subscribe(()=>{this.sharedFolders.forEach(s=>{Pg([wo.enableDocumentStatus],()=>{this.offDocumentListeners.get(s)||this.offDocumentListeners.set(s,s.fset.on(()=>{this.refresh()}))}),s.whenReady().then(()=>{this.refresh()}),this.unsubscribes.push(s.syncSettingsManager.subscribe(i=>{this.quickRefresh()})),this.unsubscribes.push(s.subscribe(this,()=>{this.quickRefresh()})),this.unsubscribes.push(s.syncStore.subscribe(i=>{this.quickRefresh()}))}),this.refresh()}),this.offLayoutChange=(()=>{let s=this.workspace.on("layout-change",()=>this.quickRefresh());return()=>{this.workspace.offref(s)}})()}makeVisitors(){let e=[];return e.push(new Dd),e.push(new Rd),jo(wo.enableDocumentStatus,()=>{e.push(new qd),e.push(new Od(this.backgroundSync.activeSync,this.backgroundSync.activeDownloads))}),e.push(new Nd),e.push(new Vd),e}getFileExplorers(){let e=[];return this.workspace.iterateAllLeaves(t=>{t.view.getViewType()==="file-explorer"&&(e.includes(t)||e.push(t))}),e}quickRefresh(){if(!this.layoutReady)return;let e=this.getFileExplorers(),t=this.sharedFolders.map(r=>r.path);for(let r of e){let n=this.treeState.get(r)||new Il(r,this.sharedFolders,this.makeVisitors());this.treeState.set(r,n);for(let s of t){let i=this.vault.getAbstractFileByPath(s);i instanceof Rs.TFolder&&n.walk(i)}}}refresh(){if(!this.layoutReady)return;let e=this.getFileExplorers();for(let t of e){let r=this.treeState.get(t)||new Il(t,this.sharedFolders,this.makeVisitors());this.treeState.set(t,r);let n=this.vault.getAbstractFileByPath("/");n instanceof Rs.TFolder&&r.walk(n)}}destroy(){var e;(e=this.offFolderListener)==null||e.call(this),this.offDocumentListeners.forEach(t=>t()),this.offDocumentListeners.clear(),this.unsubscribes.forEach(t=>t()),this.unsubscribes.length=0,this.treeState.forEach(t=>{t.destroy()}),this.treeState.clear(),this.offLayoutChange(),this.vault=null,this.workspace=null,this.sharedFolders=null,this.backgroundSync=null,this.offFolderListener=null}};var xb=require("obsidian");function Ee(o,e,t,r){function n(s){return s instanceof t?s:new t(function(i){i(s)})}return new(t||(t=Promise))(function(s,i){function a(f){try{c(r.next(f))}catch(u){i(u)}}function l(f){try{c(r.throw(f))}catch(u){i(u)}}function c(f){f.done?s(f.value):n(f.value).then(a,l)}c((r=r.apply(o,e||[])).next())})}var Br=require("obsidian");function UI(o){let e,t,r;return{c(){e=$r("svg"),t=$r("g"),r=$r("path"),h(r,"d","M216.856339,16.5966031 C200.285002,8.84328665 182.566144,3.2084988 164.041564,0 C161.766523,4.11318106 159.108624,9.64549908 157.276099,14.0464379 C137.583995,11.0849896 118.072967,11.0849896 98.7430163,14.0464379 C96.9108417,9.64549908 94.1925838,4.11318106 91.8971895,0 C73.3526068,3.2084988 55.6133949,8.86399117 39.0420583,16.6376612 C5.61752293,67.146514 -3.4433191,116.400813 1.08711069,164.955721 C23.2560196,181.510915 44.7403634,191.567697 65.8621325,198.148576 C71.0772151,190.971126 75.7283628,183.341335 79.7352139,175.300261 C72.104019,172.400575 64.7949724,168.822202 57.8887866,164.667963 C59.7209612,163.310589 61.5131304,161.891452 63.2445898,160.431257 C105.36741,180.133187 151.134928,180.133187 192.754523,160.431257 C194.506336,161.891452 196.298154,163.310589 198.110326,164.667963 C191.183787,168.842556 183.854737,172.420929 176.223542,175.320965 C180.230393,183.341335 184.861538,190.991831 190.096624,198.16893 C211.238746,191.588051 232.743023,181.531619 254.911949,164.955721 C260.227747,108.668201 245.831087,59.8662432 216.856339,16.5966031 Z M85.4738752,135.09489 C72.8290281,135.09489 62.4592217,123.290155 62.4592217,108.914901 C62.4592217,94.5396472 72.607595,82.7145587 85.4738752,82.7145587 C98.3405064,82.7145587 108.709962,94.5189427 108.488529,108.914901 C108.508531,123.290155 98.3405064,135.09489 85.4738752,135.09489 Z M170.525237,135.09489 C157.88039,135.09489 147.510584,123.290155 147.510584,108.914901 C147.510584,94.5396472 157.658606,82.7145587 170.525237,82.7145587 C183.391518,82.7145587 193.761324,94.5189427 193.539891,108.914901 C193.539891,123.290155 183.391518,135.09489 170.525237,135.09489 Z"),h(r,"fill","#5865F2"),h(r,"fill-rule","nonzero"),h(e,"width",o[0]),h(e,"height",o[0]),h(e,"viewBox","0 -28.5 256 256"),h(e,"version","1.1"),h(e,"xmlns","http://www.w3.org/2000/svg"),h(e,"xmlns:xlink","http://www.w3.org/1999/xlink"),h(e,"preserveAspectRatio","xMidYMid")},m(n,s){_(n,e,s),b(e,t),b(t,r)},p(n,[s]){s&1&&h(e,"width",n[0]),s&1&&h(e,"height",n[0])},i:q,o:q,d(n){n&&w(e)}}}function OI(o,e,t){let{size:r="1em"}=e;return o.$$set=n=>{"size"in n&&t(0,r=n.size)},[r]}var zd=class extends K{constructor(e){super(),G(this,e,OI,UI,j,{size:0})}},Ll=zd;function $I(o){_e(o,"svelte-4t8k3t",`.menu-container.svelte-4t8k3t{display:inline-block;position:relative}.menu-button.svelte-4t8k3t{box-shadow:none;padding:8px;border:none;background:transparent;color:var(--text-muted)}.menu-button.svelte-4t8k3t:hover{color:var(--icon-color-hover)}.menu-button.svelte-4t8k3t:focus{color:var(--icon-color-focus)}.menu-dropdown.svelte-4t8k3t{position:absolute;right:0;margin-top:8px;width:224px;background:var(--color-base-10);border-radius:6px;box-shadow:0 4px 6px -1px rgba(0, 0, 0, 0.1),
			0 2px 4px -1px rgba(0, 0, 0, 0.06);border:1px solid rgba(0, 0, 0, 0.1)}.arrow.svelte-4t8k3t{position:absolute;top:-5px;right:12px;width:10px;height:10px;background:var(--color-base-10);border-left:1px solid rgba(0, 0, 0, 0.1);border-top:1px solid rgba(0, 0, 0, 0.1);transform:rotate(45deg)}.menu-content.svelte-4t8k3t{display:flex;flex-direction:column;gap:8px;padding:8px}.menu-item.svelte-4t8k3t{display:flex;width:100%;align-items:center;gap:12px;padding:8px;border-radius:4px;text-decoration:none;color:var(--text-muted);transition:background-color 0.2s;font-size:14px}.menu-item.svelte-4t8k3t:hover{background-color:var(--background-modifier-hover)}.menu-item.svelte-4t8k3t:focus{background-color:var(--background-modifier-hover)}`)}function By(o){let e,t,r,n,s,i,a,l,c,f,u,d,m;return a=new Ll({props:{size:20}}),{c(){e=S("div"),t=S("div"),r=M(),n=S("div"),s=S("span"),i=S("a"),R(a.$$.fragment),l=M(),c=S("span"),c.textContent="Join the community",h(t,"class","arrow svelte-4t8k3t"),h(i,"href","https://discord.system3.md"),h(i,"target","_blank"),h(i,"rel","noopener noreferrer"),h(i,"class","menu-item svelte-4t8k3t"),ue(s,"text-align","center"),ue(s,"display","flex"),h(n,"class","menu-content svelte-4t8k3t"),h(e,"class","menu-dropdown svelte-4t8k3t")},m(p,y){_(p,e,y),b(e,t),b(e,r),b(e,n),b(n,s),b(s,i),D(a,i,null),b(i,l),b(i,c),u=!0,d||(m=rl(f=o[1].call(null,e)),d=!0)},i(p){u||(x(a.$$.fragment,p),u=!0)},o(p){k(a.$$.fragment,p),u=!1},d(p){p&&w(e),F(a),d=!1,m()}}}function NI(o){let e,t,r,n,s,i,a;r=new Gu({props:{size:"20px"}});let l=o[0]&&By(o);return{c(){e=S("div"),t=S("button"),R(r.$$.fragment),n=M(),l&&l.c(),h(t,"class","menu-button svelte-4t8k3t"),h(e,"class","menu-container svelte-4t8k3t")},m(c,f){_(c,e,f),b(e,t),D(r,t,null),b(e,n),l&&l.m(e,null),s=!0,i||(a=z(t,"click",nl(o[2])),i=!0)},p(c,[f]){c[0]?l?f&1&&x(l,1):(l=By(c),l.c(),x(l,1),l.m(e,null)):l&&(ie(),k(l,1,1,()=>{l=null}),ae())},i(c){s||(x(r.$$.fragment,c),x(l),s=!0)},o(c){k(r.$$.fragment,c),k(l),s=!1},d(c){c&&w(e),F(r),l&&l.d(),i=!1,a()}}}function BI(o,e,t){let r=!1;function n(i){let a=l=>{let c=document.querySelector(".menu-button");!i.contains(l.target)&&l.target!==c&&!(c!=null&&c.contains(l.target))&&t(0,r=!1)};return setTimeout(()=>{document.addEventListener("click",a)},0),{destroy(){document.removeEventListener("click",a)}}}function s(i){i.stopPropagation(),t(0,r=!r)}return[r,n,s]}var Wd=class extends K{constructor(e){super(),G(this,e,BI,NI,j,{},$I)}},Vy=Wd;function VI(o){_e(o,"svelte-ycfe1d",".relay-text.svelte-ycfe1d{fill:var(--text-normal)}")}function HI(o){let e,t;return{c(){e=$r("svg"),t=$r("path"),h(t,"d","m112.88679 65.94517c-1.8219-.6498-2.8316-1.9996-2.8205-3.7707.019-2.9692 4.2679-9.1564 8.5532-12.4538.8896-.6846 3.2865-2.0796 5.3264-3.1002l3.7089-1.8555 1.1034-2.1157c.6069-1.1636 1.0788-2.1403 1.0487-2.1704-.03-.03-.7517.2969-1.6037.7266-1.7893.9026-3.4923 1.0179-5.6348.3816-1.2664-.376-2.6971-1.5724-3.0511-2.5512-.1036-.2865-.2262-.2926-.6259-.031-1.6133 1.0551-3.9805 2.2931-5.3124 2.7783-3.2045 1.1672-7.1579.5507-8.5509-1.3335l-.5903-.7983-1.2238.7491c-3.1246 1.9126-7.5052 2.5576-9.6905 1.4268-1.3209-.6835-2.1336-1.8529-2.3663-3.405-.099-.6587-.2706-1.1976-.3819-1.1976-.1112 0-.4909.3082-.8437.685-1.1393 1.2168-4.3891 3.211-6.2437 3.8314-4.3168 1.4441-8.0424.1949-8.8532-2.9684-.1823-.7114-.3977-1.2593-.4786-1.2177-8.2088 4.2188-13.1666 5.5617-17.3451 4.6983-7.2318-1.4943-8.5363-7.633-3.2721-15.3969 3.43-5.0586 8.1226-8.1393 12.5368-8.2303 4.2661-.088 6.1851 2.8612 4.6067 7.0798-1.4639 3.9129-6.6553 7.7738-11.3995 8.4781l-1.2322.183-.173.9219c-.2449 1.3054.055 2.3726.8414 2.9909 1.4773 1.162 5.3481.4499 9.169-1.6869 4.0877-2.286 9.2494-6.7459 10.2254-8.8353 2.1729-4.6512 10.3391-19.4528 12.6199-22.8741 1.9649-2.9472 2.9544-3.913 4.6877-4.575 2.2454-.8575 3.8556.1204 3.8556 2.3418 0 1.0627-.8749 2.8756-5.2398 10.8581-4.5459 8.3134-10.5554 20.346-10.9601 21.9446-.372 1.4696-.093 1.8547 1.0954 1.5137 3.1691-.9088 8.5727-5.615 10.728-9.3431 3.192-5.5215 7.5241-8.5901 12.516-8.8657 1.3396-.074 2.6532.01 3.3914.2166 1.585.4437 3.5318 2.2009 3.7762 3.4083.1003.4954.3584.9822.5736 1.0817 1.6112.7453 1.9862 1.0047 2.0682 1.4307.051.2665-.9529 2.6236-2.2318 5.238-1.8799 3.8432-2.328 4.9899-2.3404 5.9886l-.015 1.2352.9261.077c1.132.094 3.2883-1.1349 5.6894-3.243 2.3304-2.0459 3.4794-3.659 6.2257-8.7403 1.3371-2.4739 2.6529-4.8096 2.924-5.1906.7068-.9931 1.8337-1.3742 3.6712-1.2413 1.7839.1291 2.6563.7039 2.6563 1.7502 0 .3631-1.6536 3.8273-3.6747 7.698-3.6147 6.9231-4.2241 8.2285-3.8408 8.2285.3864 0 2.6593-1.4351 4.2082-2.6571 2.9724-2.3449 4.1289-3.8334 6.7129-8.64 3.2167-5.9836 4.0513-6.6961 7.4599-6.3685 1.5037.1444 2.3637.7781 2.3637 1.7416 0 .6971-3.7642 8.1283-7.3844 14.5783-1.1774 2.0975-2.1406 3.9288-2.1406 4.0695 0 1.0032 6.4569-2.0079 10.373-4.8373 1.75083-1.265 2.80833-1.8553 3.32363-1.8553.8396 0 1.9138.8456 1.9138 1.5065 0 1.6136-6.83683 5.3607-15.31743 8.3952l-3.0144 1.0785-3.1147 4.959c-6.6125 10.5277-11.2414 15.4863-16.0267 17.1682-1.6492.5797-2.5036.6042-3.8855.1114zm3.4676-4.0874c2.3533-1.2035 5.0029-4.3759 7.0335-8.4211 1.4729-2.9341 1.2858-3.2801-1.0497-1.9405-2.6054 1.4944-6.0792 5.1835-7.6115 8.0833-1.3391 2.5343-.6792 3.458 1.6277 2.2783zm-13.7433-25.7067c2.0798-1.3888 2.707-2.2251 5.1929-6.9235 1.1337-2.1427 2.4702-4.3736 2.9701-4.9576.4999-.5839.8343-1.1823.7432-1.3297-.3028-.49-1.5733-.2724-2.9201.5001-3.9 2.237-10.6318 12.1845-9.2087 13.6076.4489.4489 1.7491.087 3.2226-.8969zm-39.6413-6.7383c1.4951-.7532 3.4914-2.3885 4.373-3.5822.8778-1.1886.8303-2.7169-.089-2.8472-.9504-.1348-2.84 1.147-4.3353 2.9408-1.4368 1.7237-2.8652 3.8321-2.8652 4.2293 0 .3431 1.5421-.048 2.916-.7407zm-15.7519 34.9397c-7.7618-1.6901-14.6809-7.6649-17.3519-14.9834-1.0082-2.7626-2.5946-8.8926-3.6898-14.2584-.7621-3.7334-1.4567-5.8195-2.0623-6.1938-.1258-.078-.173.4384-.1049 1.147l.1238 1.2883-2.6916 5.648c-3.9954 8.3841-5.3958 10.566-7.4555 11.6168-1.4222.7256-3.7417.6896-5.2712-.082-1.0729-.541-1.1779-.6797-1.1514-1.5213.017-.5465.8143-2.6067 1.945-5.0271 3.1568-6.7568 12.4018-25.1754 13.3068-26.5105 1.1089-1.6358 2.3136-2.186 4.3772-1.9989 1.8988.1722 3.7575 1.0556 3.7575 1.7858 0 .685-.9801 3.23-2.4839 6.4499-.6712 1.437-1.2203 2.6574-1.2203 2.712 0 .2508 2.423.059 3.8048-.3005 2.1083-.5492 3.5885-1.4764 5.2895-3.3138 2.9831-3.2221 3.5133-7.5609 1.1835-9.6842-3.8351-3.4952-12.7275-2.9971-21.5226 1.2055-6.4797 3.0962-10.7971 8.141-11.8606 13.8587-.5183 2.7868-1.354 3.618-2.8384 2.8236-2.234-1.1956-1.5337-5.997 1.651-11.3196 5.1483-8.6044 15.656-14.9768 26.6996-16.192 9.3582-1.0298 17.2345 3.5198 17.8697 10.322.3469 3.7147-1.5827 8.0493-5.1855 11.6487-2.6104 2.6078-4.969 3.9861-7.9877 4.6679l-1.94.4381.8512.2875c1.5709.5307 1.8619 1.0923 3.1019 5.988 2.5245 9.9665 4.9471 14.9264 9.4592 19.3659 6.055 5.9576 14.0611 6.1192 19.4354.3922.7131-.7598 2.2084-2.7055 3.323-4.3238 1.1145-1.6182 2.2218-3.0172 2.4606-3.1088 2.1176-.8126 2.9615 1.5236 1.6137 4.4675-2.2327 4.877-6.6161 9.1629-11.4944 11.2387-4.1481 1.7652-9.8251 2.3621-13.9414 1.4657z"),h(e,"class","relay-text svelte-ycfe1d"),h(e,"width",o[0]),h(e,"height",o[1]),h(e,"viewBox","0 0 154.24573 66.293579"),h(e,"xmlns","http://www.w3.org/2000/svg")},m(r,n){_(r,e,n),b(e,t)},p:q,i:q,o:q,d(r){r&&w(e)}}}function qI(o,e,t){let{size:r=64}=e,n=r,s=r/2;return o.$$set=i=>{"size"in i&&t(2,r=i.size)},[n,s,r]}var jd=class extends K{constructor(e){super(),G(this,e,qI,HI,j,{size:2},VI)}},Tl=jd;function zI(o){_e(o,"svelte-120r7kg",".subtitle.svelte-120r7kg{color:var(--text-muted);font-size:1.25rem;margin:0}.description.svelte-120r7kg{color:var(--text-muted);font-size:1rem;max-width:480px;margin:0}")}function WI(o){let e,t,r,n,s,i;return e=new Tl({props:{size:140}}),{c(){R(e.$$.fragment),t=M(),r=S("p"),r.textContent="Real-time collaboration in Obsidian",n=M(),s=S("p"),s.textContent=`Share folders with your team, edit together in real time, and keep your
	knowledge library exactly how you want it.`,h(r,"class","subtitle svelte-120r7kg"),h(s,"class","description svelte-120r7kg")},m(a,l){D(e,a,l),_(a,t,l),_(a,r,l),_(a,n,l),_(a,s,l),i=!0},p:q,i(a){i||(x(e.$$.fragment,a),i=!0)},o(a){k(e.$$.fragment,a),i=!1},d(a){a&&(w(t),w(r),w(n),w(s)),F(e,a)}}}var Kd=class extends K{constructor(e){super(),G(this,e,null,WI,j,{},zI)}},Hy=Kd;var Al=require("obsidian");function jI(o){_e(o,"svelte-1rfjxfa",`.help-section.svelte-1rfjxfa{width:100%;padding:0 2rem;margin-bottom:2rem}.footer.svelte-1rfjxfa{padding:0 2rem;margin-bottom:2rem;text-align:center}.help-container.svelte-1rfjxfa{position:relative;max-width:640px;margin:0 auto}.why-signin.svelte-1rfjxfa:hover{background-color:transparent !important;box-shadow:none;color:var(--text-modifier-hover)}.why-signin.svelte-1rfjxfa{outline:0;color:var(--text-muted);font-size:0.875rem;margin:0;background-color:transparent !important;box-shadow:none;text-decoration-line:var(--link-decoration);padding:0;border:none;cursor:pointer;width:100%;text-align:left}.why-signin.svelte-1rfjxfa:hover{color:var(--text-normal)}.help-content.svelte-1rfjxfa{margin-top:8px;padding:12px 16px;background:var(--color-base-05);border-radius:4px;font-size:0.9em;color:var(--text-muted);box-shadow:inset 0 1px 3px rgba(0, 0, 0, 0.1);text-align:left}.popover.svelte-1rfjxfa{position:absolute;z-index:50;width:256px;padding-left:1em;padding-right:1em;font-size:0.875rem;background-color:var(--background-primary);border:1px solid var(--background-modifier-border);border-radius:4px;box-shadow:var(--shadow-s);top:calc(100% + 8px);text-align:left;left:50%;transform:translateX(-50%);opacity:0;visibility:hidden;transition:opacity 0.3s ease,
			visibility 0.3s ease;transition-delay:0.1s}.popover.visible.svelte-1rfjxfa{opacity:1;visibility:visible}.popover.svelte-1rfjxfa:not(.visible){transition-delay:0s}.arrow.svelte-1rfjxfa{position:absolute;width:8px;height:8px;background-color:var(--background-primary);border-top:1px solid var(--background-modifier-border);border-left:1px solid var(--background-modifier-border);transform:rotate(45deg);top:-5px;right:40px}.discord-link.svelte-1rfjxfa{display:inline-flex;align-items:center;justify-content:center;gap:0.5rem;color:var(--text-muted);font-size:0.875rem;margin:0}`)}function KI(o){let e,t,r,n;return{c(){e=S("div"),t=S("div"),r=M(),n=S("p"),n.textContent=`${zy}`,h(t,"class","arrow svelte-1rfjxfa"),h(e,"class","popover svelte-1rfjxfa"),Me(e,"visible",o[0])},m(s,i){_(s,e,i),b(e,t),b(e,r),b(e,n),o[9](e)},p(s,i){i&1&&Me(e,"visible",s[0])},d(s){s&&w(e),o[9](null)}}}function GI(o){let e,t=o[0]&&qy(o);return{c(){t&&t.c(),e=ve()},m(r,n){t&&t.m(r,n),_(r,e,n)},p(r,n){r[0]?t?t.p(r,n):(t=qy(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&w(e),t&&t.d(r)}}}function qy(o){let e,t;return{c(){e=S("div"),t=S("p"),t.textContent=`${zy}`,h(e,"class","help-content svelte-1rfjxfa")},m(r,n){_(r,e,n),b(e,t)},p:q,d(r){r&&w(e)}}}function JI(o){let e,t,r,n,s,i,a,l,c,f,u,d;function m(g,v){return g[1]?GI:KI}let p=m(o,-1),y=p(o);return l=new Ll({}),{c(){e=S("div"),t=S("div"),r=S("button"),r.textContent="Why do I need to sign in?",n=M(),y.c(),s=M(),i=S("div"),a=S("a"),R(l.$$.fragment),c=B(`
		Join the project on Discord`),h(r,"class","why-signin svelte-1rfjxfa"),Me(r,"mobile",o[1]),h(t,"class","help-container svelte-1rfjxfa"),h(e,"class","help-section svelte-1rfjxfa"),h(a,"href","https://discord.system3.md"),h(a,"class","discord-link svelte-1rfjxfa"),h(i,"class","footer svelte-1rfjxfa")},m(g,v){_(g,e,v),b(e,t),b(t,r),o[8](r),b(t,n),y.m(t,null),_(g,s,v),_(g,i,v),b(i,a),D(l,a,null),b(a,c),f=!0,u||(d=[z(r,"mouseenter",o[4]),z(r,"mouseleave",o[5]),z(r,"click",o[6])],u=!0)},p(g,[v]){(!f||v&2)&&Me(r,"mobile",g[1]),p===(p=m(g,v))&&y?y.p(g,v):(y.d(1),y=p(g),y&&(y.c(),y.m(t,null)))},i(g){f||(x(l.$$.fragment,g),f=!0)},o(g){k(l.$$.fragment,g),f=!1},d(g){g&&(w(e),w(s),w(i)),o[8](null),y.d(),F(l),u=!1,we(d)}}}var zy="We require sign-in because your vault needs to communicate securely with Relay servers for syncing. Using an identity provider helps to prevent spam accounts and ensures secure authentication.";function YI(o,e,t){var r;let n=!1,s=!1,i,a;function l(){s||t(0,n=!0)}function c(){s||t(0,n=!1)}function f(){s&&t(0,n=!n)}function u(m){er[m?"unshift":"push"](()=>{i=m,t(2,i)})}function d(m){er[m?"unshift":"push"](()=>{a=m,t(3,a)})}return o.$$.update=()=>{if(o.$$.dirty&128){e:t(1,s=t(7,r=Al.Platform===null||Al.Platform===void 0?void 0:Al.Platform.isMobile)!==null&&r!==void 0?r:!1)}},[n,s,i,a,l,c,f,r,u,d]}var Gd=class extends K{constructor(e){super(),G(this,e,YI,JI,j,{},jI)}},Wy=Gd;var jy=[{color:"#30bced",light:"#30bced33"},{color:"#6eeb83",light:"#6eeb8333"},{color:"#ffbc42",light:"#ffbc4233"},{color:"#ecd444",light:"#ecd44433"},{color:"#ee6352",light:"#ee635233"},{color:"#9ac2c9",light:"#9ac2c933"},{color:"#8acb88",light:"#8acb8833"},{color:"#1be7ff",light:"#1be7ff33"}],Ml=class{constructor(e,t,r,n,s){this.id=e;this.name=t;this.email=r;this.picture=n;this.token=s;this.color=jy[ri()%jy.length]}};function QI(o){_e(o,"svelte-18fffd7",".avatar.svelte-18fffd7.svelte-18fffd7{position:relative;border-radius:50%;overflow:hidden;display:flex;align-items:center;justify-content:center;background-color:var(--color-base-30)}.avatar.svelte-18fffd7>img.svelte-18fffd7{margin:0px}.initial.svelte-18fffd7.svelte-18fffd7{color:var(--text-on-accent)}img.svelte-18fffd7.svelte-18fffd7{width:100%;height:100%;object-fit:cover}")}function ZI(o){let e,t;return{c(){e=S("span"),t=B(o[5]),h(e,"class","initial svelte-18fffd7"),ue(e,"font-size",o[4])},m(r,n){_(r,e,n),b(e,t)},p(r,n){n&32&&Y(t,r[5]),n&16&&ue(e,"font-size",r[4])},d(r){r&&w(e)}}}function XI(o){let e,t,r,n;return{c(){e=S("img"),Xo(e.src,t=o[0].picture)||h(e,"src",t),h(e,"alt",o[1]),h(e,"referrerpolicy","no-referrer"),h(e,"class","svelte-18fffd7")},m(s,i){_(s,e,i),r||(n=z(e,"error",o[6]),r=!0)},p(s,i){i&1&&!Xo(e.src,t=s[0].picture)&&h(e,"src",t),i&2&&h(e,"alt",s[1])},d(s){s&&w(e),r=!1,n()}}}function eC(o){let e;function t(s,i){return!s[3]&&s[0].picture?XI:ZI}let r=t(o,-1),n=r(o);return{c(){e=S("div"),n.c(),h(e,"class","avatar svelte-18fffd7"),ue(e,"width",o[2]),ue(e,"height",o[2])},m(s,i){_(s,e,i),n.m(e,null)},p(s,[i]){r===(r=t(s,i))&&n?n.p(s,i):(n.d(1),n=r(s),n&&(n.c(),n.m(e,null))),i&4&&ue(e,"width",s[2]),i&4&&ue(e,"height",s[2])},i:q,o:q,d(s){s&&w(e),n.d()}}}function tC(o){var e;return((e=o.match(/[a-z]+$/i))===null||e===void 0?void 0:e[0])||"px"}function rC(o,e,t){let r,n,s,{user:i}=e,{alt:a="Profile picture"}=e,{size:l="40px"}=e,c=!1;function f(){t(3,c=!0)}return o.$$set=u=>{"user"in u&&t(0,i=u.user),"alt"in u&&t(1,a=u.alt),"size"in u&&t(2,l=u.size)},o.$$.update=()=>{if(o.$$.dirty&1){e:t(5,r=i.name?i.name.charAt(0).toUpperCase():"?")}if(o.$$.dirty&4){e:t(7,n=tC(l))}if(o.$$.dirty&132){e:t(4,s=`${parseFloat(l)/2}${n}`)}},[i,a,l,c,s,r,f,n]}var Jd=class extends K{constructor(e){super(),G(this,e,rC,eC,j,{user:0,alt:1,size:2},QI)}},Ky=Jd;var c8=require("obsidian");function oC(o){_e(o,"svelte-zlums1",".setting-item-control.svelte-zlums1{width:unset !important;margin-top:unset !important}.setting-item.svelte-zlums1{flex-direction:unset !important;align-items:flex-start}.setting-item-info.svelte-zlums1{min-width:0;margin-top:auto;margin-bottom:auto}")}function nC(o){let e,t,r,n,s,i=(o[0].name||"")+"",a,l,c,f,u=(o[0].email||"")+"",d,m,p,y;t=new Ky({props:{size:"2.5em",user:o[0]}});let g=o[2].default,v=me(g,o,o[1],null);return{c(){e=S("div"),R(t.$$.fragment),r=M(),n=S("div"),s=S("div"),a=B(i),l=M(),c=S("br"),f=M(),d=B(u),m=M(),p=S("div"),v&&v.c(),h(s,"class","setting-item-description"),h(n,"class","setting-item-info svelte-zlums1"),ue(n,"display","grid"),h(p,"class","setting-item-control svelte-zlums1"),h(e,"class","setting-item svelte-zlums1")},m(C,L){_(C,e,L),D(t,e,null),b(e,r),b(e,n),b(n,s),b(s,a),b(s,l),b(s,c),b(s,f),b(s,d),b(e,m),b(e,p),v&&v.m(p,null),y=!0},p(C,[L]){let T={};L&1&&(T.user=C[0]),t.$set(T),(!y||L&1)&&i!==(i=(C[0].name||"")+"")&&Y(a,i),(!y||L&1)&&u!==(u=(C[0].email||"")+"")&&Y(d,u),v&&v.p&&(!y||L&2)&&ge(v,g,C,C[1],y?he(g,C[1],L,null):ye(C[1]),null)},i(C){y||(x(t.$$.fragment,C),x(v,C),y=!0)},o(C){k(t.$$.fragment,C),k(v,C),y=!1},d(C){C&&w(e),F(t),v&&v.d(C)}}}function sC(o,e,t){let{$$slots:r={},$$scope:n}=e,{user:s}=e;return o.$$set=i=>{"user"in i&&t(0,s=i.user),"$$scope"in i&&t(1,n=i.$$scope)},[s,n,r]}var Yd=class extends K{constructor(e){super(),G(this,e,sC,nC,j,{user:0},oC)}},El=Yd;var Pl=require("obsidian");function iC(o){_e(o,"svelte-1da9go9",".help-container.svelte-1da9go9.svelte-1da9go9{position:relative;display:inline-block}button.svelte-1da9go9.svelte-1da9go9{display:flex;align-items:center;justify-content:center;width:24px;height:24px;padding:2px;margin:0;background:transparent;border:none;color:var(--text-muted);box-shadow:none;border-radius:50%}button.svelte-1da9go9.svelte-1da9go9:hover{box-shadow:none;color:var(--icon-color-hover);opacity:var(--icon-opacity-hover);background-color:transparent;border-radius:0}button.svelte-1da9go9.svelte-1da9go9:focus{outline:none;box-shadow:none;color:var(--icon-color-focus)}.help-container.svelte-1da9go9>.popover.svelte-1da9go9{position:absolute;z-index:70;width:256px;padding:8px;font-size:0.875rem;background-color:var(--background-primary);border:1px solid var(--background-modifier-border);border-radius:4px;box-shadow:var(--shadow-s);top:32px;transition-delay:0.1s}.help-container.svelte-1da9go9>.popover.left.svelte-1da9go9{right:100%;margin-right:8px}.help-container.svelte-1da9go9>.popover.right.svelte-1da9go9{left:0}.arrow.svelte-1da9go9.svelte-1da9go9{position:absolute;width:8px;height:8px;background-color:var(--background-primary);border-top:1px solid var(--background-modifier-border);border-left:1px solid var(--background-modifier-border);transform:rotate(45deg);top:-5px}.arrow.left.svelte-1da9go9.svelte-1da9go9{right:8px}.arrow.right.svelte-1da9go9.svelte-1da9go9{left:8px}p.svelte-1da9go9.svelte-1da9go9{margin:0;color:var(--text-normal)}")}function Gy(o){let e,t,r,n,s;return{c(){e=S("div"),t=S("div"),r=M(),n=S("p"),s=B(o[0]),h(t,"class","arrow svelte-1da9go9"),Me(t,"left",o[4]==="left"),Me(t,"right",o[4]==="right"),h(n,"class","svelte-1da9go9"),h(e,"class","popover svelte-1da9go9"),Me(e,"left",o[4]==="left"),Me(e,"right",o[4]==="right")},m(i,a){_(i,e,a),b(e,t),b(e,r),b(e,n),b(n,s),o[9](e)},p(i,a){a&16&&Me(t,"left",i[4]==="left"),a&16&&Me(t,"right",i[4]==="right"),a&1&&Y(s,i[0]),a&16&&Me(e,"left",i[4]==="left"),a&16&&Me(e,"right",i[4]==="right")},d(i){i&&w(e),o[9](null)}}}function aC(o){let e,t,r,n,s,i,a;r=new Oi({props:{size:16}});let l=o[1]&&Gy(o);return{c(){e=S("div"),t=S("button"),R(r.$$.fragment),n=M(),l&&l.c(),h(t,"type","button"),h(t,"class","svelte-1da9go9"),h(e,"class","help-container svelte-1da9go9")},m(c,f){_(c,e,f),b(e,t),D(r,t,null),o[8](t),b(e,n),l&&l.m(e,null),s=!0,i||(a=[z(t,"mouseenter",o[5]),z(t,"mouseleave",o[6]),z(t,"click",o[7])],i=!0)},p(c,[f]){c[1]?l?l.p(c,f):(l=Gy(c),l.c(),l.m(e,null)):l&&(l.d(1),l=null)},i(c){s||(x(r.$$.fragment,c),s=!0)},o(c){k(r.$$.fragment,c),s=!1},d(c){c&&w(e),F(r),o[8](null),l&&l.d(),i=!1,we(a)}}}function lC(o,e,t){let{helpText:r}=e,n=!1,s="right",i,a;function l(){t(1,n=!0)}function c(){t(1,n=!1)}function f(){t(1,n=!n)}function u(m){er[m?"unshift":"push"](()=>{i=m,t(2,i)})}function d(m){er[m?"unshift":"push"](()=>{a=m,t(3,a)})}return o.$$set=m=>{"helpText"in m&&t(0,r=m.helpText)},o.$$.update=()=>{if(o.$$.dirty&14){e:if(n&&i&&a){let m=i.getBoundingClientRect(),p=a.getBoundingClientRect(),y=window.innerWidth;t(4,s=m.right+p.width>y-20?"left":"right")}}},[r,n,i,a,s,l,c,f,u,d]}var Qd=class extends K{constructor(e){super(),G(this,e,lC,aC,j,{helpText:0},iC)}},Jy=Qd;function cC(o){_e(o,"svelte-5o4y9d",".setting-item-name.svelte-5o4y9d{display:flex;align-items:center;gap:8px;overflow:unset}.help-button.svelte-5o4y9d{display:flex;align-items:center;justify-content:center;width:24px;height:24px;padding:2px !important;margin:0;background:transparent;border:none;color:var(--text-muted);border-radius:50%;-webkit-tap-highlight-color:transparent}@media(hover: hover){.help-button.svelte-5o4y9d:hover{box-shadow:none;color:var(--text-normal);background:transparent;border-radius:0}}.help-button.svelte-5o4y9d:active{color:var(--text-normal)}.help-content.svelte-5o4y9d{margin-top:8px;padding:12px 16px;background:var(--color-base-05);border-radius:4px;font-size:0.9em;color:var(--text-muted);box-shadow:inset 0 1px 3px rgba(0, 0, 0, 0.1)}p.svelte-5o4y9d{margin:0}")}var fC=o=>({}),Yy=o=>({}),uC=o=>({}),Qy=o=>({}),dC=o=>({}),Zy=o=>({});function pC(o){let e;return{c(){e=B(o[0])},m(t,r){_(t,e,r)},p(t,r){r&1&&Y(e,t[0])},d(t){t&&w(e)}}}function Xy(o){let e,t,r,n,s=[hC,mC],i=[];function a(l,c){return l[3]?0:1}return e=a(o,-1),t=i[e]=s[e](o),{c(){t.c(),r=ve()},m(l,c){i[e].m(l,c),_(l,r,c),n=!0},p(l,c){let f=e;e=a(l,c),e===f?i[e].p(l,c):(ie(),k(i[f],1,1,()=>{i[f]=null}),ae(),t=i[e],t?t.p(l,c):(t=i[e]=s[e](l),t.c()),x(t,1),t.m(r.parentNode,r))},i(l){n||(x(t),n=!0)},o(l){k(t),n=!1},d(l){l&&w(r),i[e].d(l)}}}function mC(o){let e,t;return e=new Jy({props:{helpText:o[1]}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n&2&&(s.helpText=r[1]),e.$set(s)},i(r){t||(x(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function hC(o){let e,t,r,n,s;return t=new Oi({props:{size:16}}),{c(){e=S("button"),R(t.$$.fragment),h(e,"class","help-button svelte-5o4y9d"),h(e,"aria-expanded",o[2])},m(i,a){_(i,e,a),D(t,e,null),r=!0,n||(s=z(e,"click",o[4]),n=!0)},p(i,a){(!r||a&4)&&h(e,"aria-expanded",i[2])},i(i){r||(x(t.$$.fragment,i),r=!0)},o(i){k(t.$$.fragment,i),r=!1},d(i){i&&w(e),F(t),n=!1,s()}}}function gC(o){let e,t,r=o[7].description,n=me(r,o,o[6],Yy);return{c(){e=S("div"),n&&n.c(),h(e,"class","setting-item-description")},m(s,i){_(s,e,i),n&&n.m(e,null),t=!0},p(s,i){n&&n.p&&(!t||i&64)&&ge(n,r,s,s[6],t?he(r,s[6],i,fC):ye(s[6]),Yy)},i(s){t||(x(n,s),t=!0)},o(s){k(n,s),t=!1},d(s){s&&w(e),n&&n.d(s)}}}function ex(o){let e,t,r;return{c(){e=S("div"),t=S("p"),r=B(o[1]),h(t,"class","svelte-5o4y9d"),h(e,"class","help-content svelte-5o4y9d"),Me(e,"expanded",o[2])},m(n,s){_(n,e,s),b(e,t),b(t,r)},p(n,s){s&2&&Y(r,n[1]),s&4&&Me(e,"expanded",n[2])},d(n){n&&w(e)}}}function yC(o){let e,t,r,n,s,i,a,l,c,f=o[7].name,u=me(f,o,o[6],Zy),d=u||pC(o),m=o[1]&&Xy(o),p=o[7].description,y=me(p,o,o[6],Qy),g=y||gC(o),v=o[1]&&o[2]&&o[3]&&ex(o),C=o[7].default,L=me(C,o,o[6],null);return{c(){e=S("div"),t=S("div"),r=S("div"),d&&d.c(),n=M(),m&&m.c(),s=M(),g&&g.c(),i=M(),v&&v.c(),a=M(),l=S("div"),L&&L.c(),h(r,"class","setting-item-name svelte-5o4y9d"),h(t,"class","setting-item-info"),h(l,"class","setting-item-control"),h(e,"class","setting-item setting-item-heading mod-list-item")},m(T,E){_(T,e,E),b(e,t),b(t,r),d&&d.m(r,null),b(r,n),m&&m.m(r,null),b(t,s),g&&g.m(t,null),b(t,i),v&&v.m(t,null),b(e,a),b(e,l),L&&L.m(l,null),c=!0},p(T,[E]){u?u.p&&(!c||E&64)&&ge(u,f,T,T[6],c?he(f,T[6],E,dC):ye(T[6]),Zy):d&&d.p&&(!c||E&1)&&d.p(T,c?E:-1),T[1]?m?(m.p(T,E),E&2&&x(m,1)):(m=Xy(T),m.c(),x(m,1),m.m(r,null)):m&&(ie(),k(m,1,1,()=>{m=null}),ae()),y?y.p&&(!c||E&64)&&ge(y,p,T,T[6],c?he(p,T[6],E,uC):ye(T[6]),Qy):g&&g.p&&(!c||E&64)&&g.p(T,c?E:-1),T[1]&&T[2]&&T[3]?v?v.p(T,E):(v=ex(T),v.c(),v.m(t,null)):v&&(v.d(1),v=null),L&&L.p&&(!c||E&64)&&ge(L,C,T,T[6],c?he(C,T[6],E,null):ye(T[6]),null)},i(T){c||(x(d,T),x(m),x(g,T),x(L,T),c=!0)},o(T){k(d,T),k(m),k(g,T),k(L,T),c=!1},d(T){T&&w(e),d&&d.d(T),m&&m.d(),g&&g.d(T),v&&v.d(),L&&L.d(T)}}}function xC(o,e,t){let{$$slots:r={},$$scope:n}=e;var s;let{name:i=""}=e,{helpText:a=void 0}=e,l=!1,c=!1;function f(){c&&t(2,l=!l)}return o.$$set=u=>{"name"in u&&t(0,i=u.name),"helpText"in u&&t(1,a=u.helpText),"$$scope"in u&&t(6,n=u.$$scope)},o.$$.update=()=>{if(o.$$.dirty&32){e:t(3,c=t(5,s=Pl.Platform===null||Pl.Platform===void 0?void 0:Pl.Platform.isMobile)!==null&&s!==void 0?s:!1)}},[i,a,l,c,f,s,n,r]}var Zd=class extends K{constructor(e){super(),G(this,e,xC,yC,j,{name:0,helpText:1},cC)}},qe=Zd;var Us=[];function bC(o,e){return{subscribe:xe(o,e).subscribe}}function xe(o,e=q){let t,r=new Set;function n(a){if(j(o,a)&&(o=a,t)){let l=!Us.length;for(let c of r)c[1](),Us.push(c,o);if(l){for(let c=0;c<Us.length;c+=2)Us[c][0](Us[c+1]);Us.length=0}}}function s(a){n(a(o))}function i(a,l=q){let c=[a,l];return r.add(c),r.size===1&&(t=e(n,s)||q),a(o),()=>{r.delete(c),r.size===0&&t&&(t(),t=null)}}return{set:n,update:s,subscribe:i}}function Ot(o,e,t){let r=!Array.isArray(o),n=r?[o]:o;if(!n.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");let s=e.length<2;return bC(t,(i,a)=>{let l=!1,c=[],f=0,u=q,d=()=>{if(f)return;u();let p=e(r?c[0]:c,i,a);s?i(p):u=ze(p)?p:q},m=n.map((p,y)=>Dt(p,g=>{c[y]=g,f&=~(1<<y),l&&d()},()=>{f|=1<<y}));return l=!0,d(),function(){we(m),u(),l=!1}})}function tx(o){let e=o-1;return e*e*e+1}function Rn(o){return--o*o*o*o*o+1}function Un(o,{delay:e=0,duration:t=400,easing:r=tx,axis:n="y"}={}){let s=getComputedStyle(o),i=+s.opacity,a=n==="y"?"height":"width",l=parseFloat(s[a]),c=n==="y"?["top","bottom"]:["left","right"],f=c.map(v=>`${v[0].toUpperCase()}${v.slice(1)}`),u=parseFloat(s[`padding${f[0]}`]),d=parseFloat(s[`padding${f[1]}`]),m=parseFloat(s[`margin${f[0]}`]),p=parseFloat(s[`margin${f[1]}`]),y=parseFloat(s[`border${f[0]}Width`]),g=parseFloat(s[`border${f[1]}Width`]);return{delay:e,duration:t,easing:r,css:v=>`overflow: hidden;opacity: ${Math.min(v*20,1)*i};${a}: ${v*l}px;padding-${c[0]}: ${v*u}px;padding-${c[1]}: ${v*d}px;margin-${c[0]}: ${v*m}px;margin-${c[1]}: ${v*p}px;border-${c[0]}-width: ${v*y}px;border-${c[1]}-width: ${v*g}px;`}}function vC(o){_e(o,"svelte-umtfyz",`.continue.svelte-umtfyz{font-weight:600;font-size:larger;margin-top:0;margin-bottom:0px}.link.svelte-umtfyz{color:var(--text-muted)}.link.svelte-umtfyz:hover{color:var(--text-normal)}.not-working.svelte-umtfyz{margin-top:0px;margin-bottom:0px;color:var(--text-faint);font-size:0.75em}.link-button.svelte-umtfyz{box-shadow:none;background:none;border:none;padding:0;font:inherit;text-decoration:underline}button.link-button.svelte-umtfyz:hover{box-shadow:none;color:var(--text-normal)}button.link.link-button.svelte-umtfyz{height:auto;padding:0}.welcome.svelte-umtfyz{display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:7rem 2rem 1rem 2rem;max-width:640px;margin:0 auto;gap:2rem}.google-sign-in-button.svelte-umtfyz{width:100%;height:unset;padding:12px 16px 12px 42px !important;border:none;border-radius:3px;box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25);color:var(--text-color);font-size:14px;font-weight:500;font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu,
			Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;background-image:url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48cGF0aCBkPSJNMTcuNiA5LjJsLS4xLTEuOEg5djMuNGg0LjhDMTMuNiAxMiAxMyAxMyAxMiAxMy42djIuMmgzYTguOCA4LjggMCAwIDAgMi42LTYuNnoiIGZpbGw9IiM0Mjg1RjQiIGZpbGwtcnVsZT0ibm9uemVybyIvPjxwYXRoIGQ9Ik05IDE4YzIuNCAwIDQuNS0uOCA2LTIuMmwtMy0yLjJhNS40IDUuNCAwIDAgMS04LTIuOUgxVjEzYTkgOSAwIDAgMCA4IDV6IiBmaWxsPSIjMzRBODUzIiBmaWxsLXJ1bGU9Im5vbnplcm8iLz48cGF0aCBkPSJNNCAxMC43YTUuNCA1LjQgMCAwIDEgMC0zLjRWNUgxYTkgOSAwIDAgMCAwIDhsMy0yLjN6IiBmaWxsPSIjRkJCQzA1IiBmaWxsLXJ1bGU9Im5vbnplcm8iLz48cGF0aCBkPSJNOSAzLjZjMS4zIDAgMi41LjQgMy40IDEuM0wxNSAyLjNBOSA5IDAgMCAwIDEgNWwzIDIuNGE1LjQgNS40IDAgMCAxIDUtMy43eiIgZmlsbD0iI0VBNDMzNSIgZmlsbC1ydWxlPSJub256ZXJvIi8+PHBhdGggZD0iTTAgMGgxOHYxOEgweiIvPjwvZz48L3N2Zz4=);background-color:var(--background-secondary);background-repeat:no-repeat;background-position:12px 11px}.google-sign-in-button.svelte-umtfyz:hover{box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 2px 4px rgba(0, 0, 0, 0.25)}.google-sign-in-button.svelte-umtfyz:disabled{cursor:unset;filter:grayscale(100%);box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25)}.discord-sign-in-button.svelte-umtfyz{width:100%;height:unset;padding:12px 16px 12px 42px !important;border:none;border-radius:3px;box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25);color:var(--text-color);font-size:14px;font-weight:500;font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu,
			Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;background-image:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyAgIHdpZHRoPSIxOCIgICBoZWlnaHQ9IjE4IiAgIHZpZXdCb3g9Ii0xNSAtMTUgMjg2IDI4NiIgICBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJ4TWlkWU1pZCIgICB2ZXJzaW9uPSIxLjEiICAgaWQ9InN2ZzYiICAgc29kaXBvZGk6ZG9jbmFtZT0iZGlzY29yZC5zdmciICAgaW5rc2NhcGU6dmVyc2lvbj0iMS4xLjIgKDBhMDBjZjUzMzksIDIwMjItMDItMDQpIiAgIHhtbG5zOmlua3NjYXBlPSJodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy9uYW1lc3BhY2VzL2lua3NjYXBlIiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIgICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciICAgeG1sbnM6c3ZnPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+ICA8ZGVmcyAgICAgaWQ9ImRlZnMxMCIgLz4gIDxzb2RpcG9kaTpuYW1lZHZpZXcgICAgIGlkPSJuYW1lZHZpZXc4IiAgICAgcGFnZWNvbG9yPSIjZmZmZmZmIiAgICAgYm9yZGVyY29sb3I9IiM2NjY2NjYiICAgICBib3JkZXJvcGFjaXR5PSIxLjAiICAgICBpbmtzY2FwZTpwYWdlc2hhZG93PSIyIiAgICAgaW5rc2NhcGU6cGFnZW9wYWNpdHk9IjAuMCIgICAgIGlua3NjYXBlOnBhZ2VjaGVja2VyYm9hcmQ9IjAiICAgICBzaG93Z3JpZD0iZmFsc2UiICAgICBpbmtzY2FwZTp6b29tPSIyNC4yNSIgICAgIGlua3NjYXBlOmN4PSI0LjM3MTEzNCIgICAgIGlua3NjYXBlOmN5PSIxNC40NTM2MDgiICAgICBpbmtzY2FwZTp3aW5kb3ctd2lkdGg9IjE4OTAiICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSIxMDY0IiAgICAgaW5rc2NhcGU6d2luZG93LXg9IjE4OTAiICAgICBpbmtzY2FwZTp3aW5kb3cteT0iMTA5NiIgICAgIGlua3NjYXBlOndpbmRvdy1tYXhpbWl6ZWQ9IjAiICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJzdmc2IiAvPiAgPGcgICAgIGlkPSJnNCIgICAgIHRyYW5zZm9ybT0ibWF0cml4KDEuMDg4NzYxMiwwLDAsMS4wNDc4NTU0LC0xMC40NTgyNzYsMzMuNDI2NTI1KSI+ICAgIDxwYXRoICAgICAgIGQ9Ik0gMjE2Ljg1NjM0LDE2LjU5NjYwMyBDIDIwMC4yODUsOC44NDMyODY3IDE4Mi41NjYxNCwzLjIwODQ5ODggMTY0LjA0MTU2LDAgYyAtMi4yNzUwNCw0LjExMzE4MTEgLTQuOTMyOTQsOS42NDU0OTkxIC02Ljc2NTQ2LDE0LjA0NjQzOCAtMTkuNjkyMTEsLTIuOTYxNDQ4IC0zOS4yMDMxMywtMi45NjE0NDggLTU4LjUzMzA4NCwwIEMgOTYuOTEwODQyLDkuNjQ1NDk5MSA5NC4xOTI1ODQsNC4xMTMxODExIDkxLjg5NzE4OSwwIDczLjM1MjYwNywzLjIwODQ5ODggNTUuNjEzMzk1LDguODYzOTkxMiAzOS4wNDIwNTgsMTYuNjM3NjYxIDUuNjE3NTIyOSw2Ny4xNDY1MTQgLTMuNDQzMzE5MSwxMTYuNDAwODEgMS4wODcxMTA3LDE2NC45NTU3MiAyMy4yNTYwMiwxODEuNTEwOTEgNDQuNzQwMzYzLDE5MS41Njc3IDY1Ljg2MjEzMywxOTguMTQ4NTggYyA1LjIxNTA4MiwtNy4xNzc0NSA5Ljg2NjIzLC0xNC44MDcyNSAxMy44NzMwODEsLTIyLjg0ODMyIC03LjYzMTE5NSwtMi44OTk2OSAtMTQuOTQwMjQyLC02LjQ3ODA2IC0yMS44NDY0MjcsLTEwLjYzMjMgMS44MzIxNzQsLTEuMzU3MzcgMy42MjQzNDMsLTIuNzc2NTEgNS4zNTU4MDMsLTQuMjM2NyA0Mi4xMjI4MiwxOS43MDE5MyA4Ny44OTAzNCwxOS43MDE5MyAxMjkuNTA5OTMsMCAxLjc1MTgyLDEuNDYwMTkgMy41NDM2MywyLjg3OTMzIDUuMzU1ODEsNC4yMzY3IC02LjkyNjU0LDQuMTc0NiAtMTQuMjU1NTksNy43NTI5NyAtMjEuODg2NzksMTAuNjUzIDQuMDA2ODUsOC4wMjAzNyA4LjYzOCwxNS42NzA4NyAxMy44NzMwOCwyMi44NDc5NyAyMS4xNDIxMywtNi41ODA4OCA0Mi42NDY0LC0xNi42MzczMSA2NC44MTUzMywtMzMuMjEzMjEgNS4zMTU4LC01Ni4yODc1MiAtOS4wODA4NiwtMTA1LjA4OTQ3NyAtMzguMDU1NjEsLTE0OC4zNTkxMTcgeiBNIDg1LjQ3Mzg3NSwxMzUuMDk0ODkgYyAtMTIuNjQ0ODQ3LDAgLTIzLjAxNDY1MywtMTEuODA0NzMgLTIzLjAxNDY1MywtMjYuMTc5OTkgMCwtMTQuMzc1MjUzIDEwLjE0ODM3MywtMjYuMjAwMzQxIDIzLjAxNDY1MywtMjYuMjAwMzQxIDEyLjg2NjYzMSwwIDIzLjIzNjA4NSwxMS44MDQzODQgMjMuMDE0NjU1LDI2LjIwMDM0MSAwLjAyLDE0LjM3NTI2IC0xMC4xNDgwMjQsMjYuMTc5OTkgLTIzLjAxNDY1NSwyNi4xNzk5OSB6IG0gODUuMDUxMzY1LDAgYyAtMTIuNjQ0ODUsMCAtMjMuMDE0NjYsLTExLjgwNDczIC0yMy4wMTQ2NiwtMjYuMTc5OTkgMCwtMTQuMzc1MjUzIDEwLjE0ODAzLC0yNi4yMDAzNDEgMjMuMDE0NjYsLTI2LjIwMDM0MSAxMi44NjYyOCwwIDIzLjIzNjA4LDExLjgwNDM4NCAyMy4wMTQ2NSwyNi4yMDAzNDEgMCwxNC4zNzUyNiAtMTAuMTQ4MzcsMjYuMTc5OTkgLTIzLjAxNDY1LDI2LjE3OTk5IHoiICAgICAgIGZpbGw9IiM1ODY1ZjIiICAgICAgIGZpbGwtcnVsZT0ibm9uemVybyIgICAgICAgaWQ9InBhdGgyIiAvPiAgPC9nPjwvc3ZnPg==);background-color:var(--background-secondary);background-repeat:no-repeat;background-position:12px 11px}.discord-sign-in-button.svelte-umtfyz:hover{box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 2px 4px rgba(0, 0, 0, 0.25)}.discord-sign-in-button.svelte-umtfyz:disabled{cursor:unset;filter:grayscale(100%);box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25)}.microsoft-sign-in-button.svelte-umtfyz{width:100%;height:unset;padding:12px 16px 12px 42px !important;border:none;border-radius:3px;box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25);color:var(--text-color);font-size:14px;font-weight:500;font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu,
			Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;background-image:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48c3ZnIHdpZHRoPSIxOHB4IiBoZWlnaHQ9IjE4cHgiIHZpZXdCb3g9Ii0xNSAtMTUgMjg2IDI4NiIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHByZXNlcnZlQXNwZWN0UmF0aW89InhNaWRZTWlkIj4gICAgPHRpdGxlPk1pY3Jvc29mdDwvdGl0bGU+ICAgIDxnPiAgICAgICAgPHBvbHlnb24gZmlsbD0iI0YxNTExQiIgcG9pbnRzPSIxMjEuNjY2MDk1IDEyMS42NjYwOTUgMCAxMjEuNjY2MDk1IDAgMCAxMjEuNjY2MDk1IDAiLz4gICAgICAgIDxwb2x5Z29uIGZpbGw9IiM4MENDMjgiIHBvaW50cz0iMjU2IDEyMS42NjYwOTUgMTM0LjMzNTM1NiAxMjEuNjY2MDk1IDEzNC4zMzUzNTYgMCAyNTYgMCIvPiAgICAgICAgPHBvbHlnb24gZmlsbD0iIzAwQURFRiIgcG9pbnRzPSIxMjEuNjYzMTk0IDI1Ni4wMDIxODggMCAyNTYuMDAyMTg4IDAgMTM0LjMzNjA5NSAxMjEuNjYzMTk0IDEzNC4zMzYwOTUiLz4gICAgICAgIDxwb2x5Z29uIGZpbGw9IiNGQkJDMDkiIHBvaW50cz0iMjU2IDI1Ni4wMDIxODggMTM0LjMzNTM1NiAyNTYuMDAyMTg4IDEzNC4zMzUzNTYgMTM0LjMzNjA5NSAyNTYgMTM0LjMzNjA5NSIvPiAgICA8L2c+PC9zdmc+);background-color:var(--background-secondary);background-repeat:no-repeat;background-position:12px 11px}.microsoft-sign-in-button.svelte-umtfyz:hover{box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 2px 4px rgba(0, 0, 0, 0.25)}.microsoft-sign-in-button.svelte-umtfyz:disabled{cursor:unset;filter:grayscale(100%);box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25)}.github-sign-in-button.svelte-umtfyz{width:100%;height:unset;padding:12px 16px 12px 42px !important;border:none;border-radius:3px;box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25);color:var(--text-color);font-size:14px;font-weight:500;font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu,
			Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;background-image:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcKICAgd2lkdGg9IjE2LjE5NjU4NSIKICAgaGVpZ2h0PSIxNS42NTQ3NjgiCiAgIGZpbGw9Im5vbmUiCiAgIHZlcnNpb249IjEuMSIKICAgaWQ9InN2ZzQiCiAgIHNvZGlwb2RpOmRvY25hbWU9ImdoLnN2ZyIKICAgaW5rc2NhcGU6dmVyc2lvbj0iMS4xLjIgKDBhMDBjZjUzMzksIDIwMjItMDItMDQpIgogICB4bWxuczppbmtzY2FwZT0iaHR0cDovL3d3dy5pbmtzY2FwZS5vcmcvbmFtZXNwYWNlcy9pbmtzY2FwZSIKICAgeG1sbnM6c29kaXBvZGk9Imh0dHA6Ly9zb2RpcG9kaS5zb3VyY2Vmb3JnZS5uZXQvRFREL3NvZGlwb2RpLTAuZHRkIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogIDxkZWZzCiAgICAgaWQ9ImRlZnM4IiAvPgogIDxzb2RpcG9kaTpuYW1lZHZpZXcKICAgICBpZD0ibmFtZWR2aWV3NiIKICAgICBwYWdlY29sb3I9IiNmZmZmZmYiCiAgICAgYm9yZGVyY29sb3I9IiM2NjY2NjYiCiAgICAgYm9yZGVyb3BhY2l0eT0iMS4wIgogICAgIGlua3NjYXBlOnBhZ2VzaGFkb3c9IjIiCiAgICAgaW5rc2NhcGU6cGFnZW9wYWNpdHk9IjAuMCIKICAgICBpbmtzY2FwZTpwYWdlY2hlY2tlcmJvYXJkPSIwIgogICAgIHNob3dncmlkPSJmYWxzZSIKICAgICBmaXQtbWFyZ2luLXRvcD0iMCIKICAgICBmaXQtbWFyZ2luLWxlZnQ9IjAiCiAgICAgZml0LW1hcmdpbi1yaWdodD0iMCIKICAgICBmaXQtbWFyZ2luLWJvdHRvbT0iMCIKICAgICBpbmtzY2FwZTp6b29tPSI0OC41IgogICAgIGlua3NjYXBlOmN4PSI4IgogICAgIGlua3NjYXBlOmN5PSI4LjAxMDMwOTMiCiAgICAgaW5rc2NhcGU6d2luZG93LXdpZHRoPSIzNzY0IgogICAgIGlua3NjYXBlOndpbmRvdy1oZWlnaHQ9IjIxMTIiCiAgICAgaW5rc2NhcGU6d2luZG93LXg9IjgiCiAgICAgaW5rc2NhcGU6d2luZG93LXk9IjQwIgogICAgIGlua3NjYXBlOndpbmRvdy1tYXhpbWl6ZWQ9IjAiCiAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0ic3ZnNCIgLz4KICA8cGF0aAogICAgIGZpbGwtcnVsZT0iZXZlbm9kZCIKICAgICBjbGlwLXJ1bGU9ImV2ZW5vZGQiCiAgICAgZD0ibSA4LjAwMTc3OTksMC4wMDIzNzIxNiBhIDgsOCAwIDAgMCAtMi41MywxNS41ODk5OTk4NCBjIDAuNCwwLjA3IDAuNTUsLTAuMTcgMC41NSwtMC4zOCB2IC0xLjMzIGMgLTIuMjIsMC40OCAtMi42OSwtMS4wNyAtMi42OSwtMS4wNyAtMC4zNiwtMC45MiAtMC44OCwtMS4xNyAtMC44OCwtMS4xNyAtMC43MywtMC40OSAwLjA1LC0wLjQ4IDAuMDUsLTAuNDggMC44LDAuMDYgMS4yMywwLjgzIDEuMjMsMC44MyAwLjcyLDEuMjMgMS44OCwwLjg3IDIuMzMsMC42NiAwLjA3LC0wLjUyIDAuMjgsLTAuODcgMC41MSwtMS4wNyAtMS43OCwtMC4yIC0zLjY1LC0wLjg5IC0zLjY1LC0zLjk0OTk5OTggMCwtMC44NyAwLjMxLC0xLjU4IDAuODIsLTIuMTQgLTAuMDgsLTAuMiAtMC4zNiwtMS4wMSAwLjA4LC0yLjEgMCwwIDAuNjcsLTAuMjIgMi4yLDAuODIgYSA3LjY1LDcuNjUgMCAwIDEgNC4wMDAwMDAxLDAgYyAxLjUzLC0xLjA0IDIuMiwtMC44MiAyLjIsLTAuODIgMC40NCwxLjA5IDAuMTYsMS45IDAuMDgsMi4xIDAuNTEsMC41NiAwLjgyLDEuMjcgMC44MiwyLjE0IDAsMy4wNjk5OTk4IC0xLjg3LDMuNzQ5OTk5OCAtMy42NTAwMDAxLDMuOTQ5OTk5OCAwLjI5LDAuMjUgMC41NDAwMDAxLDAuNzQgMC41NDAwMDAxLDEuNDggdiAyLjIgYyAwLDAuMjEgMC4xNSwwLjQ1IDAuNTUsMC4zOCBBIDgsOCAwIDAgMCA4LjAwMTc3OTksMC4wMDIzNzIxNiBaIgogICAgIGZpbGw9IiMyNDI5MmYiCiAgICAgaWQ9InBhdGgyIiAvPgo8L3N2Zz4K);background-color:var(--background-secondary);background-repeat:no-repeat;background-position:12px 11px}.github-sign-in-button.svelte-umtfyz:hover{box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 2px 4px rgba(0, 0, 0, 0.25)}.github-sign-in-button.svelte-umtfyz:disabled{cursor:unset;filter:grayscale(100%);box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25)}.oidc-sign-in-button.svelte-umtfyz{width:100%;height:unset;padding:12px 16px 12px 42px !important;border:none;border-radius:3px;box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25);color:var(--text-color);font-size:14px;font-weight:500;font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu,
			Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;background-image:url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMTIgMkM2LjQ4IDIgMiA2LjQ4IDIgMTJzNC40OCAxMCAxMCAxMCAxMC00LjQ4IDEwLTEwUzE3LjUyIDIgMTIgMnoiIHN0cm9rZT0iIzYzNjM2MyIgc3Ryb2tlLXdpZHRoPSIyIi8+PHBhdGggZD0iTTggMTJoOE0xMiA4bDQgNC00IDQiIHN0cm9rZT0iIzYzNjM2MyIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L3N2Zz4=);background-color:var(--background-secondary);background-repeat:no-repeat;background-position:12px 11px}.oidc-sign-in-button.svelte-umtfyz:hover{box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 2px 4px rgba(0, 0, 0, 0.25)}.oidc-sign-in-button.svelte-umtfyz:disabled{cursor:unset;filter:grayscale(100%);box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25)}.login-buttons.svelte-umtfyz{display:flex;flex-direction:column;gap:0.85rem;padding:1rem;background:var(--background-modifier-border-hover);border-radius:0.5rem}.choose-another.svelte-umtfyz{text-align:center;margin-top:0.25rem;margin-bottom:1rem;font-size:0.85em;color:var(--text-normal)}`)}function rx(o,e,t){let r=o.slice();return r[57]=e[t],r}function ox(o,e,t){let r=o.slice();return r[57]=e[t],r}function wC(o){let e,t,r,n,s,i,a,l,c,f;t=new Hy({});let u=[kC,SC],d=[];function m(C,L){return C[5]?0:1}n=m(o,[-1,-1]),s=d[n]=u[n](o);function p(C,L){if(C[11])return TC;if(C[7])return LC}let y=p(o,[-1,-1]),g=y&&y(o),v=o[3].provider&&!o[7]&&ax(o);return c=new Wy({}),{c(){e=S("div"),R(t.$$.fragment),r=M(),s.c(),i=M(),g&&g.c(),a=M(),v&&v.c(),l=M(),R(c.$$.fragment),h(e,"class","welcome svelte-umtfyz")},m(C,L){_(C,e,L),D(t,e,null),b(e,r),d[n].m(e,null),b(e,i),g&&g.m(e,null),_(C,a,L),v&&v.m(C,L),_(C,l,L),D(c,C,L),f=!0},p(C,L){let T=n;n=m(C,L),n===T?d[n].p(C,L):(ie(),k(d[T],1,1,()=>{d[T]=null}),ae(),s=d[n],s?s.p(C,L):(s=d[n]=u[n](C),s.c()),x(s,1),s.m(e,i)),y===(y=p(C,L))&&g?g.p(C,L):(g&&g.d(1),g=y&&y(C),g&&(g.c(),g.m(e,null))),C[3].provider&&!C[7]?v?v.p(C,L):(v=ax(C),v.c(),v.m(l.parentNode,l)):v&&(v.d(1),v=null)},i(C){f||(x(t.$$.fragment,C),x(s),x(c.$$.fragment,C),f=!0)},o(C){k(t.$$.fragment,C),k(s),k(c.$$.fragment,C),f=!1},d(C){C&&(w(e),w(a),w(l)),F(t),d[n].d(),g&&g.d(),v&&v.d(C),F(c,C)}}}function _C(o){let e,t,r,n,s,i,a;e=new qe({props:{$$slots:{name:[MC],default:[AC]},$$scope:{ctx:o}}}),r=new qe({props:{name:"Account"}}),s=new El({props:{user:o[4].user,$$slots:{default:[EC]},$$scope:{ctx:o}}});let l=o[34].default,c=me(l,o,o[42],null);return{c(){R(e.$$.fragment),t=M(),R(r.$$.fragment),n=M(),R(s.$$.fragment),i=M(),c&&c.c()},m(f,u){D(e,f,u),_(f,t,u),D(r,f,u),_(f,n,u),D(s,f,u),_(f,i,u),c&&c.m(f,u),a=!0},p(f,u){let d={};u[1]&2048&&(d.$$scope={dirty:u,ctx:f}),e.$set(d);let m={};u[0]&16&&(m.user=f[4].user),u[1]&2048&&(m.$$scope={dirty:u,ctx:f}),s.$set(m),c&&c.p&&(!a||u[1]&2048)&&ge(c,l,f,f[42],a?he(l,f[42],u,null):ye(f[42]),null)},i(f){a||(x(e.$$.fragment,f),x(r.$$.fragment,f),x(s.$$.fragment,f),x(c,f),a=!0)},o(f){k(e.$$.fragment,f),k(r.$$.fragment,f),k(s.$$.fragment,f),k(c,f),a=!1},d(f){f&&(w(t),w(n),w(i)),F(e,f),F(r,f),F(s,f),c&&c.d(f)}}}function SC(o){let e,t=[],r=new Map,n=Se(o[6]),s=i=>i[57];for(let i=0;i<n.length;i+=1){let a=rx(o,n,i),l=s(a);r.set(l,t[i]=nx(l,a))}return{c(){e=S("div");for(let i=0;i<t.length;i+=1)t[i].c();h(e,"class","login-buttons svelte-umtfyz")},m(i,a){_(i,e,a);for(let l=0;l<t.length;l+=1)t[l]&&t[l].m(e,null)},p(i,a){a[0]&18114|a[1]&2&&(n=Se(i[6]),t=Pn(t,a,s,1,i,n,r,e,cl,nx,null,rx))},i:q,o:q,d(i){i&&w(e);for(let a=0;a<t.length;a+=1)t[a].d()}}}function kC(o){let e,t=[],r=new Map,n,s=Se(o[6]),i=a=>a[57];for(let a=0;a<s.length;a+=1){let l=ox(o,s,a),c=i(l);r.set(c,t[a]=sx(c,l))}return{c(){e=S("div");for(let a=0;a<t.length;a+=1)t[a].c();h(e,"class","login-buttons svelte-umtfyz")},m(a,l){_(a,e,l);for(let c=0;c<t.length;c+=1)t[c]&&t[c].m(e,null);n=!0},p(a,l){l[0]&1073760192&&(s=Se(a[6]),ie(),t=Pn(t,l,i,1,a,s,r,e,fl,sx,null,ox),ae())},i(a){if(!n){for(let l=0;l<s.length;l+=1)x(t[l]);n=!0}},o(a){for(let l=0;l<t.length;l+=1)k(t[l]);n=!1},d(a){a&&w(e);for(let l=0;l<t.length;l+=1)t[l].d()}}}function IC(o){let e,t,r=(o[10][o[57]]||On(o[57]))+"",n,s,i,a,l;return{c(){e=S("button"),t=B("Sign in with "),n=B(r),h(e,"class",s=Wt(`${o[57].startsWith("oidc")?"oidc":o[57]}-sign-in-button`)+" svelte-umtfyz"),e.disabled=i=!0},m(c,f){_(c,e,f),b(e,t),b(e,n),l=!0},p(c,f){o=c,(!l||f[0]&1088)&&r!==(r=(o[10][o[57]]||On(o[57]))+"")&&Y(n,r),(!l||f[0]&64&&s!==(s=Wt(`${o[57].startsWith("oidc")?"oidc":o[57]}-sign-in-button`)+" svelte-umtfyz"))&&h(e,"class",s)},i(c){l||(c&&eo(()=>{l&&(a||(a=En(e,Un,{duration:o[9]?300:0,easing:Rn},!0)),a.run(1))}),l=!0)},o(c){c&&(a||(a=En(e,Un,{duration:o[9]?300:0,easing:Rn},!1)),a.run(0)),l=!1},d(c){c&&w(e),c&&a&&a.end()}}}function CC(o){let e,t,r,n=(o[10][o[57]]||On(o[57]))+"",s,i,a,l,c,f,u,d,m;function p(){return o[37](o[57])}return{c(){e=S("a"),t=S("button"),r=B("Sign in with "),s=B(n),c=M(),h(t,"class",i=Wt(`${o[57].startsWith("oidc")?"oidc":o[57]}-sign-in-button`)+" svelte-umtfyz"),t.disabled=a=o[7]||!o[1][o[57]],h(e,"href",f=o[1][o[57]].fullAuthUrl),h(e,"target","_blank")},m(y,g){_(y,e,g),b(e,t),b(t,r),b(t,s),b(e,c),u=!0,d||(m=z(t,"click",p),d=!0)},p(y,g){o=y,(!u||g[0]&1088)&&n!==(n=(o[10][o[57]]||On(o[57]))+"")&&Y(s,n),(!u||g[0]&64&&i!==(i=Wt(`${o[57].startsWith("oidc")?"oidc":o[57]}-sign-in-button`)+" svelte-umtfyz"))&&h(t,"class",i),(!u||g[0]&194&&a!==(a=o[7]||!o[1][o[57]]))&&(t.disabled=a),(!u||g[0]&66&&f!==(f=o[1][o[57]].fullAuthUrl))&&h(e,"href",f)},i(y){u||(y&&eo(()=>{u&&(l||(l=En(t,Un,{duration:o[9]?300:0,easing:Rn},!0)),l.run(1))}),u=!0)},o(y){y&&(l||(l=En(t,Un,{duration:o[9]?300:0,easing:Rn},!1)),l.run(0)),u=!1},d(y){y&&w(e),y&&l&&l.end(),d=!1,m()}}}function nx(o,e){let t,r,n,s,i=[CC,IC],a=[];function l(c,f){return c[1][c[57]]?0:1}return r=l(e,[-1,-1]),n=a[r]=i[r](e),{key:o,first:null,c(){t=ve(),n.c(),s=ve(),this.first=t},m(c,f){_(c,t,f),a[r].m(c,f),_(c,s,f)},p(c,f){e=c;let u=r;r=l(e,f),r===u?a[r].p(e,f):(ie(),k(a[u],1,1,()=>{a[u]=null}),ae(),n=a[r],n?n.p(e,f):(n=a[r]=i[r](e),n.c()),x(n,1),n.m(s.parentNode,s))},d(c){c&&(w(t),w(s)),a[r].d(c)}}}function sx(o,e){let t,r,n=(e[10][e[57]]||On(e[57]))+"",s,i,a,l,c,f,u;function d(){return e[36](e[57])}return{key:o,first:null,c(){t=S("button"),r=B("Sign in with "),s=B(n),h(t,"class",i=Wt(`${e[57].startsWith("oidc")?"oidc":e[57]}-sign-in-button`)+" svelte-umtfyz"),t.disabled=a=e[7]||!e[8].contains(e[57]),this.first=t},m(m,p){_(m,t,p),b(t,r),b(t,s),c=!0,f||(u=z(t,"click",function(){ze((0,Br.debounce)(d))&&(0,Br.debounce)(d).apply(this,arguments)}),f=!0)},p(m,p){e=m,(!c||p[0]&1088)&&n!==(n=(e[10][e[57]]||On(e[57]))+"")&&Y(s,n),(!c||p[0]&64&&i!==(i=Wt(`${e[57].startsWith("oidc")?"oidc":e[57]}-sign-in-button`)+" svelte-umtfyz"))&&h(t,"class",i),(!c||p[0]&448&&a!==(a=e[7]||!e[8].contains(e[57])))&&(t.disabled=a)},i(m){c||(m&&eo(()=>{c&&(l||(l=En(t,Un,{duration:e[9]?300:0,easing:Rn},!0)),l.run(1))}),c=!0)},o(m){m&&(l||(l=En(t,Un,{duration:e[9]?300:0,easing:Rn},!1)),l.run(0)),c=!1},d(m){m&&w(t),m&&l&&l.end(),f=!1,u()}}}function LC(o){let e,t,r,n,s,i,a,l;return{c(){e=S("div"),t=S("p"),t.textContent="Continue in your browser...",r=M(),n=S("p"),s=B(`Not working?
					`),i=S("button"),i.textContent="(try again)",h(t,"class","continue svelte-umtfyz"),h(i,"class","link link-button svelte-umtfyz"),h(n,"class","not-working svelte-umtfyz")},m(c,f){_(c,e,f),b(e,t),b(e,r),b(e,n),b(n,s),b(n,i),a||(l=z(i,"click",o[40]),a=!0)},p:q,d(c){c&&w(e),a=!1,l()}}}function TC(o){let e,t,r,n,s,i,a,l,c,f,u,d=o[12]&&o[2]&&ix(o);return{c(){e=S("p"),t=B(o[11]),r=B("."),n=S("br"),s=M(),d&&d.c(),i=M(),a=S("p"),l=B(`Not working?
				`),c=S("button"),c.textContent="(try again)",h(c,"class","link link-button svelte-umtfyz"),h(a,"class","not-working svelte-umtfyz")},m(m,p){_(m,e,p),b(e,t),b(e,r),b(e,n),b(e,s),d&&d.m(e,null),_(m,i,p),_(m,a,p),b(a,l),b(a,c),f||(u=z(c,"click",o[39]),f=!0)},p(m,p){p[0]&2048&&Y(t,m[11]),m[12]&&m[2]?d?d.p(m,p):(d=ix(m),d.c(),d.m(e,null)):d&&(d.d(1),d=null)},d(m){m&&(w(e),w(i),w(a)),d&&d.d(),f=!1,u()}}}function ix(o){let e,t,r,n;return{c(){e=B("Already logged in? "),t=S("button"),t.textContent="(click here)",h(t,"class","link link-button svelte-umtfyz")},m(s,i){_(s,e,i),_(s,t,i),r||(n=z(t,"click",function(){ze((0,Br.debounce)(o[38]))&&(0,Br.debounce)(o[38]).apply(this,arguments)}),r=!0)},p(s,i){o=s},d(s){s&&(w(e),w(t)),r=!1,n()}}}function ax(o){let e,t,r,n;return{c(){e=S("p"),t=S("button"),t.textContent="(choose another provider)",h(t,"class","link link-button svelte-umtfyz"),h(e,"class","choose-another svelte-umtfyz")},m(s,i){_(s,e,i),b(e,t),r||(n=z(t,"click",(0,Br.debounce)(o[41])),r=!0)},p:q,d(s){s&&w(e),r=!1,n()}}}function AC(o){let e,t;return e=new Vy({}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},i(r){t||(x(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function MC(o){let e,t;return e=new Tl({props:{slot:"name"}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p:q,i(r){t||(x(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function EC(o){let e,t,r;return{c(){e=S("button"),e.textContent="Logout"},m(n,s){_(n,e,s),t||(r=z(e,"click",(0,Br.debounce)(o[35])),t=!0)},p:q,d(n){n&&w(e),t=!1,r()}}}function PC(o){let e,t,r,n,s=[_C,wC],i=[];function a(l,c){return l[4].hasUser&&l[4].user?0:1}return e=a(o,[-1,-1]),t=i[e]=s[e](o),{c(){t.c(),r=ve()},m(l,c){i[e].m(l,c),_(l,r,c),n=!0},p(l,c){let f=e;e=a(l,c),e===f?i[e].p(l,c):(ie(),k(i[f],1,1,()=>{i[f]=null}),ae(),t=i[e],t?t.p(l,c):(t=i[e]=s[e](l),t.c()),x(t,1),t.m(r.parentNode,r))},i(l){n||(x(t),n=!0)},o(l){k(t),n=!1},d(l){l&&w(r),i[e].d(l)}}}var DC="system3-relay-auth-providers-";function On(o){return o?o=="oidc"?"OIDC":o=="github"?"GitHub":o.charAt(0).toUpperCase()+o.slice(1).toLowerCase():""}function FC(o,e,t){let r,n,s,i,a,l,c,f,u=q,d=()=>(u(),u=Dt(A,se=>t(4,f=se)),A),m,p,y,g,v,C,L,T;o.$$.on_destroy.push(()=>u());let{$$slots:E={},$$scope:O}=e,{plugin:I}=e,A,U=xe(!Br.Platform.isIosApp);ce(o,U,se=>t(5,m=se));let W=xe(!1);ce(o,W,se=>t(7,y=se)),d(A=I.loginManager);let J=xe(!1);ce(o,J,se=>t(12,T=se));let H=xe(!1),P=xe(!0);ce(o,P,se=>t(44,s=se));let V=xe("");ce(o,V,se=>t(2,r=se));let fe=xt.getInstance();ce(o,fe,se=>t(45,i=se));let de={},le=xe(!1);ce(o,le,se=>t(47,l=se));let ee=A.loginSettings;ce(o,ee,se=>t(3,c=se));let re=xe([]);ce(o,re,se=>t(46,a=se));let $=xe(!1);ce(o,$,se=>t(9,v=se));function N(){var se;let He=((se=A.pb)===null||se===void 0?void 0:se.baseUrl)||"default";return`${DC}${He}`}function pe(){let se=["google","microsoft"];return i.getFlag("enableDiscordLogin")&&se.push("discord"),i.getFlag("enableGitHubLogin")&&se.push("github"),se}function Q(){try{let se=N(),He=localStorage.getItem(se);if(He)return JSON.parse(He)}catch(se){console.error("Failed to load cached providers:",se)}return pe()}function Ie(se){try{let He=N();localStorage.setItem(He,JSON.stringify(se))}catch(He){console.error("Failed to save cached providers:",He)}}let Ue=Ot([V,fe],()=>{let se=["google","microsoft"];return i.getFlag("enableDiscordLogin")&&se.push("discord"),i.getFlag("enableGitHubLogin")&&se.push("github"),i.getFlag("enableOIDCLogin")&&se.push("oidc"),se});ce(o,Ue,se=>t(43,n=se));let Ne=Ot([V,A.loginSettings,fe,le,re],()=>{if(c&&c.provider)return[c.provider];if(r!=="")return[r];if(l&&Object.keys(de).length>0){let He=Object.keys(de),Qe=[];He.includes("google")&&Qe.push("google"),He.includes("microsoft")&&Qe.push("microsoft"),He.includes("discord")&&i.getFlag("enableDiscordLogin")&&Qe.push("discord"),He.includes("github")&&i.getFlag("enableGitHubLogin")&&Qe.push("github"),He.forEach(Hn=>{Hn.startsWith("oidc")&&i.getFlag("enableOIDCLogin")&&Qe.push(Hn)});let qr=JSON.stringify(Qe.sort())!==JSON.stringify(a.sort());return $.set(qr),Ie(Qe),Qe}if(a.length>0&&!l)return a;let se=["google","microsoft"];return i.getFlag("enableDiscordLogin")&&se.push("discord"),i.getFlag("enableGitHubLogin")&&se.push("github"),se});ce(o,Ne,se=>t(6,p=se));function te(){A.clearPreferredProvider(),V.set(""),nr()}let Oe=Ot([V,I.loginSettings,fe,le],()=>r?[r]:Object.keys(de));ce(o,Oe,se=>t(8,g=se));let We=Ot([le],()=>{var se;let He={};for(let Qe of Object.keys(de)){let qr=de[Qe];!((se=qr==null?void 0:qr.info)===null||se===void 0)&&se.displayName?He[Qe]=qr.info.displayName:He[Qe]=On(Qe)}return He});ce(o,We,se=>t(10,C=se));let st,Ye=xe("");ce(o,Ye,se=>t(11,L=se));function ao(){return Ee(this,void 0,void 0,function*(){I.loginManager.logout(),H.set(!1),W.set(!1),V.set(""),J.set(!1)})}function Fo(se){return Ee(this,void 0,void 0,function*(){try{V.set(se),(yield I.loginManager.login(se))&&H.set(!0)}catch(He){U.set(!1),H.set(!1);let Qe=de[se];Qe&&(window.open(Qe.fullAuthUrl,"_blank"),lo(se))}})}let zs=xe(I.loginManager.pb);function fn(){zs.set(I.loginManager.pb)}function nr(){try{let se=s?ot:fetch;A.initiateManualOAuth2CodeFlow(se,n).then(He=>{t(1,de=He),le.set(!0),A.updateWebviewIntercepts(He)}).catch(He=>{let Qe=He.message;throw Qe=Qe,Ye.set(Qe),H.set(!1),V.set(""),He})}catch(se){Ye.set(se.message)}}Rt(()=>{H.set(!1);let se=Q();re.set(se),nr()});function lo(se){return Ee(this,void 0,void 0,function*(){let He=de[se];if(He)return V.set(se),yield I.loginManager.poll(He).then(Qe=>{H.set(!0),W.set(!1),Ye.set("")}).catch(Qe=>{J.set(!0),W.set(!1),H.set(!1),Ye.set(Qe.message)})})}function Bn(se){let He=se.target;He.focus(),He.select(),navigator.clipboard.writeText(He.value).then(()=>new Br.Notice("Invite link copied")).catch(Qe=>{}),lo(r)}let un=()=>{ao()},Ws=async se=>{W.set(!0),await Fo(se)},Vn=se=>{W.set(!0),lo(se)},js=()=>{lo(r)},Ks=()=>{W.set(!1),U.set(!1),Ye.set(""),V.set(""),le.set(!1),nr()},Gs=()=>{W.set(!1),U.set(!1),Ye.set(""),V.set("")},Js=()=>{te()};return o.$$set=se=>{"plugin"in se&&t(33,I=se.plugin),"$$scope"in se&&t(42,O=se.$$scope)},[A,de,r,c,f,m,p,y,g,v,C,L,T,U,W,J,P,V,fe,le,ee,re,$,Ue,Ne,te,Oe,We,Ye,ao,Fo,nr,lo,I,E,un,Ws,Vn,js,Ks,Gs,Js,O]}var Xd=class extends K{constructor(e){super(),G(this,e,FC,PC,j,{plugin:33},vC,[-1,-1])}},lx=Xd;function cx(o,e,t){let r=o.slice();return r[5]=e[t],r}var RC=o=>({}),fx=o=>({}),UC=o=>({}),ux=o=>({});function OC(o){let e;return{c(){e=B(o[0])},m(t,r){_(t,e,r)},p(t,r){r&1&&Y(e,t[0])},d(t){t&&w(e)}}}function $C(o){let e,t=Se(o[1]),r=[];for(let n=0;n<t.length;n+=1)r[n]=dx(cx(o,t,n));return{c(){for(let n=0;n<r.length;n+=1)r[n].c();e=ve()},m(n,s){for(let i=0;i<r.length;i+=1)r[i]&&r[i].m(n,s);_(n,e,s)},p(n,s){if(s&2){t=Se(n[1]);let i;for(i=0;i<t.length;i+=1){let a=cx(n,t,i);r[i]?r[i].p(a,s):(r[i]=dx(a),r[i].c(),r[i].m(e.parentNode,e))}for(;i<r.length;i+=1)r[i].d(1);r.length=t.length}},d(n){n&&w(e),Je(r,n)}}}function dx(o){let e;return{c(){e=S("div"),e.textContent=`${o[5]} `},m(t,r){_(t,e,r)},p:q,d(t){t&&w(e)}}}function NC(o){let e,t=o[1].length>0&&$C(o);return{c(){t&&t.c(),e=ve()},m(r,n){t&&t.m(r,n),_(r,e,n)},p(r,n){r[1].length>0&&t.p(r,n)},d(r){r&&w(e),t&&t.d(r)}}}function BC(o){let e,t,r,n,s,i,a,l,c=o[4].name,f=me(c,o,o[3],ux),u=f||OC(o),d=o[4].description,m=me(d,o,o[3],fx),p=m||NC(o),y=o[4].default,g=me(y,o,o[3],null);return{c(){e=S("div"),t=S("div"),r=S("div"),u&&u.c(),n=M(),s=S("div"),p&&p.c(),i=M(),a=S("div"),g&&g.c(),h(r,"class","setting-item-name"),ue(r,"display","grid"),ue(r,"align-items","center"),h(s,"class","setting-item-description"),h(t,"class","setting-item-info"),ue(t,"display","grid"),h(a,"class","setting-item-control"),h(e,"class","setting-item")},m(v,C){_(v,e,C),b(e,t),b(t,r),u&&u.m(r,null),b(t,n),b(t,s),p&&p.m(s,null),b(e,i),b(e,a),g&&g.m(a,null),l=!0},p(v,[C]){f?f.p&&(!l||C&8)&&ge(f,c,v,v[3],l?he(c,v[3],C,UC):ye(v[3]),ux):u&&u.p&&(!l||C&1)&&u.p(v,l?C:-1),m&&m.p&&(!l||C&8)&&ge(m,d,v,v[3],l?he(d,v[3],C,RC):ye(v[3]),fx),g&&g.p&&(!l||C&8)&&ge(g,y,v,v[3],l?he(y,v[3],C,null):ye(v[3]),null)},i(v){l||(x(u,v),x(p,v),x(g,v),l=!0)},o(v){k(u,v),k(p,v),k(g,v),l=!1},d(v){v&&w(e),u&&u.d(v),p&&p.d(v),g&&g.d(v)}}}function VC(o,e,t){let{$$slots:r={},$$scope:n}=e,{name:s=""}=e,{description:i}=e,a=i!==void 0?i.split(`
`):[];return o.$$set=l=>{"name"in l&&t(0,s=l.name),"description"in l&&t(2,i=l.description),"$$scope"in l&&t(3,n=l.$$scope)},[s,a,i,n,r]}var ep=class extends K{constructor(e){super(),G(this,e,VC,BC,j,{name:0,description:2})}},Pe=ep;function HC(o){_e(o,"svelte-11hpkul",".setting-item-control.svelte-11hpkul{width:unset !important;margin-top:unset !important}.setting-item.svelte-11hpkul{flex-direction:unset !important}.setting-item-info.svelte-11hpkul{min-width:0;margin-top:auto;margin-bottom:auto}.setting-item-name.svelte-11hpkul{min-width:0}.truncate.svelte-11hpkul *{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}")}var qC=o=>({}),px=o=>({}),zC=o=>({}),mx=o=>({});function WC(o){let e;return{c(){e=B(o[0])},m(t,r){_(t,e,r)},p(t,r){r&1&&Y(e,t[0])},d(t){t&&w(e)}}}function hx(o){let e,t;return{c(){e=S("div"),t=B(o[1]),h(e,"class","setting-item-description")},m(r,n){_(r,e,n),b(e,t)},p(r,n){n&2&&Y(t,r[1])},d(r){r&&w(e)}}}function jC(o){let e,t=o[1]&&hx(o);return{c(){t&&t.c(),e=ve()},m(r,n){t&&t.m(r,n),_(r,e,n)},p(r,n){r[1]?t?t.p(r,n):(t=hx(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&w(e),t&&t.d(r)}}}function KC(o){let e,t,r,n,s,i,a,l=o[3].name,c=me(l,o,o[2],mx),f=c||WC(o),u=o[3].description,d=me(u,o,o[2],px),m=d||jC(o),p=o[3].default,y=me(p,o,o[2],null);return{c(){e=S("div"),t=S("div"),r=S("div"),f&&f.c(),n=M(),m&&m.c(),s=M(),i=S("div"),y&&y.c(),h(r,"class","setting-item-name truncate svelte-11hpkul"),h(t,"class","setting-item-info svelte-11hpkul"),h(i,"class","setting-item-control svelte-11hpkul"),h(e,"class","setting-item mod-list-item svelte-11hpkul")},m(g,v){_(g,e,v),b(e,t),b(t,r),f&&f.m(r,null),b(t,n),m&&m.m(t,null),b(e,s),b(e,i),y&&y.m(i,null),a=!0},p(g,[v]){c?c.p&&(!a||v&4)&&ge(c,l,g,g[2],a?he(l,g[2],v,zC):ye(g[2]),mx):f&&f.p&&(!a||v&1)&&f.p(g,a?v:-1),d?d.p&&(!a||v&4)&&ge(d,u,g,g[2],a?he(u,g[2],v,qC):ye(g[2]),px):m&&m.p&&(!a||v&2)&&m.p(g,a?v:-1),y&&y.p&&(!a||v&4)&&ge(y,p,g,g[2],a?he(p,g[2],v,null):ye(g[2]),null)},i(g){a||(x(f,g),x(m,g),x(y,g),a=!0)},o(g){k(f,g),k(m,g),k(y,g),a=!1},d(g){g&&w(e),f&&f.d(g),m&&m.d(g),y&&y.d(g)}}}function GC(o,e,t){let{$$slots:r={},$$scope:n}=e,{name:s=""}=e,{description:i=""}=e;return o.$$set=a=>{"name"in a&&t(0,s=a.name),"description"in a&&t(1,i=a.description),"$$scope"in a&&t(2,n=a.$$scope)},[s,i,n,r]}var tp=class extends K{constructor(e){super(),G(this,e,GC,KC,j,{name:0,description:1},HC)}},ht=tp;function JC(o){_e(o,"svelte-y529x8",".extra-setting-button.svelte-y529x8:focus{outline:none;box-shadow:none;color:var(--icon-color-focus)}.extra-setting-button.svelte-y529x8:hover{box-shadow:none;opacity:var(--icon-opacity-hover);color:var(--icon-color-hover);background-color:var(--background-modifier-hover)}")}function YC(o){let e,t,r,n,s;return t=new od({props:{class:"svg-icon lucide-settings",props:{class:"svg-icon lucide-settings"}}}),{c(){e=S("div"),R(t.$$.fragment),h(e,"class","clickable-icon extra-setting-button svelte-y529x8"),h(e,"aria-label","Options"),h(e,"role","button"),h(e,"tabindex","0")},m(i,a){_(i,e,a),D(t,e,null),r=!0,n||(s=[z(e,"click",o[0]),z(e,"keydown",o[0])],n=!0)},p:q,i(i){r||(x(t.$$.fragment,i),r=!0)},o(i){k(t.$$.fragment,i),r=!1},d(i){i&&w(e),F(t),n=!1,we(s)}}}function QC(o){let e=pt();function t(r){(r instanceof MouseEvent||r instanceof KeyboardEvent&&(r.key==="Enter"||r.key===" "))&&e("settings")}return[t]}var rp=class extends K{constructor(e){super(),G(this,e,QC,YC,j,{},JC)}},$n=rp;function ZC(o){let e,t,r,n,s,i;t=new Dn({props:{class:"svg-icon",style:"margin-right: .2em; flex-shrink: 0;"}});let a=o[3].default,l=me(a,o,o[2],null);return{c(){e=S("span"),R(t.$$.fragment),r=M(),l&&l.c(),h(e,"role","button"),h(e,"tabindex","0"),ue(e,"display","flex"),ue(e,"align-items","center"),ue(e,"width","100%")},m(c,f){_(c,e,f),D(t,e,null),b(e,r),l&&l.m(e,null),n=!0,s||(i=[z(e,"keypress",o[0]),z(e,"click",o[0])],s=!0)},p(c,[f]){l&&l.p&&(!n||f&4)&&ge(l,a,c,c[2],n?he(a,c[2],f,null):ye(c[2]),null)},i(c){n||(x(t.$$.fragment,c),x(l,c),n=!0)},o(c){k(t.$$.fragment,c),k(l,c),n=!1},d(c){c&&w(e),F(t),l&&l.d(c),s=!1,we(i)}}}function XC(o,e,t){let{$$slots:r={},$$scope:n}=e,{relay:s=void 0}=e,i=pt();function a(){s&&i("manageRelay",{relay:s})}return o.$$set=l=>{"relay"in l&&t(1,s=l.relay),"$$scope"in l&&t(2,n=l.$$scope)},[a,s,n,r]}var op=class extends K{constructor(e){super(),G(this,e,XC,ZC,j,{relay:1})}},Po=op;function eL(o){let e,t,r,n,s,i;t=new Vu({props:{class:"svg-icon",style:"margin-right: .2em; flex-shrink: 0"}});let a=o[3].default,l=me(a,o,o[2],null);return{c(){e=S("span"),R(t.$$.fragment),r=M(),l&&l.c(),h(e,"role","button"),h(e,"tabindex","0"),ue(e,"display","inline-flex"),ue(e,"align-items","center"),ue(e,"width","100%")},m(c,f){_(c,e,f),D(t,e,null),b(e,r),l&&l.m(e,null),n=!0,s||(i=[z(e,"keypress",o[0]),z(e,"click",o[0])],s=!0)},p(c,[f]){l&&l.p&&(!n||f&4)&&ge(l,a,c,c[2],n?he(a,c[2],f,null):ye(c[2]),null)},i(c){n||(x(t.$$.fragment,c),x(l,c),n=!0)},o(c){k(t.$$.fragment,c),k(l,c),n=!1},d(c){c&&w(e),F(t),l&&l.d(c),s=!1,we(i)}}}function tL(o,e,t){let{$$slots:r={},$$scope:n}=e,{folder:s=void 0}=e,i=pt();function a(){var l;s&&i("manageSharedFolder",{folder:s,relay:(l=s.remote)===null||l===void 0?void 0:l.relay})}return o.$$set=l=>{"folder"in l&&t(1,s=l.folder),"$$scope"in l&&t(2,n=l.$$scope)},[a,s,n,r]}var np=class extends K{constructor(e){super(),G(this,e,tL,eL,j,{folder:1})}},oo=np;function rL(o){let e,t=o[0].name+"",r;return{c(){e=S("span"),r=B(t),ue(e,"overflow","hidden"),ue(e,"text-overflow","ellipsis"),ue(e,"white-space","nowrap")},m(n,s){_(n,e,s),b(e,r)},p(n,s){s&1&&t!==(t=n[0].name+"")&&Y(r,t)},d(n){n&&w(e)}}}function gx(o){let e,t,r,n,s;return t=new Iu({props:{size:16,class:"svg-icon"}}),n=new Po({props:{relay:o[1],$$slots:{default:[oL]},$$scope:{ctx:o}}}),n.$on("manageRelay",o[3]),{c(){e=S("span"),R(t.$$.fragment),r=M(),R(n.$$.fragment),ue(e,"width","16px"),ue(e,"flex-shrink","0"),ue(e,"display","flex"),ue(e,"justify-content","center")},m(i,a){_(i,e,a),D(t,e,null),_(i,r,a),D(n,i,a),s=!0},p(i,a){let l={};a&2&&(l.relay=i[1]),a&17&&(l.$$scope={dirty:a,ctx:i}),n.$set(l)},i(i){s||(x(t.$$.fragment,i),x(n.$$.fragment,i),s=!0)},o(i){k(t.$$.fragment,i),k(n.$$.fragment,i),s=!1},d(i){i&&(w(e),w(r)),F(t),F(n,i)}}}function oL(o){let e,t=o[0].remote.relay.name+"",r;return{c(){e=S("span"),r=B(t),ue(e,"flex","1"),ue(e,"min-width","0"),ue(e,"text-overflow","ellipsis"),ue(e,"white-space","nowrap")},m(n,s){_(n,e,s),b(e,r)},p(n,s){s&1&&t!==(t=n[0].remote.relay.name+"")&&Y(r,t)},d(n){n&&w(e)}}}function nL(o){let e,t,r,n,s;r=new oo({props:{folder:o[0],$$slots:{default:[rL]},$$scope:{ctx:o}}}),r.$on("manageSharedFolder",o[2]);let i=o[0].remote&&gx(o);return{c(){e=S("span"),t=S("span"),R(r.$$.fragment),n=M(),i&&i.c(),ue(t,"display","inline-flex"),ue(t,"align-items","center"),ue(t,"width","200px"),ue(t,"min-width","200px"),ue(t,"flex-shrink","0"),ue(e,"display","inline-flex"),ue(e,"align-items","center"),ue(e,"width","100%"),ue(e,"gap","8px")},m(a,l){_(a,e,l),b(e,t),D(r,t,null),b(e,n),i&&i.m(e,null),s=!0},p(a,[l]){let c={};l&1&&(c.folder=a[0]),l&17&&(c.$$scope={dirty:l,ctx:a}),r.$set(c),a[0].remote?i?(i.p(a,l),l&1&&x(i,1)):(i=gx(a),i.c(),x(i,1),i.m(e,null)):i&&(ie(),k(i,1,1,()=>{i=null}),ae())},i(a){s||(x(r.$$.fragment,a),x(i),s=!0)},o(a){k(r.$$.fragment,a),k(i),s=!1},d(a){a&&w(e),F(r),i&&i.d()}}}function sL(o,e,t){let{folder:r}=e,{relay:n}=e;function s(a){Ir.call(this,o,a)}function i(a){Ir.call(this,o,a)}return o.$$set=a=>{"folder"in a&&t(0,r=a.folder),"relay"in a&&t(1,n=a.relay)},[r,n,s,i]}var sp=class extends K{constructor(e){super(),G(this,e,sL,nL,j,{folder:0,relay:1})}},yx=sp;var Cr=require("obsidian");var no=require("obsidian");function iL(o){_e(o,"svelte-1fe7ajn",".input-with-icon.svelte-1fe7ajn{position:relative;width:100%}.secret-text-toggle-icon.svelte-1fe7ajn{display:flex;align-items:center;justify-content:center;cursor:pointer;width:24px;height:24px;position:absolute;right:4px;top:50%;transform:translateY(-50%);border-radius:4px}.secret-text-toggle-icon.svelte-1fe7ajn:hover{background-color:var(--background-modifier-hover)}.system3-secret-text.svelte-1fe7ajn{padding-inline-end:28px !important;font-family:monospace !important}.system3-input-invalid.svelte-1fe7ajn{border:1px solid var(--color-red) !important}")}function aL(o){let e,t,r,n;return{c(){e=S("input"),e.value=o[0],h(e,"placeholder",o[2]),h(e,"type","password"),e.readOnly=o[3],h(e,"class",t=Wt(`system3-secret-text ${o[5]?"system3-input-invalid":""}`)+" svelte-1fe7ajn"),e.disabled=o[1]},m(s,i){_(s,e,i),r||(n=[z(e,"click",function(){ze(o[4]?(0,no.debounce)(o[12]):null)&&(o[4]?(0,no.debounce)(o[12]):null).apply(this,arguments)}),z(e,"input",o[15]),z(e,"keydown",o[10])],r=!0)},p(s,i){o=s,i&1&&e.value!==o[0]&&(e.value=o[0]),i&4&&h(e,"placeholder",o[2]),i&8&&(e.readOnly=o[3]),i&32&&t!==(t=Wt(`system3-secret-text ${o[5]?"system3-input-invalid":""}`)+" svelte-1fe7ajn")&&h(e,"class",t),i&2&&(e.disabled=o[1])},d(s){s&&w(e),r=!1,we(n)}}}function lL(o){let e,t,r,n;return{c(){e=S("input"),e.value=o[0],h(e,"placeholder",o[2]),h(e,"type","text"),e.readOnly=o[3],h(e,"class",t=Wt(`system3-secret-text ${o[5]?"system3-input-invalid":""}`)+" svelte-1fe7ajn"),e.disabled=o[1]},m(s,i){_(s,e,i),r||(n=[z(e,"click",function(){ze(o[4]?(0,no.debounce)(o[12]):null)&&(o[4]?(0,no.debounce)(o[12]):null).apply(this,arguments)}),z(e,"input",o[14]),z(e,"keydown",o[10])],r=!0)},p(s,i){o=s,i&1&&e.value!==o[0]&&(e.value=o[0]),i&4&&h(e,"placeholder",o[2]),i&8&&(e.readOnly=o[3]),i&32&&t!==(t=Wt(`system3-secret-text ${o[5]?"system3-input-invalid":""}`)+" svelte-1fe7ajn")&&h(e,"class",t),i&2&&(e.disabled=o[1])},d(s){s&&w(e),r=!1,we(n)}}}function cL(o){let e,t,r,n,s,i,a;function l(u,d){return u[6]?lL:aL}let c=l(o,-1),f=c(o);return{c(){e=S("div"),f.c(),t=M(),r=S("div"),h(r,"class","secret-text-toggle-icon svelte-1fe7ajn"),h(r,"role","button"),h(r,"tabindex","0"),h(r,"aria-label",n=o[6]?"Hide text":"Show text"),h(e,"class","input-with-icon svelte-1fe7ajn")},m(u,d){_(u,e,d),f.m(e,null),b(e,t),b(e,r),i||(a=[rl(s=o[11].call(null,r)),z(r,"click",o[16]),z(r,"keypress",o[17])],i=!0)},p(u,[d]){c===(c=l(u,d))&&f?f.p(u,d):(f.d(1),f=c(u),f&&(f.c(),f.m(e,t))),d&64&&n!==(n=u[6]?"Hide text":"Show text")&&h(r,"aria-label",n)},i:q,o:q,d(u){u&&w(e),f.d(),i=!1,we(a)}}}function fL(o,e,t){let r,n,s=pt(),{value:i}=e,{disabled:a=!1}=e,{placeholder:l="please wait..."}=e,{readonly:c=!0}=e,{copyOnClick:f=!0}=e,{successMessage:u="Copied to clipboard"}=e,{invalid:d=!1}=e,m=xe(!1);ce(o,m,I=>t(6,r=I));let p=xe(!1);ce(o,p,I=>t(19,n=I));let y;function g(I){I.key==="Enter"&&!a&&s("enter")}function v(I){y=I;let A=()=>{n?((0,no.setIcon)(I,"clipboard-check"),I.addClass("mod-success")):((0,no.setIcon)(I,r?"eye-off":"eye"),I.removeClass("mod-success"))},U=m.subscribe(()=>{A()}),W=p.subscribe(()=>{A()});return A(),{destroy(){U(),W()}}}function C(I){!f||!i||a||navigator.clipboard.writeText(i).then(()=>{new no.Notice(u),p.set(!0),setTimeout(()=>{p.set(!1)},800)}).catch(A=>{console.error("Failed to copy: ",A)})}let L=I=>{t(0,i=I.currentTarget.value),s("input",I)},T=I=>{t(0,i=I.currentTarget.value),s("input",I)},E=()=>m.update(I=>!I),O=()=>m.update(I=>!I);return o.$$set=I=>{"value"in I&&t(0,i=I.value),"disabled"in I&&t(1,a=I.disabled),"placeholder"in I&&t(2,l=I.placeholder),"readonly"in I&&t(3,c=I.readonly),"copyOnClick"in I&&t(4,f=I.copyOnClick),"successMessage"in I&&t(13,u=I.successMessage),"invalid"in I&&t(5,d=I.invalid)},[i,a,l,c,f,d,r,s,m,p,g,v,C,u,L,T,E,O]}var ip=class extends K{constructor(e){super(),G(this,e,fL,cL,j,{value:0,disabled:1,placeholder:2,readonly:3,copyOnClick:4,successMessage:13,invalid:5},iL)}},Dl=ip;var ap=require("obsidian");function uL(o){_e(o,"svelte-zmx7zz","span.faint.svelte-zmx7zz{color:var(--text-faint)}div.spacer.svelte-zmx7zz{height:3em}")}function xx(o,e,t){let r=o.slice();return r[30]=e[t],r}function bx(o,e,t){let r=o.slice();return r[33]=e[t],r[34]=e,r[35]=t,r}function vx(o,e,t){let r=o.slice();return r[36]=e[t],r}function wx(o,e,t){let r=o.slice();return r[39]=e[t],r}function dL(o){let e,t,r,n,s,i,a,l;function c(u){o[18](u)}let f={disabled:o[6],placeholder:"Enter share key",readonly:!1,copyOnClick:!1,invalid:o[5]};return o[4]!==void 0&&(f.value=o[4]),e=new Dl({props:f}),er.push(()=>gy(e,"value",c)),e.$on("input",o[15]),e.$on("enter",function(){ze((0,Cr.debounce)(o[19]))&&(0,Cr.debounce)(o[19]).apply(this,arguments)}),{c(){R(e.$$.fragment),r=M(),n=S("button"),s=B("Join"),h(n,"class","mod-cta"),n.disabled=o[6]},m(u,d){D(e,u,d),_(u,r,d),_(u,n,d),b(n,s),i=!0,a||(l=z(n,"click",function(){ze((0,Cr.debounce)(o[20]))&&(0,Cr.debounce)(o[20]).apply(this,arguments)}),a=!0)},p(u,d){o=u;let m={};d[0]&64&&(m.disabled=o[6]),d[0]&32&&(m.invalid=o[5]),!t&&d[0]&16&&(t=!0,m.value=o[4],my(()=>t=!1)),e.$set(m),(!i||d[0]&64)&&(n.disabled=o[6])},i(u){i||(x(e.$$.fragment,u),i=!0)},o(u){k(e.$$.fragment,u),i=!1},d(u){u&&(w(r),w(n)),F(e,u),a=!1,l()}}}function pL(o){let e;return{c(){e=S("span"),e.textContent="Relay Servers",h(e,"slot","name"),ue(e,"display","inline-flex"),ue(e,"align-items","center")},m(t,r){_(t,e,r)},p:q,d(t){t&&w(e)}}}function mL(o){let e,t;function r(){return o[22](o[39])}return e=new $n({}),e.$on("settings",r),{c(){R(e.$$.fragment)},m(n,s){D(e,n,s),t=!0},p(n,s){o=n},i(n){t||(x(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function hL(o){let e;return{c(){e=S("span"),e.textContent="(Untitled Relay Server)",h(e,"class","faint svelte-zmx7zz")},m(t,r){_(t,e,r)},p:q,d(t){t&&w(e)}}}function gL(o){let e=o[39].name+"",t;return{c(){t=B(e)},m(r,n){_(r,t,n)},p(r,n){n[0]&128&&e!==(e=r[39].name+"")&&Y(t,e)},d(r){r&&w(t)}}}function yL(o){let e;function t(s,i){return s[39].name?gL:hL}let r=t(o,[-1,-1]),n=r(o);return{c(){n.c(),e=ve()},m(s,i){n.m(s,i),_(s,e,i)},p(s,i){r===(r=t(s,i))&&n?n.p(s,i):(n.d(1),n=r(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&w(e),n.d(s)}}}function xL(o){let e,t;return e=new Po({props:{slot:"name",relay:o[39],$$slots:{default:[yL]},$$scope:{ctx:o}}}),e.$on("manageRelay",o[21]),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n[0]&128&&(s.relay=r[39]),n[0]&128|n[1]&2048&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(x(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function _x(o){let e,t;return e=new ht({props:{$$slots:{name:[xL],default:[mL]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n[0]&128|n[1]&2048&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(x(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function bL(o){let e,t,r;return{c(){e=S("button"),e.textContent="Create",h(e,"class","mod-cta")},m(n,s){_(n,e,s),t||(r=z(e,"click",(0,Cr.debounce)(o[23])),t=!0)},p:q,d(n){n&&w(e),t=!1,r()}}}function Sx(o){let e,t;return e=new Pe({props:{description:"Go to a Relay Server's settings page above to share existing folders, or add Shared Folders to your vault."}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},i(r){t||(x(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function vL(o){let e,t;function r(){return o[26](o[36])}return e=new $n({}),e.$on("settings",function(){ze((0,Cr.debounce)(r))&&(0,Cr.debounce)(r).apply(this,arguments)}),{c(){R(e.$$.fragment)},m(n,s){D(e,n,s),t=!0},p(n,s){o=n},i(n){t||(x(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function wL(o){var r;let e,t;return e=new yx({props:{folder:o[36],relay:(r=o[36].remote)==null?void 0:r.relay,slot:"name"}}),e.$on("manageRelay",o[24]),e.$on("manageSharedFolder",o[25]),{c(){R(e.$$.fragment)},m(n,s){D(e,n,s),t=!0},p(n,s){var a;let i={};s[0]&256&&(i.folder=n[36]),s[0]&256&&(i.relay=(a=n[36].remote)==null?void 0:a.relay),e.$set(i)},i(n){t||(x(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function kx(o){let e,t;return e=new ht({props:{$$slots:{name:[wL],default:[vL]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n[0]&384|n[1]&2048&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(x(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function Ix(o){let e,t,r,n,s,i;r=new qe({props:{name:"Subscriptions",helpText:"Subscriptions are tied to each Relay Server, not to your user account. Modify and cancel your subscription via our payment processor Stripe."}});let a=Se(o[9].values()),l=[];for(let f=0;f<a.length;f+=1)l[f]=Cx(bx(o,a,f));let c=f=>k(l[f],1,1,()=>{l[f]=null});return{c(){e=S("div"),t=M(),R(r.$$.fragment),n=M();for(let f=0;f<l.length;f+=1)l[f].c();s=ve(),h(e,"class","spacer svelte-zmx7zz")},m(f,u){_(f,e,u),_(f,t,u),D(r,f,u),_(f,n,u);for(let d=0;d<l.length;d+=1)l[d]&&l[d].m(f,u);_(f,s,u),i=!0},p(f,u){if(u[0]&8705){a=Se(f[9].values());let d;for(d=0;d<a.length;d+=1){let m=bx(f,a,d);l[d]?(l[d].p(m,u),x(l[d],1)):(l[d]=Cx(m),l[d].c(),x(l[d],1),l[d].m(s.parentNode,s))}for(ie(),d=a.length;d<l.length;d+=1)c(d);ae()}},i(f){if(!i){x(r.$$.fragment,f);for(let u=0;u<a.length;u+=1)x(l[u]);i=!0}},o(f){k(r.$$.fragment,f),l=l.filter(Boolean);for(let u=0;u<l.length;u+=1)k(l[u]);i=!1},d(f){f&&(w(e),w(t),w(n),w(s)),F(r,f),Je(l,f)}}}function _L(o){let e,t,r,n;function s(){return o[28](o[33],o[34],o[35])}return{c(){e=S("button"),e.textContent="Manage",t=M()},m(i,a){_(i,e,a),_(i,t,a),r||(n=z(e,"click",function(){ze((0,Cr.debounce)(s))&&(0,Cr.debounce)(s).apply(this,arguments)}),r=!0)},p(i,a){o=i},d(i){i&&(w(e),w(t)),r=!1,n()}}}function SL(o){let e;return{c(){e=S("span"),e.textContent="(Untitled Relay Server)",h(e,"class","faint svelte-zmx7zz")},m(t,r){_(t,e,r)},p:q,d(t){t&&w(e)}}}function kL(o){let e=o[33].relay.name+"",t;return{c(){t=B(e)},m(r,n){_(r,t,n)},p(r,n){n[0]&512&&e!==(e=r[33].relay.name+"")&&Y(t,e)},d(r){r&&w(t)}}}function IL(o){let e;function t(s,i){return s[33].relay.name?kL:SL}let r=t(o,[-1,-1]),n=r(o);return{c(){n.c(),e=M()},m(s,i){n.m(s,i),_(s,e,i)},p(s,i){r===(r=t(s,i))&&n?n.p(s,i):(n.d(1),n=r(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&w(e),n.d(s)}}}function CL(o){let e,t;return e=new Po({props:{slot:"name",relay:o[33].relay,$$slots:{default:[IL]},$$scope:{ctx:o}}}),e.$on("manageRelay",o[27]),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n[0]&512&&(s.relay=r[33].relay),n[0]&512|n[1]&2048&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(x(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function Cx(o){let e,t;return e=new ht({props:{name:"",description:o[33].cancelAt?o[13](o[33].cancelAt):"",$$slots:{name:[CL],default:[_L]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n[0]&512&&(s.description=r[33].cancelAt?r[13](r[33].cancelAt):""),n[0]&513|n[1]&2048&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(x(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function LL(o){let e,t,r=o[10].values().length===0,n,s,i;e=new qe({props:{name:"Hosts",helpText:"Manage self-hosted Relay Servers"}});let a=r&&Lx(o),l=Se(o[10].values()),c=[];for(let u=0;u<l.length;u+=1)c[u]=Tx(xx(o,l,u));let f=u=>k(c[u],1,1,()=>{c[u]=null});return{c(){R(e.$$.fragment),t=M(),a&&a.c(),n=M();for(let u=0;u<c.length;u+=1)c[u].c();s=ve()},m(u,d){D(e,u,d),_(u,t,d),a&&a.m(u,d),_(u,n,d);for(let m=0;m<c.length;m+=1)c[m]&&c[m].m(u,d);_(u,s,d),i=!0},p(u,d){if(d[0]&1024&&(r=u[10].values().length===0),r?a?d[0]&1024&&x(a,1):(a=Lx(u),a.c(),x(a,1),a.m(n.parentNode,n)):a&&(ie(),k(a,1,1,()=>{a=null}),ae()),d[0]&1024){l=Se(u[10].values());let m;for(m=0;m<l.length;m+=1){let p=xx(u,l,m);c[m]?(c[m].p(p,d),x(c[m],1)):(c[m]=Tx(p),c[m].c(),x(c[m],1),c[m].m(s.parentNode,s))}for(ie(),m=l.length;m<c.length;m+=1)f(m);ae()}},i(u){if(!i){x(e.$$.fragment,u),x(a);for(let d=0;d<l.length;d+=1)x(c[d]);i=!0}},o(u){k(e.$$.fragment,u),k(a),c=c.filter(Boolean);for(let d=0;d<c.length;d+=1)k(c[d]);i=!1},d(u){u&&(w(t),w(n),w(s)),F(e,u),a&&a.d(u),Je(c,u)}}}function Lx(o){let e,t;return e=new Pe({props:{description:"See our documentation for how to host a Relay Server."}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},i(r){t||(x(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function Tx(o){var r,n;let e,t;return e=new ht({props:{name:(r=o[30])==null?void 0:r.name,description:(n=o[30])==null?void 0:n.url}}),{c(){R(e.$$.fragment)},m(s,i){D(e,s,i),t=!0},p(s,i){var l,c;let a={};i[0]&1024&&(a.name=(l=s[30])==null?void 0:l.name),i[0]&1024&&(a.description=(c=s[30])==null?void 0:c.url),e.$set(a)},i(s){t||(x(e.$$.fragment,s),t=!0)},o(s){k(e.$$.fragment,s),t=!1},d(s){F(e,s)}}}function TL(o){let e,t,r,n,s,i,a,l,c,f,u,d=o[8].items().length===0,m,p,y=o[3].values().length>0,g,v=Ve().enableSelfManageHosts,C,L;e=new qe({props:{name:"Join a Relay Server"}}),r=new Pe({props:{name:"Share key",description:"Enter the code that was shared with you.",$$slots:{default:[dL]},$$scope:{ctx:o}}}),s=new qe({props:{helpText:"A Relay Server coordinates real-time updates between collaborators. You can add collaborators and share folders on the Relay Server's settings page.",$$slots:{name:[pL]},$$scope:{ctx:o}}});let T=Se(o[7].values().filter(Ax).sort(Mx)),E=[];for(let P=0;P<T.length;P+=1)E[P]=_x(wx(o,T,P));let O=P=>k(E[P],1,1,()=>{E[P]=null});l=new Pe({props:{name:"",description:"",$$slots:{default:[bL]},$$scope:{ctx:o}}}),f=new qe({props:{name:"Shared Folders",helpText:"Shared Folders enhance local folders by tracking edits. You can see what Relay Server a Shared Folder is connected to below."}});let I=d&&Sx(o),A=Se(o[8].items()),U=[];for(let P=0;P<A.length;P+=1)U[P]=kx(vx(o,A,P));let W=P=>k(U[P],1,1,()=>{U[P]=null}),J=y&&Ix(o),H=v&&LL(o);return{c(){R(e.$$.fragment),t=M(),R(r.$$.fragment),n=M(),R(s.$$.fragment),i=M();for(let P=0;P<E.length;P+=1)E[P].c();a=M(),R(l.$$.fragment),c=M(),R(f.$$.fragment),u=M(),I&&I.c(),m=M();for(let P=0;P<U.length;P+=1)U[P].c();p=M(),J&&J.c(),g=M(),H&&H.c(),C=ve()},m(P,V){D(e,P,V),_(P,t,V),D(r,P,V),_(P,n,V),D(s,P,V),_(P,i,V);for(let fe=0;fe<E.length;fe+=1)E[fe]&&E[fe].m(P,V);_(P,a,V),D(l,P,V),_(P,c,V),D(f,P,V),_(P,u,V),I&&I.m(P,V),_(P,m,V);for(let fe=0;fe<U.length;fe+=1)U[fe]&&U[fe].m(P,V);_(P,p,V),J&&J.m(P,V),_(P,g,V),H&&H.m(P,V),_(P,C,V),L=!0},p(P,V){let fe={};V[0]&112|V[1]&2048&&(fe.$$scope={dirty:V,ctx:P}),r.$set(fe);let de={};if(V[1]&2048&&(de.$$scope={dirty:V,ctx:P}),s.$set(de),V[0]&4224){T=Se(P[7].values().filter(Ax).sort(Mx));let ee;for(ee=0;ee<T.length;ee+=1){let re=wx(P,T,ee);E[ee]?(E[ee].p(re,V),x(E[ee],1)):(E[ee]=_x(re),E[ee].c(),x(E[ee],1),E[ee].m(a.parentNode,a))}for(ie(),ee=T.length;ee<E.length;ee+=1)O(ee);ae()}let le={};if(V[1]&2048&&(le.$$scope={dirty:V,ctx:P}),l.$set(le),V[0]&256&&(d=P[8].items().length===0),d?I?V[0]&256&&x(I,1):(I=Sx(P),I.c(),x(I,1),I.m(m.parentNode,m)):I&&(ie(),k(I,1,1,()=>{I=null}),ae()),V[0]&16768){A=Se(P[8].items());let ee;for(ee=0;ee<A.length;ee+=1){let re=vx(P,A,ee);U[ee]?(U[ee].p(re,V),x(U[ee],1)):(U[ee]=kx(re),U[ee].c(),x(U[ee],1),U[ee].m(p.parentNode,p))}for(ie(),ee=A.length;ee<U.length;ee+=1)W(ee);ae()}V[0]&8&&(y=P[3].values().length>0),y?J?(J.p(P,V),V[0]&8&&x(J,1)):(J=Ix(P),J.c(),x(J,1),J.m(g.parentNode,g)):J&&(ie(),k(J,1,1,()=>{J=null}),ae()),v&&H.p(P,V)},i(P){if(!L){x(e.$$.fragment,P),x(r.$$.fragment,P),x(s.$$.fragment,P);for(let V=0;V<T.length;V+=1)x(E[V]);x(l.$$.fragment,P),x(f.$$.fragment,P),x(I);for(let V=0;V<A.length;V+=1)x(U[V]);x(J),x(H),L=!0}},o(P){k(e.$$.fragment,P),k(r.$$.fragment,P),k(s.$$.fragment,P),E=E.filter(Boolean);for(let V=0;V<E.length;V+=1)k(E[V]);k(l.$$.fragment,P),k(f.$$.fragment,P),k(I),U=U.filter(Boolean);for(let V=0;V<U.length;V+=1)k(U[V]);k(J),k(H),L=!1},d(P){P&&(w(t),w(n),w(i),w(a),w(c),w(u),w(m),w(p),w(g),w(C)),F(e,P),F(r,P),F(s,P),Je(E,P),F(l,P),F(f,P),I&&I.d(P),Je(U,P),J&&J.d(P),H&&H.d(P)}}}function Ax(o){return!!o.acl}function Mx(o,e){return o.owner&&!e.owner?-1:e.owner&&!o.owner||o.name>e.name?1:-1}function AL(o,e,t){let r,n=q,s=()=>(n(),n=Dt(p,Q=>t(7,r=Q)),p),i,a,l=q,c=()=>(l(),l=Dt(g,Q=>t(9,a=Q)),g),f,u=q,d=()=>(u(),u=Dt(y,Q=>t(10,f=Q)),y);o.$$.on_destroy.push(()=>n()),o.$$.on_destroy.push(()=>l()),o.$$.on_destroy.push(()=>u());let{plugin:m}=e,{relays:p}=e;s();let{providers:y}=e;d();let{subscriptions:g}=e;c();let v=m.sharedFolders;ce(o,v,Q=>t(8,i=Q));let C="",L=!1,T=!1,E=pt();function O(Q){Q&&E("manageRelay",{relay:Q})}function I(Q){if(!Q)return"Active";let Ie=ap.moment.utc(),Ue=ap.moment.utc(Q),Ne=Ue.diff(Ie,"days");return Ne<=0?"Subscription has ended":Ne===1?"Active for 1 more day":Ne>31?`Ends on ${Ue.format("YYYY-MM-DD")}`:`Active for ${Ne} more days`}function A(Q,Ie){Q&&E("manageSharedFolder",{folder:Q,relay:Ie})}function U(){t(5,L=!1)}function W(Q){return Ee(this,void 0,void 0,function*(){try{t(6,T=!0);let Ie=yield m.relayManager.acceptInvitation(Q).catch(Ue=>{throw Ue.status===429&&new Cr.Notice("Slow down"),Ue});t(6,T=!1),E("joinRelay",{relay:Ie})}catch(Ie){t(5,L=!0),t(6,T=!1)}})}function J(){E("createRelay")}function H(Q){C=Q,t(4,C)}let P=()=>W(C),V=()=>W(C);function fe(Q){Ir.call(this,o,Q)}let de=Q=>{O(Q)},le=()=>J();function ee(Q){Ir.call(this,o,Q)}function re(Q){Ir.call(this,o,Q)}let $=Q=>{let Ie=r.values().find(Ue=>{var Ne;return((Ne=Q.remote)==null?void 0:Ne.relay.guid)===Ue.guid});A(Q,Ie)};function N(Q){Ir.call(this,o,Q)}let pe=async(Q,Ie,Ue)=>{if(!Q.token){let Oe=await m.relayManager.getSubscriptionToken(Q);tl(g,Ie[Ue].token=Oe,a)}let Ne=Q.id,te=Q.token;window.open(m.buildApiUrl(`/subscriptions/${Ne}/manage?token=${te}`),"_blank")};return o.$$set=Q=>{"plugin"in Q&&t(0,m=Q.plugin),"relays"in Q&&s(t(1,p=Q.relays)),"providers"in Q&&d(t(2,y=Q.providers)),"subscriptions"in Q&&c(t(3,g=Q.subscriptions))},[m,p,y,g,C,L,T,r,i,a,f,v,O,I,A,U,W,J,H,P,V,fe,de,le,ee,re,$,N,pe]}var lp=class extends K{constructor(e){super(),G(this,e,AL,TL,j,{plugin:0,relays:1,providers:2,subscriptions:3},uL,[-1,-1])}},so=lp;var ft=require("obsidian");var ib=zn(Qs());function ML(o){_e(o,"svelte-15ov1wm",".lock-icon.svelte-15ov1wm{width:16px;height:16px;opacity:0.5;display:flex;align-items:center;justify-content:center}")}function EL(o){let e,t,r;return t=new ju({props:{class:"svg-icon"}}),{c(){e=S("span"),R(t.$$.fragment),h(e,"class","lock-icon svelte-15ov1wm")},m(n,s){_(n,e,s),D(t,e,null),r=!0},p:q,i(n){r||(x(t.$$.fragment,n),r=!0)},o(n){k(t.$$.fragment,n),r=!1},d(n){n&&w(e),F(t)}}}var cp=class extends K{constructor(e){super(),G(this,e,null,EL,j,{},ML)}},Fl=cp;function PL(o){let e,t,r,n,s,i,a,l,c;n=new Du({props:{size:16}});let f=o[3].default,u=me(f,o,o[4],null);return{c(){e=S("span"),t=B(o[1]),r=M(),R(n.$$.fragment),s=M(),i=S("span"),u&&u.c(),h(e,"tabindex","0"),h(e,"role","button"),ue(i,"flex","1"),ue(i,"min-width","0"),ue(i,"text-overflow","ellipsis"),ue(i,"white-space","nowrap"),ue(i,"overflow","hidden")},m(d,m){_(d,e,m),b(e,t),_(d,r,m),D(n,d,m),_(d,s,m),_(d,i,m),u&&u.m(i,null),a=!0,l||(c=[z(e,"click",o[2]),z(e,"keypress",o[2])],l=!0)},p(d,m){(!a||m&2)&&Y(t,d[1]),u&&u.p&&(!a||m&16)&&ge(u,f,d,d[4],a?he(f,d[4],m,null):ye(d[4]),null)},i(d){a||(x(n.$$.fragment,d),x(u,d),a=!0)},o(d){k(n.$$.fragment,d),k(u,d),a=!1},d(d){d&&(w(e),w(r),w(s),w(i)),F(n,d),u&&u.d(d),l=!1,we(c)}}}function DL(o){let e,t,r;var n=o[0];function s(i,a){return{props:{$$slots:{default:[PL]},$$scope:{ctx:i}}}}return n&&(t=Ts(n,s(o))),{c(){e=S("h4"),t&&R(t.$$.fragment)},m(i,a){_(i,e,a),t&&D(t,e,null),r=!0},p(i,[a]){if(a&1&&n!==(n=i[0])){if(t){ie();let l=t;k(l.$$.fragment,1,0,()=>{F(l,1)}),ae()}n?(t=Ts(n,s(i,a)),R(t.$$.fragment),x(t.$$.fragment,1),D(t,e,null)):t=null}else if(n){let l={};a&18&&(l.$$scope={dirty:a,ctx:i}),t.$set(l)}},i(i){r||(t&&x(t.$$.fragment,i),r=!0)},o(i){t&&k(t.$$.fragment,i),r=!1},d(i){i&&w(e),t&&F(t)}}}function FL(o,e,t){let{$$slots:r={},$$scope:n}=e,{category:s}=e,{categoryText:i}=e,a=pt();function l(){a("goBack")}return o.$$set=c=>{"category"in c&&t(0,s=c.category),"categoryText"in c&&t(1,i=c.categoryText),"$$scope"in c&&t(4,n=c.$$scope)},[s,i,l,r,n]}var fp=class extends K{constructor(e){super(),G(this,e,FL,DL,j,{category:0,categoryText:1})}},Rl=fp;function RL(o){_e(o,"svelte-1ezpbya",'.system3-disk-usage-container.svelte-1ezpbya{width:100%;background-color:var(--interactive-normal);overflow:hidden}.system3-disk-usage-bar.svelte-1ezpbya{height:0.5rem;background-color:var(--color-accent);transition:width 0.6s ease}.system3-disk-usage-report.svelte-1ezpbya{text-align:center}.system3-disk-usage-bar[data-state="warning"].svelte-1ezpbya{height:0.3rem;background-color:var(--red);transition:width 0.6s ease}')}function UL(o){let e,t,r,n,s,i;return{c(){e=S("div"),t=S("div"),n=M(),s=S("div"),i=B(o[1]),h(t,"class","system3-disk-usage-bar svelte-1ezpbya"),ue(t,"width",o[0]+"%"),h(t,"data-state",r=o[0]>90?"warning":""),h(e,"class","system3-disk-usage-container svelte-1ezpbya"),h(s,"class","system3-disk-usage-report svelte-1ezpbya")},m(a,l){_(a,e,l),b(e,t),_(a,n,l),_(a,s,l),b(s,i)},p(a,[l]){l&1&&ue(t,"width",a[0]+"%"),l&1&&r!==(r=a[0]>90?"warning":"")&&h(t,"data-state",r),l&2&&Y(i,a[1])},i:q,o:q,d(a){a&&(w(e),w(n),w(s))}}}function OL(o,e,t){let{diskUsagePercentage:r=0}=e,{text:n=""}=e;return r=Math.max(0,r),r=Math.min(100,r),o.$$set=s=>{"diskUsagePercentage"in s&&t(0,r=s.diskUsagePercentage),"text"in s&&t(1,n=s.text)},[r,n]}var up=class extends K{constructor(e){super(),G(this,e,OL,UL,j,{diskUsagePercentage:0,text:1},RL)}},Ex=up;var Ol=require("obsidian");function $L(o){let e,t,r=o[0].shared&&Px(o);return{c(){e=S("div"),r&&r.c(),h(e,"class","suggestion-icon")},m(n,s){_(n,e,s),r&&r.m(e,null),t=!0},p(n,s){n[0].shared?r?s&1&&x(r,1):(r=Px(n),r.c(),x(r,1),r.m(e,null)):r&&(ie(),k(r,1,1,()=>{r=null}),ae())},i(n){t||(x(r),t=!0)},o(n){k(r),t=!1},d(n){n&&w(e),r&&r.d()}}}function NL(o){let e;return{c(){e=S("span"),e.textContent="Enter to create",h(e,"class","suggestion-action")},m(t,r){_(t,e,r)},p:q,i:q,o:q,d(t){t&&w(e)}}}function Px(o){let e,t;return e=new To({props:{class:"svg-icon"}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},i(r){t||(x(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function BL(o){let e,t,r=o[0].folder+"",n,s,i,a,l,c,f=[NL,$L],u=[];function d(m,p){return m[0].exists?1:0}return a=d(o,-1),l=u[a]=f[a](o),{c(){e=S("div"),t=S("div"),n=B(r),s=M(),i=S("div"),l.c(),h(t,"class","suggestion-title"),h(e,"class","suggestion-content"),h(i,"class","suggestion-aux")},m(m,p){_(m,e,p),b(e,t),b(t,n),_(m,s,p),_(m,i,p),u[a].m(i,null),c=!0},p(m,[p]){(!c||p&1)&&r!==(r=m[0].folder+"")&&Y(n,r);let y=a;a=d(m,p),a===y?u[a].p(m,p):(ie(),k(u[y],1,1,()=>{u[y]=null}),ae(),l=u[a],l?l.p(m,p):(l=u[a]=f[a](m),l.c()),x(l,1),l.m(i,null))},i(m){c||(x(l),c=!0)},o(m){k(l),c=!1},d(m){m&&(w(e),w(s),w(i)),u[a].d()}}}function VL(o,e,t){let{suggestion:r}=e;return o.$$set=n=>{"suggestion"in n&&t(0,r=n.suggestion)},[r]}var dp=class extends K{constructor(e){super(),G(this,e,VL,BL,j,{suggestion:0})}},Dx=dp;var Ul=class extends Ol.SuggestModal{constructor(t,r,n){super(t);this.sharedFolders=r;this.onChoose=n;this.components=[];this.sharedPaths=new Set(this.sharedFolders.map(s=>s.path)),this.hasRemotes=new Set(this.sharedFolders.filter(s=>s.remote!==void 0).map(s=>s.path)),this.setInstructions([{command:"\u2191/\u2193",purpose:"Navigate"},{command:"Enter",purpose:"Choose and share folder"},{command:"Esc",purpose:"Cancel"}])}sortFn(t,r){return t.exists&&!r.exists?1:!t.exists&&r.exists||t.shared&&!r.shared?-1:r.shared&&!t.shared?1:t.folder.localeCompare(r.folder)}onClose(){super.onClose(),this.components.forEach(t=>{t.$destroy()})}getSuggestions(t){this.components.forEach(a=>{a.$destroy()});let r=t.toLowerCase(),n=[],s=this.app.vault.getAbstractFileByPath(t)!==null;t.length>0&&!s&&n.push({folder:t,exists:!1,shared:!1});let i=a=>{let l=this.sharedPaths.has(a.path),c=this.hasRemotes.has(a.path);if(a.path.toLowerCase().contains(r)&&a.path.length>1&&!c&&n.push({folder:a.path,exists:!0,shared:l}),!l)for(let f of a.children)f instanceof Ol.TFolder&&i(f)};return i(this.app.vault.getRoot()),n.sort(this.sortFn)}renderSuggestion(t,r){r.addClass("mod-complex");let n=new Dx({target:r,props:{suggestion:t}});this.components.push(n)}onChooseSuggestion(t,r){this.onChoose(t.folder)}};var Nx=require("obsidian");var mp=require("obsidian");var Fx=require("obsidian"),Rx=require("obsidian"),$l=class extends Rx.AbstractInputSuggest{constructor(t,r,n){super(t,n);this.app=t;this.sharedFolders=r;this.inputEl=n;this.sharedPaths=new Set(this.sharedFolders.map(s=>s.path))}getSuggestions(t){let r=t.toLowerCase(),n=[],s=i=>{if(!this.sharedPaths.has(i.path)){i.path.toLowerCase().contains(r)&&n.push(i.path);for(let l of i.children)l instanceof Fx.TFolder&&s(l)}};return s(this.app.vault.getRoot()),n}renderSuggestion(t,r){r.setText(t)}selectSuggestion(t){this.inputEl.value=t,this.inputEl.trigger("input"),this.close()}};function HL(o){let e,t,r,n;return{c(){e=S("div"),t=S("input"),h(t,"type","text"),h(t,"placeholder","/"),h(e,"class","folder-suggest-container")},m(s,i){_(s,e,i),b(e,t),o[5](t),Ft(t,o[2]),r||(n=[z(t,"input",qL),z(t,"input",o[6])],r=!0)},p(s,[i]){i&4&&t.value!==s[2]&&Ft(t,s[2])},i:q,o:q,d(s){s&&w(e),o[5](null),r=!1,we(n)}}}function qL(){}function zL(o,e,t){let r,n=q,s=()=>(n(),n=Dt(f,m=>t(2,r=m)),f);o.$$.on_destroy.push(()=>n());let{app:i}=e,a,l,{sharedFolders:c}=e,{selectedFolder:f=xe()}=e;s(),Rt(()=>{l=new $l(i,c,a);let m=p=>{s(t(0,f=p.detail.folder.path))};return a.addEventListener("folder-selected",m),()=>{a.removeEventListener("folder-selected",m)}}),hu(()=>{l&&l.close()});function u(m){er[m?"unshift":"push"](()=>{a=m,t(1,a)})}function d(){r=this.value,f.set(r)}return o.$$set=m=>{"app"in m&&t(3,i=m.app),"sharedFolders"in m&&t(4,c=m.sharedFolders),"selectedFolder"in m&&s(t(0,f=m.selectedFolder))},[f,a,r,i,c,u,d]}var pp=class extends K{constructor(e){super(),G(this,e,zL,HL,j,{app:3,sharedFolders:4,selectedFolder:0})}},Ux=pp;function WL(o){_e(o,"svelte-hgd3zf","span.error.svelte-hgd3zf{flex:auto;align-content:center}")}function jL(o){let e,t,r;return{c(){e=S("input"),h(e,"type","text")},m(n,s){_(n,e,s),Ft(e,o[4]),t||(r=z(e,"input",o[8]),t=!0)},p(n,s){s&16&&e.value!==n[4]&&Ft(e,n[4])},d(n){n&&w(e),t=!1,r()}}}function KL(o){let e,t;return e=new Ux({props:{app:o[0],sharedFolders:o[2],selectedFolder:o[7]}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n&1&&(s.app=r[0]),n&4&&(s.sharedFolders=r[2]),e.$set(s)},i(r){t||(x(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function Ox(o){let e,t;return{c(){e=S("span"),t=B(o[5]),h(e,"class","mod-warning error svelte-hgd3zf")},m(r,n){_(r,e,n),b(e,t)},p(r,n){n&32&&Y(t,r[5])},d(r){r&&w(e)}}}function GL(o){let e,t,r,n,s,i,a,l,c,f,u,d,m;n=new Pe({props:{name:"Folder name",description:"Set the name of the folder to be added.",$$slots:{default:[jL]},$$scope:{ctx:o}}}),i=new Pe({props:{name:"Folder location",description:"Set the location in your vault.",$$slots:{default:[KL]},$$scope:{ctx:o}}});let p=o[5]&&Ox(o);return{c(){e=S("div"),e.textContent="Add to vault",t=M(),r=S("div"),R(n.$$.fragment),s=M(),R(i.$$.fragment),a=M(),l=S("div"),p&&p.c(),c=M(),f=S("button"),f.textContent="Confirm",h(e,"class","modal-title"),h(f,"class","mod-cta"),h(l,"class","modal-button-container"),h(r,"class","modal-content")},m(y,g){_(y,e,g),_(y,t,g),_(y,r,g),D(n,r,null),b(r,s),D(i,r,null),b(r,a),b(r,l),p&&p.m(l,null),b(l,c),b(l,f),u=!0,d||(m=z(f,"click",function(){ze((0,mp.debounce)(o[9]))&&(0,mp.debounce)(o[9]).apply(this,arguments)}),d=!0)},p(y,[g]){o=y;let v={};g&1040&&(v.$$scope={dirty:g,ctx:o}),n.$set(v);let C={};g&1029&&(C.$$scope={dirty:g,ctx:o}),i.$set(C),o[5]?p?p.p(o,g):(p=Ox(o),p.c(),p.m(l,c)):p&&(p.d(1),p=null)},i(y){u||(x(n.$$.fragment,y),x(i.$$.fragment,y),u=!0)},o(y){k(n.$$.fragment,y),k(i.$$.fragment,y),u=!1},d(y){y&&(w(e),w(t),w(r)),F(n),F(i),p&&p.d(),d=!1,m()}}}function JL(o,e,t){let r,{app:n}=e,{remoteFolder:s}=e,{sharedFolders:i}=e,{onConfirm:a}=e,l=s.name,c=xe();ce(o,c,m=>t(6,r=m));let f="";function u(){l=this.value,t(4,l)}let d=async()=>{a(s,l,r||"").catch(m=>{t(5,f=m.message)})};return o.$$set=m=>{"app"in m&&t(0,n=m.app),"remoteFolder"in m&&t(1,s=m.remoteFolder),"sharedFolders"in m&&t(2,i=m.sharedFolders),"onConfirm"in m&&t(3,a=m.onConfirm)},[n,s,i,a,l,f,r,c,u,d]}var hp=class extends K{constructor(e){super(),G(this,e,JL,GL,j,{app:0,remoteFolder:1,sharedFolders:2,onConfirm:3},WL)}},$x=hp;var Nl=class extends Nx.Modal{constructor(t,r,n,s){super(t);this.sharedFolders=r;this.remoteFolder=n;this.onConfirm=s;this.onConfirm=s}onOpen(){let{contentEl:t}=this;this.component=new $x({target:t,props:{remoteFolder:this.remoteFolder,sharedFolders:this.sharedFolders,onConfirm:async(r,n,s)=>{await this.onConfirm(r,n,s),this.close()},app:this.app}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var gp=require("obsidian");function YL(o){let e=[],t="",r=0;for(;r<o.length;)o[r]==="*"&&r+1<o.length&&o[r+1]==="*"?(t&&(e.push({type:"TEXT",value:t}),t=""),e.push({type:"DOUBLE_STAR"}),r+=2):o[r]==="*"?(t&&(e.push({type:"TEXT",value:t}),t=""),e.push({type:"STAR"}),r++):(t+=o[r],r++);return t&&e.push({type:"TEXT",value:t}),e}function QL(o){let e="",t="NORMAL",r=0;for(;r<o.length;){let n=o[r];switch(t){case"NORMAL":n.type==="TEXT"?e+=n.value:n.type==="STAR"?(t="EMPHASIS",e+="<u>"):n.type==="DOUBLE_STAR"&&(t="BOLD",e+="<strong>");break;case"EMPHASIS":n.type==="TEXT"?e+=n.value:n.type==="STAR"?(t="NORMAL",e+="</u>"):n.type==="DOUBLE_STAR"&&(t="BOLD",e+="</u><strong>");break;case"BOLD":n.type==="TEXT"?e+=n.value:n.type==="STAR"?e+="*":n.type==="DOUBLE_STAR"&&(t="NORMAL",e+="</strong>");break}r++}return t==="EMPHASIS"?e+="</u>":t==="BOLD"&&(e+="</strong>"),e}function nn(o){let e=YL(o);return QL(e)}function ZL(o){_e(o,"svelte-3c0ydk",`.faint.svelte-3c0ydk{color:var(--text-faint) !important}.edit-members-button.svelte-3c0ydk{display:flex;cursor:pointer;padding:4px;margin-bottom:-4px;border-radius:var(--radius-s);color:var(--icon-color);transition:color 0.15s ease-in-out,
			background-color 0.15s ease-in-out}.edit-members-button.svelte-3c0ydk:hover{color:var(--icon-color-hover);background-color:var(--background-modifier-hover)}.edit-members-button.svelte-3c0ydk:focus{outline:none;color:var(--icon-color-focus)}.share-key-container.svelte-3c0ydk{width:100%}.share-key-disabled-notice.svelte-3c0ydk{color:var(--text-error) !important;font-size:0.85em !important}.relay-host-check.svelte-3c0ydk{text-align:right}`)}function Bx(o,e,t){let r=o.slice();return r[67]=e[t],r}function Vx(o,e,t){let r=o.slice();return r[70]=e[t],r}function XL(o){let e;return{c(){e=S("span"),e.textContent="(Untitled Relay Server)",h(e,"class","faint svelte-3c0ydk")},m(t,r){_(t,e,r)},p:q,d(t){t&&w(e)}}}function e2(o){let e=o[0].name+"",t;return{c(){t=B(e)},m(r,n){_(r,t,n)},p(r,n){n[0]&1&&e!==(e=r[0].name+"")&&Y(t,e)},d(r){r&&w(t)}}}function t2(o){let e;function t(s,i){return s[0].name?e2:XL}let r=t(o,[-1,-1,-1]),n=r(o);return{c(){n.c(),e=ve()},m(s,i){n.m(s,i),_(s,e,i)},p(s,i){r===(r=t(s,i))&&n?n.p(s,i):(n.d(1),n=r(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&w(e),n.d(s)}}}function Hx(o){let e,t;return e=new Pe({props:{name:"Name",description:"Set the Relay Server's name.",$$slots:{default:[r2]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n[0]&4241|n[2]&2048&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(x(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function r2(o){let e,t,r,n;return{c(){e=S("input"),h(e,"type","text"),h(e,"spellcheck","false"),h(e,"placeholder","Example: Shared Notes"),h(e,"class",t=Wt((o[12]?"system3-updating":"")+(o[7]?"":" system3-input-invalid"))+" svelte-3c0ydk")},m(s,i){_(s,e,i),Ft(e,o[0].name),o[48](e),r||(n=[z(e,"input",o[47]),z(e,"input",o[38])],r=!0)},p(s,i){i[0]&4224&&t!==(t=Wt((s[12]?"system3-updating":"")+(s[7]?"":" system3-input-invalid"))+" svelte-3c0ydk")&&h(e,"class",t),i[0]&1&&e.value!==s[0].name&&Ft(e,s[0].name)},d(s){s&&w(e),o[48](null),r=!1,we(n)}}}function o2(o){let e,t;return e=new ht({props:{$$slots:{name:[a2],default:[s2]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n[0]&8192|n[2]&2048&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(x(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function n2(o){let e,t;return e=new ht({props:{$$slots:{name:[f2],default:[l2]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n[0]&24576|n[2]&2048&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(x(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function s2(o){let e,t,r;function n(){return o[52](o[70])}return{c(){e=S("button"),e.textContent="Add to Vault",h(e,"class","mod-cta"),h(e,"aria-label","Add shared folder to vault"),ue(e,"max-width","8em")},m(s,i){_(s,e,i),t||(r=z(e,"click",function(){ze((0,ft.debounce)(n))&&(0,ft.debounce)(n).apply(this,arguments)}),t=!0)},p(s,i){o=s},d(s){s&&w(e),t=!1,r()}}}function i2(o){let e=o[70].name+"",t;return{c(){t=B(e)},m(r,n){_(r,t,n)},p(r,n){n[0]&8192&&e!==(e=r[70].name+"")&&Y(t,e)},d(r){r&&w(t)}}}function a2(o){let e,t;return e=new oo({props:{slot:"name",$$slots:{default:[i2]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n[0]&8192|n[2]&2048&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(x(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function l2(o){let e,t;function r(){return o[51](o[70])}return e=new $n({}),e.$on("settings",function(){ze((0,ft.debounce)(r))&&(0,ft.debounce)(r).apply(this,arguments)}),{c(){R(e.$$.fragment)},m(n,s){D(e,n,s),t=!0},p(n,s){o=n},i(n){t||(x(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function c2(o){let e=o[70].name+"",t;return{c(){t=B(e)},m(r,n){_(r,t,n)},p(r,n){n[0]&8192&&e!==(e=r[70].name+"")&&Y(t,e)},d(r){r&&w(t)}}}function f2(o){let e,t;function r(...n){return o[49](o[70],...n)}return e=new oo({props:{folder:o[14].find(r),slot:"name",$$slots:{default:[c2]},$$scope:{ctx:o}}}),e.$on("manageSharedFolder",o[50]),{c(){R(e.$$.fragment)},m(n,s){D(e,n,s),t=!0},p(n,s){o=n;let i={};s[0]&24576&&(i.folder=o[14].find(r)),s[0]&8192|s[2]&2048&&(i.$$scope={dirty:s,ctx:o}),e.$set(i)},i(n){t||(x(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function qx(o){let e,t,r,n,s;function i(...f){return o[46](o[70],...f)}let a=[n2,o2],l=[];function c(f,u){return u[0]&24576&&(e=null),e==null&&(e=!!f[14].find(i)),e?0:1}return t=c(o,[-1,-1,-1]),r=l[t]=a[t](o),{c(){r.c(),n=ve()},m(f,u){l[t].m(f,u),_(f,n,u),s=!0},p(f,u){o=f;let d=t;t=c(o,u),t===d?l[t].p(o,u):(ie(),k(l[d],1,1,()=>{l[d]=null}),ae(),r=l[t],r?r.p(o,u):(r=l[t]=a[t](o),r.c()),x(r,1),r.m(n.parentNode,n))},i(f){s||(x(r),s=!0)},o(f){k(r),s=!1},d(f){f&&w(n),l[t].d(f)}}}function u2(o){let e,t,r;return{c(){e=S("button"),e.textContent="Share a folder",h(e,"class","mod-cta"),h(e,"aria-label","Select a folder to share it with this Relay Server")},m(n,s){_(n,e,s),t||(r=z(e,"click",(0,ft.debounce)(o[53])),t=!0)},p:q,d(n){n&&w(e),t=!1,r()}}}function zx(o){let e,t,r,n,s,i,a,l=[p2,d2],c=[];function f(u,d){return u[15]?0:1}return t=f(o,[-1,-1,-1]),r=c[t]=l[t](o),{c(){e=S("div"),r.c(),h(e,"class","edit-members-button svelte-3c0ydk"),h(e,"role","button"),h(e,"tabindex","0"),h(e,"aria-label",n=o[15]?"Cancel editing members":"Edit members")},m(u,d){_(u,e,d),c[t].m(e,null),s=!0,i||(a=[z(e,"click",o[43]),z(e,"keypress",o[43])],i=!0)},p(u,d){let m=t;t=f(u,d),t!==m&&(ie(),k(c[m],1,1,()=>{c[m]=null}),ae(),r=c[t],r||(r=c[t]=l[t](u),r.c()),x(r,1),r.m(e,null)),(!s||d[0]&32768&&n!==(n=u[15]?"Cancel editing members":"Edit members"))&&h(e,"aria-label",n)},i(u){s||(x(r),s=!0)},o(u){k(r),s=!1},d(u){u&&w(e),c[t].d(),i=!1,we(a)}}}function d2(o){let e,t;return e=new sd({props:{class:"svg-icon"}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},i(r){t||(x(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function p2(o){let e,t;return e=new Au({props:{class:"svg-icon"}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},i(r){t||(x(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function m2(o){let e,t,r=o[10].owner&&zx(o);return{c(){r&&r.c(),e=ve()},m(n,s){r&&r.m(n,s),_(n,e,s),t=!0},p(n,s){n[10].owner?r?(r.p(n,s),s[0]&1024&&x(r,1)):(r=zx(n),r.c(),x(r,1),r.m(e.parentNode,e)):r&&(ie(),k(r,1,1,()=>{r=null}),ae())},i(n){t||(x(r),t=!0)},o(n){k(r),t=!1},d(n){n&&w(e),r&&r.d(n)}}}function h2(o){let e,t=o[67].role+"",r;return{c(){e=S("span"),r=B(t),h(e,"class","role-label")},m(n,s){_(n,e,s),b(e,r)},p(n,s){s[0]&64&&t!==(t=n[67].role+"")&&Y(r,t)},d(n){n&&w(e)}}}function g2(o){let e;function t(s,i){return s[15]?x2:y2}let r=t(o,[-1,-1,-1]),n=r(o);return{c(){n.c(),e=ve()},m(s,i){n.m(s,i),_(s,e,i)},p(s,i){r===(r=t(s,i))&&n?n.p(s,i):(n.d(1),n=r(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&w(e),n.d(s)}}}function y2(o){let e,t,r,n,s,i,a,l,c,f;return{c(){var u,d;e=S("div"),t=S("select"),r=S("option"),r.textContent="Owner",n=S("option"),n.textContent="Member",r.__value="Owner",Ft(r,r.__value),n.__value="Member",Ft(n,n.__value),h(t,"class","dropdown"),t.disabled=s=o[67].userId===((u=o[1].loginManager.user)==null?void 0:u.id),h(t,"aria-label",i=o[67].userId===((d=o[1].loginManager.user)==null?void 0:d.id)?"Cannot modify your own role":void 0),h(t,"data-role-id",l=o[67].id),ue(e,"display","flex"),ue(e,"gap","8px"),ue(e,"align-items","center")},m(u,d){_(u,e,d),b(e,t),b(t,r),b(t,n),pu(t,o[67].role),c||(f=z(t,"change",o[41]),c=!0)},p(u,d){var m,p;d[0]&66&&s!==(s=u[67].userId===((m=u[1].loginManager.user)==null?void 0:m.id))&&(t.disabled=s),d[0]&66&&i!==(i=u[67].userId===((p=u[1].loginManager.user)==null?void 0:p.id)?"Cannot modify your own role":void 0)&&h(t,"aria-label",i),d[0]&64&&a!==(a=u[67].role)&&pu(t,u[67].role),d[0]&64&&l!==(l=u[67].id)&&h(t,"data-role-id",l)},d(u){u&&w(e),c=!1,f()}}}function x2(o){var r;let e,t=o[67].userId!==((r=o[1].loginManager.user)==null?void 0:r.id)&&Wx(o);return{c(){t&&t.c(),e=ve()},m(n,s){t&&t.m(n,s),_(n,e,s)},p(n,s){var i;n[67].userId!==((i=n[1].loginManager.user)==null?void 0:i.id)?t?t.p(n,s):(t=Wx(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(n){n&&w(e),t&&t.d(n)}}}function Wx(o){let e,t,r;function n(){return o[54](o[67])}return{c(){e=S("button"),e.textContent="Kick",h(e,"class","mod-destructive")},m(s,i){_(s,e,i),t||(r=z(e,"click",function(){ze((0,ft.debounce)(n))&&(0,ft.debounce)(n).apply(this,arguments)}),t=!0)},p(s,i){o=s},d(s){s&&w(e),t=!1,r()}}}function b2(o){let e;function t(s,i){return s[10].owner?g2:h2}let r=t(o,[-1,-1,-1]),n=r(o);return{c(){n.c(),e=ve()},m(s,i){n.m(s,i),_(s,e,i)},p(s,i){r===(r=t(s,i))&&n?n.p(s,i):(n.d(1),n=r(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&w(e),n.d(s)}}}function jx(o){let e,t;return e=new El({props:{user:o[67].user,$$slots:{default:[b2]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n[0]&64&&(s.user=r[67].user),n[0]&33858|n[2]&2048&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(x(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function v2(o){let e,t=o[6].values().length+"",r,n,s=o[10].userLimit+"",i,a;return{c(){e=S("span"),r=B(t),n=B(" of "),i=B(s),a=B(" seats used"),h(e,"class","faint svelte-3c0ydk")},m(l,c){_(l,e,c),b(e,r),b(e,n),b(e,i),b(e,a)},p(l,c){c[0]&64&&t!==(t=l[6].values().length+"")&&Y(r,t),c[0]&1024&&s!==(s=l[10].userLimit+"")&&Y(i,s)},d(l){l&&w(e)}}}function Kx(o){let e,t;return e=new Fl({}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},i(r){t||(x(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function w2(o){let e,t,r,n,s,i,a,l,c,f,u,d=!o[0].owner&&Kx(o);return{c(){e=S("div"),d&&d.c(),t=M(),r=S("div"),n=S("input"),i=M(),a=S("div"),h(n,"type","checkbox"),n.checked=o[8],n.disabled=s=!o[0].owner,h(a,"class","checkbox-toggle"),h(r,"role","checkbox"),h(r,"aria-checked",o[8]),h(r,"tabindex","0"),h(r,"class",l=o[0].owner?"checkbox-container":"checkbox-container checkbox-locked"),Me(r,"is-enabled",o[8]),h(e,"class","setting-item-control")},m(m,p){_(m,e,p),d&&d.m(e,null),b(e,t),b(e,r),b(r,n),b(r,i),b(r,a),c=!0,f||(u=[z(n,"change",o[55]),z(r,"keypress",o[56]),z(r,"click",o[57])],f=!0)},p(m,p){m[0].owner?d&&(ie(),k(d,1,1,()=>{d=null}),ae()):d?p[0]&1&&x(d,1):(d=Kx(m),d.c(),x(d,1),d.m(e,t)),(!c||p[0]&256)&&(n.checked=m[8]),(!c||p[0]&1&&s!==(s=!m[0].owner))&&(n.disabled=s),(!c||p[0]&256)&&h(r,"aria-checked",m[8]),(!c||p[0]&1&&l!==(l=m[0].owner?"checkbox-container":"checkbox-container checkbox-locked"))&&h(r,"class",l),(!c||p[0]&257)&&Me(r,"is-enabled",m[8])},i(m){c||(x(d),c=!0)},o(m){k(d),c=!1},d(m){m&&w(e),d&&d.d(),f=!1,we(u)}}}function _2(o){let e;return{c(){e=S("div"),e.textContent="The owner of this Relay Server has disabled key sharing.",h(e,"class","setting-item-description mod-warning")},m(t,r){_(t,e,r)},d(t){t&&w(e)}}}function S2(o){let e;return{c(){e=S("div"),e.textContent="The owner of this Relay Server has enabled key sharing.",h(e,"class","setting-item-description")},m(t,r){_(t,e,r)},d(t){t&&w(e)}}}function k2(o){let e;return{c(){e=S("div"),e.textContent="Allow others to join this Relay Server with a Share Key.",h(e,"class","setting-item-description")},m(t,r){_(t,e,r)},d(t){t&&w(e)}}}function I2(o){let e;function t(s,i){return s[0].owner?k2:s[8]?S2:_2}let r=t(o,[-1,-1,-1]),n=r(o);return{c(){e=S("fragment"),n.c(),h(e,"slot","description")},m(s,i){_(s,e,i),n.m(e,null)},p(s,i){r!==(r=t(s,i))&&(n.d(1),n=r(s),n&&(n.c(),n.m(e,null)))},d(s){s&&w(e),n.d()}}}function Gx(o){let e,t,r,n;e=new Pe({props:{name:"Share Key",description:"Share this key with your collaborators.",$$slots:{default:[T2]},$$scope:{ctx:o}}});let s=o[0].owner&&Jx(o);return{c(){R(e.$$.fragment),t=M(),s&&s.c(),r=ve()},m(i,a){D(e,i,a),_(i,t,a),s&&s.m(i,a),_(i,r,a),n=!0},p(i,a){let l={};a[0]&288|a[2]&2048&&(l.$$scope={dirty:a,ctx:i}),e.$set(l),i[0].owner?s?(s.p(i,a),a[0]&1&&x(s,1)):(s=Jx(i),s.c(),x(s,1),s.m(r.parentNode,r)):s&&(ie(),k(s,1,1,()=>{s=null}),ae())},i(i){n||(x(e.$$.fragment,i),x(s),n=!0)},o(i){k(e.$$.fragment,i),k(s),n=!1},d(i){i&&(w(t),w(r)),F(e,i),s&&s.d(i)}}}function C2(o){let e,t;return e=new Dl({props:{value:o[5]?o[5].key:"please wait...",disabled:!o[8],placeholder:"please wait...",readonly:!0,copyOnClick:!0,successMessage:"Invite link copied"}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n[0]&32&&(s.value=r[5]?r[5].key:"please wait..."),n[0]&256&&(s.disabled=!r[8]),e.$set(s)},i(r){t||(x(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function L2(o){let e;return{c(){e=S("span"),e.textContent="Share key is currently disabled",h(e,"role","button"),h(e,"tabindex","0"),h(e,"class","input-like share-key-disabled-notice svelte-3c0ydk")},m(t,r){_(t,e,r)},p:q,i:q,o:q,d(t){t&&w(e)}}}function T2(o){let e,t,r,n,s=[L2,C2],i=[];function a(l,c){return l[8]?1:0}return t=a(o,[-1,-1,-1]),r=i[t]=s[t](o),{c(){e=S("div"),r.c(),h(e,"class","share-key-container svelte-3c0ydk")},m(l,c){_(l,e,c),i[t].m(e,null),n=!0},p(l,c){let f=t;t=a(l,c),t===f?i[t].p(l,c):(ie(),k(i[f],1,1,()=>{i[f]=null}),ae(),r=i[t],r?r.p(l,c):(r=i[t]=s[t](l),r.c()),x(r,1),r.m(e,null))},i(l){n||(x(r),n=!0)},o(l){k(r),n=!1},d(l){l&&w(e),i[t].d()}}}function Jx(o){let e,t;return e=new Pe({props:{name:"Rotate key",description:"Create a new share key. The old key will no longer work.",$$slots:{default:[A2]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n[2]&2048&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(x(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function A2(o){let e,t,r;return{c(){e=S("button"),e.textContent="Rotate key",h(e,"class","mod-destructive")},m(n,s){_(n,e,s),t||(r=z(e,"click",(0,ft.debounce)(o[35])),t=!0)},p:q,d(n){n&&w(e),t=!1,r()}}}function Yx(o){let e,t,r,n,s,i,a,l;e=new qe({props:{name:"Plan"}});let c=[E2,M2],f=[];function u(p,y){return p[16]?0:1}r=u(o,[-1,-1,-1]),n=f[r]=c[r](o);let d=o[17]&&o[17].quota>0&&Xx(o),m=o[0].provider&&eb(o);return{c(){R(e.$$.fragment),t=M(),n.c(),s=M(),d&&d.c(),i=M(),m&&m.c(),a=ve()},m(p,y){D(e,p,y),_(p,t,y),f[r].m(p,y),_(p,s,y),d&&d.m(p,y),_(p,i,y),m&&m.m(p,y),_(p,a,y),l=!0},p(p,y){let g=r;r=u(p,y),r===g?f[r].p(p,y):(ie(),k(f[g],1,1,()=>{f[g]=null}),ae(),n=f[r],n?n.p(p,y):(n=f[r]=c[r](p),n.c()),x(n,1),n.m(s.parentNode,s)),p[17]&&p[17].quota>0?d?(d.p(p,y),y[0]&131072&&x(d,1)):(d=Xx(p),d.c(),x(d,1),d.m(i.parentNode,i)):d&&(ie(),k(d,1,1,()=>{d=null}),ae()),p[0].provider?m?(m.p(p,y),y[0]&1&&x(m,1)):(m=eb(p),m.c(),x(m,1),m.m(a.parentNode,a)):m&&(ie(),k(m,1,1,()=>{m=null}),ae())},i(p){l||(x(e.$$.fragment,p),x(n),x(d),x(m),l=!0)},o(p){k(e.$$.fragment,p),k(n),k(d),k(m),l=!1},d(p){p&&(w(t),w(s),w(i),w(a)),F(e,p),f[r].d(p),d&&d.d(p),m&&m.d(p)}}}function M2(o){let e,t;return e=new Pe({props:{name:`Plan: ${o[10].plan}`,description:o[10].cta||"Thanks for supporting Relay development",$$slots:{default:[P2]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n[0]&1024&&(s.name=`Plan: ${r[10].plan}`),n[0]&1024&&(s.description=r[10].cta||"Thanks for supporting Relay development"),n[0]&1024|n[2]&2048&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(x(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function E2(o){let e,t,r=!o[11].values()[0].active||o[11].values()[0].cancelAt,n,s;e=new Pe({props:{name:`Plan: ${o[10].plan}`,description:"",$$slots:{description:[F2],default:[D2]},$$scope:{ctx:o}}});let i=r&&Zx(o);return{c(){R(e.$$.fragment),t=M(),i&&i.c(),n=ve()},m(a,l){D(e,a,l),_(a,t,l),i&&i.m(a,l),_(a,n,l),s=!0},p(a,l){let c={};l[0]&1024&&(c.name=`Plan: ${a[10].plan}`),l[0]&68608|l[2]&2048&&(c.$$scope={dirty:l,ctx:a}),e.$set(c),l[0]&2048&&(r=!a[11].values()[0].active||a[11].values()[0].cancelAt),r?i?(i.p(a,l),l[0]&2048&&x(i,1)):(i=Zx(a),i.c(),x(i,1),i.m(n.parentNode,n)):i&&(ie(),k(i,1,1,()=>{i=null}),ae())},i(a){s||(x(e.$$.fragment,a),x(i),s=!0)},o(a){k(e.$$.fragment,a),k(i),s=!1},d(a){a&&(w(t),w(n)),F(e,a),i&&i.d(a)}}}function P2(o){let e,t,r;return{c(){e=S("button"),e.textContent="Upgrade",h(e,"class","mod-cta")},m(n,s){_(n,e,s),t||(r=z(e,"click",function(){ze((0,ft.debounce)(o[60]))&&(0,ft.debounce)(o[60]).apply(this,arguments)}),t=!0)},p(n,s){o=n},d(n){n&&w(e),t=!1,r()}}}function Qx(o){let e,t,r;return{c(){e=S("button"),e.textContent="Cancel",h(e,"class","mod-destructive")},m(n,s){_(n,e,s),t||(r=z(e,"click",function(){ze((0,ft.debounce)(o[59]))&&(0,ft.debounce)(o[59]).apply(this,arguments)}),t=!0)},p(n,s){o=n},d(n){n&&w(e),t=!1,r()}}}function D2(o){let e,t,r=o[11].values()[0].active&&!o[11].values()[0].cancelAt,n,s,i,a=r&&Qx(o);return{c(){e=S("button"),e.textContent="Manage",t=M(),a&&a.c(),n=ve()},m(l,c){_(l,e,c),_(l,t,c),a&&a.m(l,c),_(l,n,c),s||(i=z(e,"click",function(){ze((0,ft.debounce)(o[58]))&&(0,ft.debounce)(o[58]).apply(this,arguments)}),s=!0)},p(l,c){o=l,c[0]&2048&&(r=o[11].values()[0].active&&!o[11].values()[0].cancelAt),r?a?a.p(o,c):(a=Qx(o),a.c(),a.m(n.parentNode,n)):a&&(a.d(1),a=null)},d(l){l&&(w(e),w(t),w(n)),a&&a.d(l),s=!1,i()}}}function F2(o){let e,t=o[10].cta+"",r;return{c(){e=S("fragment"),r=B(t),h(e,"slot","description")},m(n,s){_(n,e,s),b(e,r)},p(n,s){s[0]&1024&&t!==(t=n[10].cta+"")&&Y(r,t)},d(n){n&&w(e)}}}function Zx(o){let e,t;return e=new Pe({props:{description:"",$$slots:{name:[U2],default:[R2]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n[0]&2048|n[2]&2048&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(x(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function R2(o){let e=o[20](o[11].values()[0].cancelAt)+"",t;return{c(){t=B(e)},m(r,n){_(r,t,n)},p(r,n){n[0]&2048&&e!==(e=r[20](r[11].values()[0].cancelAt)+"")&&Y(t,e)},d(r){r&&w(t)}}}function U2(o){let e;return{c(){e=S("span"),e.textContent="Status: Cancelled",h(e,"slot","name"),h(e,"class","mod-warning")},m(t,r){_(t,e,r)},p:q,d(t){t&&w(e)}}}function Xx(o){let e,t,r,n,s,i,a,l,c,f;return e=new qe({props:{name:"Storage"}}),r=new Ex({props:{diskUsagePercentage:Math.round(o[17].usage*100/o[17].quota)}}),s=new ht({props:{name:"Usage",description:"Storage for images, audio, video, etc",$$slots:{default:[O2]},$$scope:{ctx:o}}}),a=new ht({props:{name:"Total storage",description:"Total available storage.",$$slots:{default:[$2]},$$scope:{ctx:o}}}),c=new ht({props:{name:"File size limit",description:"Maximum supported file size.",$$slots:{default:[N2]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment),t=M(),R(r.$$.fragment),n=M(),R(s.$$.fragment),i=M(),R(a.$$.fragment),l=M(),R(c.$$.fragment)},m(u,d){D(e,u,d),_(u,t,d),D(r,u,d),_(u,n,d),D(s,u,d),_(u,i,d),D(a,u,d),_(u,l,d),D(c,u,d),f=!0},p(u,d){let m={};d[0]&131072&&(m.diskUsagePercentage=Math.round(u[17].usage*100/u[17].quota)),r.$set(m);let p={};d[0]&131072|d[2]&2048&&(p.$$scope={dirty:d,ctx:u}),s.$set(p);let y={};d[0]&131072|d[2]&2048&&(y.$$scope={dirty:d,ctx:u}),a.$set(y);let g={};d[0]&131072|d[2]&2048&&(g.$$scope={dirty:d,ctx:u}),c.$set(g)},i(u){f||(x(e.$$.fragment,u),x(r.$$.fragment,u),x(s.$$.fragment,u),x(a.$$.fragment,u),x(c.$$.fragment,u),f=!0)},o(u){k(e.$$.fragment,u),k(r.$$.fragment,u),k(s.$$.fragment,u),k(a.$$.fragment,u),k(c.$$.fragment,u),f=!1},d(u){u&&(w(t),w(n),w(i),w(l)),F(e,u),F(r,u),F(s,u),F(a,u),F(c,u)}}}function O2(o){let e=Os(o[17].usage)+"",t;return{c(){t=B(e)},m(r,n){_(r,t,n)},p(r,n){n[0]&131072&&e!==(e=Os(r[17].usage)+"")&&Y(t,e)},d(r){r&&w(t)}}}function $2(o){let e=Os(o[17].quota)+"",t;return{c(){t=B(e)},m(r,n){_(r,t,n)},p(r,n){n[0]&131072&&e!==(e=Os(r[17].quota)+"")&&Y(t,e)},d(r){r&&w(t)}}}function N2(o){let e=Os(o[17].maxFileSize)+"",t;return{c(){t=B(e)},m(r,n){_(r,t,n)},p(r,n){n[0]&131072&&e!==(e=Os(r[17].maxFileSize)+"")&&Y(t,e)},d(r){r&&w(t)}}}function eb(o){let e,t,r,n,s,i,a,l,c,f=[V2,B2],u=[];function d(p,y){return p[0].provider.selfHosted?0:1}e=d(o,[-1,-1,-1]),t=u[e]=f[e](o),n=new Pe({props:{name:"Name",description:"",$$slots:{default:[H2]},$$scope:{ctx:o}}}),i=new Pe({props:{name:"Domain",description:"",$$slots:{default:[q2]},$$scope:{ctx:o}}});let m=o[0].provider.selfHosted&&tb(o);return{c(){t.c(),r=M(),R(n.$$.fragment),s=M(),R(i.$$.fragment),a=M(),m&&m.c(),l=ve()},m(p,y){u[e].m(p,y),_(p,r,y),D(n,p,y),_(p,s,y),D(i,p,y),_(p,a,y),m&&m.m(p,y),_(p,l,y),c=!0},p(p,y){let g=e;e=d(p,y),e!==g&&(ie(),k(u[g],1,1,()=>{u[g]=null}),ae(),t=u[e],t||(t=u[e]=f[e](p),t.c()),x(t,1),t.m(r.parentNode,r));let v={};y[0]&1|y[2]&2048&&(v.$$scope={dirty:y,ctx:p}),n.$set(v);let C={};y[0]&1|y[2]&2048&&(C.$$scope={dirty:y,ctx:p}),i.$set(C),p[0].provider.selfHosted?m?m.p(p,y):(m=tb(p),m.c(),m.m(l.parentNode,l)):m&&(m.d(1),m=null)},i(p){c||(x(t),x(n.$$.fragment,p),x(i.$$.fragment,p),c=!0)},o(p){k(t),k(n.$$.fragment,p),k(i.$$.fragment,p),c=!1},d(p){p&&(w(r),w(s),w(a),w(l)),u[e].d(p),F(n,p),F(i,p),m&&m.d(p)}}}function B2(o){let e,t;return e=new qe({props:{name:"Host"}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},i(r){t||(x(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function V2(o){let e,t;return e=new qe({props:{name:"Self hosting"}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},i(r){t||(x(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function H2(o){let e=o[0].provider.name+"",t;return{c(){t=B(e)},m(r,n){_(r,t,n)},p(r,n){n[0]&1&&e!==(e=r[0].provider.name+"")&&Y(t,e)},d(r){r&&w(t)}}}function q2(o){let e=o[0].provider.url+"",t;return{c(){t=B(e)},m(r,n){_(r,t,n)},p(r,n){n[0]&1&&e!==(e=r[0].provider.url+"")&&Y(t,e)},d(r){r&&w(t)}}}function tb(o){let e,t,r={ctx:o,current:null,token:null,hasCatch:!1,pending:j2,then:W2,catch:z2,value:66};return Lo(t=o[19](o[0]),r),{c(){e=ve(),r.block.c()},m(n,s){_(n,e,s),r.block.m(n,r.anchor=s),r.mount=()=>e.parentNode,r.anchor=e},p(n,s){o=n,r.ctx=o,s[0]&1&&t!==(t=o[19](o[0]))&&Lo(t,r)||Es(r,o,s)},d(n){n&&w(e),r.block.d(n),r.token=null,r=null}}}function z2(o){return{c:q,m:q,p:q,d:q}}function W2(o){let e,t=o[66].level==="warning"&&rb(o);return{c(){t&&t.c(),e=ve()},m(r,n){t&&t.m(r,n),_(r,e,n)},p(r,n){r[66].level==="warning"?t?t.p(r,n):(t=rb(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&w(e),t&&t.d(r)}}}function rb(o){let e,t,r=nn(o[66].status)+"",n,s=o[66].link&&ob(o);return{c(){e=S("p"),t=new en(!1),n=M(),s&&s.c(),t.a=n,h(e,"class","mod-warning relay-host-check svelte-3c0ydk")},m(i,a){_(i,e,a),t.m(r,e),b(e,n),s&&s.m(e,null)},p(i,a){a[0]&1&&r!==(r=nn(i[66].status)+"")&&t.p(r),i[66].link?s?s.p(i,a):(s=ob(i),s.c(),s.m(e,null)):s&&(s.d(1),s=null)},d(i){i&&w(e),s&&s.d()}}}function ob(o){let e,t,r,n=nn(o[66].link.text)+"",s;return{c(){e=S("br"),t=M(),r=S("a"),h(r,"href",s=o[66].link.url)},m(i,a){_(i,e,a),_(i,t,a),_(i,r,a),r.innerHTML=n},p(i,a){a[0]&1&&n!==(n=nn(i[66].link.text)+"")&&(r.innerHTML=n),a[0]&1&&s!==(s=i[66].link.url)&&h(r,"href",s)},d(i){i&&(w(e),w(t),w(r))}}}function j2(o){return{c:q,m:q,p:q,d:q}}function nb(o){let e,t,r,n;return e=new qe({props:{name:"Membership"}}),r=new Pe({props:{name:"Leave Relay Server",description:"Leave the Relay Server. Local data is preserved.",$$slots:{default:[K2]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment),t=M(),R(r.$$.fragment)},m(s,i){D(e,s,i),_(s,t,i),D(r,s,i),n=!0},p(s,i){let a={};i[2]&2048&&(a.$$scope={dirty:i,ctx:s}),r.$set(a)},i(s){n||(x(e.$$.fragment,s),x(r.$$.fragment,s),n=!0)},o(s){k(e.$$.fragment,s),k(r.$$.fragment,s),n=!1},d(s){s&&w(t),F(e,s),F(r,s)}}}function K2(o){let e,t,r;return{c(){e=S("button"),e.textContent="Leave",h(e,"class","mod-warning")},m(n,s){_(n,e,s),t||(r=z(e,"click",(0,ft.debounce)(o[61])),t=!0)},p:q,d(n){n&&w(e),t=!1,r()}}}function sb(o){let e,t,r,n;return e=new qe({props:{name:"Danger zone"}}),r=new Pe({props:{name:"Destroy Relay Server",description:"This will destroy the Relay Server (deleting all data on the server). Local data is preserved.",$$slots:{default:[Y2]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment),t=M(),R(r.$$.fragment)},m(s,i){D(e,s,i),_(s,t,i),D(r,s,i),n=!0},p(s,i){let a={};i[0]&2048|i[2]&2048&&(a.$$scope={dirty:i,ctx:s}),r.$set(a)},i(s){n||(x(e.$$.fragment,s),x(r.$$.fragment,s),n=!0)},o(s){k(e.$$.fragment,s),k(r.$$.fragment,s),n=!1},d(s){s&&w(t),F(e,s),F(r,s)}}}function G2(o){let e,t,r;return{c(){e=S("button"),e.textContent="Destroy",h(e,"class","mod-warning")},m(n,s){_(n,e,s),t||(r=z(e,"click",(0,ft.debounce)(o[39])),t=!0)},p:q,d(n){n&&w(e),t=!1,r()}}}function J2(o){let e,t;return{c(){e=S("button"),e.textContent="Destroy",e.disabled=t=!0,h(e,"class","mod-warning"),h(e,"aria-label","Cancel subscription to destroy Relay Server.")},m(r,n){_(r,e,n)},p:q,d(r){r&&w(e)}}}function Y2(o){let e,t;function r(i,a){return a[0]&2048&&(e=null),e==null&&(e=i[11].values().length>0&&!i[11].values()[0].cancelAt),e?J2:G2}let n=r(o,[-1,-1,-1]),s=n(o);return{c(){s.c(),t=ve()},m(i,a){s.m(i,a),_(i,t,a)},p(i,a){n===(n=r(i,a))&&s?s.p(i,a):(s.d(1),s=n(i),s&&(s.c(),s.m(t.parentNode,t)))},d(i){i&&w(t),s.d(i)}}}function Q2(o){let e,t,r,n,s,i,a,l,c,f,u,d,m,p,y,g,v,C,L,T,E=!o[10].owner||o[9].filter(o[45]).values().length>1,O,I,A;e=new Rl({props:{category:Po,categoryText:"Relay Servers",$$slots:{default:[t2]},$$scope:{ctx:o}}}),e.$on("goBack",o[32]);let U=o[0].owner&&Hx(o);n=new qe({props:{name:"Folders on this Relay Server"}});let W=Se(o[13].values()),J=[];for(let $=0;$<W.length;$+=1)J[$]=qx(Vx(o,W,$));let H=$=>k(J[$],1,1,()=>{J[$]=null});a=new Pe({props:{description:"",name:"",$$slots:{default:[u2]},$$scope:{ctx:o}}}),f=new qe({props:{name:"Users",$$slots:{default:[m2]},$$scope:{ctx:o}}});let P=Se(o[6].values().sort(o[21])),V=[];for(let $=0;$<P.length;$+=1)V[$]=jx(Bx(o,P,$));let fe=$=>k(V[$],1,1,()=>{V[$]=null});m=new Pe({props:{description:"",name:"",$$slots:{default:[v2]},$$scope:{ctx:o}}}),y=new qe({props:{name:"Sharing"}}),v=new ht({props:{name:o[0].owner?"Enable key sharing":"Key sharing",$$slots:{description:[I2],default:[w2]},$$scope:{ctx:o}}});let de=o[8]&&Gx(o),le=o[10].owner&&Yx(o),ee=E&&nb(o),re=o[10].owner&&sb(o);return{c(){R(e.$$.fragment),t=M(),U&&U.c(),r=M(),R(n.$$.fragment),s=M();for(let $=0;$<J.length;$+=1)J[$].c();i=M(),R(a.$$.fragment),l=M(),c=S("div"),R(f.$$.fragment),u=M();for(let $=0;$<V.length;$+=1)V[$].c();d=M(),R(m.$$.fragment),p=M(),R(y.$$.fragment),g=M(),R(v.$$.fragment),C=M(),de&&de.c(),L=M(),le&&le.c(),T=M(),ee&&ee.c(),O=M(),re&&re.c(),I=ve(),h(c,"class","users-header")},m($,N){D(e,$,N),_($,t,N),U&&U.m($,N),_($,r,N),D(n,$,N),_($,s,N);for(let pe=0;pe<J.length;pe+=1)J[pe]&&J[pe].m($,N);_($,i,N),D(a,$,N),_($,l,N),_($,c,N),D(f,c,null),_($,u,N);for(let pe=0;pe<V.length;pe+=1)V[pe]&&V[pe].m($,N);_($,d,N),D(m,$,N),_($,p,N),D(y,$,N),_($,g,N),D(v,$,N),_($,C,N),de&&de.m($,N),_($,L,N),le&&le.m($,N),_($,T,N),ee&&ee.m($,N),_($,O,N),re&&re.m($,N),_($,I,N),A=!0},p($,N){let pe={};if(N[0]&1|N[2]&2048&&(pe.$$scope={dirty:N,ctx:$}),e.$set(pe),$[0].owner?U?(U.p($,N),N[0]&1&&x(U,1)):(U=Hx($),U.c(),x(U,1),U.m(r.parentNode,r)):U&&(ie(),k(U,1,1,()=>{U=null}),ae()),N[0]&24576|N[1]&2112){W=Se($[13].values());let te;for(te=0;te<W.length;te+=1){let Oe=Vx($,W,te);J[te]?(J[te].p(Oe,N),x(J[te],1)):(J[te]=qx(Oe),J[te].c(),x(J[te],1),J[te].m(i.parentNode,i))}for(ie(),te=W.length;te<J.length;te+=1)H(te);ae()}let Q={};N[2]&2048&&(Q.$$scope={dirty:N,ctx:$}),a.$set(Q);let Ie={};if(N[0]&33792|N[2]&2048&&(Ie.$$scope={dirty:N,ctx:$}),f.$set(Ie),N[0]&2131010|N[1]&1536){P=Se($[6].values().sort($[21]));let te;for(te=0;te<P.length;te+=1){let Oe=Bx($,P,te);V[te]?(V[te].p(Oe,N),x(V[te],1)):(V[te]=jx(Oe),V[te].c(),x(V[te],1),V[te].m(d.parentNode,d))}for(ie(),te=P.length;te<V.length;te+=1)fe(te);ae()}let Ue={};N[0]&1088|N[2]&2048&&(Ue.$$scope={dirty:N,ctx:$}),m.$set(Ue);let Ne={};N[0]&1&&(Ne.name=$[0].owner?"Enable key sharing":"Key sharing"),N[0]&257|N[2]&2048&&(Ne.$$scope={dirty:N,ctx:$}),v.$set(Ne),$[8]?de?(de.p($,N),N[0]&256&&x(de,1)):(de=Gx($),de.c(),x(de,1),de.m(L.parentNode,L)):de&&(ie(),k(de,1,1,()=>{de=null}),ae()),$[10].owner?le?(le.p($,N),N[0]&1024&&x(le,1)):(le=Yx($),le.c(),x(le,1),le.m(T.parentNode,T)):le&&(ie(),k(le,1,1,()=>{le=null}),ae()),N[0]&1537&&(E=!$[10].owner||$[9].filter($[45]).values().length>1),E?ee?(ee.p($,N),N[0]&1537&&x(ee,1)):(ee=nb($),ee.c(),x(ee,1),ee.m(O.parentNode,O)):ee&&(ie(),k(ee,1,1,()=>{ee=null}),ae()),$[10].owner?re?(re.p($,N),N[0]&1024&&x(re,1)):(re=sb($),re.c(),x(re,1),re.m(I.parentNode,I)):re&&(ie(),k(re,1,1,()=>{re=null}),ae())},i($){if(!A){x(e.$$.fragment,$),x(U),x(n.$$.fragment,$);for(let N=0;N<W.length;N+=1)x(J[N]);x(a.$$.fragment,$),x(f.$$.fragment,$);for(let N=0;N<P.length;N+=1)x(V[N]);x(m.$$.fragment,$),x(y.$$.fragment,$),x(v.$$.fragment,$),x(de),x(le),x(ee),x(re),A=!0}},o($){k(e.$$.fragment,$),k(U),k(n.$$.fragment,$),J=J.filter(Boolean);for(let N=0;N<J.length;N+=1)k(J[N]);k(a.$$.fragment,$),k(f.$$.fragment,$),V=V.filter(Boolean);for(let N=0;N<V.length;N+=1)k(V[N]);k(m.$$.fragment,$),k(y.$$.fragment,$),k(v.$$.fragment,$),k(de),k(le),k(ee),k(re),A=!1},d($){$&&(w(t),w(r),w(s),w(i),w(l),w(c),w(u),w(d),w(p),w(g),w(C),w(L),w(T),w(O),w(I)),F(e,$),U&&U.d($),F(n,$),Je(J,$),F(a,$),F(f),Je(V,$),F(m,$),F(y,$),F(v,$),de&&de.d($),le&&le.d($),ee&&ee.d($),re&&re.d($)}}}function Os(o,e=2){if(o===0)return"0 MB";let t=1024,r=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],n=Math.floor(Math.log(o)/Math.log(t));return(o/Math.pow(t,n)).toFixed(e)+" "+r[n]}function Z2(o){if(/[\\:*?"<>|]/.test(o))return!1;let t=o.split("/");for(let r of t)if(r===""||r==="."||r==="..")return!1;return!0}function X2(o,e,t){let r,n,s,i,a=q,l=()=>(a(),a=Dt(U,X=>t(9,i=X)),U),c,f=q,u=()=>(f(),f=Dt(E,X=>t(10,c=X)),E),d,m,p,y,g=q,v=()=>(g(),g=Dt(A,X=>t(14,y=X)),A),C,L,T;o.$$.on_destroy.push(()=>a()),o.$$.on_destroy.push(()=>f()),o.$$.on_destroy.push(()=>g());let{relay:E}=e;u();let O=E.folders;ce(o,O,X=>t(13,p=X));let{plugin:I}=e,{sharedFolders:A}=e;v();let{relayRoles:U}=e;l();function W(X){return Ee(this,void 0,void 0,function*(){let Ae=yield I.loginManager.checkRelayHost(X.guid);if(Ae.status===200)return Ae.json})}function J(X){if(!X)return"Active";let Ae=gp.moment.utc(),Ze=gp.moment.utc(X),Gt=Ze.diff(Ae,"days");return Gt<=0?"Subscription has ended":Gt===1?"Active for 1 more day":Gt>31?`Ends on ${Ze.format("YYYY-MM-DD")}`:`Active for ${Gt} more days`}function H(X,Ae){var Ze;return X.role==="Owner"&&Ae.role==="Owner"?X.userId===((Ze=I.loginManager.user)===null||Ze===void 0?void 0:Ze.id)?-1:1:X.role==="Owner"&&Ae.role!=="Owner"?-1:X.role!=="Owner"&&Ae.role==="Owner"||X.user.name>Ae.user.name?1:-1}let P=c.subscriptions;ce(o,P,X=>t(11,d=X));let V=Ot(d,X=>{if(X.values().length===0)return;let Ae=X.values()[0];return Ae.token||I.relayManager.getSubscriptionToken(Ae).then(Ze=>{Ae.token=Ze}),Ae});ce(o,V,X=>t(16,L=X));let fe=c.storageQuota;ce(o,fe,X=>t(17,T=X));let de=i.filter(X=>X.relayId===E.id);ce(o,de,X=>t(6,r=X));let le=xe(!0);ce(o,le,X=>t(7,n=X));let ee;Rt(()=>{ee&&ee.value===""&&ee.focus()});let re=pt();function $(X){return Ee(this,void 0,void 0,function*(){var Ae;if(!(!((Ae=I.loginManager)===null||Ae===void 0)&&Ae.user))return;let Ze={relay:X.id,quantity:10,user_email:I.loginManager.user.email},Gt=btoa(JSON.stringify(Ze)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");window.open(I.buildApiUrl(`/subscribe/${Gt}`),"_blank")})}function N(X){return Ee(this,void 0,void 0,function*(){let Ae=X.token,Ze=X.id;window.open(I.buildApiUrl(`/subscriptions/${Ze}/manage?token=${Ae}`),"_blank")})}function pe(X){return Ee(this,void 0,void 0,function*(){let Ae=X.token,Ze=X.id;window.open(I.buildApiUrl(`/subscriptions/${Ze}/cancel?token=${Ae}`),"_blank")})}function Q(X){E.owner&&(te.set(X),I.relayManager.toggleRelayInvitation(Ne,s).then(Ae=>{te.set(Ae.enabled)}))}function Ie(){return Ee(this,void 0,void 0,function*(){I.relayManager.leaveRelay(E),re("goBack",{clear:!0})})}function Ue(){return Ee(this,void 0,void 0,function*(){re("goBack",{clear:!0})})}let Ne,te=xe(!0);ce(o,te,X=>t(8,s=X));let Oe=xe(!1);ce(o,Oe,X=>t(15,C=X)),I.relayManager.getRelayInvitation(E).then(X=>{X&&(t(5,Ne=X),te.set(X.enabled))});function We(){return Ee(this,void 0,void 0,function*(){Ne&&t(5,Ne=yield I.relayManager.rotateKey(Ne).catch(X=>{throw X.status===429&&new ft.Notice("Slow down"),X}))})}function st(X,Ae,Ze){return Ee(this,void 0,void 0,function*(){let Gt=(0,ft.normalizePath)((0,ib.join)(Ze,Ae));I.vault.getFolderByPath(Gt)===null&&(yield I.vault.createFolder(Gt));let qn=I.sharedFolders.new(Gt,X.guid,E.guid,!0);return qn.remote=X,I.sharedFolders.notifyListeners(),qn})}let Ye=xe(!1);ce(o,Ye,X=>t(12,m=X));let ao=I.timeProvider.debounce(()=>{I.relayManager.updateRelay(E).then(()=>{Ye.set(!1)})},500),Fo=X=>{new Nl(I.app,A,X,st).open()};function zs(){le.set(Z2(ee.value)),n&&ee.value!==""&&(Ye.set(!0),ao())}function fn(){I.relayManager.destroyRelay(E),re("goBack",{})}function nr(X){I.relayManager.kick(X)}function lo(X,Ae){return Ee(this,void 0,void 0,function*(){yield I.relayManager.updateRelayRole(X,Ae)})}function Bn(X){return Ee(this,void 0,void 0,function*(){let Ae=X.target,Ze=r.get(Ae.dataset.roleId);if(Ze){let Gt=Ze.role;try{yield lo(Ze,Ae.value)}catch(qn){Ae.value=Gt}}})}function un(X,Ae){X&&re("manageSharedFolder",{folder:X,relay:Ae,mount:!1})}function Ws(X){(X instanceof MouseEvent||X instanceof KeyboardEvent&&(X.key==="Enter"||X.key===" "))&&Oe.update(Ae=>!Ae)}let Vn=new Ul(I.app,A,X=>Ee(void 0,void 0,void 0,function*(){let Ae=(0,ft.normalizePath)(X),Ze=A.find(_c=>_c.path==X);if(Ze){let _c=yield I.relayManager.createRemoteFolder(Ze,E);Ze.remote=_c,Ze.connect(),I.sharedFolders.notifyListeners();return}I.vault.getFolderByPath(Ae)===null&&(yield I.vault.createFolder(Ae));let Gt=ns(),qn=I.sharedFolders.new((0,ft.normalizePath)(X),Gt,E.guid,!0),Iw=yield I.relayManager.createRemoteFolder(qn,E);qn.remote=Iw,I.sharedFolders.notifyListeners()})),js=X=>X.role==="Owner"&&X.relayId===E.id,Ks=(X,Ae)=>Ae.remote===X;function Gs(){E.name=this.value,u(t(0,E))}function Js(X){er[X?"unshift":"push"](()=>{ee=X,t(4,ee)})}let se=(X,Ae)=>Ae.remote===X;function He(X){Ir.call(this,o,X)}let Qe=X=>{let Ae=y.find(Ze=>Ze.remote===X);Ae&&un(Ae,X.relay)},qr=X=>{Fo(X)},Hn=()=>{Vn.open()},wc=X=>{nr(X)},Z=X=>Q(X.currentTarget.checked),Ce=()=>Q(!s),ut=()=>Q(!s),Ro=()=>{N(L)},Tr=()=>{pe(L)},Sw=()=>{$(c)},kw=()=>{Ie()};return o.$$set=X=>{"relay"in X&&u(t(0,E=X.relay)),"plugin"in X&&t(1,I=X.plugin),"sharedFolders"in X&&v(t(2,A=X.sharedFolders)),"relayRoles"in X&&l(t(3,U=X.relayRoles))},[E,I,A,U,ee,Ne,r,n,s,i,c,d,m,p,y,C,L,T,O,W,J,H,P,V,fe,de,le,$,N,pe,Q,Ie,Ue,te,Oe,We,Ye,Fo,zs,fn,nr,Bn,un,Ws,Vn,js,Ks,Gs,Js,se,He,Qe,qr,Hn,wc,Z,Ce,ut,Ro,Tr,Sw,kw]}var yp=class extends K{constructor(e){super(),G(this,e,X2,Q2,j,{relay:0,plugin:1,sharedFolders:2,relayRoles:3},ZL,[-1,-1,-1])}},$s=yp;function eT(o){let e,t,r,n,s,i;return r=new Eu({}),{c(){e=S("div"),t=S("div"),R(r.$$.fragment),h(t,"class","clickable-icon"),h(t,"aria-label","Back"),h(t,"tabindex","0"),h(t,"role","button"),h(e,"class","modal-setting-nav-bar")},m(a,l){_(a,e,l),b(e,t),D(r,t,null),n=!0,s||(i=[z(t,"click",o[0]),z(t,"keypress",o[1])],s=!0)},p:q,i(a){n||(x(r.$$.fragment,a),n=!0)},o(a){k(r.$$.fragment,a),n=!1},d(a){a&&w(e),F(r),s=!1,we(i)}}}function tT(o){let e=pt();function t(){e("goBack",{})}function r(n){n.key==="Escape"&&(e("goBack",{}),n.stopPropagation())}return[t,r]}var xp=class extends K{constructor(e){super(),G(this,e,tT,eT,j,{})}},ab=xp;var sn=require("obsidian");function lb(o,e,t){let r=o.slice();return r[32]=e[t][0],r[33]=e[t][1],r}function rT(o){let e=o[1].name+"",t;return{c(){t=B(e)},m(r,n){_(r,t,n)},p(r,n){n[0]&2&&e!==(e=r[1].name+"")&&Y(t,e)},d(r){r&&w(t)}}}function oT(o){let e,t;return e=new Pe({props:{description:"This folder is tracking edits, but is not connected to a Relay Server."}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p:q,i(r){t||(x(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function nT(o){let e,t;return e=new ht({props:{$$slots:{name:[aT],default:[sT]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n[0]&128|n[1]&32&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(x(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function sT(o){let e,t;return e=new $n({}),e.$on("settings",function(){ze((0,sn.debounce)(o[22]))&&(0,sn.debounce)(o[22]).apply(this,arguments)}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){o=r},i(r){t||(x(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function iT(o){let e=o[7].name+"",t;return{c(){t=B(e)},m(r,n){_(r,t,n)},p(r,n){n[0]&128&&e!==(e=r[7].name+"")&&Y(t,e)},d(r){r&&w(t)}}}function aT(o){let e,t;return e=new Po({props:{slot:"name",relay:o[7],$$slots:{default:[iT]},$$scope:{ctx:o}}}),e.$on("manageRelay",o[21]),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n[0]&128&&(s.relay=r[7]),n[0]&128|n[1]&32&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(x(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function cb(o){let e,t,r,n,s;e=new qe({props:{name:"Sync settings",helpText:"You must have attachment storage available in order to sync attachments."}});let i=Se(o[4]),a=[];for(let f=0;f<i.length;f+=1)a[f]=ub(lb(o,i,f));let l=f=>k(a[f],1,1,()=>{a[f]=null}),c=o[6]&&o[7]&&db(o);return{c(){R(e.$$.fragment),t=M();for(let f=0;f<a.length;f+=1)a[f].c();r=M(),c&&c.c(),n=ve()},m(f,u){D(e,f,u),_(f,t,u);for(let d=0;d<a.length;d+=1)a[d]&&a[d].m(f,u);_(f,r,u),c&&c.m(f,u),_(f,n,u),s=!0},p(f,u){if(u[0]&16728){i=Se(f[4]);let d;for(d=0;d<i.length;d+=1){let m=lb(f,i,d);a[d]?(a[d].p(m,u),x(a[d],1)):(a[d]=ub(m),a[d].c(),x(a[d],1),a[d].m(r.parentNode,r))}for(ie(),d=i.length;d<a.length;d+=1)l(d);ae()}f[6]&&f[7]?c?(c.p(f,u),u[0]&192&&x(c,1)):(c=db(f),c.c(),x(c,1),c.m(n.parentNode,n)):c&&(ie(),k(c,1,1,()=>{c=null}),ae())},i(f){if(!s){x(e.$$.fragment,f);for(let u=0;u<i.length;u+=1)x(a[u]);x(c),s=!0}},o(f){k(e.$$.fragment,f),a=a.filter(Boolean);for(let u=0;u<a.length;u+=1)k(a[u]);k(c),s=!1},d(f){f&&(w(t),w(r),w(n)),F(e,f),Je(a,f),c&&c.d(f)}}}function fb(o){let e,t;return e=new Fl({}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},i(r){t||(x(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function lT(o){let e,t,r,n,s,i,a,l,c,f,u,d=o[6]&&fb(o);function m(...g){return o[23](o[32],...g)}function p(){return o[24](o[32])}function y(){return o[25](o[32])}return{c(){e=S("div"),d&&d.c(),t=M(),r=S("div"),n=S("input"),i=M(),a=S("div"),h(n,"type","checkbox"),n.checked=s=o[8][o[32]]&&!o[6],n.disabled=o[3],h(a,"class","checkbox-toggle"),h(r,"role","checkbox"),h(r,"aria-checked",l=o[8][o[32]]&&!o[6]),h(r,"tabindex","0"),h(r,"class","checkbox-container"),Me(r,"is-enabled",o[8][o[32]]&&!o[6]),h(e,"class","setting-item-control")},m(g,v){_(g,e,v),d&&d.m(e,null),b(e,t),b(e,r),b(r,n),b(r,i),b(r,a),c=!0,f||(u=[z(n,"change",m),z(r,"keypress",p),z(r,"click",y)],f=!0)},p(g,v){o=g,o[6]?d?v[0]&64&&x(d,1):(d=fb(o),d.c(),x(d,1),d.m(e,t)):d&&(ie(),k(d,1,1,()=>{d=null}),ae()),(!c||v[0]&336&&s!==(s=o[8][o[32]]&&!o[6]))&&(n.checked=s),(!c||v[0]&8)&&(n.disabled=o[3]),(!c||v[0]&336&&l!==(l=o[8][o[32]]&&!o[6]))&&h(r,"aria-checked",l),(!c||v[0]&336)&&Me(r,"is-enabled",o[8][o[32]]&&!o[6])},i(g){c||(x(d),c=!0)},o(g){k(d),c=!1},d(g){g&&w(e),d&&d.d(),f=!1,we(u)}}}function ub(o){let e,t;return e=new ht({props:{name:o[33].name,description:o[33].description,$$slots:{default:[lT]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n[0]&16&&(s.name=r[33].name),n[0]&16&&(s.description=r[33].description),n[0]&344|n[1]&32&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(x(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function db(o){let e,t;return e=new ht({props:{name:"",$$slots:{default:[cT]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n[0]&128|n[1]&32&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(x(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function cT(o){let e,t,r;return{c(){e=S("button"),e.textContent="Buy storage",h(e,"class","mod-cta")},m(n,s){_(n,e,s),t||(r=z(e,"click",function(){ze((0,sn.debounce)(o[26]))&&(0,sn.debounce)(o[26]).apply(this,arguments)}),t=!0)},p(n,s){o=n},d(n){n&&w(e),t=!1,r()}}}function fT(o){let e,t,r;return{c(){e=S("button"),e.textContent="Delete local",h(e,"class","mod-warning")},m(n,s){_(n,e,s),t||(r=z(e,"click",(0,sn.debounce)(o[27])),t=!0)},p:q,d(n){n&&w(e),t=!1,r()}}}function uT(o){let e,t,r,n,s,i,a;return{c(){e=S("button"),t=B("Delete metadata"),h(e,"class",r=o[7]?"mod-disabled":"mod-warning"),e.disabled=n=!!o[7],h(e,"aria-label",s=o[7]?"Metadata is required for sharing.":"")},m(l,c){_(l,e,c),b(e,t),i||(a=z(e,"click",(0,sn.debounce)(o[28])),i=!0)},p(l,c){c[0]&128&&r!==(r=l[7]?"mod-disabled":"mod-warning")&&h(e,"class",r),c[0]&128&&n!==(n=!!l[7])&&(e.disabled=n),c[0]&128&&s!==(s=l[7]?"Metadata is required for sharing.":"")&&h(e,"aria-label",s)},d(l){l&&w(e),i=!1,a()}}}function pb(o){var n,s,i,a,l;let e,t,r=(((n=o[7])==null?void 0:n.owner)||((a=(i=(s=o[5])==null?void 0:s.remote)==null?void 0:i.creator)==null?void 0:a.id)===((l=o[0].relayManager.user)==null?void 0:l.id))&&mb(o);return{c(){r&&r.c(),e=ve()},m(c,f){r&&r.m(c,f),_(c,e,f),t=!0},p(c,f){var u,d,m,p,y;(u=c[7])!=null&&u.owner||((p=(m=(d=c[5])==null?void 0:d.remote)==null?void 0:m.creator)==null?void 0:p.id)===((y=c[0].relayManager.user)==null?void 0:y.id)?r?(r.p(c,f),f[0]&161&&x(r,1)):(r=mb(c),r.c(),x(r,1),r.m(e.parentNode,e)):r&&(ie(),k(r,1,1,()=>{r=null}),ae())},i(c){t||(x(r),t=!0)},o(c){k(r),t=!1},d(c){c&&w(e),r&&r.d(c)}}}function mb(o){let e,t,r,n;return e=new qe({props:{name:"Remote Folder"}}),r=new Pe({props:{name:"Remove from relay",description:"Deletes the remote folder from the relay. Local files will be preserved.",$$slots:{default:[dT]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment),t=M(),R(r.$$.fragment)},m(s,i){D(e,s,i),_(s,t,i),D(r,s,i),n=!0},p(s,i){let a={};i[1]&32&&(a.$$scope={dirty:i,ctx:s}),r.$set(a)},i(s){n||(x(e.$$.fragment,s),x(r.$$.fragment,s),n=!0)},o(s){k(e.$$.fragment,s),k(r.$$.fragment,s),n=!1},d(s){s&&w(t),F(e,s),F(r,s)}}}function dT(o){let e,t,r;return{c(){e=S("button"),e.textContent="Delete remote",h(e,"class","mod-destructive")},m(n,s){_(n,e,s),t||(r=z(e,"click",(0,sn.debounce)(o[17])),t=!0)},p:q,d(n){n&&w(e),t=!1,r()}}}function pT(o){let e,t,r,n,s,i,a,l=o[7]&&Ve().enableAttachmentSync,c,f,u,d,m,p,y,g,v;e=new Rl({props:{category:oo,categoryText:"Shared Folders",$$slots:{default:[rT]},$$scope:{ctx:o}}}),e.$on("goBack",o[15]),r=new qe({props:{name:"Relay Server"}});let C=[nT,oT],L=[];function T(I,A){return I[7]?0:1}s=T(o,[-1,-1]),i=L[s]=C[s](o);let E=l&&cb(o);f=new qe({props:{name:"Local folder"}}),d=new Pe({props:{name:"Delete from vault",description:"Delete the local Shared Folder and all of its contents.",$$slots:{default:[fT]},$$scope:{ctx:o}}}),p=new Pe({props:{name:"Delete metadata",description:"Deletes edit history and disables change tracking.",$$slots:{default:[uT]},$$scope:{ctx:o}}});let O=o[7]&&pb(o);return{c(){R(e.$$.fragment),t=M(),R(r.$$.fragment),n=M(),i.c(),a=M(),E&&E.c(),c=M(),R(f.$$.fragment),u=M(),R(d.$$.fragment),m=M(),R(p.$$.fragment),y=M(),O&&O.c(),g=ve()},m(I,A){D(e,I,A),_(I,t,A),D(r,I,A),_(I,n,A),L[s].m(I,A),_(I,a,A),E&&E.m(I,A),_(I,c,A),D(f,I,A),_(I,u,A),D(d,I,A),_(I,m,A),D(p,I,A),_(I,y,A),O&&O.m(I,A),_(I,g,A),v=!0},p(I,A){let U={};A[0]&2|A[1]&32&&(U.$$scope={dirty:A,ctx:I}),e.$set(U);let W=s;s=T(I,A),s===W?L[s].p(I,A):(ie(),k(L[W],1,1,()=>{L[W]=null}),ae(),i=L[s],i?i.p(I,A):(i=L[s]=C[s](I),i.c()),x(i,1),i.m(a.parentNode,a)),A[0]&128&&(l=I[7]&&Ve().enableAttachmentSync),l?E?(E.p(I,A),A[0]&128&&x(E,1)):(E=cb(I),E.c(),x(E,1),E.m(c.parentNode,c)):E&&(ie(),k(E,1,1,()=>{E=null}),ae());let J={};A[1]&32&&(J.$$scope={dirty:A,ctx:I}),d.$set(J);let H={};A[0]&128|A[1]&32&&(H.$$scope={dirty:A,ctx:I}),p.$set(H),I[7]?O?(O.p(I,A),A[0]&128&&x(O,1)):(O=pb(I),O.c(),x(O,1),O.m(g.parentNode,g)):O&&(ie(),k(O,1,1,()=>{O=null}),ae())},i(I){v||(x(e.$$.fragment,I),x(r.$$.fragment,I),x(i),x(E),x(f.$$.fragment,I),x(d.$$.fragment,I),x(p.$$.fragment,I),x(O),v=!0)},o(I){k(e.$$.fragment,I),k(r.$$.fragment,I),k(i),k(E),k(f.$$.fragment,I),k(d.$$.fragment,I),k(p.$$.fragment,I),k(O),v=!1},d(I){I&&(w(t),w(n),w(a),w(c),w(u),w(m),w(y),w(g)),F(e,I),F(r,I),L[s].d(I),E&&E.d(I),F(f,I),F(d,I),F(p,I),O&&O.d(I)}}}function mT(o,e,t){let r,n,s,i,a=q,l=()=>(a(),a=Dt(m,N=>t(29,i=N)),m),c,f;o.$$.on_destroy.push(()=>a());let{plugin:u}=e,{sharedFolder:d}=e,{sharedFolders:m}=e;l();let{relayRoles:p}=e;function y(N){return Ee(this,void 0,void 0,function*(){var pe;if(!(!((pe=u.loginManager)===null||pe===void 0)&&pe.user))return;let Q={relay:N.id,quantity:10,user_email:u.loginManager.user.email},Ie=btoa(JSON.stringify(Q)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");window.open(u.buildApiUrl(`/subscribe/${Ie}?action="buy_storage"`),"_blank")})}let g=Ot(i,N=>N.find(pe=>pe===d));ce(o,g,N=>t(5,n=N));let v=d.syncSettingsManager;ce(o,v,N=>t(8,f=N));let C=Ot([g,p],([N,pe])=>{var Q;return(Q=pe.find(Ie=>{var Ue;return Ie.relay===((Ue=N==null?void 0:N.remote)===null||Ue===void 0?void 0:Ue.relay)}))===null||Q===void 0?void 0:Q.relay});ce(o,C,N=>t(7,c=N));let L=Ot([g,p],([N,pe])=>{var Q,Ie,Ue;return((Ue=(Ie=(Q=pe.find(Ne=>{var te;return Ne.relay===((te=N==null?void 0:N.remote)===null||te===void 0?void 0:te.relay)}))===null||Q===void 0?void 0:Q.relay)===null||Ie===void 0?void 0:Ie.storageQuota)===null||Ue===void 0?void 0:Ue.quota)===0});ce(o,L,N=>t(6,s=N));let T=!1;function E(N,pe){return Ee(this,void 0,void 0,function*(){if(!T&&!s){t(3,T=!0);try{yield v.toggleCategory(N,pe),t(4,r=Object.entries(v.getCategories()))}catch(Q){}finally{t(3,T=!1)}}})}let O;Rt(()=>{!d&&O&&O.value===""&&O.focus()});let I=pt();function A(){return Ee(this,void 0,void 0,function*(){I("goBack",{clear:!0})})}function U(N){N&&I("manageRelay",{relay:N})}function W(){return Ee(this,void 0,void 0,function*(){yield u.relayManager.deleteRemote(d),u.sharedFolders.notifyListeners()})}function J(){return Ee(this,void 0,void 0,function*(){n&&u.sharedFolders.delete(n),I("goBack",{clear:!0})})}function H(){let N=u.vault.getFolderByPath(d.path);N&&u.app.vault.trash(N,!1),I("goBack",{})}function P(N){Ir.call(this,o,N)}let V=()=>{U(c)},fe=(N,pe)=>E(N,pe.currentTarget.checked),de=N=>E(N,!f[N]),le=N=>E(N,!f[N]),ee=()=>{y(c)},re=()=>{H()},$=()=>{J()};o.$$set=N=>{"plugin"in N&&t(0,u=N.plugin),"sharedFolder"in N&&t(1,d=N.sharedFolder),"sharedFolders"in N&&l(t(2,m=N.sharedFolders)),"relayRoles"in N&&t(20,p=N.relayRoles)};e:t(4,r=Object.entries(v.getCategories()));return[u,d,m,T,r,n,s,c,f,y,g,v,C,L,E,A,U,W,J,H,p,P,V,fe,de,le,ee,re,$]}var bp=class extends K{constructor(e){super(),G(this,e,mT,pT,j,{plugin:0,sharedFolder:1,sharedFolders:2,relayRoles:20},null,[-1,-1])}},vp=bp;function hT(o){_e(o,"svelte-d22j3",".relay-version.svelte-d22j3{user-select:auto;background:var(--color-base-10);color:var(--text-faint);position:absolute;bottom:0;right:0;font-size:xx-small;padding-right:1em;padding-top:0.3em;padding-left:1em;border-top-left-radius:1em}.vertical-tab-content.svelte-d22j3{max-height:var(--modal-max-height);position:relative}.system3-announcement-banner.svelte-d22j3{padding-left:48px !important}.system3-announcement.svelte-d22j3{color:var(--text-on-accent)}")}function gT(o){let e,t,r,n,s=o[0].networkStatus.status&&hb(o);return{c(){e=S("div"),t=S("span"),s&&s.c(),h(t,"class","system3-announcement svelte-d22j3"),ue(t,"color",o[0].networkStatus.status.color?o[0].networkStatus.status.color:"var(--text-on-accent)",1),h(e,"class","modal-setting-nav-bar system3-announcement-banner svelte-d22j3"),h(e,"role","button"),h(e,"tabindex","0"),ue(e,"background-color",o[0].networkStatus.status.backgroundColor?o[0].networkStatus.status.backgroundColor:"var(--color-accent)",1)},m(i,a){_(i,e,a),b(e,t),s&&s.m(t,null),r||(n=[z(e,"click",o[19]),z(e,"keypress",o[20])],r=!0)},p(i,a){i[0].networkStatus.status?s?s.p(i,a):(s=hb(i),s.c(),s.m(t,null)):s&&(s.d(1),s=null),a&1&&ue(t,"color",i[0].networkStatus.status.color?i[0].networkStatus.status.color:"var(--text-on-accent)",1),a&1&&ue(e,"background-color",i[0].networkStatus.status.backgroundColor?i[0].networkStatus.status.backgroundColor:"var(--color-accent)",1)},i:q,o:q,d(i){i&&w(e),s&&s.d(),r=!1,we(n)}}}function yT(o){let e,t;return e=new ab({}),e.$on("goBack",o[11]),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p:q,i(r){t||(x(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function hb(o){let e,t=nn(o[0].networkStatus.status.status)+"",r;return{c(){e=new en(!1),r=ve(),e.a=r},m(n,s){e.m(t,n,s),_(n,r,s)},p(n,s){s&1&&t!==(t=nn(n[0].networkStatus.status.status)+"")&&e.p(t)},d(n){n&&(w(r),e.d())}}}function xT(o){let e,t;return e=new lx({props:{plugin:o[0],$$slots:{default:[wT]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n&1&&(s.plugin=r[0]),n&33554433&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(x(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function bT(o){let e,t;return e=new $s({props:{plugin:o[0],relayRoles:o[3],relay:o[2],sharedFolders:o[7]}}),e.$on("goBack",o[11]),e.$on("close",o[12]),e.$on("manageSharedFolder",o[9]),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n&1&&(s.plugin=r[0]),n&4&&(s.relay=r[2]),e.$set(s)},i(r){t||(x(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function vT(o){let e,t;return e=new vp({props:{plugin:o[0],relayRoles:o[3],sharedFolder:o[1],sharedFolders:o[7]}}),e.$on("goBack",o[11]),e.$on("close",o[12]),e.$on("manageRelay",o[8]),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n&1&&(s.plugin=r[0]),n&2&&(s.sharedFolder=r[1]),e.$set(s)},i(r){t||(x(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function wT(o){let e,t;return e=new so({props:{relays:o[4],subscriptions:o[5],providers:o[6],plugin:o[0]}}),e.$on("manageRelay",o[8]),e.$on("manageSharedFolder",o[9]),e.$on("createRelay",o[10]),e.$on("joinRelay",o[13]),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n&1&&(s.plugin=r[0]),e.$set(s)},i(r){t||(x(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function gb(o){let e,t=o[0].version+"",r;return{c(){e=S("span"),r=B(t),h(e,"class","relay-version svelte-d22j3")},m(n,s){_(n,e,s),b(e,r)},p(n,s){s&1&&t!==(t=n[0].version+"")&&Y(r,t)},d(n){n&&w(e)}}}function _T(o){let e,t,r,n,s,i,a,l,c,f=[yT,gT],u=[];function d(v,C){return v[2]||v[1]?0:v[0].networkStatus.status?1:-1}~(e=d(o,-1))&&(t=u[e]=f[e](o));let m=[vT,bT,xT],p=[];function y(v,C){return v[1]?0:v[2]?1:2}s=y(o,-1),i=p[s]=m[s](o);let g=o[0].manifest.version!==o[0].version&&gb(o);return{c(){t&&t.c(),r=M(),n=S("div"),i.c(),a=M(),g&&g.c(),l=ve(),h(n,"class","vertical-tab-content svelte-d22j3")},m(v,C){~e&&u[e].m(v,C),_(v,r,C),_(v,n,C),p[s].m(n,null),_(v,a,C),g&&g.m(v,C),_(v,l,C),c=!0},p(v,[C]){let L=e;e=d(v,C),e===L?~e&&u[e].p(v,C):(t&&(ie(),k(u[L],1,1,()=>{u[L]=null}),ae()),~e?(t=u[e],t?t.p(v,C):(t=u[e]=f[e](v),t.c()),x(t,1),t.m(r.parentNode,r)):t=null);let T=s;s=y(v,C),s===T?p[s].p(v,C):(ie(),k(p[T],1,1,()=>{p[T]=null}),ae(),i=p[s],i?i.p(v,C):(i=p[s]=m[s](v),i.c()),x(i,1),i.m(n,null)),v[0].manifest.version!==v[0].version?g?g.p(v,C):(g=gb(v),g.c(),g.m(l.parentNode,l)):g&&(g.d(1),g=null)},i(v){c||(x(t),x(i),c=!0)},o(v){k(t),k(i),c=!1},d(v){v&&(w(r),w(n),w(a),w(l)),~e&&u[e].d(v),p[s].d(),g&&g.d(v)}}}function ST(o,e,t){let r,{plugin:n}=e,{path:s=void 0}=e,i=n.app,a=n.relayManager,l=a.relayRoles,c=a.relays;ce(o,c,H=>t(18,r=H));let f=a.subscriptions,u=a.providers,d=n.sharedFolders,m,p=so,y,g=[{component:so}],{close:v}=e;function C(H){if(t(2,y=void 0),t(1,m=void 0),H==="/"){t(17,p=so);return}let P=new URLSearchParams(H.split("?")[1]||""),V=P.get("id");if(H.startsWith("/relays")){V?(t(2,y=a.relays.find(fe=>fe.guid===V)),t(17,p=$s)):t(17,p=so);return}if(H.startsWith("/shared-folders")){if(V){t(1,m=d.find(de=>de.guid===V));let fe=P.get("relay");fe&&t(2,y=a.relays.get(fe)),t(17,p=vp)}return}}function L(H){g.push({currentRelay:y,sharedFolder:m,component:p}),t(2,y=H.detail.relay),t(1,m=void 0),t(17,p=$s)}function T(H){g.push({currentRelay:y,sharedFolder:m,component:p}),t(1,m=H.detail.folder),t(2,y=H.detail.relay)}function E(H){return Ee(this,void 0,void 0,function*(){g.push({currentRelay:y,sharedFolder:m,component:p}),t(2,y=yield n.relayManager.createRelay("")),t(17,p=$s)})}function O(H){if(H.detail.clear){g.length=0,t(2,y=void 0),t(1,m=void 0),t(17,p=so);return}let P=g.pop();if(P)for(;P;){if(!P.currentRelay&&!P.sharedFolder)t(2,y=P.currentRelay),t(1,m=P.sharedFolder),t(17,p=P.component);else if(P.sharedFolder&&d.has(P.sharedFolder)){t(2,y=P.currentRelay),t(1,m=P.sharedFolder),t(17,p=P.component);break}else if(P.currentRelay&&a.relays.get(P.currentRelay.id)){t(2,y=P.currentRelay),t(1,m=P.sharedFolder),t(17,p=P.component);break}P=g.pop()}else t(2,y=void 0),t(1,m=void 0),t(17,p=so)}function I(H){g.length=0,v()}function A(H){t(2,y=H.detail.relay),t(17,p=$s)}function U(){var H;!((H=n.networkStatus.status)===null||H===void 0)&&H.versions&&(n.releaseSettings.get().channel==="stable"?n.installVersion(n.networkStatus.status.versions.stable):n.releaseSettings.get().channel==="beta"&&n.installVersion(n.networkStatus.status.versions.beta))}let W=()=>{var H,P;(H=n.networkStatus.status)!=null&&H.versions?U():(P=n.networkStatus.status)!=null&&P.link&&window.open(n.networkStatus.status.link)},J=()=>{var H,P;(H=n.networkStatus.status)!=null&&H.versions?U():(P=n.networkStatus.status)!=null&&P.link&&window.open(n.networkStatus.status.link)};return o.$$set=H=>{"plugin"in H&&t(0,n=H.plugin),"path"in H&&t(15,s=H.path),"close"in H&&t(16,v=H.close)},o.$$.update=()=>{if(o.$$.dirty&32768){e:s&&C(s)}if(o.$$.dirty&262148){e:y&&!r.has(y.id)&&(t(2,y=void 0),t(17,p=so))}if(o.$$.dirty&2){e:m&&!d.has(m)&&(t(1,m=void 0),t(17,p=so))}if(o.$$.dirty&131078){e:(p||y||m)&&setTimeout(()=>{let H=document.querySelector(".vertical-tab-content");H&&(H.scrollTop=0)},0)}},[n,m,y,l,c,f,u,d,L,T,E,O,I,A,U,s,v,p,r,W,J]}var wp=class extends K{constructor(e){super(),G(this,e,ST,_T,j,{plugin:0,path:15,close:16},hT)}},yb=wp;var Bl=class extends xb.PluginSettingTab{constructor(t,r){super(t,r);this.plugin=r}display(){let{containerEl:t}=this;this.targetEl=t.parentElement,this.targetEl.empty(),this.plugin.relayManager.update(),this.component=new yb({target:this.targetEl,props:{plugin:this.plugin,close:()=>{this.setting.close()}}})}navigateTo(t){var r;(r=this.component)==null||r.$set({path:t})}hide(){var t;try{(t=this.component)==null||t.$destroy()}catch(r){console.warn(r)}}destroy(){this.hide(),this.plugin=null}};var nc=require("obsidian");var Vl=class extends Li{constructor(t="pocketbase_auth"){super();this.storageFallback={};this._storageChangeHandler=t=>{if(t.key!=this.storageKey)return;let r=this._storageGet(this.storageKey)||{};super.save(r.token||"",r.model||null)};this.storageKey=t,this._bindStorageEvent()}get token(){return(this._storageGet(this.storageKey)||{}).token||""}get model(){return(this._storageGet(this.storageKey)||{}).model||null}save(t,r){this._storageSet(this.storageKey,{token:t,model:r}),super.save(t,r)}clear(){this._storageRemove(this.storageKey),super.clear()}destroy(){this._unbindStorageEvent()}_storageGet(t){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let r=window.localStorage.getItem(t)||"";try{return JSON.parse(r)}catch(n){return r}}return this.storageFallback[t]}_storageSet(t,r){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let n=r;typeof r!="string"&&(n=JSON.stringify(r)),window.localStorage.setItem(t,n)}else this.storageFallback[t]=r}_storageRemove(t){var r;typeof window!="undefined"&&(window!=null&&window.localStorage)&&((r=window.localStorage)==null||r.removeItem(t)),delete this.storageFallback[t]}_bindStorageEvent(){if(typeof window=="undefined"||!(window!=null&&window.localStorage)||!window.addEventListener)return()=>{};window.addEventListener("storage",this._storageChangeHandler)}_unbindStorageEvent(){if(typeof window=="undefined"||!(window!=null&&window.localStorage)||!window.addEventListener)return()=>{};window.removeEventListener("storage",this._storageChangeHandler)}};var vt=crypto,Lr=o=>o instanceof CryptoKey;var or=new TextEncoder,$t=new TextDecoder,n5=2**32;function an(...o){let e=o.reduce((n,{length:s})=>n+s,0),t=new Uint8Array(e),r=0;for(let n of o)t.set(n,r),r+=n.length;return t}var bb=o=>{let e=o;typeof e=="string"&&(e=or.encode(e));let t=32768,r=[];for(let n=0;n<e.length;n+=t)r.push(String.fromCharCode.apply(null,e.subarray(n,n+t)));return btoa(r.join(""))},Vr=o=>bb(o).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),vb=o=>{let e=atob(o),t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t},io=o=>{let e=o;e instanceof Uint8Array&&(e=$t.decode(e)),e=e.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return vb(e)}catch(t){throw new TypeError("The input to be decoded is not correctly encoded.")}};var _p={};kc(_p,{JOSEAlgNotAllowed:()=>Bs,JOSEError:()=>Lt,JOSENotSupported:()=>nt,JWEDecryptionFailed:()=>qi,JWEInvalid:()=>dr,JWKInvalid:()=>Hl,JWKSInvalid:()=>ql,JWKSMultipleMatchingKeys:()=>zl,JWKSNoMatchingKey:()=>zi,JWKSTimeout:()=>Wl,JWSInvalid:()=>rt,JWSSignatureVerificationFailed:()=>Vs,JWTClaimValidationFailed:()=>jt,JWTExpired:()=>Ns,JWTInvalid:()=>Ut});var Lt=class extends Error{static get code(){return"ERR_JOSE_GENERIC"}constructor(e){var t;super(e),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,(t=Error.captureStackTrace)==null||t.call(Error,this,this.constructor)}},jt=class extends Lt{static get code(){return"ERR_JWT_CLAIM_VALIDATION_FAILED"}constructor(e,t="unspecified",r="unspecified"){super(e),this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=t,this.reason=r}},Ns=class extends Lt{static get code(){return"ERR_JWT_EXPIRED"}constructor(e,t="unspecified",r="unspecified"){super(e),this.code="ERR_JWT_EXPIRED",this.claim=t,this.reason=r}},Bs=class extends Lt{constructor(){super(...arguments),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}static get code(){return"ERR_JOSE_ALG_NOT_ALLOWED"}},nt=class extends Lt{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}static get code(){return"ERR_JOSE_NOT_SUPPORTED"}},qi=class extends Lt{constructor(){super(...arguments),this.code="ERR_JWE_DECRYPTION_FAILED",this.message="decryption operation failed"}static get code(){return"ERR_JWE_DECRYPTION_FAILED"}},dr=class extends Lt{constructor(){super(...arguments),this.code="ERR_JWE_INVALID"}static get code(){return"ERR_JWE_INVALID"}},rt=class extends Lt{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}static get code(){return"ERR_JWS_INVALID"}},Ut=class extends Lt{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}static get code(){return"ERR_JWT_INVALID"}},Hl=class extends Lt{constructor(){super(...arguments),this.code="ERR_JWK_INVALID"}static get code(){return"ERR_JWK_INVALID"}},ql=class extends Lt{constructor(){super(...arguments),this.code="ERR_JWKS_INVALID"}static get code(){return"ERR_JWKS_INVALID"}},zi=class extends Lt{constructor(){super(...arguments),this.code="ERR_JWKS_NO_MATCHING_KEY",this.message="no applicable key found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_NO_MATCHING_KEY"}},zl=class extends Lt{constructor(){super(...arguments),this.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS",this.message="multiple matching keys found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_MULTIPLE_MATCHING_KEYS"}},Wl=class extends Lt{constructor(){super(...arguments),this.code="ERR_JWKS_TIMEOUT",this.message="request timed out"}static get code(){return"ERR_JWKS_TIMEOUT"}},Vs=class extends Lt{constructor(){super(...arguments),this.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED",this.message="signature verification failed"}static get code(){return"ERR_JWS_SIGNATURE_VERIFICATION_FAILED"}};var jl=vt.getRandomValues.bind(vt);function Do(o,e="algorithm.name"){return new TypeError(`CryptoKey does not support this operation, its ${e} must be ${o}`)}function Kl(o,e){return o.name===e}function Sp(o){return parseInt(o.name.slice(4),10)}function IT(o){switch(o){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}}function CT(o,e){if(e.length&&!e.some(t=>o.usages.includes(t))){let t="CryptoKey does not support this operation, its usages must include ";if(e.length>2){let r=e.pop();t+=`one of ${e.join(", ")}, or ${r}.`}else e.length===2?t+=`one of ${e[0]} or ${e[1]}.`:t+=`${e[0]}.`;throw new TypeError(t)}}function _b(o,e,...t){switch(e){case"HS256":case"HS384":case"HS512":{if(!Kl(o.algorithm,"HMAC"))throw Do("HMAC");let r=parseInt(e.slice(2),10);if(Sp(o.algorithm.hash)!==r)throw Do(`SHA-${r}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!Kl(o.algorithm,"RSASSA-PKCS1-v1_5"))throw Do("RSASSA-PKCS1-v1_5");let r=parseInt(e.slice(2),10);if(Sp(o.algorithm.hash)!==r)throw Do(`SHA-${r}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!Kl(o.algorithm,"RSA-PSS"))throw Do("RSA-PSS");let r=parseInt(e.slice(2),10);if(Sp(o.algorithm.hash)!==r)throw Do(`SHA-${r}`,"algorithm.hash");break}case"EdDSA":{if(o.algorithm.name!=="Ed25519"&&o.algorithm.name!=="Ed448")throw Do("Ed25519 or Ed448");break}case"ES256":case"ES384":case"ES512":{if(!Kl(o.algorithm,"ECDSA"))throw Do("ECDSA");let r=IT(e);if(o.algorithm.namedCurve!==r)throw Do(r,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}CT(o,t)}function Sb(o,e,...t){var r;if(t.length>2){let n=t.pop();o+=`one of type ${t.join(", ")}, or ${n}.`}else t.length===2?o+=`one of type ${t[0]} or ${t[1]}.`:o+=`of type ${t[0]}.`;return e==null?o+=` Received ${e}`:typeof e=="function"&&e.name?o+=` Received function ${e.name}`:typeof e=="object"&&e!=null&&(r=e.constructor)!=null&&r.name&&(o+=` Received an instance of ${e.constructor.name}`),o}var Hr=(o,...e)=>Sb("Key must be ",o,...e);function kp(o,e,...t){return Sb(`Key for the ${o} algorithm must be `,e,...t)}var Ip=o=>Lr(o),wt=["CryptoKey"];var MT=(...o)=>{let e=o.filter(Boolean);if(e.length===0||e.length===1)return!0;let t;for(let r of e){let n=Object.keys(r);if(!t||t.size===0){t=new Set(n);continue}for(let s of n){if(t.has(s))return!1;t.add(s)}}return!0},Hs=MT;function ET(o){return typeof o=="object"&&o!==null}function Tt(o){if(!ET(o)||Object.prototype.toString.call(o)!=="[object Object]")return!1;if(Object.getPrototypeOf(o)===null)return!0;let e=o;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(o)===e}var Gl=(o,e)=>{if(o.startsWith("RS")||o.startsWith("PS")){let{modulusLength:t}=e.algorithm;if(typeof t!="number"||t<2048)throw new TypeError(`${o} requires key modulusLength to be 2048 bits or larger`)}};var ln=(o,e,t=0)=>{t===0&&(e.unshift(e.length),e.unshift(6));let r=o.indexOf(e[0],t);if(r===-1)return!1;let n=o.subarray(r,r+e.length);return n.length!==e.length?!1:n.every((s,i)=>s===e[i])||ln(o,e,r+1)},Ib=o=>{switch(!0){case ln(o,[42,134,72,206,61,3,1,7]):return"P-256";case ln(o,[43,129,4,0,34]):return"P-384";case ln(o,[43,129,4,0,35]):return"P-521";case ln(o,[43,101,110]):return"X25519";case ln(o,[43,101,111]):return"X448";case ln(o,[43,101,112]):return"Ed25519";case ln(o,[43,101,113]):return"Ed448";default:throw new nt("Invalid or unsupported EC Key Curve or OKP Key Sub Type")}},RT=async(o,e,t,r,n)=>{var c;let s,i,a=new Uint8Array(atob(t.replace(o,"")).split("").map(f=>f.charCodeAt(0))),l=e==="spki";switch(r){case"PS256":case"PS384":case"PS512":s={name:"RSA-PSS",hash:`SHA-${r.slice(-3)}`},i=l?["verify"]:["sign"];break;case"RS256":case"RS384":case"RS512":s={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${r.slice(-3)}`},i=l?["verify"]:["sign"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":s={name:"RSA-OAEP",hash:`SHA-${parseInt(r.slice(-3),10)||1}`},i=l?["encrypt","wrapKey"]:["decrypt","unwrapKey"];break;case"ES256":s={name:"ECDSA",namedCurve:"P-256"},i=l?["verify"]:["sign"];break;case"ES384":s={name:"ECDSA",namedCurve:"P-384"},i=l?["verify"]:["sign"];break;case"ES512":s={name:"ECDSA",namedCurve:"P-521"},i=l?["verify"]:["sign"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{let f=Ib(a);s=f.startsWith("P-")?{name:"ECDH",namedCurve:f}:{name:f},i=l?[]:["deriveBits"];break}case"EdDSA":s={name:Ib(a)},i=l?["verify"]:["sign"];break;default:throw new nt('Invalid or unsupported "alg" (Algorithm) value')}return vt.subtle.importKey(e,a,s,(c=n==null?void 0:n.extractable)!=null?c:!1,i)};var Cb=(o,e,t)=>RT(/(?:-----(?:BEGIN|END) PUBLIC KEY-----|\s)/g,"spki",o,e,t);async function Cp(o,e,t){if(typeof o!="string"||o.indexOf("-----BEGIN PUBLIC KEY-----")!==0)throw new TypeError('"spki" must be SPKI formatted string');return Cb(o,e,t)}var UT=(o,e)=>{if(!(e instanceof Uint8Array)){if(!Ip(e))throw new TypeError(kp(o,e,...wt,"Uint8Array"));if(e.type!=="secret")throw new TypeError(`${wt.join(" or ")} instances for symmetric algorithms must be of type "secret"`)}},OT=(o,e,t)=>{if(!Ip(e))throw new TypeError(kp(o,e,...wt));if(e.type==="secret")throw new TypeError(`${wt.join(" or ")} instances for asymmetric algorithms must not be of type "secret"`);if(t==="sign"&&e.type==="public")throw new TypeError(`${wt.join(" or ")} instances for asymmetric algorithm signing must be of type "private"`);if(t==="decrypt"&&e.type==="public")throw new TypeError(`${wt.join(" or ")} instances for asymmetric algorithm decryption must be of type "private"`);if(e.algorithm&&t==="verify"&&e.type==="private")throw new TypeError(`${wt.join(" or ")} instances for asymmetric algorithm verifying must be of type "public"`);if(e.algorithm&&t==="encrypt"&&e.type==="private")throw new TypeError(`${wt.join(" or ")} instances for asymmetric algorithm encryption must be of type "public"`)},$T=(o,e,t)=>{o.startsWith("HS")||o==="dir"||o.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(o)?UT(o,e):OT(o,e,t)},ji=$T;function zT(o,e,t,r,n){if(n.crit!==void 0&&(r==null?void 0:r.crit)===void 0)throw new o('"crit" (Critical) Header Parameter MUST be integrity protected');if(!r||r.crit===void 0)return new Set;if(!Array.isArray(r.crit)||r.crit.length===0||r.crit.some(i=>typeof i!="string"||i.length===0))throw new o('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let s;t!==void 0?s=new Map([...Object.entries(t),...e.entries()]):s=e;for(let i of r.crit){if(!s.has(i))throw new nt(`Extension Header Parameter "${i}" is not recognized`);if(n[i]===void 0)throw new o(`Extension Header Parameter "${i}" is missing`);if(s.get(i)&&r[i]===void 0)throw new o(`Extension Header Parameter "${i}" MUST be integrity protected`)}return new Set(r.crit)}var qs=zT;var WT=(o,e)=>{if(e!==void 0&&(!Array.isArray(e)||e.some(t=>typeof t!="string")))throw new TypeError(`"${o}" option must be an array of strings`);if(e)return new Set(e)},Tp=WT;var GT=Symbol();function Jl(o,e){let t=`SHA-${o.slice(-3)}`;switch(o){case"HS256":case"HS384":case"HS512":return{hash:t,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:t,name:"RSA-PSS",saltLength:o.slice(-3)>>3};case"RS256":case"RS384":case"RS512":return{hash:t,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:t,name:"ECDSA",namedCurve:e.namedCurve};case"EdDSA":return{name:e.name};default:throw new nt(`alg ${o} is not supported either by JOSE or your javascript runtime`)}}function Yl(o,e,t){if(Lr(e))return _b(e,o,t),e;if(e instanceof Uint8Array){if(!o.startsWith("HS"))throw new TypeError(Hr(e,...wt));return vt.subtle.importKey("raw",e,{hash:`SHA-${o.slice(-3)}`,name:"HMAC"},!1,[t])}throw new TypeError(Hr(e,...wt,"Uint8Array"))}var JT=async(o,e,t,r)=>{let n=await Yl(o,e,"verify");Gl(o,n);let s=Jl(o,n.algorithm);try{return await vt.subtle.verify(s,n,t,r)}catch(i){return!1}},Mb=JT;async function Ql(o,e,t){var y;if(!Tt(o))throw new rt("Flattened JWS must be an object");if(o.protected===void 0&&o.header===void 0)throw new rt('Flattened JWS must have either of the "protected" or "header" members');if(o.protected!==void 0&&typeof o.protected!="string")throw new rt("JWS Protected Header incorrect type");if(o.payload===void 0)throw new rt("JWS Payload missing");if(typeof o.signature!="string")throw new rt("JWS Signature missing or incorrect type");if(o.header!==void 0&&!Tt(o.header))throw new rt("JWS Unprotected Header incorrect type");let r={};if(o.protected)try{let g=io(o.protected);r=JSON.parse($t.decode(g))}catch(g){throw new rt("JWS Protected Header is invalid")}if(!Hs(r,o.header))throw new rt("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let n={...r,...o.header},s=qs(rt,new Map([["b64",!0]]),t==null?void 0:t.crit,r,n),i=!0;if(s.has("b64")&&(i=r.b64,typeof i!="boolean"))throw new rt('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:a}=n;if(typeof a!="string"||!a)throw new rt('JWS "alg" (Algorithm) Header Parameter missing or invalid');let l=t&&Tp("algorithms",t.algorithms);if(l&&!l.has(a))throw new Bs('"alg" (Algorithm) Header Parameter value not allowed');if(i){if(typeof o.payload!="string")throw new rt("JWS Payload must be a string")}else if(typeof o.payload!="string"&&!(o.payload instanceof Uint8Array))throw new rt("JWS Payload must be a string or an Uint8Array instance");let c=!1;typeof e=="function"&&(e=await e(r,o),c=!0),ji(a,e,"verify");let f=an(or.encode((y=o.protected)!=null?y:""),or.encode("."),typeof o.payload=="string"?or.encode(o.payload):o.payload),u;try{u=io(o.signature)}catch(g){throw new rt("Failed to base64url decode the signature")}if(!await Mb(a,e,u,f))throw new Vs;let m;if(i)try{m=io(o.payload)}catch(g){throw new rt("Failed to base64url decode the payload")}else typeof o.payload=="string"?m=or.encode(o.payload):m=o.payload;let p={payload:m};return o.protected!==void 0&&(p.protectedHeader=r),o.header!==void 0&&(p.unprotectedHeader=o.header),c?{...p,key:e}:p}async function Ap(o,e,t){if(o instanceof Uint8Array&&(o=$t.decode(o)),typeof o!="string")throw new rt("Compact JWS must be a string or Uint8Array");let{0:r,1:n,2:s,length:i}=o.split(".");if(i!==3)throw new rt("Invalid Compact JWS");let a=await Ql({payload:n,protected:r,signature:s},e,t),l={payload:a.payload,protectedHeader:a.protectedHeader};return typeof e=="function"?{...l,key:a.key}:l}var Mp=o=>Math.floor(o.getTime()/1e3);var YT=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i,Zl=o=>{let e=YT.exec(o);if(!e||e[4]&&e[1])throw new TypeError("Invalid time period format");let t=parseFloat(e[2]),r=e[3].toLowerCase(),n;switch(r){case"sec":case"secs":case"second":case"seconds":case"s":n=Math.round(t);break;case"minute":case"minutes":case"min":case"mins":case"m":n=Math.round(t*60);break;case"hour":case"hours":case"hr":case"hrs":case"h":n=Math.round(t*3600);break;case"day":case"days":case"d":n=Math.round(t*86400);break;case"week":case"weeks":case"w":n=Math.round(t*604800);break;default:n=Math.round(t*31557600);break}return e[1]==="-"||e[4]==="ago"?-n:n};var Eb=o=>o.toLowerCase().replace(/^application\//,""),QT=(o,e)=>typeof o=="string"?e.includes(o):Array.isArray(o)?e.some(Set.prototype.has.bind(new Set(o))):!1,Xl=(o,e,t={})=>{let{typ:r}=t;if(r&&(typeof o.typ!="string"||Eb(o.typ)!==Eb(r)))throw new jt('unexpected "typ" JWT header value',"typ","check_failed");let n;try{n=JSON.parse($t.decode(e))}catch(p){}if(!Tt(n))throw new Ut("JWT Claims Set must be a top-level JSON object");let{requiredClaims:s=[],issuer:i,subject:a,audience:l,maxTokenAge:c}=t,f=[...s];c!==void 0&&f.push("iat"),l!==void 0&&f.push("aud"),a!==void 0&&f.push("sub"),i!==void 0&&f.push("iss");for(let p of new Set(f.reverse()))if(!(p in n))throw new jt(`missing required "${p}" claim`,p,"missing");if(i&&!(Array.isArray(i)?i:[i]).includes(n.iss))throw new jt('unexpected "iss" claim value',"iss","check_failed");if(a&&n.sub!==a)throw new jt('unexpected "sub" claim value',"sub","check_failed");if(l&&!QT(n.aud,typeof l=="string"?[l]:l))throw new jt('unexpected "aud" claim value',"aud","check_failed");let u;switch(typeof t.clockTolerance){case"string":u=Zl(t.clockTolerance);break;case"number":u=t.clockTolerance;break;case"undefined":u=0;break;default:throw new TypeError("Invalid clockTolerance option type")}let{currentDate:d}=t,m=Mp(d||new Date);if((n.iat!==void 0||c)&&typeof n.iat!="number")throw new jt('"iat" claim must be a number',"iat","invalid");if(n.nbf!==void 0){if(typeof n.nbf!="number")throw new jt('"nbf" claim must be a number',"nbf","invalid");if(n.nbf>m+u)throw new jt('"nbf" claim timestamp check failed',"nbf","check_failed")}if(n.exp!==void 0){if(typeof n.exp!="number")throw new jt('"exp" claim must be a number',"exp","invalid");if(n.exp<=m-u)throw new Ns('"exp" claim timestamp check failed',"exp","check_failed")}if(c){let p=m-n.iat,y=typeof c=="number"?c:Zl(c);if(p-u>y)throw new Ns('"iat" claim timestamp check failed (too far in the past)',"iat","check_failed");if(p<0-u)throw new jt('"iat" claim timestamp check failed (it should be in the past)',"iat","check_failed")}return n};async function Ep(o,e,t){var i;let r=await Ap(o,e,t);if((i=r.protectedHeader.crit)!=null&&i.includes("b64")&&r.protectedHeader.b64===!1)throw new Ut("JWTs MUST NOT use unencoded payload");let s={payload:Xl(r.protectedHeader,r.payload,t),protectedHeader:r.protectedHeader};return typeof e=="function"?{...s,key:r.key}:s}var rA,ec,Fb;(typeof navigator=="undefined"||!((Fb=(ec=navigator.userAgent)==null?void 0:ec.startsWith)!=null&&Fb.call(ec,"Mozilla/5.0 ")))&&(rA="jose/v5.3.0");var Pp={};kc(Pp,{decode:()=>tc,encode:()=>oA});var oA=Vr,tc=io;function Ki(o){if(typeof o!="string")throw new Ut("JWTs must use Compact JWS serialization, JWT must be a string");let{1:e,length:t}=o.split(".");if(t===5)throw new Ut("Only JWTs using Compact JWS serialization can be decoded");if(t!==3)throw new Ut("Invalid JWT");if(!e)throw new Ut("JWTs must contain a payload");let r;try{r=tc(e)}catch(s){throw new Ut("Failed to base64url decode the payload")}let n;try{n=JSON.parse($t.decode(r))}catch(s){throw new Ut("Failed to parse the decoded payload as JSON")}if(!Tt(n))throw new Ut("Invalid JWT Claims Set");return n}var nA=`
-----BEGIN PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAyDIav6xzBzyi6eQu8aJA
O8DufA/MyTMDsD9d6PmjhuPTSlVPharZSjxRkHi6sK50ZmRedQbyiBuNp0g6so30
+zunoqT9XUpvZD0+USlGvi0J48Cop+DQbbpTlAlsmX6BxhHJLUrmgU0AhHjvJLNL
rRuzzQxrn/Oi0byUHu/moitUypX1hSYrKH5meRy8zoyGb8b0qIOEKpcpVKGyD/ne
+u0Bhh6tI8t2vQDQK0RL87dc+EqlQXxtijXBSClqvJi7o3JYTtWtuaWcZ2pQdg5y
+gDMii2hZYLNdgDM+/NcJlp3fkPztVeVRpiV20gZDhqANSjWjx9iN1Jt9A97rCSH
XQIDAQAB
-----END PUBLIC KEY-----
`.trim();var At=class extends Error{constructor(t,r,n){super(t);this.type=r;this.details=n;this.name="ValidationError"}};function Dp(o){return typeof o=="object"&&o!==null&&"license"in o&&typeof o.license=="string"}function rc(o){return Array.isArray(o)&&o.every(Dp)}var oc=class{constructor(e){this.settings=e;this.log=ke("[EndpointManager]")}isStaging(){return!1}sanitizeUrlForLog(e){try{let t=new URL(e);return t.search="",t.toString()}catch(t){return e}}validateUrl(e){if(!e||typeof e!="string")throw new At("URL must be a non-empty string","URL_INVALID");let t;try{t=new URL(e)}catch(s){throw new At("Invalid URL format","URL_INVALID")}let r=this.isStaging();if(r){if(t.protocol!=="https:"&&t.protocol!=="http:")throw new At("Only HTTP and HTTPS URLs are allowed in development","URL_INVALID")}else if(t.protocol!=="https:")throw new At("Only HTTPS URLs are allowed in production","URL_INVALID");let n=t.hostname.toLowerCase();if((n==="localhost"||n==="127.0.0.1"||n==="::1")&&this.log(`Warning: Using localhost endpoint (development build: ${r})`),!n||n.length<3)throw new At("Invalid hostname","URL_INVALID")}async getPublicKey(){if(this._publicKeyCache)return this._publicKeyCache;try{return this._publicKeyCache=await Cp(nA,"RS256"),this._publicKeyCache}catch(e){throw new At("Failed to import public key","JWT_VERIFICATION_FAILED",e)}}getApiUrl(){return this._validatedApiUrl||"https://api.system3.md"}getAuthUrl(){return this._validatedAuthUrl||"https://auth.system3.md"}getDefaultUrls(){return{apiUrl:"https://api.system3.md",authUrl:"https://auth.system3.md",environment:"production"}}async validateAndSetEndpoints(e=1e4){let t=this.settings.get(),r=this.getActiveTenant(t);if(!r)return this.log("No active enterprise tenant configured, using defaults"),this._validatedApiUrl=void 0,this._validatedAuthUrl=void 0,{success:!0};try{let n=this.performTenantValidation(r.tenantUrl),s=new Promise((a,l)=>setTimeout(()=>l(new Error(`Validation timed out after ${e}ms`)),e));return await Promise.race([n,s])}catch(n){let s=n instanceof Error?n.message:"Unknown error";return this.log("Failed to validate tenant:",s),{success:!1,error:s}}}async performTenantValidation(e){try{this.validateUrl(e);let t=await this.fetchTenantLicense(e);if(!t.success)return{success:!1,error:`Failed to fetch tenant license: ${t.error}`};let r=await this.validateTenantLicense(t.license,e);if(!r.success)return{success:!1,error:`Tenant license validation failed: ${r.error}`};let n=await this.verifyJWT(t.license);return!n.apiUrl||!n.authUrl?{success:!1,error:"License missing required apiUrl or authUrl"}:n.authUrl!==e?{success:!1,error:`Tenant URL mismatch: expected ${e}, license has ${n.authUrl}`}:(this._validatedApiUrl=n.apiUrl,this._validatedAuthUrl=n.authUrl,this.log("Successfully validated enterprise tenant",{tenant:e,apiUrl:this._validatedApiUrl,authUrl:this._validatedAuthUrl,customer:n.customer}),{success:!0,licenseInfo:r.licenseInfo})}catch(t){return{success:!1,error:t instanceof Error?t.message:"Unknown error"}}}async fetchTenantLicense(e){try{let t=new URL(e),r=`${t.protocol}//${t.host}/.well-known/relay.md/license`;this.log("Fetching tenant license from:",r);let n=await ot(r,{method:"GET",headers:{"Content-Type":"application/json"}});if(!n.ok)throw new Error(`License fetch failed: ${n.status} ${n.statusText}`);let s=await n.json(),i=[];if(rc(s))i=s;else if(s&&typeof s=="object"&&"licenses"in s&&rc(s.licenses))i=s.licenses;else if(Dp(s))i=[s];else throw new At("No valid licenses found in response","LICENSE_NOT_FOUND");if(i.length===0)throw new Error("Empty license list");return{success:!0,license:i[0].license}}catch(t){let r=t instanceof Error?t.message:"Unknown error";return r.includes("Failed to fetch")||r.includes("NetworkError")||r.includes("ERR_")||r.includes("ECONNREFUSED")?r=`Unable to connect to ${e}. Please check the URL and ensure the server is running.`:r.includes("404")?r=`No tenant license found at ${e}. This may not be a valid Enterprise Relay tenant.`:r.includes("License fetch failed"),this.log("Tenant license fetch error:",r),{success:!1,error:r}}}findMatchingEndpointLicense(e,t,r){this.log(`Searching for ${r} license for ${this.sanitizeUrlForLog(t)}`);for(let n of e)try{let s=Ki(n.license);if(s.endpointType===r&&s.url===t)return this.log(`Found matching license for ${r}: ${this.sanitizeUrlForLog(t)}`),n}catch(s){continue}return null}async validateTenantLicense(e,t){this.log(`Tenant license validation starting: ${this.sanitizeUrlForLog(t)}`);try{let r=await this.verifyJWT(e);if(r.iss!=="https://auth.system3.md")throw new At(`Invalid token issuer: expected https://auth.system3.md, got ${r.iss}`,"LICENSE_INVALID");if(r.sub!=="endpoint-certificate")throw new At(`Invalid token subject: expected "endpoint-certificate", got ${r.sub}`,"LICENSE_INVALID");let n={issuer:r.iss||"Unknown",subject:r.sub||"Unknown",validFrom:r.iat?new Date(r.iat*1e3).toISOString():"Unknown",validTo:r.exp?new Date(r.exp*1e3).toISOString():"Unknown",isValid:!0};return this.log(`Tenant license validation successful: ${this.sanitizeUrlForLog(t)}`),{success:!0,licenseInfo:n}}catch(r){let n=r instanceof Error?r.message:"Unknown error";return this.log(`Tenant license validation failed: ${this.sanitizeUrlForLog(t)} - ${n}`),{success:!1,error:n}}}validateLicenseClaims(e,t,r){if(e.iss!=="https://auth.system3.md")throw new At(`Invalid token issuer: expected https://auth.system3.md, got ${e.iss}`,"LICENSE_INVALID");if(e.sub!=="endpoint-certificate")throw new At(`Invalid token subject: expected "endpoint-certificate", got ${e.sub}`,"LICENSE_INVALID");if(e.endpointType!==t)throw new At(`License endpoint type mismatch: expected ${t}, got ${e.endpointType}`,"LICENSE_INVALID");if(e.url!==r)throw new At(`License URL mismatch: expected ${r}, got ${e.url}`,"LICENSE_INVALID")}async verifyJWT(e){try{let t=await this.getPublicKey(),{payload:r}=await Ep(e,t,{algorithms:["RS256"]});return r}catch(t){throw this.log("JWT verification failed:",t),new At(`JWT verification failed: ${t instanceof Error?t.message:"Unknown error"}`,"JWT_VERIFICATION_FAILED",t)}}clearValidatedEndpoints(){this._validatedApiUrl=void 0,this._validatedAuthUrl=void 0,this.log("Cleared validated endpoints, reverted to defaults")}hasValidatedEndpoints(){return!!(this._validatedApiUrl&&this._validatedAuthUrl)}getActiveTenant(e){if(!(!e.activeTenantId||!e.tenants))return e.tenants.find(t=>t.id===e.activeTenantId)}generateTenantId(e){try{let t=new URL(e);return`${t.hostname}:${t.port||(t.protocol==="https:"?"443":"80")}`}catch(t){return e.replace(/[^a-zA-Z0-9]/g,"_")}}async addTenant(e,t=!0){var r;try{this.validateUrl(e);let n=this.generateTenantId(e);if((r=this.settings.get().tenants)!=null&&r.some(l=>l.id===n))return{success:!1,error:"This tenant is already configured"};let i={id:n,name:e,tenantUrl:e,isValidated:!1},a;if(t){let l=await this.fetchTenantLicense(e);if(!l.success)return{success:!1,error:l.error||"Failed to fetch tenant license"};let c=await this.validateTenantLicense(l.license,e);if(!c.success)return{success:!1,error:c.error||"Tenant license validation failed"};a=c;let f=await this.verifyJWT(l.license);i={...i,name:f.customer||e,apiUrl:f.apiUrl,authUrl:f.authUrl,customer:f.customer,logo:f.logo,environment:f.environment,isValidated:!0,lastValidated:Date.now()}}return await this.settings.update(l=>({...l,tenants:[...l.tenants||[],i]})),{success:!0,tenantId:n,licenseInfo:a==null?void 0:a.licenseInfo}}catch(n){return{success:!1,error:n instanceof Error?n.message:"Unknown error"}}}async removeTenant(e){let t=this.settings.get(),r=t.tenants||[];if(!r.some(s=>s.id===e))return!1;let n={tenants:r.filter(s=>s.id!==e)};return t.activeTenantId===e&&(n.activeTenantId=void 0,this._validatedApiUrl=void 0,this._validatedAuthUrl=void 0),await this.settings.update(s=>({...s,...n})),!0}async switchToTenant(e){var n;let r=(n=this.settings.get().tenants)==null?void 0:n.find(s=>s.id===e);return r?(await this.settings.update(s=>({...s,activeTenantId:e})),r.isValidated&&r.apiUrl&&r.authUrl?(this._validatedApiUrl=r.apiUrl,this._validatedAuthUrl=r.authUrl):(this._validatedApiUrl=void 0,this._validatedAuthUrl=void 0),{success:!0}):{success:!1,error:"Tenant not found"}}async getCustomerInfo(){if(!this.hasValidatedEndpoints())return null;let e=this.settings.get(),t=this.getActiveTenant(e);if(!t)return null;try{if(t.isValidated&&t.customer)return{customer:t.customer,logo:t.logo};let r=await this.fetchTenantLicense(t.tenantUrl);if(r.success&&r.license){let n=await this.verifyJWT(r.license);return{customer:n.customer,logo:n.logo}}}catch(r){this.log("Failed to get customer info:",r)}return null}async getDefaultTenantInfo(){try{let e=await this.fetchTenantLicense("https://auth.system3.md");if(e.success&&e.license){let t=await this.verifyJWT(e.license);return{customer:t.customer,logo:t.logo,environment:"production"}}}catch(e){this.log("Failed to get default tenant info:",e)}return null}async testValidateTenant(e,t=1e4){try{let r=this.performTestValidation(e),n=new Promise((i,a)=>setTimeout(()=>a(new Error(`Validation timed out after ${t}ms`)),t));return await Promise.race([r,n])}catch(r){let n=r instanceof Error?r.message:"Unknown error";return this.log("Failed to test validate endpoints:",n),{success:!1,error:n}}}async performTestValidation(e){try{this.validateUrl(e);let t=await this.fetchTenantLicense(e);if(!t.success)return{success:!1,error:`Failed to fetch tenant license: ${t.error}`};let r=await this.validateTenantLicense(t.license,e);if(!r.success)return{success:!1,error:`Tenant license validation failed: ${r.error}`};let n=await this.verifyJWT(t.license);return this.log("Test validation successful for tenant",{tenantUrl:e,apiUrl:n.apiUrl,authUrl:n.authUrl}),{success:!0,licenseInfo:r.licenseInfo}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Unknown error"}}}async fetchEndpointLicenseForUrl(e,t,r){try{let n=new URL(e),s=`${n.protocol}//${n.host}/.well-known/relay.md/license`;this.log(`Fetching ${t.toUpperCase()} licenses for test validation from:`,s);let i=await ot(s,{method:"GET",headers:{"Content-Type":"application/json"}});if(!i.ok)throw new Error(`License fetch failed: ${i.status} ${i.statusText}`);let a=await i.json();this.log("License response received from:",s);let l=[];if(rc(a))l=a;else if(a&&typeof a=="object"&&"licenses"in a&&rc(a.licenses))l=a.licenses;else if(Dp(a))l=[a];else throw new At("No valid licenses found in response","LICENSE_NOT_FOUND");if(this.log(`Parsed ${l.length} licenses`),l.length===0)throw new Error("Empty license list");let c=this.findMatchingEndpointLicense(l,r,t);if(!c)throw new At(`No valid ${t.toUpperCase()} license found for: ${r}`,"LICENSE_NOT_FOUND");return{success:!0,license:c.license}}catch(n){let s=n instanceof Error?n.message:"Unknown error";return this.log("License fetch error:",s),{success:!1,error:`License fetch failed: ${s}`}}}};function sA(o){if("email"in o&&"name"in o&&"given_name"in o&&"family_name"in o){let e=o;return{name:e.name,given_name:e.given_name,family_name:e.family_name,email:e.email,picture:e.picture}}if("email"in o&&"login"in o&&"avatar_url"in o){let e=o,t=(e.name||e.login).split(" ");return{name:e.name||e.login,given_name:t[0]||e.login,family_name:t.slice(1).join(" ")||"",email:e.email,picture:e.avatar_url}}if("mail"in o&&"displayName"in o){let e=o;return{name:e.displayName,given_name:e.givenName,family_name:e.surname,email:e.mail}}if("email"in o&&"given_name"in o&&"family_name"in o){let e=o;return{name:e.name||`${e.given_name} ${e.family_name}`,given_name:e.given_name,family_name:e.family_name,email:e.email,picture:e.picture}}return null}function iA(o,e,t,r){let n=r?sA(r):null;return new Ml(o,(t==null?void 0:t.name)||(n==null?void 0:n.name)||"",(t==null?void 0:t.email)||(n==null?void 0:n.email)||"",(t==null?void 0:t.picture)||(n==null?void 0:n.picture)||"",e)}var Fp=class{constructor(e,t,r){this.fullAuthUrl=e,this.info=t,this.login=r}},sc=class extends et{constructor(t,r,n,s,i,a){var c;super();this.beforeLogin=s;this.loginSettings=i;let l=ke("[Pocketbase]","debug");this.authStore=new Vl(`pocketbase_auth_${t}`),this.endpointManager=new oc(a),this.pb=new Tn(this.endpointManager.getAuthUrl(),this.authStore),this.pb.beforeSend=(f,u)=>(l(f,u),u.fetch=ot,u.headers=Object.assign({},u.headers,{"Relay-Version":"0.5.13"}),{url:f,options:u}),this.refreshToken(),n.setInterval(()=>this.refreshToken(),864e5),this.openSettings=r,this.pb.authStore.isValid||this.logout(),(c=this.pb.authStore.model)!=null&&c.id&&this.pb.collection("users").getOne(this.pb.authStore.model.id).then(()=>{this.getFlags()}).catch(f=>{f.status===404&&this.logout()}),Ct.set(this,"loginManager")}refreshToken(){this.pb.authStore.isValid&&(this.user=this.makeUser(this.pb.authStore),this.pb.collection("users").authRefresh().then(t=>{let r=t.token,[,n]=r.split("."),s=JSON.parse(atob(n)),i=new Date(s.exp*1e3),a=new Date,l=Math.ceil((i.getTime()-a.getTime())/(1e3*60*60*24));this.log("Token Refreshed"),this.log("JWT Info:",{expiresAt:i.toLocaleString(),expiresIn:`${l} days`,userId:s.id,email:s.email})}))}setup(t,r){var n,s;return this.pb.authStore.isValid?(this.user=this.makeUser(this.pb.authStore,(n=t==null?void 0:t.meta)==null?void 0:n.rawUser),this.notifyListeners(),t&&this.pb.collection("oauth2_response").create({user:t.record.id,oauth_response:(s=t.meta)==null?void 0:s.rawUser}).then(()=>{this.notifyListeners()}).catch(i=>{this.log(i)}),r&&this.loginSettings.set({provider:r}),!0):(this.notifyListeners(),!1)}clearPreferredProvider(){this.loginSettings.set({provider:void 0})}async checkRelayHost(t){let r={Authorization:`Bearer ${this.pb.authStore.token}`,"Relay-Version":"0.5.13"};return(0,nc.requestUrl)({url:`${this.endpointManager.getApiUrl()}/relay/${t}/check-host`,method:"GET",headers:r})}getFlags(){let t={Authorization:`Bearer ${this.pb.authStore.token}`,"Relay-Version":"0.5.13"};(0,nc.requestUrl)({url:`${this.endpointManager.getApiUrl()}/flags`,method:"GET",headers:t}).then(r=>{if(r.status===200){let n=r.json;xt.getInstance().applyServerFlags(n)}}).catch(r=>{this.log(r)})}whoami(){let t={Authorization:`Bearer ${this.pb.authStore.token}`};(0,nc.requestUrl)({url:`${this.endpointManager.getApiUrl()}/whoami`,method:"GET",headers:t}).then(r=>{this.log(r.json)}).catch(r=>{this.log(r)})}get loggedIn(){return this.user!==void 0}getEndpointManager(){return this.endpointManager}async validateAndApplyEndpoints(t){let r=await this.endpointManager.validateAndSetEndpoints(t);if(r.success&&this.endpointManager.hasValidatedEndpoints()){let n=ke("[Pocketbase]","debug");this.pb=new Tn(this.endpointManager.getAuthUrl(),this.authStore),this.pb.beforeSend=(s,i)=>(n(s,i),i.fetch=ot,i.headers=Object.assign({},i.headers,{"Relay-Version":"0.5.13"}),{url:s,options:i}),this.log("Updated PocketBase instance with validated endpoints")}return r}get hasUser(){return this.user!==void 0}makeUser(t,r){var n;return iA((n=t.model)==null?void 0:n.id,t.token,t.model,r)}logout(){this.pb.cancelAllRequests(),this.pb.authStore.clear(),this.user=void 0,this.notifyListeners()}getWebviewIntercepts(t){var a;let r=this.pb.buildUrl("/api/oauth2-redirect"),n=l=>{let c=l.replace(/\//g,"\\/");return new RegExp(`^${c}.*?[?&]redirect_uri=(${r}|${encodeURIComponent(r)})`,"i")},s=l=>{let c=new URL(l),u=`${c.protocol}//${c.host}${c.pathname}`.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return new RegExp(`^${u}.*?[?&]redirect_uri=(${r}|${encodeURIComponent(r)})`,"i")},i=[n("https://accounts.google.com/o/oauth2/auth"),n("https://github.com/login/oauth/authorize"),n("https://discord.com/api/oauth2/authorize"),n("https://login.microsoftonline.com/common/oauth2/v2.0/authorize")];if(t){let l=t.oidc;(a=l==null?void 0:l.info)!=null&&a.authUrl&&(console.log("[OIDC Provider] Creating dynamic intercept for authUrl:",l.info.authUrl),i.push(s(l.info.authUrl)))}else i.push(new RegExp(`.*?/auth.*?[?&]redirect_uri=(${r}|${encodeURIComponent(r)})`,"i"));return i}updateWebviewIntercepts(t){let r=this.getWebviewIntercepts(t);return console.log("[OIDC Provider] Updated webview intercepts:",r.map(n=>n.source)),r}async initiateManualOAuth2CodeFlow(t,r){this.beforeLogin();let n=await this.pb.collection("users").listAuthMethods({fetch:t}).catch(a=>{throw a.originalError}),s=this.pb.buildUrl("/api/oauth2-redirect"),i={};for(let a of r){let l=n.authProviders.find(f=>f.name===a);if(!l){this.log(`Warning: unable to find provider: ${a}`);continue}let c=async f=>this.pb.collection("users").authWithOAuth2Code(l.name,f,l.codeVerifier,s,{fetch:t}).then(u=>(this.setup(u,l.name),u));i[a]=new Fp(l.authUrl+s,l,c)}if(Object.keys(i).length===0)throw new Error(`No valid providers found from requested list: ${r.join(", ")}`);return i}async poll(t){let r=0,n=1e3;return new Promise((s,i)=>{let a=setInterval(()=>{if(r+=1,r>=30)return clearInterval(a),i(new Error(`Auth timeout: Timed out after ${r*n/1e3} seconds`));this.pb.collection("code_exchange").getOne(t.info.state.slice(0,15)).then(l=>{if(l)return clearInterval(a),s(t.login(l.code))}).catch(l=>{})},n)})}async login(t){this.beforeLogin();let r=await this.pb.collection("users").authWithOAuth2({provider:t});return this.setup(r,t)}async openLoginPage(){return await this.openSettings(),await new Promise((r,n)=>{let s=()=>{this.loggedIn&&(this.off(s),r(!0)),r(!1)};this.on(s)})}destroy(){this.pb.cancelAllRequests(),this.pb.realtime.unsubscribe(),this.pb=null,this.authStore.destroy(),this.authStore=null,this.user=void 0,this.openSettings=null,super.destroy()}};var Hb=require("obsidian");function aA(o){_e(o,"svelte-74c8lg",".endpoint-config-modal.svelte-74c8lg.svelte-74c8lg{padding:0}.tenant-list-section.svelte-74c8lg.svelte-74c8lg{margin:16px 0}.tenant-card.svelte-74c8lg.svelte-74c8lg{display:flex;align-items:center;justify-content:space-between;padding:12px;margin:8px 0;border:1px solid var(--background-modifier-border);border-radius:var(--radius-s);background:var(--background-primary);cursor:pointer;transition:all 0.2s ease}.tenant-card.svelte-74c8lg.svelte-74c8lg:hover{background:var(--background-modifier-hover)}.tenant-card.active.svelte-74c8lg.svelte-74c8lg{border-color:var(--interactive-accent);background:var(--background-modifier-hover)}.tenant-info.svelte-74c8lg.svelte-74c8lg{display:flex;align-items:center;gap:12px;flex:1}.tenant-logo.svelte-74c8lg.svelte-74c8lg{width:4em;height:4em;object-fit:contain;border-radius:4px;background:var(--background-secondary);padding:4px}.tenant-details.svelte-74c8lg.svelte-74c8lg{flex:1}.tenant-name.svelte-74c8lg.svelte-74c8lg{font-weight:500;color:var(--text-normal);margin-bottom:2px}.tenant-url.svelte-74c8lg.svelte-74c8lg{font-size:0.85em;color:var(--text-muted);font-family:var(--font-monospace)}.tenant-env.svelte-74c8lg.svelte-74c8lg{font-size:0.8em;color:var(--text-faint);text-transform:capitalize}.tenant-actions.svelte-74c8lg.svelte-74c8lg{display:flex;align-items:center;gap:8px}.add-tenant-container.svelte-74c8lg.svelte-74c8lg{display:flex;gap:8px;align-items:center}.endpoint-url-input.svelte-74c8lg.svelte-74c8lg{flex:1;padding:6px 12px;border:1px solid var(--background-modifier-border);border-radius:var(--radius-s);background:var(--background-primary);color:var(--text-normal)}.endpoint-input-invalid.svelte-74c8lg.svelte-74c8lg{border-color:var(--text-error) !important;box-shadow:0 0 0 1px var(--text-error) !important;transition:border-color 0.3s ease, box-shadow 0.3s ease}.endpoint-input-invalid.svelte-74c8lg.svelte-74c8lg:focus{border-color:var(--text-error) !important;box-shadow:0 0 0 2px var(--text-error) !important}.add-tenant-container.svelte-74c8lg button.mod-cta.svelte-74c8lg{background:var(--interactive-accent);color:var(--text-on-accent);padding:6px 12px;white-space:nowrap}.error-banner.svelte-74c8lg.svelte-74c8lg{display:flex;align-items:flex-start;justify-content:space-between;margin:12px 0;padding:10px 12px;background-color:rgba(255, 0, 0, 0.1);color:var(--text-normal);border:1px solid rgba(255, 0, 0, 0.3);border-radius:var(--radius-s);animation:svelte-74c8lg-error-slide-in 0.3s ease-out}.error-content.svelte-74c8lg.svelte-74c8lg{display:flex;align-items:flex-start;gap:8px;flex:1}.error-icon.svelte-74c8lg.svelte-74c8lg{font-size:1em;line-height:1.2;margin-top:2px}.error-text.svelte-74c8lg.svelte-74c8lg{font-size:0.85em;line-height:1.4;color:var(--text-normal)}.error-dismiss.svelte-74c8lg.svelte-74c8lg{background:none;border:none;color:var(--text-muted);font-size:1.2em;font-weight:normal;cursor:pointer;padding:0;width:20px;height:20px;display:flex;align-items:center;justify-content:center;transition:opacity 0.2s ease;opacity:0.6}.error-dismiss.svelte-74c8lg.svelte-74c8lg:hover{opacity:1}@keyframes svelte-74c8lg-error-slide-in{0%{opacity:0;transform:translateY(-10px)}100%{opacity:1;transform:translateY(0)}}.apply-section.svelte-74c8lg.svelte-74c8lg{display:flex;justify-content:flex-end;margin-top:20px;padding-top:16px;border-top:1px solid var(--background-modifier-border)}.apply-btn.svelte-74c8lg.svelte-74c8lg{padding:8px 20px;font-size:0.9em}")}function Rb(o,e,t){let r=o.slice();return r[32]=e[t],r}function lA(o){let e,t,r,n,s,i=o[5]?"Adding...":"Add Tenant",a,l,c,f;return{c(){e=S("div"),t=S("input"),n=M(),s=S("button"),a=B(i),h(t,"type","text"),h(t,"placeholder","https://auth.example.com"),h(t,"class","endpoint-url-input svelte-74c8lg"),h(t,"title",r=o[6].error),Me(t,"endpoint-input-invalid",!o[6].isValid||o[2]),h(s,"class","mod-cta svelte-74c8lg"),s.disabled=l=o[5]||!o[0].trim()||!o[6].isValid,h(e,"class","add-tenant-container svelte-74c8lg")},m(u,d){_(u,e,d),b(e,t),Ft(t,o[0]),b(e,n),b(e,s),b(s,a),c||(f=[z(t,"input",o[20]),z(s,"click",o[12])],c=!0)},p(u,d){d[0]&64&&r!==(r=u[6].error)&&h(t,"title",r),d[0]&1&&t.value!==u[0]&&Ft(t,u[0]),d[0]&68&&Me(t,"endpoint-input-invalid",!u[6].isValid||u[2]),d[0]&32&&i!==(i=u[5]?"Adding...":"Add Tenant")&&Y(a,i),d[0]&97&&l!==(l=u[5]||!u[0].trim()||!u[6].isValid)&&(s.disabled=l)},d(u){u&&w(e),c=!1,we(f)}}}function Ub(o){let e,t,r,n,s,i,a,l,c,f;return{c(){e=S("div"),t=S("div"),r=S("span"),r.textContent="\u26A0\uFE0F",n=M(),s=S("span"),i=B(o[1]),a=M(),l=S("button"),l.textContent="\xD7",h(r,"class","error-icon svelte-74c8lg"),h(s,"class","error-text svelte-74c8lg"),h(t,"class","error-content svelte-74c8lg"),h(l,"class","error-dismiss svelte-74c8lg"),h(l,"title","Dismiss error"),h(e,"class","error-banner svelte-74c8lg")},m(u,d){_(u,e,d),b(e,t),b(t,r),b(t,n),b(t,s),b(s,i),b(e,a),b(e,l),c||(f=z(l,"click",o[11]),c=!0)},p(u,d){d[0]&2&&Y(i,u[1])},d(u){u&&w(e),c=!1,f()}}}function Ob(o){let e,t,r;return{c(){e=S("img"),Xo(e.src,t=o[8].logo)||h(e,"src",t),h(e,"alt",r=o[8].customer||"Default Tenant"),h(e,"class","tenant-logo svelte-74c8lg")},m(n,s){_(n,e,s)},p(n,s){s[0]&256&&!Xo(e.src,t=n[8].logo)&&h(e,"src",t),s[0]&256&&r!==(r=n[8].customer||"Default Tenant")&&h(e,"alt",r)},d(n){n&&w(e)}}}function $b(o){let e,t,r;return{c(){e=S("img"),Xo(e.src,t=o[32].logo)||h(e,"src",t),h(e,"alt",r=o[32].name),h(e,"class","tenant-logo svelte-74c8lg")},m(n,s){_(n,e,s)},p(n,s){s[0]&16&&!Xo(e.src,t=n[32].logo)&&h(e,"src",t),s[0]&16&&r!==(r=n[32].name)&&h(e,"alt",r)},d(n){n&&w(e)}}}function Nb(o){let e,t=o[32].environment+"",r;return{c(){e=S("div"),r=B(t),h(e,"class","tenant-env svelte-74c8lg")},m(n,s){_(n,e,s),b(e,r)},p(n,s){s[0]&16&&t!==(t=n[32].environment+"")&&Y(r,t)},d(n){n&&w(e)}}}function Bb(o,e){let t,r,n,s,i,a=e[32].name+"",l,c,f,u=e[32].tenantUrl+"",d,m,p,y,g,v,C,L,T=e[32].logo&&$b(e),E=e[32].environment&&Nb(e);function O(){return e[22](e[32])}function I(){return e[23](e[32])}function A(...U){return e[24](e[32],...U)}return{key:o,first:null,c(){t=S("div"),r=S("div"),T&&T.c(),n=M(),s=S("div"),i=S("div"),l=B(a),c=M(),f=S("div"),d=B(u),m=M(),E&&E.c(),p=M(),y=S("div"),g=S("button"),g.textContent="Remove",v=M(),h(i,"class","tenant-name svelte-74c8lg"),h(f,"class","tenant-url svelte-74c8lg"),h(s,"class","tenant-details svelte-74c8lg"),h(r,"class","tenant-info svelte-74c8lg"),h(g,"class","mod-destructive"),h(g,"title","Remove this tenant"),h(y,"class","tenant-actions svelte-74c8lg"),h(t,"class","tenant-card svelte-74c8lg"),h(t,"role","button"),h(t,"tabindex","0"),h(t,"title","Click to switch to this tenant"),Me(t,"active",e[32].id===e[3]),this.first=t},m(U,W){_(U,t,W),b(t,r),T&&T.m(r,null),b(r,n),b(r,s),b(s,i),b(i,l),b(s,c),b(s,f),b(f,d),b(s,m),E&&E.m(s,null),b(t,p),b(t,y),b(y,g),b(t,v),C||(L=[z(g,"click",nl(O)),z(t,"click",I),z(t,"keydown",A)],C=!0)},p(U,W){e=U,e[32].logo?T?T.p(e,W):(T=$b(e),T.c(),T.m(r,n)):T&&(T.d(1),T=null),W[0]&16&&a!==(a=e[32].name+"")&&Y(l,a),W[0]&16&&u!==(u=e[32].tenantUrl+"")&&Y(d,u),e[32].environment?E?E.p(e,W):(E=Nb(e),E.c(),E.m(s,null)):E&&(E.d(1),E=null),W[0]&24&&Me(t,"active",e[32].id===e[3])},d(U){U&&w(t),T&&T.d(),E&&E.d(),C=!1,we(L)}}}function cA(o){var Ie,Ue,Ne;let e,t,r,n,s,i=o[1]&&o[1].trim(),a,l,c,f,u,d,m,p,y,g,v=(((Ie=o[8])==null?void 0:Ie.customer)||"Default Tenant")+"",C,L,T,E,O,I=(((Ue=o[8])==null?void 0:Ue.environment)||o[10].environment)+"",A,U,W,J,H=[],P=new Map,V,fe,de,le,ee,re;n=new Pe({props:{name:"Add Enterprise Tenant",description:"Enter your organization's tenant URL",$$slots:{default:[lA]},$$scope:{ctx:o}}});let $=i&&Ub(o),N=((Ne=o[8])==null?void 0:Ne.logo)&&Ob(o),pe=Se(o[4]),Q=te=>te[32].id;for(let te=0;te<pe.length;te+=1){let Oe=Rb(o,pe,te),We=Q(Oe);P.set(We,H[te]=Bb(We,Oe))}return{c(){e=S("div"),t=S("div"),t.innerHTML="<p>Manage your organization&#39;s enterprise Relay tenants. Add tenants to switch between different enterprise deployments.</p>",r=M(),R(n.$$.fragment),s=M(),$&&$.c(),a=M(),l=S("div"),c=S("div"),c.textContent="Available Tenants",f=M(),u=S("div"),d=S("div"),m=S("div"),N&&N.c(),p=M(),y=S("div"),g=S("div"),C=B(v),L=M(),T=S("div"),T.textContent=`${o[10].authUrl}`,E=M(),O=S("div"),A=B(I),U=M(),W=S("div"),W.innerHTML="",J=M();for(let te=0;te<H.length;te+=1)H[te].c();V=M(),fe=S("div"),de=S("button"),de.textContent="Apply",h(t,"class","setting-item-description"),ue(t,"margin-bottom","16px"),h(c,"class","setting-item-name"),h(g,"class","tenant-name svelte-74c8lg"),h(T,"class","tenant-url svelte-74c8lg"),h(O,"class","tenant-env svelte-74c8lg"),h(y,"class","tenant-details svelte-74c8lg"),h(m,"class","tenant-info svelte-74c8lg"),h(W,"class","tenant-actions svelte-74c8lg"),h(d,"class","tenant-card svelte-74c8lg"),h(d,"role","button"),h(d,"tabindex","0"),h(d,"title","Click to use default tenant"),Me(d,"active",!o[3]),h(u,"class","tenant-list"),h(l,"class","tenant-list-section svelte-74c8lg"),h(de,"class","mod-cta apply-btn svelte-74c8lg"),h(fe,"class","apply-section svelte-74c8lg"),h(e,"class","endpoint-config-modal svelte-74c8lg")},m(te,Oe){_(te,e,Oe),b(e,t),b(e,r),D(n,e,null),b(e,s),$&&$.m(e,null),b(e,a),b(e,l),b(l,c),b(l,f),b(l,u),b(u,d),b(d,m),N&&N.m(m,null),b(m,p),b(m,y),b(y,g),b(g,C),b(y,L),b(y,T),b(y,E),b(y,O),b(O,A),b(d,U),b(d,W),b(u,J);for(let We=0;We<H.length;We+=1)H[We]&&H[We].m(u,null);b(e,V),b(e,fe),b(fe,de),le=!0,ee||(re=[z(d,"click",o[15]),z(d,"keydown",o[21]),z(de,"click",o[25])],ee=!0)},p(te,Oe){var st,Ye,ao;let We={};Oe[0]&101|Oe[1]&16&&(We.$$scope={dirty:Oe,ctx:te}),n.$set(We),Oe[0]&2&&(i=te[1]&&te[1].trim()),i?$?$.p(te,Oe):($=Ub(te),$.c(),$.m(e,a)):$&&($.d(1),$=null),(st=te[8])!=null&&st.logo?N?N.p(te,Oe):(N=Ob(te),N.c(),N.m(m,p)):N&&(N.d(1),N=null),(!le||Oe[0]&256)&&v!==(v=(((Ye=te[8])==null?void 0:Ye.customer)||"Default Tenant")+"")&&Y(C,v),(!le||Oe[0]&256)&&I!==(I=(((ao=te[8])==null?void 0:ao.environment)||te[10].environment)+"")&&Y(A,I),(!le||Oe[0]&8)&&Me(d,"active",!te[3]),Oe[0]&24600&&(pe=Se(te[4]),H=Pn(H,Oe,Q,1,te,pe,P,u,cl,Bb,null,Rb))},i(te){le||(x(n.$$.fragment,te),le=!0)},o(te){k(n.$$.fragment,te),le=!1},d(te){te&&w(e),F(n),$&&$.d(),N&&N.d();for(let Oe=0;Oe<H.length;Oe+=1)H[Oe].d();ee=!1,we(re)}}}function fA(o,e,t){let r,n,s,i,a,{plugin:l}=e,c=pt(),f="",u=!1,d={isValid:!0,error:""},m="",p=!1,y="",g=!1,v=0,C=l.loginManager.getEndpointManager().getDefaultUrls(),L=null;function T(){t(18,v++,v)}function E(){t(1,m=""),t(2,p=!1)}function O(re){if(!re.trim())return{isValid:!0,error:""};try{let $=new URL(re);if(l.loginManager.getEndpointManager().isStaging()){if($.protocol!=="https:"&&$.protocol!=="http:")return{isValid:!1,error:"Only HTTP and HTTPS URLs are allowed in development"}}else if($.protocol!=="https:")return{isValid:!1,error:"Only HTTPS URLs are allowed in production"};return $.hostname.length<3?{isValid:!1,error:"Invalid hostname"}:{isValid:!0,error:""}}catch($){return{isValid:!1,error:"Invalid URL format"}}}function I(){return Ee(this,void 0,void 0,function*(){if(f.trim()&&d.isValid){t(5,u=!0);try{let re=yield l.loginManager.getEndpointManager().addTenant(f);re.success?(t(0,f=""),t(1,m=""),t(2,p=!1),T(),t(7,g=!0),re.tenantId&&(yield A(re.tenantId))):(console.log("Add tenant failed with error:",re.error),t(1,m=re.error||"Failed to add tenant"),t(2,p=!0),T())}catch(re){let $=re instanceof Error?re.message:"Unknown error occurred";t(1,m=`Error adding tenant: ${$}`),t(2,p=!0)}finally{t(5,u=!1)}}})}function A(re){return Ee(this,void 0,void 0,function*(){try{let $=yield l.loginManager.getEndpointManager().switchToTenant(re);$.success?(t(7,g=!0),T()):t(1,m=$.error||"Failed to switch tenant")}catch($){let N=$ instanceof Error?$.message:"Unknown error occurred";t(1,m=`Error switching tenant: ${N}`)}})}function U(re){return Ee(this,void 0,void 0,function*(){try{(yield l.loginManager.getEndpointManager().removeTenant(re))?(t(7,g=!0),T()):t(1,m="Failed to remove tenant")}catch($){let N=$ instanceof Error?$.message:"Unknown error occurred";t(1,m=`Error removing tenant: ${N}`)}})}function W(){return Ee(this,void 0,void 0,function*(){yield l.endpointSettings.update(re=>Object.assign(Object.assign({},re),{activeTenantId:void 0})),l.loginManager.getEndpointManager().clearValidatedEndpoints(),t(7,g=!0),T()})}function J(){return Ee(this,void 0,void 0,function*(){try{return yield l.loginManager.getEndpointManager().getCustomerInfo()}catch(re){return null}})}function H(){return Ee(this,void 0,void 0,function*(){try{let re=l.loginManager.getEndpointManager();t(8,L=yield re.getDefaultTenantInfo())}catch(re){console.log("Failed to load default tenant info:",re),t(8,L=null)}})}Rt(()=>{H()});function P(){f=this.value,t(0,f)}let V=re=>re.key==="Enter"||re.key===" "?W():null,fe=re=>U(re.id),de=re=>A(re.id),le=(re,$)=>$.key==="Enter"||$.key===" "?A(re.id):null,ee=()=>{c(g?"apply":"close")};return o.$$set=re=>{"plugin"in re&&t(16,l=re.plugin)},o.$$.update=()=>{if(o.$$.dirty[0]&327680){e:t(19,r=l.endpointSettings.get())}if(o.$$.dirty[0]&524288){e:t(4,n=r.tenants||[])}if(o.$$.dirty[0]&524288){e:t(3,s=r.activeTenantId)}if(o.$$.dirty[0]&24){e:i=n.find(re=>re.id===s)}if(o.$$.dirty[0]&65536){e:a=l.loginManager.getEndpointManager().hasValidatedEndpoints()}if(o.$$.dirty[0]&131079){e:t(6,d=O(f)),f!==y&&y!==""&&(p&&t(2,p=!1),m&&t(1,m="")),t(17,y=f)}},[f,m,p,s,n,u,d,g,L,c,C,E,I,A,U,W,l,y,v,r,P,V,fe,de,le,ee]}var Rp=class extends K{constructor(e){super(),G(this,e,fA,cA,j,{plugin:16},aA,[-1,-1])}},Vb=Rp;var ic=class extends Hb.Modal{constructor(t,r,n){super(t);this.plugin=r;this.reload=n;this.setTitle("Enterprise Tenant Configuration")}onOpen(){let{contentEl:t}=this;this.component=new Vb({target:t,props:{plugin:this.plugin,reload:this.reload}}),this.component.$on("close",()=>{this.close()}),this.component.$on("apply",()=>{this.close(),setTimeout(()=>{this.reload()},100)})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};function qb(o){return o<1e3?`${o}ms`:o<6e4?`${Math.round(o/1e3)}s`:o<36e5?`${Math.round(o/6e4)}m`:`${Math.round(o/36e5)}h`}function uA(o){let e=Ki(o.token);if(typeof e=="string")return 0;let t=e==null?void 0:e.exp;return t?t*1e3:0}var ac=class{constructor(e,t=5){this.expiryMargin=5*60*1e3;this.activeConnections=0;this._activePromises=new Map,e.getStorage?this.tokenMap=e.getStorage():this.tokenMap=new Map,this.callbacks=new Map,this.refreshQueue=new Set,this._log=e.log,this.refresh=e.refresh,this.timeProvider=e.getTimeProvider(),e.getJwtExpiry?this.getJwtExpiry=e.getJwtExpiry:this.getJwtExpiry=uA,this.maxConnections=t,this.refreshInterval=null,Ct.set(this,"TokenStore")}onRefresh(e){return new Promise((r,n)=>{let s=a=>{r(a)},i=a=>{this.removeFromRefreshQueue(e),n(a)};this.refresh(e,s,i)})}start(){this.log("starting"),this.report(),this.refreshInterval=this.timeProvider.setInterval(()=>this.checkAndRefreshTokens(),60*1e3),this.checkAndRefreshTokens()}stop(){this.log("stopping"),this.refreshInterval&&(this.timeProvider.clearInterval(this.refreshInterval),this.refreshInterval=null)}_cleanupInvalidTokens(){let e=[];for(let[t,r]of this.tokenMap.entries())this.isTokenValid(r)||e.push(t);for(let t of e)this.tokenMap.delete(t)}checkAndRefreshTokens(){this.log("check and refresh tokens"),this._cleanupInvalidTokens();for(let[e,t]of this.tokenMap.entries())this.callbacks.has(e)&&this.shouldRefresh(t)&&(this.log("adding to refresh queue"),this.addToRefreshQueue(e));this.log(this.report())}dequeue(){if(this.log("getting next item in queue"),this.refreshQueue.size>0){let e=this.refreshQueue.values().next().value;return this.refreshQueue.delete(e),e}return null}addToRefreshQueue(e){if(this.activeConnections<this.maxConnections){this.log(`immediate refresh of ${e}`),this.activeConnections++;let t=n=>{this.onTokenRefreshed(e,n),this.activeConnections--;let s=this.dequeue();s&&this.addToRefreshQueue(s)},r=()=>{this.onRefreshFailure(e),this.activeConnections--;let n=this.dequeue();n&&this.addToRefreshQueue(n)};this.refresh(e,t,r)}else this.log(`enqueued refresh of ${e}`),this.refreshQueue.add(e)}removeFromRefreshQueue(e){return this.log(`removing ${e} from refresh queue`),this.refreshQueue.has(e)?(this.refreshQueue.delete(e),!0):!1}log(e){this._log(e)}onTokenRefreshed(e,t){let r=this.getJwtExpiry(t);if(this.tokenMap.has(e)){let n=this.tokenMap.get(e),s=this.callbacks.get(e);this.log(`new expiry time is ${r}`),this.tokenMap.set(e,{...n,token:t,expiryTime:r}),s(t),this.log(`Token refreshed for ${n.friendlyName} (${e})`)}}onRefreshFailure(e){var n;let t=this.tokenMap.get(e),r=((n=t==null?void 0:t.attempts)!=null?n:0)+1;r<=3?this.tokenMap.set(e,{...t,attempts:r}):this.tokenMap.delete(e)}isTokenValid(e){return this.timeProvider.getTime()<e.expiryTime}shouldRefresh(e){return this.timeProvider.getTime()+this.expiryMargin>e.expiryTime}getTokenSync(e){var t,r;return(r=(t=this.tokenMap)==null?void 0:t.get(e))==null?void 0:r.token}getTokenFromNetwork(e,t,r){var a;let n=this._activePromises.get(e);if(n)return n;let s=this.tokenMap.get(e);this.tokenMap.set(e,{token:null,friendlyName:t,expiryTime:0,attempts:(a=s==null?void 0:s.attempts)!=null?a:0}),this.callbacks.set(e,r);let i=this.onRefresh(e).then(l=>(this.onTokenRefreshed(e,l),this._activePromises.delete(e),l)).catch(l=>{throw this.onRefreshFailure(e),this._activePromises.delete(e),l});return this._activePromises.set(e,i),i}async getToken(e,t,r){if(this.log(`getting token ${t}`),this.tokenMap||Promise.reject(new Error("attempted to get token after TokenStore was destroyed.")),this.tokenMap.has(e)){let n=this.tokenMap.get(e);if(n.token&&this.isTokenValid(n))return this.callbacks.set(e,r),n.friendlyName=t,r(n.token),this.log("token was valid, cache hit!"),this._activePromises.delete(e),Promise.resolve(n.token)}return this.getTokenFromNetwork(e,t,r)}_reportWithFilter(e){let t=[],r=this.timeProvider.getTime(),n=Array.from(this.tokenMap.entries()).sort((s,i)=>s[1].expiryTime-i[1].expiryTime);for(let[s,{friendlyName:i,expiryTime:a,attempts:l}]of n){if(!e(s))continue;let c=a-r,f="";c>0?f=`expires in ${qb(c-this.expiryMargin)}`:f="expired",t.push(`${s} (${i}): ${l} attempts, (${f})`)}return t}report(){let e=[];return e.push("Token Store Report:"),e.push(`Expiry Margin: ${qb(this.expiryMargin)}`),e.push("Active Tokens:"),e.push(...this._reportWithFilter(t=>this.callbacks.has(t))),e.push("Stale Tokens:"),e.push(...this._reportWithFilter(t=>!this.callbacks.has(t))),e.push(`Queue size: ${this.refreshQueue.size}`),e.join(`
`)}async waitForQueue(){return new Promise(e=>{setInterval(()=>{if(this.refreshQueue.size==0)return e()},100)})}clearState(){this.refreshQueue.clear();for(let[e,t]of this.tokenMap.entries())this.isTokenValid(t)?this.tokenMap.set(e,{...t,attempts:0}):this.tokenMap.delete(e)}clear(e){e?this.tokenMap.forEach((t,r)=>{e(t)&&(this.tokenMap.delete(r),this.refreshQueue.delete(r))}):(this.tokenMap.clear(),this.refreshQueue.clear())}destroy(){this.clear(),this.timeProvider.destroy(),this.timeProvider=null,this.refresh=null,this.callbacks.clear(),this.callbacks=null,this._activePromises.clear(),this._activePromises=null,this.tokenMap=null}};function dA(o){return o.expiryTime||0}function pA(o,e){return(...t)=>e(o,...t)}async function mA(o,e,t,r){var c;let n=ke("[TokenStore][Refresh]","debug"),s=ke("[TokenStore][Refresh]","error");n(`${e}`);let i=at.decode(e),a;if(i instanceof Ur)a=JSON.stringify({docId:i.documentId,relay:i.relayId,folder:i.folderId});else if(i instanceof Zt)a=JSON.stringify({docId:i.canvasId,relay:i.relayId,folder:i.folderId});else if(i instanceof xo)a=JSON.stringify({docId:i.folderId,relay:i.relayId,folder:i.folderId});else if(i instanceof bo)a=JSON.stringify({docId:i.fileId,relay:i.relayId,folder:i.folderId});else{r(new Error("No remote to connect to"));return}if(!o.loggedIn){r(Error("Not logged in"));return}let l={Authorization:`Bearer ${(c=o.user)==null?void 0:c.token}`,"Relay-Version":"0.5.13"};try{let f=o.getEndpointManager().getApiUrl(),u=await ot(`${f}/token`,{method:"POST",headers:l,body:a});if(!u.ok){n(u.status,await u.text()),r(Error(`Received status code ${u.status} from an API.`));return}let d=await u.json();t(d)}catch(f){s(f,a),r(f)}}var lc=class extends ac{constructor(t,r,n,s=5){super({log:ke("[LiveTokenStore]","debug"),refresh:pA(t,mA),getJwtExpiry:dA,getStorage:function(){return new ko("TokenStore/"+n)},getTimeProvider:()=>r},s);this.loginManager=t}async getFileTokenFromNetwork(t,r,n,s){let i=`${t}${r}`,a=this._activePromises.get(i);if(a)return a;this.tokenMap.set(t,{token:null,expiryTime:0,attempts:0});let l=this.fetchFileToken(t,r,n,s).then(c=>{let f=this.getJwtExpiry(c),u=this.tokenMap.get(i);return this.tokenMap.set(r,{...u,token:c,expiryTime:f}),this._activePromises.delete(i),c}).catch(c=>{throw this._activePromises.delete(i),c});return this._activePromises.set(i,l),l}async fetchFileToken(t,r,n,s){var m;let i=ke("[TokenStore][Fetch]","debug");i(`${t}`);let a=at.decode(t),l;if(a instanceof bo)l=JSON.stringify({docId:a.fileId,relay:a.relayId,folder:a.folderId,hash:r,contentType:n,contentLength:s});else throw new Error(`No remote to connect to for ${t}`);if(!this.loginManager.loggedIn)throw new Error("Not logged in");let c={Authorization:`Bearer ${(m=this.loginManager.user)==null?void 0:m.token}`,"Relay-Version":"0.5.13"},f=this.loginManager.getEndpointManager().getApiUrl(),u=await ot(`${f}/file-token`,{method:"POST",headers:c,body:l});if(!u.ok){i(u.status,await u.text());let p=await u.json();throw new Error(p.error)}return await u.json()}async getFileToken(t,r,n,s){let i=`${t}${r}`,a=this.tokenMap.get(i);return a&&a.token&&this.isTokenValid(a)?(this.log("token was valid, cache hit!"),this._activePromises.delete(i),Promise.resolve(a.token)):this.getFileTokenFromNetwork(t,r,n,s)}};var zb=require("obsidian");var Up=class{constructor(e,t,r=1e4){this.timeProvider=e;this.onOnline=[];this.onOffline=[];this.online=!0;this._log=ke("[NetworkStatus]"),this.url=t,this.interval=r,this._onceOnline=new Set}log(e,...t){this._log(e,...t)}start(){this.timer||(this.timer=this.checkStatusRepeatedly())}stop(){this.timer&&clearInterval(this.timer)}checkStatusRepeatedly(){return this.timeProvider.setInterval(this._checkStatus.bind(this),this.interval)}checkStatus(){return this.online?Promise.resolve(!0):new Promise(e=>{this._checkStatus().then(()=>{e(this.online)})})}async _checkStatus(){return(0,zb.requestUrl)({url:this.url,method:"GET",headers:{"Relay-Version":"0.5.13"}}).then(e=>{if(e.status===200){if(e.json&&e.json.status&&(this.status=e.json),!this.online){this.log("back online"),this.online=!0,this.onOnline.forEach(t=>t(this.status)),this._onceOnline.forEach(t=>t(this.status)),this._onceOnline.clear();return}}else if(e.status!==200&&this.online)throw new Error("disconnected")}).catch(e=>{if(e.message.includes("ERR_NETWORK_CHANGED")){this._checkStatus();return}this.online=!1,this.onOffline.forEach(t=>t(this.status))})}onceOnline(e){this._onceOnline.add(e)}addEventListener(e,t){e==="online"?this.onOnline.push(t):e==="offline"&&this.onOffline.push(t)}destroy(){this._onceOnline.clear(),this._onceOnline=null,this.onOnline=null,this.onOffline=null,this.timeProvider=null}},Wb=Up;var Kt=class extends et{constructor(t){super();this.observableName=t;this._map=new Map,this._derivedMaps=new WeakMap}set(t,r){return this._map.set(t,r),this.notifyListeners(),this}delete(t){let r=this._map.delete(t);return r&&this.notifyListeners(),r}clear(){this._map.clear(),this.notifyListeners()}has(t){return this._map.has(t)}get(t){return this._map.get(t)}keys(){return[...this._map.keys()]}values(){return[...this._map.values()]}entries(){return[...this._map.entries()]}get size(){return this._map.size}forEach(t){this._map.forEach(t)}find(t){for(let[r,n]of this._map)if(t(n,r))return n}some(t){for(let[r,n]of this._map)if(t(n,r))return!0;return!1}filter(t){let r=this._derivedMaps.get(t);if(r)return r;let n=new Op(this,t);return this._derivedMaps.set(t,n),n}},Op=class extends Kt{constructor(t,r){super();this.parentMap=t;this.predicate=r;this.sub(),this.observableName=t.observableName+"(filter: "+r.toString()+")"}sub(){this.unsub||(this.unsub=this.parentMap.subscribe(()=>{let t=new Map;this.parentMap.forEach((r,n)=>{this.predicate(r,n)&&t.set(n,r)}),this._map=t,this.notifyListeners()}))}subscribe(t){return this.sub(),super.subscribe(t),()=>{this.unsubscribe(t)}}unsubscribe(t){super.unsubscribe(t),this._listeners.size===0&&this.unsub&&(this.unsub(),this.unsub=void 0)}destroy(){this.unsub&&this.unsub()}};function $p(o){return typeof o.id=="string"}function hA(o){return typeof o.name=="string"}var Np=class{constructor(e){this.collectionName="roles";this.roles=e}items(){return this.roles.values()}clear(){this.roles.clear()}get(e){return this.roles.get(e)}ingest(e){return this.roles.set(e.id,e),e}delete(e){this.roles.delete(e)}};function jb(o){return typeof o.aggregate_root=="object"}function Kb(o){return typeof o.acl=="object"}var Gi=class{get aggregate_root(){}get acl(){}},Bp=class extends et{constructor(t,r){super();this.storageQuota=t;this.relays=r}update(t){return this.storageQuota=t,this}get name(){return this.storageQuota.name}get id(){return this.storageQuota.id}get quota(){return this.storageQuota.quota}get pending(){return this.storageQuota.pending}get usage(){return this.storageQuota.usage}get maxFileSize(){return this.storageQuota.max_file_size}get updated(){return this.storageQuota.updated}get created(){return this.storageQuota.created}get aggregate_root(){var t;return["relays",(t=this.relays.find(r=>r.storageQuotaId===this.storageQuota.id))==null?void 0:t.id]}},Vp=class{constructor(e,t,r){this.subscribeRecord=e;this.storageQuota=t;this.relays=r;this.collectionName="storage_quotas"}items(){return this.storageQuota.values()}clear(){this.storageQuota.clear()}get(e){return this.storageQuota.get(e)}ingest(e){let t=this.storageQuota.get(e.id);if(t)return t.update(e),this.storageQuota.notifyListeners(),t;let r=new Bp(e,this.relays);return this.subscribeRecord(this.collectionName,e.id,[]).then(n=>{r.offRecordSubscription=n}),this.storageQuota.set(e.id,r),r}delete(e){var r;let t=this.storageQuota.get(e);(r=t==null?void 0:t.offRecordSubscription)==null||r.call(t),this.storageQuota.delete(e)}},cc=class extends Gi{constructor(t){super();this.user=t}get id(){return this.user.id}get name(){return this.user.name}get email(){return this.user.email}get picture(){return this.user.picture}update(t){return this.user=t,this}},Hp=class extends et{constructor(t){super();this.provider=t}get id(){return this.provider.id}get name(){return this.provider.name}get url(){return this.provider.url}get selfHosted(){return this.provider.self_hosted}update(t){return this.provider=t,this}},qp=class{constructor(e){this.providers=e;this.collectionName="providers"}items(){return this.providers.values()}clear(){this.providers.clear()}get(e){return this.providers.get(e)}ingest(e){let t=this.providers.get(e.id);if(t)return t.update(e),this.providers.notifyListeners(),t;let r=new Hp(e);return this.providers.set(e.id,r),r}delete(e){this.providers.delete(e)}},zp=class extends Gi{constructor(t,r,n){super();this.remoteFolder=t;this.relays=r;this.users=n}update(t){return this.remoteFolder=t,this}get id(){return this.remoteFolder.id}get guid(){return this.remoteFolder.guid}get name(){return this.remoteFolder.name}get private(){return this.remoteFolder.private}get creator(){let t=this.users.get(this.remoteFolder.creator);if(!t)throw new Error("invalid remote folder");return t}get relay(){let t=this.relays.get(this.remoteFolder.relay);if(!t)throw new Error("invalid remote folder");return t}get aggregate_root(){return["relays",this.remoteFolder.relay]}get acl(){return["relays",this.remoteFolder.relay]}},Wp=class{constructor(e,t,r){this.remoteFolders=e;this.relays=t;this.users=r;this.collectionName="shared_folders"}items(){return this.remoteFolders.values()}clear(){this.remoteFolders.clear()}get(e){return this.remoteFolders.get(e)}ingest(e){let t=this.remoteFolders.get(e.id);if(t)return t.update(e),this.remoteFolders.notifyListeners(),t;let r=new zp(e,this.relays,this.users);return this.remoteFolders.set(e.id,r),r}delete(e){this.remoteFolders.delete(e)}},jp=class{constructor(e,t,r,n,s,i,a,l,c){this.relays=e;this.roles=t;this.relayRoles=r;this.relayInvitations=n;this.remoteFolders=s;this.subscriptions=i;this.storageQuotas=a;this.providers=l;this.user=c;this.collectionName="relays"}items(){return this.relays.values()}clear(){this.relays.clear()}get(e){return this.relays.get(e)}ingest(e){let t=this.relays.get(e.id);if(t)return t.update(e),this.relays.notifyListeners(),t;let r=new fc(e,this.relayRoles,this.relayInvitations,this.remoteFolders,this.subscriptions,this.storageQuotas,this.providers,this.user);return this.relays.set(r.id,r),r}delete(e){this.relays.delete(e)}},Kp=class{constructor(e,t,r,n){this.collectionName="relay_roles";this.relayRoles=e,this.relays=t,this.users=r,this.roles=n}items(){return this.relayRoles.values()}clear(){this.relayRoles.clear()}get(e){return this.relayRoles.get(e)}ingest(e){let t=this.relayRoles.get(e.id);if(t)return t.update(e),this.relayRoles.notifyListeners(),t;let r=new Zp(e,this.relays,this.users,this.roles);return this.relayRoles.set(r.id,r),r}delete(e){this.relayRoles.get(e)&&this.relayRoles.delete(e)}},Gp=class{constructor(e,t,r){this.collectionName="relay_invitations";this.relayInvitations=e,this.relays=t,this.roles=r}items(){return this.relayInvitations.values()}clear(){this.relayInvitations.clear()}get(e){return this.relayInvitations.get(e)}ingest(e){let t=this.relayInvitations.get(e.id);if(t)return t.update(e),this.relayInvitations.notifyListeners(),t;let r=new Xp(e,this.relays,this.roles);return this.relayInvitations.set(r.id,r),r}delete(e){this.relayInvitations.delete(e)}},Jp=class{constructor(e){this.users=e;this.collectionName="users"}items(){return this.users.values()}clear(){this.users.clear()}get(e){return this.users.get(e)}ingest(e){let t=this.users.get(e.id);if(t)return t.update(e),this.users.notifyListeners(),t;let r=new cc(e);return this.users.set(e.id,r),r}delete(e){this.users.delete(e)}},Yp=class{constructor(e,t,r){this.subscriptions=e;this.relays=t;this.users=r;this.collectionName="subscriptions"}items(){return this.subscriptions.values()}clear(){this.subscriptions.clear()}get(e){return this.subscriptions.get(e)}ingest(e){let t=this.subscriptions.get(e.id);if(t)return t.update(e),this.subscriptions.notifyListeners(),t;let r=new em(e,this.relays,this.users);return this.subscriptions.set(e.id,r),r}delete(e){this.subscriptions.delete(e)}},Qp=class extends yt{constructor(t){super();this.collections=new Map,this.relationships=new Map;for(let r of t)this.collections.set(r.collectionName,r);Ct.set(this,"Store")}getCollection(t){let r=this.collections.get(t);if(!r)throw this.error("No collection found for",t),new Error("No collection found for "+t);return r}clear(){let t=Sr.getInstance();t.beginTransaction(),this.collections.forEach(r=>{r.clear()}),this.collections.clear(),this.relationships.clear(),t.commitTransaction()}destroy(){this.clear(),this.collections=null,this.relationships=null}ingestPage(t){return this.ingestBatch(t==null?void 0:t.items)}ingestBatch(t){if(t)return t.map(r=>this.ingest(r))}ingest(t){let r=Sr.getInstance();r.beginTransaction();let n=this._ingest(t);return r.commitTransaction(),n}_ingest(t){if(!t)return;let r,n=this.collections.get(t.collectionName);if(n?r=n.ingest(t):this.error("No collection found for record",t),jb(r)){let s=r.aggregate_root;if(s){let i=t.id,a=this.relationships.get(s.join(":"))||new Set;a.add([t.collectionName,i].join(":")),this.relationships.set(s.join(":"),a)}}if(Kb(r)){let s=r.acl;if(s){let i=t.id,a=this.relationships.get(s.join(":"))||new Set;a.add([t.collectionName,i].join(":")),this.relationships.set(s.join(":"),a)}}if(t.expand)for(let[,s]of Object.entries(t.expand))Array.isArray(s)?this.ingestBatch(s):this.ingest(s);return r}delete(t){this.cascade(t.collectionName,t.id)}graphviz(){let t=`digraph G {
`;for(let[r,n]of this.collections)for(let s of n.items()){if(!$p(s)){this.warn("record has no id",s);continue}let i=r+"_"+s.id;if(hA(s)&&(i=r+"_"+s.name),t+=`  ${r}_${s.id} [label="${i}"];
`,$p(s)&&jb(s)&&s.aggregate_root){let[a,l]=s.aggregate_root;t+=`  ${r}_${s.id} -> ${a}_${l};
`}if($p(s)&&Kb(s)&&s.acl){let[a,l]=s.acl;t+=`  ${r}_${s.id} -> ${a}_${l} [style=dotted];
`}}return t+="}",t}cascade(t,r){let n=this.collections.get(t),s=this.relationships.get([t,r].join(":")),i=Sr.getInstance();i.beginTransaction(),n&&(this.warn("cascade delete parent",t,r),n.delete(r)),this.relationships.delete([t,r].join(":"));for(let a of s||[]){let[l,c]=a.split(":");this.warn("cascade delete child",l,c),this.getCollection(l)&&this.cascade(l,c)}i.commitTransaction()}},Zp=class extends Gi{constructor(t,r,n,s){super();this.users=n,this.roles=s,this.relays=r,this.relayRole=t}update(t){return this.relayRole=t,this}get id(){return this.relayRole.id}get userId(){return this.relayRole.user}get user(){let t=this.users.get(this.relayRole.user);if(!t)throw new Error(`Unable to find user: ${this.relayRole.user}`);return t}get role(){var t;return(t=this.roles.get(this.relayRole.role))==null?void 0:t.name}get relayId(){return this.relayRole.relay}get relay(){let t=this.relays.get(this.relayRole.relay);if(!t)throw new Error(`invalid role: unable to find relay ${this.relayRole.relay} on role ${this.relayRole.id}`);return t}get aggregate_root(){return["relays",this.relayRole.relay]}get acl(){return["users",this.relayRole.user]}},Xp=class{constructor(e,t,r){this.relayInvitation=e,this.roles=r,this.relays=t}update(e){return this.relayInvitation=e,this}get key(){return this.relayInvitation.key}get id(){return this.relayInvitation.id}get role(){var e;return(e=this.roles.get(this.relayInvitation.role))==null?void 0:e.name}get relayId(){return this.relayInvitation.relay}get relay(){let e=this.relays.get(this.relayInvitation.relay);if(!e)throw new Error("invalid invitation");return e}get enabled(){return this.relayInvitation.enabled}get aggregate_root(){return["relays",this.relayInvitation.relay]}},em=class extends et{constructor(t,r,n){super();this.subscription=t;this.relays=r;this.users=n}update(t){return this.subscription=t,this.notifyListeners(),this}get id(){return this.subscription.id}get token(){return this.subscription.token}get active(){return this.subscription.active}get user(){let t=this.users.get(this.subscription.user);if(!t)throw new Error("invalid subscription");return t}get relayId(){return this.subscription.relay}get relay(){let t=this.relays.get(this.subscription.relay);if(!t)throw new Error("invalid subscription");return t}get stripe_cancel_at(){return this.subscription.stripe_cancel_at}get cancelAt(){return this.subscription.stripe_cancel_at!==0?new Date(this.subscription.stripe_cancel_at*1e3):null}get quantity(){return this.subscription.stripe_quantity}get aggregate_root(){return["relays",this.subscription.relay]}get acl(){return["users",this.subscription.user]}},fc=class extends et{constructor(t,r,n,s,i,a,l,c){super();this.relay=t;this.relayRoles=r;this.relayInvitations=n;this.remoteFolders=s;this._subscriptions=i;this.storageQuotas=a;this.providers=l;this.user=c}update(t){return this.relay=t,this.notifyListeners(),this}get cta(){return this.relay.cta}get plan(){return this.relay.plan}get id(){return this.relay.id}get guid(){return this.relay.guid}get name(){return this.relay.name}set name(t){this.relay.name=t}get userLimit(){return this.relay.user_limit}get role(){var n;let t=this.relay.creator===this.user.id,r=(n=this.relayRoles.find(s=>s.relayId===this.relay.id&&s.userId===this.user.id))==null?void 0:n.role;return r||(this.warn("couldn't find role",this.relay.id,this.user,t),t?"Owner":"Member")}get owner(){return this.role==="Owner"}get invitation(){return this.relayInvitations.find(t=>t.relay.id===this.relay.id)}get storageQuota(){return this.storageQuotas.find(t=>t.id===this.relay.storage_quota)}get storageQuotaId(){return this.relay.storage_quota}get folders(){return this.remoteFolders.filter(t=>t.relay.id===this.id)}get subscriptions(){return this._subscriptions.filter(t=>t.relay.id===this.id)}get acl(){var r;let t=(r=this.relayRoles.find(n=>n.relayId===this.id&&n.userId===this.user.id))==null?void 0:r.id;if(t)return["relay_roles",t]}get provider(){if(this.relay.provider)return this.providers.get(this.relay.provider)}get providerId(){return this.relay.provider}},uc=class extends yt{constructor(t){super();this.loginManager=t;this.destroyed=!1;this._handleEvent=(t,r)=>{var n,s;this.debug(`[Event]: ${t}`,r.action,r.record),r.action==="delete"?(n=this.store)==null||n.delete(r.record):(s=this.store)==null||s.ingest(r.record)};this.pb=this.loginManager.pb,this.users=new Kt("users"),this.relays=new Kt("relays"),this.providers=new Kt("providers"),this.remoteFolders=new Kt("remote folders"),this.relayInvitations=new Kt("relay invitations"),this.relayRoles=new Kt("relay roles"),this.roles=new Kt("roles"),this.roles.set("2arnubkcv7jpce8",{name:"Owner",id:"2arnubkcv7jpce8"}),this.roles.set("x6lllh2qsf9lxk6",{name:"Member",id:"x6lllh2qsf9lxk6"}),this.subscriptions=new Kt("subscriptions"),this.storageQuotas=new Kt("storage quotas"),this._offLoginManager=this.loginManager.on(()=>{this.loginManager.loggedIn?this.login():this.logout()}),this.setUser(),this.user&&(Ct.set(this,"RelayManager"),this.buildGraph(),this.subscribe(),this.update())}buildGraph(){if(!this.user)return;if(!this.pb){console.warn("no pb!");return}if(this.store)return;let t=new Np(this.roles),r=new Jp(this.users),n=new qp(this.providers),s=new jp(this.relays,this.roles,this.relayRoles,this.relayInvitations,this.remoteFolders,this.subscriptions,this.storageQuotas,this.providers,this.user),i=new Kp(this.relayRoles,this.relays,this.users,this.roles),a=new Gp(this.relayInvitations,this.relays,this.roles),l=new Wp(this.remoteFolders,this.relays,this.users),c=new Yp(this.subscriptions,this.relays,this.users),f=new Vp(this.subscribeRecord.bind(this),this.storageQuotas,this.relays);this.store=new Qp([t,r,s,i,a,l,c,f,n])}setUser(){var t;this.authUser=(t=this.pb)==null?void 0:t.authStore.model,this.authUser&&(this.user=new cc(this.authUser),this.users.set(this.user.id,this.user))}login(){var t;this.authUser&&this.authUser==((t=this.pb)==null?void 0:t.authStore.model)||(this.setUser(),this.buildGraph(),this.subscribe(),this.update())}logout(){var t;(t=this.store)==null||t.clear(),this.user=void 0,this.store=void 0}async rotateKey(t){if(!this.pb)throw new Error("missing pocketbase");return this.pb.send("/api/rotate-key",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:t.id})}).then(r=>{var s;let n=(s=this.store)==null?void 0:s.ingest(r);if(!n)throw new Error("unable to rotate key");return n})}async toggleRelayInvitation(t,r){if(!this.pb)throw new Error("missing pocketbase");return this.pb.collection("relay_invitations").update(t.id,{enabled:r}).then(n=>{var i;let s=(i=this.store)==null?void 0:i.ingest(n);if(!s)throw new Error("unable to toggle invitation enable");return s})}async getRelayInvitation(t){if(!this.pb)return;let r=this.relayInvitations.find(n=>n.relay.id===t.id);return r||this.pb.collection("relay_invitations").getList(0,200).then(n=>{n.items.forEach(i=>{var a;(a=this.store)==null||a.ingest(i)});let s=this.relayInvitations.find(i=>i.relay.id===t.id);if(s)return s})}async getSubscriptionToken(t){if(!this.pb||!this.pb.authStore.isValid)throw new Error("Auth is not valid");let r=`/api/subscription/${t.id}/token`,n=await this.pb.send(r,{method:"POST"});if(n!==200)throw new Error("Token API failed");return n.json().token}async subscribe(){var r;if(!this.pb||!this.pb.authStore.isValid||((r=this.pb.authStore.model)==null?void 0:r.id)===void 0){this.warn("unable to subscribe, pocketbase client is not ready");return}let t=[{name:"relays",expand:["relay_invitations_via_relay","shared_folders_via_relay","shared_folders_via_relay.creator","subscriptions_via_relay","subscriptions_via_relay.relay","subscriptions_via_relay.relay.storage_quota","creator"]},{name:"relay_invitations",expand:["relay"]},{name:"providers",expand:[]},{name:"relay_roles",expand:["user","relay"]},{name:"shared_folders",expand:["relay","creator"]},{name:"subscriptions",expand:["user","relay"]}];for(let n of t)this.pb.collection(n.name).subscribe("*",s=>this._handleEvent(n.name,s),{expand:n.expand.join(","),fetch:ot})}async subscribeRecord(t,r,n){var s;if(!this.pb||!this.pb.authStore.isValid||((s=this.pb.authStore.model)==null?void 0:s.id)===void 0){this.warn("unable to subscribe, pocketbase client is not ready");return}return this.pb.collection(t).subscribe(r,i=>this._handleEvent(t,i),{expand:n.join(","),fetch:ot})}async update(){let t=(n,s={})=>{var i;return!this.pb||!this.pb.authStore.isValid||((i=this.pb.authStore.model)==null?void 0:i.id)===void 0?Promise.resolve([]):(typeof s=="function"&&(s=s(this.pb.authStore.model.id)),this.pb.collection(n).getFullList(s))};[t("users",n=>({filter:`id="${n}"`,expand:["relay_roles_via_user","relay_roles_via_user.relay","relay_roles_via_user.relay.storage_quota","relay_roles_via_user.role"].join(",")})),t("relay_roles",{expand:"user"}),t("providers"),t("relay_invitations"),t("shared_folders",{expand:"relay,creator"}),t("subscriptions",{expand:"relay,user"})].forEach(async n=>{let s=await n;for(let i of s)!this.destroyed&&this.store&&this.store.ingest(i)})}async acceptInvitation(t){var s;if(!this.pb)throw new Error("Failed to accept invitation");let r=await this.pb.send("/api/accept-invitation",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:t})}).catch(i=>{throw i});this.debug("[InviteAccept]",r);let n=(s=this.store)==null?void 0:s.ingest(r);if(!n)throw new Error("Failed to accept invitation");return n}async createRelay(t){var i;let r=Is(),n=await((i=this.pb)==null?void 0:i.collection("relays").create({guid:r,name:t,path:null},{expand:"relay_roles_via_relay,relay_invitations_via_relay,storage_quota"}));if(!n)throw new Error("Failed to create Relay");if(!this.user)throw new Error("Not Logged In");let s=new fc(n,this.relayRoles,this.relayInvitations,this.remoteFolders,this.subscriptions,this.storageQuotas,this.providers,this.user);return this.relays.set(s.id,s),s}async updateRelay(t){var s;if(!this.pb)throw new Error("Failed to update relay");let r=await this.pb.collection("relays").update(t.id,{name:t.name.trim()}),n=(s=this.store)==null?void 0:s.ingest(r);if(!n)throw new Error("Failed to update relay");return n}async deleteRemote(t){var n;t.remote=void 0;let r=this.remoteFolders.find(s=>s.guid===t.guid);return r?(await((n=this.pb)==null?void 0:n.collection("shared_folders").delete(r.id)),t.remote=void 0,!0):!1}async createRemoteFolder(t,r){var i,a;if(!this.pb)throw new Error("Failed to create folder");let n=await this.pb.collection("shared_folders").create({name:t.name,guid:t.guid,relay:r.id,creator:(i=this.user)==null?void 0:i.id,private:!1},{expand:"relay"}),s=(a=this.store)==null?void 0:a.ingest(n);if(!s)throw new Error("Failed to create folder");return s}async destroyRelay(t){var r,n;return(r=this.store)==null||r.cascade("relays",t.id),await((n=this.pb)==null?void 0:n.collection("relays").delete(t.id)),!0}async leaveRelay(t){var n,s;let r=this.relayRoles.find(i=>{var a;return i.userId===((a=this.user)==null?void 0:a.id)&&i.relayId===t.id});r?await((n=this.pb)==null?void 0:n.collection("relay_roles").delete(r.id)):this.warn("No role found to leave relay"),(s=this.store)==null||s.cascade("relay",t.id)}async kick(t){var r;return(r=this.pb)==null?void 0:r.collection("relay_roles").delete(t.id)}async updateRelayRole(t,r){var a;if(!this.pb)throw new Error("Failed to update relay role");let n=this.roles.find(l=>l.name===r);if(!n)throw new Error("Failed to update relay role");let s=await this.pb.collection("relay_roles").update(t.id,{role:n.id}),i=(a=this.store)==null?void 0:a.ingest(s);if(!i)throw new Error("Failed to update relay role");return i}destroy(){var t,r,n;this.destroyed=!0,(t=this._offLoginManager)==null||t.call(this),this._offLoginManager=null,(r=this.pb)==null||r.cancelAllRequests(),this.loginManager=null,(n=this.store)==null||n.destroy(),this.pb=null,this.authUser=null,this.store=null}};var _w=require("obsidian");var tm=require("obsidian");function cn(o,e){let t=o.path.split("/"),r=e.path.split("/");if(t.length===2&&r.length>2)return 1;if(r.length===2&&t.length>2)return-1;let n=Math.min(t.length,r.length);for(let s=0;s<n;s++)if(t[s]!==r[s]){if(s===t.length-1){let i=t[s].match(/\d+/g),a=r[s].match(/\d+/g);if(i&&a){let l=parseInt(i[0]),c=parseInt(a[0]);if(l!==c)return l-c}}return t[s].localeCompare(r[s])}return t.length-r.length}var dc=class extends yt{constructor(t,r,n,s=3){super();this.loginManager=t;this.timeProvider=r;this.sharedFolders=n;this.concurrency=s;this.activeSync=new Go;this.activeDownloads=new Go;this.syncGroups=new Kt;this.syncQueue=[];this.downloadQueue=[];this.isProcessingSync=!1;this.isProcessingDownloads=!1;this.isPaused=!0;this.inProgressSyncs=new Set;this.inProgressDownloads=new Set;this.syncCompletionCallbacks=new Map;this.downloadCompletionCallbacks=new Map;this.loggedItems=new Map;this.subscriptions=[];this.start=this.resume;Ct.set(this,"BackgroundSync"),this.timeProvider.setInterval(()=>{this.processSyncQueue(),this.processDownloadQueue()},1e3)}get pendingSyncs(){return this.syncQueue}get pendingDownloads(){return this.downloadQueue}getOverallProgress(){let t=0,r=0,n=0,s=0,i=0,a=0;this.syncGroups.forEach(u=>{t+=u.total,r+=u.completed,n+=u.syncs,s+=u.completedSyncs,i+=u.downloads,a+=u.completedDownloads});let l=t>0?r/t*100:0,c=n>0?s/n*100:0,f=i>0?a/i*100:0;return{totalPercent:Math.round(l),syncPercent:Math.round(c),downloadPercent:Math.round(f),totalItems:t,completedItems:r,syncItems:n,completedSyncs:s,downloadItems:i,completedDownloads:a}}getGroupProgress(t){let r=this.syncGroups.get(t);if(!r)return null;let n=r.total>0?r.completed/r.total*100:0,s=r.syncs>0?r.completedSyncs/r.syncs*100:0,i=r.downloads>0?r.completedDownloads/r.downloads*100:0;return{percent:Math.round(n),syncPercent:Math.round(s),downloadPercent:Math.round(i),sharedFolder:t,status:r.status}}getAllGroupsProgress(){let t=[];return this.syncGroups.forEach((r,n)=>{let s=this.getGroupProgress(n);s&&t.push(s)}),t}async processSyncQueue(){if(this.isPaused||this.isProcessingSync)return;this.isProcessingSync=!0;let t=this.syncQueue.filter(r=>r.sharedFolder.connected);for(;t.length>0&&this.activeSync.size<this.concurrency;){let r=t.shift();if(!r)break;this.syncQueue=this.syncQueue.filter(n=>n.guid!==r.guid),r.status="running",this.activeSync.add(r);try{let n=r.doc;n instanceof Zo?await this.syncFile(n):await this.syncDocument(n),r.status="completed";let s=this.syncCompletionCallbacks.get(r.guid);s&&(s.resolve(),this.syncCompletionCallbacks.delete(r.guid));let i=this.syncGroups.get(r.sharedFolder);i&&(this.debug(`[Sync Progress] Before: completed=${i.completed}, total=${i.total}, syncs=${i.syncs}, completedSyncs=${i.completedSyncs}`),i.completedSyncs++,i.completed++,this.debug(`[Sync Progress] After: completed=${i.completed}, total=${i.total}, syncs=${i.syncs}, completedSyncs=${i.completedSyncs}`),i.completed===i.total&&(i.status="completed",this.debug("[Sync Progress] Group completed!")),this.syncGroups.set(r.sharedFolder,i))}catch(n){r.status="failed";let s=this.syncCompletionCallbacks.get(r.guid);s&&(s.reject(n instanceof Error?n:new Error(String(n))),this.syncCompletionCallbacks.delete(r.guid));let i=this.syncGroups.get(r.sharedFolder);i&&(this.error("[Sync Failed]",n),i.status="failed",this.syncGroups.set(r.sharedFolder,i))}finally{this.activeSync.delete(r),this.inProgressSyncs.delete(r.guid)}}this.isProcessingSync=!1,this.syncQueue.length>0&&!this.isPaused&&this.syncQueue.some(n=>n.sharedFolder.connected)&&this.processSyncQueue()}async processDownloadQueue(){if(this.isPaused||this.isProcessingDownloads)return;this.isProcessingDownloads=!0;let t=this.downloadQueue.filter(r=>r.sharedFolder.connected);for(;t.length>0&&this.activeDownloads.size<this.concurrency;){let r=t.shift();if(!r)break;this.downloadQueue=this.downloadQueue.filter(n=>n.guid!==r.guid),r.status="running",this.activeDownloads.add(r);try{r.doc instanceof lt?await this.getCanvas(r.doc):r.doc instanceof Zo?await this.getSyncFile(r.doc):await this.getDocument(r.doc),r.status="completed";let n=this.downloadCompletionCallbacks.get(r.guid);n&&(n.resolve(),this.downloadCompletionCallbacks.delete(r.guid));let s=this.syncGroups.get(r.sharedFolder);s&&(s.completedDownloads++,s.completed++,s.completed===s.total&&(s.status="completed"),this.syncGroups.set(r.sharedFolder,s))}catch(n){r.status="failed";let s=this.downloadCompletionCallbacks.get(r.guid);s&&(s.reject(n instanceof Error?n:new Error(String(n))),this.downloadCompletionCallbacks.delete(r.guid));let i=this.syncGroups.get(r.sharedFolder);i&&(i.status="failed",this.syncGroups.set(r.sharedFolder,i)),this.error("[processDownloadQueue]",n)}finally{this.activeDownloads.delete(r),this.inProgressDownloads.delete(r.guid)}}this.isProcessingDownloads=!1,this.downloadQueue.length>0&&!this.isPaused&&this.downloadQueue.some(n=>n.sharedFolder.connected)&&this.processDownloadQueue()}async enqueueSync(t){if(this.inProgressSyncs.has(t.guid)){this.debug(`[enqueueSync] Item ${t.guid} already in progress, skipping`);let a=this.syncCompletionCallbacks.get(t.guid);return a?new Promise((l,c)=>{a.resolve=l,a.reject=c}):(this.processSyncQueue(),Promise.resolve())}let r=t.sharedFolder,n={guid:t.guid,path:r.getPath(t.path),doc:t,status:"pending",sharedFolder:r},s=this.syncGroups.get(r);s||(s={sharedFolder:r,total:0,completed:0,status:"pending",downloads:0,syncs:0,completedDownloads:0,completedSyncs:0}),s.total++,s.syncs++,this.syncGroups.set(r,s),this.inProgressSyncs.add(t.guid);let i=new Promise((a,l)=>{this.syncCompletionCallbacks.set(t.guid,{resolve:a,reject:l})});return this.syncQueue.push(n),this.syncQueue.sort(cn),this.processSyncQueue(),i}enqueueDownload(t){if(this.inProgressDownloads.has(t.guid)){this.debug(`[enqueueDownload] Item ${t.guid} already in progress, skipping`);let a=this.downloadCompletionCallbacks.get(t.guid);return a?(this.processDownloadQueue(),new Promise((l,c)=>{a.resolve=l,a.reject=c})):(this.processDownloadQueue(),Promise.resolve())}let r=t.sharedFolder,n=this.syncGroups.get(r);n||(n={sharedFolder:r,total:0,completed:0,status:"pending",downloads:0,syncs:0,completedDownloads:0,completedSyncs:0}),n.downloads++,n.total++,this.syncGroups.set(r,n);let s={guid:t.guid,path:r.getPath(t.path),doc:t,status:"pending",sharedFolder:r};this.inProgressDownloads.add(t.guid);let i=new Promise((a,l)=>{this.downloadCompletionCallbacks.set(t.guid,{resolve:a,reject:l})});return this.downloadQueue.push(s),this.downloadQueue.sort(cn),this.processDownloadQueue(),i}enqueueSharedFolderSync(t){let r=[...t.files.values()].filter(ar),n=[...t.files.values()].filter(cr),s=[...t.files.values()].filter(kr),i=[...r,...n,...s],a={sharedFolder:t,total:i.length,completed:0,status:"pending",downloads:0,syncs:i.length,completedDownloads:0,completedSyncs:0};this.syncGroups.set(t,a);let l=[...r].sort(cn),c=[...n].sort(cn),f=[...s].sort(cn);for(let u of l)this.enqueueDocumentForGroupSync(u);for(let u of c)this.enqueueCanvasForGroupSync(u,t);for(let u of f)this.enqueueSyncFileForGroupSync(u);a.status="running",this.syncGroups.set(t,a)}async enqueueDocumentForGroupSync(t){if(this.inProgressSyncs.has(t.guid)){this.debug(`[enqueueDocumentForGroupSync] Item ${t.guid} already in progress, skipping`);let i=this.syncCompletionCallbacks.get(t.guid);return i?(this.processSyncQueue(),new Promise((a,l)=>{i.resolve=a,i.reject=l})):Promise.resolve()}let r=t.sharedFolder,n={guid:t.guid,path:r.getPath(t.path),doc:t,status:"pending",sharedFolder:r};this.inProgressSyncs.add(t.guid);let s=new Promise((i,a)=>{this.syncCompletionCallbacks.set(t.guid,{resolve:i,reject:a})});return this.syncQueue.push(n),this.syncQueue.sort(cn),this.processSyncQueue(),s}async enqueueSyncFileForGroupSync(t){if(this.inProgressSyncs.has(t.guid)){this.debug(`[enqueueSyncFileForGroupSync] Item ${t.guid} already in progress, skipping`);let i=this.syncCompletionCallbacks.get(t.guid);return i?(this.processSyncQueue(),new Promise((a,l)=>{i.resolve=a,i.reject=l})):Promise.resolve()}let r=t.sharedFolder,n={guid:t.guid,path:r.getPath(t.path),doc:t,status:"pending",sharedFolder:r};this.inProgressSyncs.add(t.guid);let s=new Promise((i,a)=>{this.syncCompletionCallbacks.set(t.guid,{resolve:i,reject:a})});return this.syncQueue.push(n),this.syncQueue.sort(cn),this.processSyncQueue(),s}getAuthHeader(t){return{Authorization:`Bearer ${t.token}`}}getBaseUrl(t,r){var a;let n=new URL(t.url);n.protocol="https:";let s=n.pathname.split("/");return s.pop(),s.push(t.docId),n.pathname=s.join("/"),((a=t.baseUrl)==null?void 0:a.replace(/\/$/,""))||n.toString()}async downloadItem(t){let r=f=>f instanceof Zt?f.canvasId:f.documentId,n=t.s3rn;if(this.log("[downloadItem]",t.path,`${at.encode(n)}`),!(n instanceof Ur||n instanceof Zt))throw new Error(`Unable to decode S3RN: ${at.encode(n)}`);let s=await t.getProviderToken(),i=this.getAuthHeader(s),l=`${this.getBaseUrl(s,n)}/as-update`,c=await(0,tm.requestUrl)({url:l,method:"GET",headers:i,throw:!1});if(c.status===200)this.debug("[downloadItem]",r(n),c.status);else throw this.error("[downloadItem]",r(n),l,c.status,c.text),new Error(`Unable to download item: ${at.encode(n)}`);return c}async syncDocumentWebsocket(t){let r="",n="",s=null;cr(t)?(s=lt.exportCanvasData(t.ydoc),n=JSON.stringify(s)):ar(t)&&(n=t.text);try{r=await t.sharedFolder.read(t)}catch(c){}let i=!1;if(cr(t)&&s){let c=r?JSON.parse(r):{nodes:[],edges:[]};i=Xr(s,c)}else i=n===r;if(!i&&r)return this.log("file is not tracking local disk. resolve merge conflicts before syncing."),!1;let a=t.onceProviderSynced(),l=t.intent;return t.connect(),l==="disconnected"&&await a,l==="disconnected"&&!t.userLock&&(t.disconnect(),t.sharedFolder.tokenStore.removeFromRefreshQueue(at.encode(t.s3rn))),!0}async uploadItem(t){let r=t.s3rn;if(this.log("[uploadItem]",`${at.encode(r)}`),!(r instanceof Ur)&&!(r instanceof Zt))throw new Error("Unable to decode S3RN");if(!this.loginManager.loggedIn)throw new Error("Not logged in");let n=await t.getProviderToken(),s={"Content-Type":"application/octet-stream",...this.getAuthHeader(n)},i=Sn(t.ydoc),l=`${this.getBaseUrl(n,r)}/update`,c=await(0,tm.requestUrl)({url:l,method:"POST",headers:s,body:i.buffer,throw:!1});return c.status===200?this.debug("[uploadItem]",r instanceof Zt?r.canvasId:r.documentId,c.status,c.text):this.error("[uploadItem]",r instanceof Zt?r.canvasId:r.documentId,l,c.status,c.text),c}enqueueCanvasDownload(t){return this.enqueueDownload(t)}async enqueueCanvasForGroupSync(t,r){try{if(!r.syncStore.has(t.path)){this.debug("[enqueueCanvasForGroupSync] Skipping canvas, not in sync list",t.path);return}await this.enqueueDownload(t)}catch(n){this.error("[enqueueCanvasForGroupSync]",n)}}async getCanvas(t,r=3,n=3e3){try{let s=lt.exportCanvasData(t.ydoc),i={edges:[],nodes:[]};try{let d=await t.sharedFolder.read(t);i=JSON.parse(d)}catch(d){}let a=Xr(s.edges,i.edges)&&Xr(s.nodes,i.nodes),l=i.nodes.length>0,f=(await this.downloadItem(t)).arrayBuffer,u=new Uint8Array(f);if(this.log("[getCanvas] applying content from server"),xr(t.ydoc,u),l&&!a){this.log("Skipping flush - file requires merge conflict resolution.");return}t.sharedFolder.syncStore.has(t.path)&&(t.sharedFolder.flush(t,t.json),this.log("[getCanvas] flushed"))}catch(s){throw this.error(s),s}}async getDocument(t,r=3,n=3e3){try{let s=t.text,i="";try{i=await t.sharedFolder.read(t)}catch(y){}let a=s===i,l=i!=="",f=(await this.downloadItem(t)).arrayBuffer,u=new Uint8Array(f),d=new ir;xr(d,u);let m=d.getMap("users");if(d.getText("contents").toString()===""){if(m.size===0){this.log("[getDocument] Server contains uninitialized document. Waiting for peer to upload.",m.size,r,n),r>0&&this.timeProvider.setTimeout(()=>{this.getDocument(t,r-1,n*2)},n);return}if(t.text){this.log("[getDocument] local crdt has contents, but remote is empty"),this.enqueueSync(t);return}}if(this.log("[getDocument] applying content from server"),xr(t.ydoc,u),l&&!a){this.log("Skipping flush - file requires merge conflict resolution.");return}t.sharedFolder.syncStore.has(t.path)&&(t.sharedFolder.flush(t,t.text),this.log("[getDocument] flushed"))}catch(s){throw this.error(s),s}}async syncItem(t){let r="",n="",s=null;cr(t)?(s=lt.exportCanvasData(t.ydoc),n=JSON.stringify(s)):ar(t)&&(n=t.text);try{r=await t.sharedFolder.read(t)}catch(m){}let i=!1;if(cr(t)&&s){let m=r?JSON.parse(r):{nodes:[],edges:[]};i=Xr(s,m)}else i=n===r;if(!i)return this.log("file is not tracking local disk. resolve merge conflicts before syncing."),!1;let a=await this.downloadItem(t);if(a.status!==200)return this.log("server returned an error."),!1;let l=a.arrayBuffer,c=new Uint8Array(l),f=new ir;xr(f,c);let u=f.getMap("users"),d=!1;if(cr(t)&&s){let m=lt.exportCanvasData(f);d=u.size>0&&Xr(m,s)}else{let m=f.getText("contents").toString();d=u.size>0&&m===n}return d||(xr(t.ydoc,c),cr(t)?t.sharedFolder.flush(t,t.json):ar(t)&&t.sharedFolder.flush(t,t.text),this.uploadItem(t)),!0}async syncFile(t){t.sync()}async getSyncFile(t){t.pull()}async syncDocument(t){var r;try{Ve().enableHTTPSync&&((r=t.sharedFolder.remote)!=null&&r.relay.provider)?await this.syncItem(t):(this.debug("fallback to websocket sync"),ar(t)?await this.syncDocumentWebsocket(t):cr(t)&&await this.syncDocumentWebsocket(t))}catch(n){console.error(n);return}}subscribeToSync(t){return this.activeSync.subscribe(t)}subscribeToDownloads(t){return this.activeDownloads.subscribe(t)}subscribeToSyncGroups(t){return this.syncGroups.subscribe(t)}subscribeToProgress(t){let r=()=>{t(this.getOverallProgress())},n=this.activeSync.subscribe(()=>r()),s=this.activeDownloads.subscribe(()=>r()),i=this.syncGroups.subscribe(()=>r());return()=>{n(),s(),i()}}subscribeToGroupProgress(t,r){return this.syncGroups.subscribe(()=>{r(this.getGroupProgress(t))})}pause(){this.isPaused=!0}resume(){this.debug("starting"),this.isPaused=!1,this.processSyncQueue(),this.processDownloadQueue()}getQueueStatus(){return{syncsQueued:this.syncQueue.length,syncsActive:this.activeSync.size,downloadsQueued:this.downloadQueue.length,downloadsActive:this.activeDownloads.size,isPaused:this.isPaused}}destroy(){for(let[t,r]of this.syncCompletionCallbacks)r.reject(new Error("BackgroundSync destroyed")),this.syncCompletionCallbacks.delete(t);for(let[t,r]of this.downloadCompletionCallbacks)r.reject(new Error("BackgroundSync destroyed")),this.downloadCompletionCallbacks.delete(t);this.activeSync.destroy(),this.activeDownloads.destroy(),this.syncGroups.destroy(),this.syncQueue=[],this.downloadQueue=[],this.inProgressSyncs.clear(),this.inProgressDownloads.clear(),this.loggedItems.clear(),this.loginManager=null,this.timeProvider=null,this.subscriptions.forEach(t=>t())}};var Zb=require("obsidian");var Yb=require("obsidian");function gA(o){_e(o,"svelte-4kkvmr",".feature-flag-toggle-modal.svelte-4kkvmr{padding:1rem}.feature-flag-item.svelte-4kkvmr{display:flex;justify-content:space-between;align-items:center;padding:0.5rem 0;border-top:1px solid var(--background-modifier-border)}.checkbox-container.svelte-4kkvmr{cursor:pointer}")}function Gb(o,e,t){let r=o.slice();return r[8]=e[t][0],r[9]=e[t][1],r}function Jb(o){let e,t,r,n=o[8]+"",s,i,a,l,c=o[8]+"",f,u,d,m,p,y,g,v,C,L,T,E;function O(){return o[6](o[8])}function I(){return o[7](o[8])}return{c(){e=S("div"),t=S("div"),r=S("div"),s=B(n),i=M(),a=S("div"),l=B("Toggle "),f=B(c),u=B(" on or off"),d=M(),m=S("div"),p=S("div"),y=S("input"),v=M(),C=S("div"),h(r,"class","setting-item-name"),h(a,"class","setting-item-description"),h(t,"class","setting-item-info"),h(y,"type","checkbox"),h(y,"tabindex","-1"),y.checked=g=o[9],h(C,"class","checkbox-toggle"),h(p,"role","checkbox"),h(p,"aria-checked",L=o[9]),h(p,"tabindex","0"),h(p,"class","checkbox-container svelte-4kkvmr"),Me(p,"is-enabled",o[9]),h(m,"class","setting-item-control"),h(e,"class","feature-flag-item setting-item svelte-4kkvmr")},m(A,U){_(A,e,U),b(e,t),b(t,r),b(r,s),b(t,i),b(t,a),b(a,l),b(a,f),b(a,u),b(e,d),b(e,m),b(m,p),b(p,y),b(p,v),b(p,C),T||(E=[z(p,"keypress",O),z(p,"click",I)],T=!0)},p(A,U){o=A,U&2&&n!==(n=o[8]+"")&&Y(s,n),U&2&&c!==(c=o[8]+"")&&Y(f,c),U&2&&g!==(g=o[9])&&(y.checked=g),U&2&&L!==(L=o[9])&&h(p,"aria-checked",L),U&2&&Me(p,"is-enabled",o[9])},d(A){A&&w(e),T=!1,we(E)}}}function yA(o){let e,t,r,n,s,i,a,l,c,f=Se(Object.entries(o[1]).filter(o[5]).sort()),u=[];for(let d=0;d<f.length;d+=1)u[d]=Jb(Gb(o,f,d));return{c(){e=S("div"),t=S("h2"),t.textContent="Feature Flags",r=M();for(let d=0;d<u.length;d+=1)u[d].c();n=M(),s=S("div"),i=S("div"),a=S("button"),a.textContent="Apply",h(a,"aria-label","apply flag settings"),h(a,"tabindex","0"),h(i,"class","setting-item-control"),h(s,"class","setting-item"),h(e,"class","feature-flag-toggle-modal svelte-4kkvmr")},m(d,m){_(d,e,m),b(e,t),b(e,r);for(let p=0;p<u.length;p+=1)u[p]&&u[p].m(e,null);b(e,n),b(e,s),b(s,i),b(i,a),l||(c=[z(a,"click",function(){ze(o[0])&&o[0].apply(this,arguments)}),z(a,"keypress",function(){ze(o[0])&&o[0].apply(this,arguments)})],l=!0)},p(d,[m]){if(o=d,m&10){f=Se(Object.entries(o[1]).filter(o[5]).sort());let p;for(p=0;p<f.length;p+=1){let y=Gb(o,f,p);u[p]?u[p].p(y,m):(u[p]=Jb(y),u[p].c(),u[p].m(e,n))}for(;p<u.length;p+=1)u[p].d(1);u.length=f.length}},i:q,o:q,d(d){d&&w(e),Je(u,d),l=!1,we(c)}}}function xA(o,e,t){let r,n,{reload:s}=e,i=xt.getInstance();ce(o,i,u=>t(4,n=u));function a(u){let d=!r[u];t(1,r[u]=d,r),i.setFlag(u,r[u])}Rt(()=>{Object.keys(r).forEach(u=>{let d=document.getElementById(`toggle-${u}`);d&&(0,Yb.setIcon)(d,"check")})});let l=([u,d])=>$a(u),c=u=>{if(!$a(u))throw new Error("Unexpected feature flag!");a(u)},f=u=>{if(!$a(u))throw new Error("Unexpected feature flag!");a(u)};return o.$$set=u=>{"reload"in u&&t(0,s=u.reload)},o.$$.update=()=>{if(o.$$.dirty&16){e:t(1,r=Object.assign({},n.flags))}},[s,r,i,a,n,l,c,f]}var rm=class extends K{constructor(e){super(),G(this,e,xA,yA,j,{reload:0},gA)}},Qb=rm;var pc=class extends Zb.Modal{constructor(t,r){super(t);this.reload=r}onOpen(){let{contentEl:t}=this;this.component=new Qb({target:t,props:{reload:this.reload}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var lv=require("obsidian");var iv=require("obsidian");function Xb(o,e,t){let r=o.slice();return r[13]=e[t],r}function ev(o,e,t){let r=o.slice();return r[16]=e[t],r}function bA(o){let e,t,r;return{c(){e=S("button"),e.textContent="Refresh"},m(n,s){_(n,e,s),t||(r=z(e,"click",(0,iv.debounce)(o[12])),t=!0)},p:q,d(n){n&&w(e),t=!1,r()}}}function vA(o){let e=navigator.userAgent+"",t;return{c(){t=B(e)},m(r,n){_(r,t,n)},p:q,d(r){r&&w(t)}}}function wA(o){let e;return{c(){e=B(o[1])},m(t,r){_(t,e,r)},p(t,r){r&2&&Y(e,t[1])},d(t){t&&w(e)}}}function _A(o){let e;return{c(){e=B(o[2])},m(t,r){_(t,e,r)},p(t,r){r&4&&Y(e,t[2])},d(t){t&&w(e)}}}function SA(o){let e;return{c(){e=B(o[3])},m(t,r){_(t,e,r)},p(t,r){r&8&&Y(e,t[3])},d(t){t&&w(e)}}}function kA(o){let e=o[0].loadTime?`${o[0].loadTime}ms`:"unknown",t;return{c(){t=B(e)},m(r,n){_(r,t,n)},p(r,n){n&1&&e!==(e=r[0].loadTime?`${r[0].loadTime}ms`:"unknown")&&Y(t,e)},d(r){r&&w(t)}}}function tv(o){let e,t=`${o[16]}`,r,n;return{c(){e=S("div"),r=B(t),n=M()},m(s,i){_(s,e,i),b(e,r),b(e,n)},p(s,i){i&16&&t!==(t=`${s[16]}`)&&Y(r,t)},d(s){s&&w(e)}}}function IA(o){let e,t=Se(Object.keys(o[4].cancelControllers)),r=[];for(let n=0;n<t.length;n+=1)r[n]=tv(ev(o,t,n));return{c(){e=S("div");for(let n=0;n<r.length;n+=1)r[n].c();h(e,"slot","description")},m(n,s){_(n,e,s);for(let i=0;i<r.length;i+=1)r[i]&&r[i].m(e,null)},p(n,s){if(s&16){t=Se(Object.keys(n[4].cancelControllers));let i;for(i=0;i<t.length;i+=1){let a=ev(n,t,i);r[i]?r[i].p(a,s):(r[i]=tv(a),r[i].c(),r[i].m(e,null))}for(;i<r.length;i+=1)r[i].d(1);r.length=t.length}},d(n){n&&w(e),Je(r,n)}}}function rv(o){let e,t=`${o[13]}`,r,n;return{c(){e=S("div"),r=B(t),n=M()},m(s,i){_(s,e,i),b(e,r),b(e,n)},p(s,i){i&32&&t!==(t=`${s[13]}`)&&Y(r,t)},d(s){s&&w(e)}}}function CA(o){let e,t=Se(o[5]),r=[];for(let n=0;n<t.length;n+=1)r[n]=rv(Xb(o,t,n));return{c(){e=S("div");for(let n=0;n<r.length;n+=1)r[n].c();h(e,"slot","description")},m(n,s){_(n,e,s);for(let i=0;i<r.length;i+=1)r[i]&&r[i].m(e,null)},p(n,s){if(s&32){t=Se(n[5]);let i;for(i=0;i<t.length;i+=1){let a=Xb(n,t,i);r[i]?r[i].p(a,s):(r[i]=rv(a),r[i].c(),r[i].m(e,null))}for(;i<r.length;i+=1)r[i].d(1);r.length=t.length}},d(n){n&&w(e),Je(r,n)}}}function LA(o){let e,t,r,n,s,i,a,l,c,f,u,d,m,p,y,g,v,C,L,T,E,O,I;return n=new qe({props:{name:"Environment",$$slots:{default:[bA]},$$scope:{ctx:o}}}),i=new Pe({props:{name:"User Agent",description:"",$$slots:{default:[vA]},$$scope:{ctx:o}}}),l=new Pe({props:{name:"Fetch",description:"",$$slots:{default:[wA]},$$scope:{ctx:o}}}),f=new Pe({props:{name:"Response",description:"",$$slots:{default:[_A]},$$scope:{ctx:o}}}),d=new Pe({props:{name:"Blink Fetch",description:"",$$slots:{default:[SA]},$$scope:{ctx:o}}}),p=new Pe({props:{name:"Startup Time",description:"",$$slots:{default:[kA]},$$scope:{ctx:o}}}),g=new qe({props:{name:"Connections"}}),C=new Pe({props:{name:"",description:"",$$slots:{description:[IA]},$$scope:{ctx:o}}}),T=new qe({props:{name:"Log Files"}}),O=new Pe({props:{name:"",description:"",$$slots:{description:[CA]},$$scope:{ctx:o}}}),{c(){e=S("div"),e.textContent="Debug Info",t=M(),r=S("div"),R(n.$$.fragment),s=M(),R(i.$$.fragment),a=M(),R(l.$$.fragment),c=M(),R(f.$$.fragment),u=M(),R(d.$$.fragment),m=M(),R(p.$$.fragment),y=M(),R(g.$$.fragment),v=M(),R(C.$$.fragment),L=M(),R(T.$$.fragment),E=M(),R(O.$$.fragment),h(e,"class","modal-title"),h(r,"class","modal-content")},m(A,U){_(A,e,U),_(A,t,U),_(A,r,U),D(n,r,null),b(r,s),D(i,r,null),b(r,a),D(l,r,null),b(r,c),D(f,r,null),b(r,u),D(d,r,null),b(r,m),D(p,r,null),b(r,y),D(g,r,null),b(r,v),D(C,r,null),b(r,L),D(T,r,null),b(r,E),D(O,r,null),I=!0},p(A,[U]){let W={};U&524288&&(W.$$scope={dirty:U,ctx:A}),n.$set(W);let J={};U&524288&&(J.$$scope={dirty:U,ctx:A}),i.$set(J);let H={};U&524290&&(H.$$scope={dirty:U,ctx:A}),l.$set(H);let P={};U&524292&&(P.$$scope={dirty:U,ctx:A}),f.$set(P);let V={};U&524296&&(V.$$scope={dirty:U,ctx:A}),d.$set(V);let fe={};U&524289&&(fe.$$scope={dirty:U,ctx:A}),p.$set(fe);let de={};U&524304&&(de.$$scope={dirty:U,ctx:A}),C.$set(de);let le={};U&524320&&(le.$$scope={dirty:U,ctx:A}),O.$set(le)},i(A){I||(x(n.$$.fragment,A),x(i.$$.fragment,A),x(l.$$.fragment,A),x(f.$$.fragment,A),x(d.$$.fragment,A),x(p.$$.fragment,A),x(g.$$.fragment,A),x(C.$$.fragment,A),x(T.$$.fragment,A),x(O.$$.fragment,A),I=!0)},o(A){k(n.$$.fragment,A),k(i.$$.fragment,A),k(l.$$.fragment,A),k(f.$$.fragment,A),k(d.$$.fragment,A),k(p.$$.fragment,A),k(g.$$.fragment,A),k(C.$$.fragment,A),k(T.$$.fragment,A),k(O.$$.fragment,A),I=!1},d(A){A&&(w(e),w(t),w(r)),F(n),F(i),F(l),F(f),F(d),F(p),F(g),F(C),F(T),F(O)}}}function ov(){try{return Response.toString()}catch(o){return"undefined"}}function nv(){try{return fetch.toString()}catch(o){return"undefined"}}function sv(){try{return(globalThis==null?void 0:globalThis.blinkfetch)!==void 0?"Yes":"No"}catch(o){return"No"}}function TA(o,e,t){let r,n,s,i,a,{plugin:l}=e,c=xe(ov());ce(o,c,g=>t(2,n=g));let f=xe(nv());ce(o,f,g=>t(1,r=g));let u=xe(sv());ce(o,u,g=>t(3,s=g));let d=xe(l.loginManager.pb);ce(o,d,g=>t(4,i=g));let m=xe([]);ce(o,m,g=>t(5,a=g)),Oa().then(g=>{m.set(g)});function p(){c.set(ov()),f.set(nv()),u.set(sv()),d.set(l.loginManager.pb)}let y=()=>{p()};return o.$$set=g=>{"plugin"in g&&t(0,l=g.plugin)},[l,r,n,s,i,a,c,f,u,d,m,p,y]}var om=class extends K{constructor(e){super(),G(this,e,TA,LA,j,{plugin:0})}},av=om;var mc=class extends lv.Modal{constructor(t,r){super(t);this.plugin=r}onOpen(){let{contentEl:t}=this;this.component=new av({target:t,props:{plugin:this.plugin}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var cv=require("obsidian"),hc=class{notify(e){new cv.Notice(e)}},gc=class{constructor(e){this.vault=e}async append(e,t){return this.vault.adapter.append(e,t)}async stat(e){return this.vault.adapter.stat(e)}async exists(e){return this.vault.adapter.exists(e)}async remove(e){return this.vault.adapter.remove(e)}async rename(e,t){return this.vault.adapter.rename(e,t)}async write(e,t){return this.vault.adapter.write(e,t)}async read(e){return this.vault.adapter.read(e)}};var xv=require("obsidian");var gv=require("obsidian");function AA(o){_e(o,"svelte-jmqfac",".system3-bug-report.svelte-jmqfac{display:flex;flex-direction:column;height:100%;min-height:30em}.report-container.svelte-jmqfac{display:flex;flex-direction:column;flex:1}.form-content.svelte-jmqfac{flex:1;overflow-y:auto}textarea.svelte-jmqfac{width:100%;height:300px;resize:vertical}.centered-message.svelte-jmqfac{display:flex;flex:1;align-items:center;justify-content:center;padding-bottom:5em}")}function fv(o,e,t){let r=o.slice();return r[21]=e[t],r}function MA(o){let e,t,r,n,s,i,a,l,c,f,u,d,m;r=new Pe({props:{name:"Description",description:"Please describe what went wrong and what you were trying to do."}}),a=new Pe({props:{name:"Include Logs",description:"Send logs to the Relay developers to help them debug the issue.",$$slots:{default:[DA]},$$scope:{ctx:o}}});let p=o[4]&&uv(o);return f=new Pe({props:{name:"",description:"",$$slots:{default:[RA]},$$scope:{ctx:o}}}),{c(){e=S("div"),t=S("div"),R(r.$$.fragment),n=M(),s=S("textarea"),i=M(),R(a.$$.fragment),l=M(),p&&p.c(),c=M(),R(f.$$.fragment),h(s,"placeholder","Describe the issue here..."),h(s,"class","svelte-jmqfac"),h(t,"class","form-content svelte-jmqfac"),h(e,"class","report-container svelte-jmqfac")},m(y,g){_(y,e,g),b(e,t),D(r,t,null),b(t,n),b(t,s),Ft(s,o[3]),b(t,i),D(a,t,null),b(t,l),p&&p.m(t,null),b(e,c),D(f,e,null),u=!0,d||(m=z(s,"input",o[13]),d=!0)},p(y,g){g&8&&Ft(s,y[3]);let v={};g&16777232&&(v.$$scope={dirty:g,ctx:y}),a.$set(v),y[4]?p?(p.p(y,g),g&16&&x(p,1)):(p=uv(y),p.c(),x(p,1),p.m(t,null)):p&&(ie(),k(p,1,1,()=>{p=null}),ae());let C={};g&16777293&&(C.$$scope={dirty:g,ctx:y}),f.$set(C)},i(y){u||(x(r.$$.fragment,y),x(a.$$.fragment,y),x(p),x(f.$$.fragment,y),u=!0)},o(y){k(r.$$.fragment,y),k(a.$$.fragment,y),k(p),k(f.$$.fragment,y),u=!1},d(y){y&&w(e),F(r),F(a),p&&p.d(),F(f),d=!1,m()}}}function EA(o){let e;return{c(){e=S("div"),e.innerHTML='<div id="spinner" class="d-flex align-items-center"><strong>Sending Bug Report...</strong> <div class="spinner-border ms-auto" role="status" aria-hidden="true"></div></div>',h(e,"class","centered-message svelte-jmqfac")},m(t,r){_(t,e,r)},p:q,i:q,o:q,d(t){t&&w(e)}}}function PA(o){let e,t,r;return t=new Pe({props:{name:"Thank you!",description:"Your bug report will help us improve Relay."}}),{c(){e=S("div"),R(t.$$.fragment),h(e,"class","centered-message svelte-jmqfac")},m(n,s){_(n,e,s),D(t,e,null),r=!0},p:q,i(n){r||(x(t.$$.fragment,n),r=!0)},o(n){k(t.$$.fragment,n),r=!1},d(n){n&&w(e),F(t)}}}function DA(o){let e,t,r,n,s,i;return{c(){e=S("div"),t=S("input"),r=M(),n=S("div"),h(t,"type","checkbox"),h(t,"tabindex","-1"),t.checked=o[4],h(n,"class","checkbox-toggle"),h(e,"role","checkbox"),h(e,"aria-checked",o[4]),h(e,"tabindex","0"),h(e,"class","checkbox-container"),Me(e,"is-enabled",o[4])},m(a,l){_(a,e,l),b(e,t),b(e,r),b(e,n),s||(i=[z(e,"keypress",OA),z(e,"click",o[14])],s=!0)},p(a,l){l&16&&(t.checked=a[4]),l&16&&h(e,"aria-checked",a[4]),l&16&&Me(e,"is-enabled",a[4])},d(a){a&&w(e),s=!1,we(i)}}}function uv(o){let e,t;return e=new Pe({props:{name:"Logs",description:"",$$slots:{description:[FA]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n&16777248&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(x(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function dv(o){let e,t=`${o[21]}
`,r,n;return{c(){e=S("div"),r=B(t),n=M()},m(s,i){_(s,e,i),b(e,r),b(e,n)},p(s,i){i&32&&t!==(t=`${s[21]}
`)&&Y(r,t)},d(s){s&&w(e)}}}function FA(o){let e,t=Se(o[5]),r=[];for(let n=0;n<t.length;n+=1)r[n]=dv(fv(o,t,n));return{c(){e=S("div");for(let n=0;n<r.length;n+=1)r[n].c();h(e,"slot","description")},m(n,s){_(n,e,s);for(let i=0;i<r.length;i+=1)r[i]&&r[i].m(e,null)},p(n,s){if(s&32){t=Se(n[5]);let i;for(i=0;i<t.length;i+=1){let a=fv(n,t,i);r[i]?r[i].p(a,s):(r[i]=dv(a),r[i].c(),r[i].m(e,null))}for(;i<r.length;i+=1)r[i].d(1);r.length=t.length}},d(n){n&&w(e),Je(r,n)}}}function RA(o){let e,t,r,n;return{c(){e=S("button"),t=B("Send"),e.disabled=o[2]},m(s,i){_(s,e,i),b(e,t),r||(n=z(e,"click",o[15]),r=!0)},p(s,i){i&4&&(e.disabled=s[2])},d(s){s&&w(e),r=!1,n()}}}function UA(o){let e,t,r,n,s,i,a=[PA,EA,MA],l=[];function c(f,u){return f[1]?0:f[2]&&!f[1]?1:2}return n=c(o,-1),s=l[n]=a[n](o),{c(){e=S("div"),e.textContent="Send Bug Report",t=M(),r=S("div"),s.c(),h(e,"class","modal-title"),h(r,"class","modal-content system3-bug-report svelte-jmqfac")},m(f,u){_(f,e,u),_(f,t,u),_(f,r,u),l[n].m(r,null),i=!0},p(f,[u]){let d=n;n=c(f,u),n===d?l[n].p(f,u):(ie(),k(l[d],1,1,()=>{l[d]=null}),ae(),s=l[n],s?s.p(f,u):(s=l[n]=a[n](f),s.c()),x(s,1),s.m(r,null))},i(f){i||(x(s),i=!0)},o(f){k(s),i=!1},d(f){f&&(w(e),w(t),w(r)),l[n].d()}}}function pv(){try{return Response.toString()}catch(o){return"undefined"}}function mv(){try{return fetch.toString()}catch(o){return"undefined"}}function hv(){try{return(globalThis==null?void 0:globalThis.blinkfetch)!==void 0?"Yes":"No"}catch(o){return"No"}}var OA=()=>{};function $A(o,e,t){let r,n,s,i,a,l,{plugin:c}=e,f=xe(pv()),u=xe(mv()),d=xe(hv()),m=xe("");ce(o,m,A=>t(3,s=A));let p=xe(!1);ce(o,p,A=>t(4,i=A));let y=xe(!1),g=xe(!1);ce(o,g,A=>t(2,n=A));let v=xe(!1);ce(o,v,A=>t(1,r=A));let C=xe(c.loginManager.pb);ce(o,C,A=>t(6,l=A));let L=xe([]);ce(o,L,A=>t(5,a=A)),Oa().then(A=>{L.set(A)});function T(){f.set(pv()),u.set(mv()),d.set(hv()),C.set(c.loginManager.pb)}function E(){s=this.value,m.set(s)}let O=()=>{let A=!i;p.set(A)},I=async()=>{var U;let A=`Bug Report

`;if(A+=JSON.stringify({userAgent:navigator.userAgent,manifest:c.manifest,user:(U=l==null?void 0:l.authStore.model)==null?void 0:U.id,loadTime:c.loadTime,description:s},null,2),A+=`

`,p){let W=await Ag();A+=W}(0,gv.requestUrl)({url:"https://bug-reports.system3.dev",method:"PUT",body:A,headers:{"Content-Type":"text/plain"}}).then(()=>{v.set(!0)}),g.set(!0)};return o.$$set=A=>{"plugin"in A&&t(0,c=A.plugin)},[c,r,n,s,i,a,l,m,p,g,v,C,L,E,O,I]}var nm=class extends K{constructor(e){super(),G(this,e,$A,UA,j,{plugin:0},AA)}},yv=nm;var yc=class extends xv.Modal{constructor(t,r){super(t);this.plugin=r}onOpen(){let{contentEl:t}=this;this.component=new yv({target:t,props:{plugin:this.plugin}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var Lv=require("obsidian");async function bv(o){let{appId:e,filterByAppId:t,onProgress:r}=o,n=await window.indexedDB.databases(),s=n.length,i=[],a=0,l=0,c=0,f=0;for(let u of n)if(u.name){try{let d=await new Promise((m,p)=>{let y=indexedDB.open(u.name);y.onerror=()=>p(y.error),y.onsuccess=g=>m(g.target.result)});try{let m=Array.from(d.objectStoreNames);if(!m.includes("updates")||!m.includes("custom"))continue;let p=d.transaction(["updates","custom"],"readonly"),y=p.objectStore("updates"),g=p.objectStore("custom"),v=await new Promise(L=>{let T=g.get("appId");T.onsuccess=()=>L(T.result||"")});a++;let C=await new Promise((L,T)=>{let E=y.count();E.onsuccess=()=>L(E.result),E.onerror=()=>T(E.error)});if(l+=C,C>0){let L=0;if(await new Promise((T,E)=>{let O=y.openCursor();O.onsuccess=I=>{let A=I.target.result;if(A){let U=A.value instanceof Uint8Array?A.value.byteLength:JSON.stringify(A.value).length;L+=U,A.continue()}else T()},O.onerror=()=>E(O.error)}),c+=L,L>1024*1024&&(!t||v===e)){let T=await new Promise(I=>{let A=g.get("path");A.onsuccess=()=>I(A.result||"")}),E=await new Promise(I=>{let A=g.get("relay");A.onsuccess=()=>I(A.result||"")}),O=!u.name.startsWith(`${e}-relay`);i.push({slug:`${u.name}/${y.name}`,path:T,relay:E,appId:v||"unknown",count:C,estimatedSizeMB:Math.round(L/(1024*1024)*100)/100,isLegacy:O})}}}finally{d.close()}}catch(d){console.error(`Error processing database ${u.name}:`,d);continue}f++,r&&r(f/n.length*100)}return{totalStores:a,totalItems:l,totalSizeMB:Math.round(c/(1024*1024)*100)/100,databaseCount:s,largeStores:i.sort((u,d)=>d.estimatedSizeMB-u.estimatedSizeMB)}}async function vv(o){let[e,t]=o.split("/"),r=await new Promise((n,s)=>{let i=indexedDB.open(e);i.onerror=()=>s(i.error),i.onsuccess=()=>n(i.result)});try{let s=r.transaction(t,"readwrite").objectStore(t);await new Promise((i,a)=>{let l=s.clear();l.onsuccess=()=>i(),l.onerror=()=>a(l.error)})}catch(n){console.error(`Error deleting store: ${o}`,n)}finally{r.close()}}var Kj=require("obsidian");function NA(o){_e(o,"svelte-1n3w4sk",".system3-dangerous.svelte-1n3w4sk:enabled{background-color:var(--background-modifier-error)}.system3-indexeddb-analysis.svelte-1n3w4sk{padding:1rem;max-height:500px;overflow-y:auto}.system3-loading-container.svelte-1n3w4sk{display:flex;flex-direction:column;align-items:center;justify-content:center;height:200px;gap:1rem}.system3-loading-spinner.svelte-1n3w4sk{border:4px solid var(--background-modifier-border);border-top:4px solid var(--interactive-accent);border-radius:50%;width:40px;height:40px;animation:svelte-1n3w4sk-spin 1s linear infinite}.system3-progress-bar.svelte-1n3w4sk{width:80%;height:8px;border-radius:4px;background-color:var(--background-secondary);overflow:hidden;margin:0 auto}.system3-progress-fill.svelte-1n3w4sk{height:100%;background-color:var(--color-accent);border-radius:4px;transition:width 0.3s ease;min-width:0%;max-width:100%}.system3-error-message.svelte-1n3w4sk{color:var(--text-error);padding:1rem;background-color:var(--mod-error);border-radius:4px}.system3-actions.svelte-1n3w4sk{display:flex;gap:0.5rem}.system3-summary-stats.svelte-1n3w4sk{display:grid;grid-template-columns:repeat(3, 1fr);gap:1rem;margin-bottom:2rem;padding:1rem;background-color:var(--background-secondary);border-radius:4px}.system3-stat-item.svelte-1n3w4sk{text-align:center}.system3-global-count.svelte-1n3w4sk{grid-column:1 / -1;padding-top:0.5rem;margin-top:0.5rem;border-bottom:1px solid var(--background-modifier-border)}.system3-warning.svelte-1n3w4sk{color:var(--text-warning)}.system3-critical.svelte-1n3w4sk{color:var(--text-error)}.system3-warning-text.svelte-1n3w4sk{font-size:0.8em;margin-top:0.5rem;color:var(--text-warning);line-height:1.4}.system3-warning-text.system3-critical.svelte-1n3w4sk{color:var(--text-error);font-weight:bold}.system3-stat-label.svelte-1n3w4sk{font-size:0.9em;color:var(--text-muted);margin-bottom:0.5rem}.system3-stat-value.svelte-1n3w4sk{font-size:1.2em;font-weight:bold}@keyframes svelte-1n3w4sk-spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}")}function wv(o,e,t){let r=o.slice();return r[18]=e[t][0],r[19]=e[t][1],r}function _v(o,e,t){let r=o.slice();return r[22]=e[t],r}function BA(o){let e,t,r,n,s,i=o[0].databaseCount.toLocaleString()+"",a,l,c,f,u,d,m,p,y=o[0].totalStores+"",g,v,C,L,T,E,O=o[0].totalItems.toLocaleString()+"",I,A,U,W,J,H,P=o[0].totalSizeMB.toFixed(2)+"",V,fe,de,le,ee;function re(Q,Ie){if(Q[0].databaseCount>45e3)return zA;if(Q[0].databaseCount>4e4)return qA}let $=re(o,-1),N=$&&$(o),pe=o[0].largeStores.length>0&&Sv(o);return{c(){e=S("div"),t=S("div"),r=S("div"),r.textContent="Global Database Limit",n=M(),s=S("div"),a=B(i),l=B(" / 50,000"),c=M(),N&&N.c(),f=M(),u=S("div"),d=S("div"),d.textContent="Relay Databases",m=M(),p=S("div"),g=B(y),v=M(),C=S("div"),L=S("div"),L.textContent="Document Updates",T=M(),E=S("div"),I=B(O),A=M(),U=S("div"),W=S("div"),W.textContent="Total Size",J=M(),H=S("div"),V=B(P),fe=B(" MB"),de=M(),pe&&pe.c(),le=ve(),h(r,"class","system3-stat-label svelte-1n3w4sk"),h(s,"class","system3-stat-value svelte-1n3w4sk"),Me(s,"system3-warning",o[0].databaseCount>4e4),Me(s,"system3-critical",o[0].databaseCount>45e3),h(t,"class","system3-stat-item system3-global-count svelte-1n3w4sk"),h(d,"class","system3-stat-label svelte-1n3w4sk"),h(p,"class","system3-stat-value svelte-1n3w4sk"),h(u,"class","system3-stat-item svelte-1n3w4sk"),h(L,"class","system3-stat-label svelte-1n3w4sk"),h(E,"class","system3-stat-value svelte-1n3w4sk"),h(C,"class","system3-stat-item svelte-1n3w4sk"),h(W,"class","system3-stat-label svelte-1n3w4sk"),h(H,"class","system3-stat-value svelte-1n3w4sk"),h(U,"class","system3-stat-item svelte-1n3w4sk"),h(e,"class","system3-summary-stats svelte-1n3w4sk")},m(Q,Ie){_(Q,e,Ie),b(e,t),b(t,r),b(t,n),b(t,s),b(s,a),b(s,l),b(t,c),N&&N.m(t,null),b(e,f),b(e,u),b(u,d),b(u,m),b(u,p),b(p,g),b(e,v),b(e,C),b(C,L),b(C,T),b(C,E),b(E,I),b(e,A),b(e,U),b(U,W),b(U,J),b(U,H),b(H,V),b(H,fe),_(Q,de,Ie),pe&&pe.m(Q,Ie),_(Q,le,Ie),ee=!0},p(Q,Ie){(!ee||Ie&1)&&i!==(i=Q[0].databaseCount.toLocaleString()+"")&&Y(a,i),(!ee||Ie&1)&&Me(s,"system3-warning",Q[0].databaseCount>4e4),(!ee||Ie&1)&&Me(s,"system3-critical",Q[0].databaseCount>45e3),$!==($=re(Q,Ie))&&(N&&N.d(1),N=$&&$(Q),N&&(N.c(),N.m(t,null))),(!ee||Ie&1)&&y!==(y=Q[0].totalStores+"")&&Y(g,y),(!ee||Ie&1)&&O!==(O=Q[0].totalItems.toLocaleString()+"")&&Y(I,O),(!ee||Ie&1)&&P!==(P=Q[0].totalSizeMB.toFixed(2)+"")&&Y(V,P),Q[0].largeStores.length>0?pe?(pe.p(Q,Ie),Ie&1&&x(pe,1)):(pe=Sv(Q),pe.c(),x(pe,1),pe.m(le.parentNode,le)):pe&&(ie(),k(pe,1,1,()=>{pe=null}),ae())},i(Q){ee||(x(pe),ee=!0)},o(Q){k(pe),ee=!1},d(Q){Q&&(w(e),w(de),w(le)),N&&N.d(),pe&&pe.d(Q)}}}function VA(o){let e,t;return{c(){e=S("div"),t=B(o[5]),h(e,"class","system3-error-message svelte-1n3w4sk")},m(r,n){_(r,e,n),b(e,t)},p(r,n){n&32&&Y(t,r[5])},i:q,o:q,d(r){r&&w(e)}}}function HA(o){let e,t,r,n,s,i,a;return{c(){e=S("div"),t=S("div"),r=M(),n=S("div"),n.textContent="Analyzing Databases...",s=M(),i=S("div"),a=S("div"),h(t,"class","system3-loading-spinner svelte-1n3w4sk"),h(n,"class","loading-text"),h(a,"class","system3-progress-fill svelte-1n3w4sk"),ue(a,"width",o[4]+"%"),h(i,"class","system3-progress-bar svelte-1n3w4sk"),h(e,"class","system3-loading-container svelte-1n3w4sk")},m(l,c){_(l,e,c),b(e,t),b(e,r),b(e,n),b(e,s),b(e,i),b(i,a)},p(l,c){c&16&&ue(a,"width",l[4]+"%")},i:q,o:q,d(l){l&&w(e)}}}function qA(o){let e;return{c(){e=S("div"),e.innerHTML=`Warning: high number of databases.<br/>
						Consider cleaning up unused databases.`,h(e,"class","system3-warning-text svelte-1n3w4sk")},m(t,r){_(t,e,r)},d(t){t&&w(e)}}}function zA(o){let e;return{c(){e=S("div"),e.innerHTML=`Critical: approaching IndexedDB database limit!<br/>
						Your browser may start deleting old databases soon.`,h(e,"class","system3-warning-text system3-critical svelte-1n3w4sk")},m(t,r){_(t,e,r)},d(t){t&&w(e)}}}function Sv(o){let e,t,r,n;e=new qe({props:{name:"Large Stores (>1MB)"}});let s=Se(o[2]),i=[];for(let l=0;l<s.length;l+=1)i[l]=Iv(wv(o,s,l));let a=l=>k(i[l],1,1,()=>{i[l]=null});return{c(){R(e.$$.fragment),t=M();for(let l=0;l<i.length;l+=1)i[l].c();r=ve()},m(l,c){D(e,l,c),_(l,t,c);for(let f=0;f<i.length;f+=1)i[f]&&i[f].m(l,c);_(l,r,c),n=!0},p(l,c){if(c&2052){s=Se(l[2]);let f;for(f=0;f<s.length;f+=1){let u=wv(l,s,f);i[f]?(i[f].p(u,c),x(i[f],1)):(i[f]=Iv(u),i[f].c(),x(i[f],1),i[f].m(r.parentNode,r))}for(ie(),f=s.length;f<i.length;f+=1)a(f);ae()}},i(l){if(!n){x(e.$$.fragment,l);for(let c=0;c<s.length;c+=1)x(i[c]);n=!0}},o(l){k(e.$$.fragment,l),i=i.filter(Boolean);for(let c=0;c<i.length;c+=1)k(i[c]);n=!1},d(l){l&&(w(t),w(r)),F(e,l),Je(i,l)}}}function WA(o){let e,t,r,n,s;function i(){return o[17](o[22])}return{c(){e=S("div"),t=S("button"),t.textContent="Delete",r=M(),h(t,"class","mod-warning"),h(t,"title","Delete all data in this store"),h(e,"class","system3-actions svelte-1n3w4sk")},m(a,l){_(a,e,l),b(e,t),_(a,r,l),n||(s=z(t,"click",i),n=!0)},p(a,l){o=a},d(a){a&&(w(e),w(r)),n=!1,s()}}}function kv(o){let e,t;return e=new Pe({props:{name:o[22].path||o[22].slug,description:"Size: "+o[22].estimatedSizeMB+"MB, Items: "+o[22].count,$$slots:{default:[WA]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n&4&&(s.name=r[22].path||r[22].slug),n&4&&(s.description="Size: "+r[22].estimatedSizeMB+"MB, Items: "+r[22].count),n&33554436&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(x(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function Iv(o){let e,t,r,n;e=new qe({props:{name:o[18]==="local"?"Tracked Documents":`Relay: ${o[18]}`}});let s=Se(o[19]),i=[];for(let l=0;l<s.length;l+=1)i[l]=kv(_v(o,s,l));let a=l=>k(i[l],1,1,()=>{i[l]=null});return{c(){R(e.$$.fragment),t=M();for(let l=0;l<i.length;l+=1)i[l].c();r=ve()},m(l,c){D(e,l,c),_(l,t,c);for(let f=0;f<i.length;f+=1)i[f]&&i[f].m(l,c);_(l,r,c),n=!0},p(l,c){let f={};if(c&4&&(f.name=l[18]==="local"?"Tracked Documents":`Relay: ${l[18]}`),e.$set(f),c&2052){s=Se(l[19]);let u;for(u=0;u<s.length;u+=1){let d=_v(l,s,u);i[u]?(i[u].p(d,c),x(i[u],1)):(i[u]=kv(d),i[u].c(),x(i[u],1),i[u].m(r.parentNode,r))}for(ie(),u=s.length;u<i.length;u+=1)a(u);ae()}},i(l){if(!n){x(e.$$.fragment,l);for(let c=0;c<s.length;c+=1)x(i[c]);n=!0}},o(l){k(e.$$.fragment,l),i=i.filter(Boolean);for(let c=0;c<i.length;c+=1)k(i[c]);n=!1},d(l){l&&(w(t),w(r)),F(e,l),Je(i,l)}}}function jA(o){let e,t,r,n,s,i,a,l,c,f,u,d,m,p,y,g,v,C=[HA,VA,BA],L=[];function T(E,O){return E[3]?0:E[5]?1:E[0]?2:-1}return~(m=T(o,-1))&&(p=L[m]=C[m](o)),{c(){e=S("div"),e.textContent="Relay database analysis",t=M(),r=S("div"),n=S("div"),s=S("div"),s.innerHTML=`<div class="setting-item-name">Search across vaults</div> <div class="setting-item-description"><div class="mod-warning">Warning: This is a dangerous setting. It allows you to delete relay
					databases from other vaults.</div></div>`,i=M(),a=S("div"),l=S("div"),c=S("input"),f=M(),u=S("div"),d=M(),p&&p.c(),h(e,"class","modal-title"),h(s,"class","setting-item-info"),h(c,"type","checkbox"),h(c,"tabindex","-1"),c.checked=o[1],h(u,"class","checkbox-toggle"),h(l,"role","checkbox"),h(l,"aria-checked",o[1]),h(l,"tabindex","0"),h(l,"class","checkbox-container system3-dangerous svelte-1n3w4sk"),Me(l,"is-enabled",o[1]),h(a,"class","setting-item-control"),h(n,"class","setting-item"),h(r,"class","system3-indexeddb-analysis svelte-1n3w4sk")},m(E,O){_(E,e,O),_(E,t,O),_(E,r,O),b(r,n),b(n,s),b(n,i),b(n,a),b(a,l),b(l,c),b(l,f),b(l,u),b(r,d),~m&&L[m].m(r,null),y=!0,g||(v=[z(l,"keypress",o[15]),z(l,"click",o[16])],g=!0)},p(E,[O]){(!y||O&2)&&(c.checked=E[1]),(!y||O&2)&&h(l,"aria-checked",E[1]),(!y||O&2)&&Me(l,"is-enabled",E[1]);let I=m;m=T(E,O),m===I?~m&&L[m].p(E,O):(p&&(ie(),k(L[I],1,1,()=>{L[I]=null}),ae()),~m?(p=L[m],p?p.p(E,O):(p=L[m]=C[m](E),p.c()),x(p,1),p.m(r,null)):p=null)},i(E){y||(x(p),y=!0)},o(E){k(p),y=!1},d(E){E&&(w(e),w(t),w(r)),~m&&L[m].d(),g=!1,we(v)}}}function KA(o,e,t){let r,n,s,i,a,l;var c;let{plugin:f}=e,u=xe(!0);ce(o,u,E=>t(3,i=E));let d=xe(0);ce(o,d,E=>t(4,a=E));let m=xe(null);ce(o,m,E=>t(0,s=E));let p=xe(null);ce(o,p,E=>t(5,l=E));let y=!1;function g(){return Ee(this,void 0,void 0,function*(){u.set(!0),p.set(null);try{let E=yield bv({appId:f.appId,filterByAppId:!y,onProgress:O=>d.set(O)});m.set(E)}catch(E){p.set(`Analysis failed: ${E.message}`)}finally{u.set(!1)}})}function v(E){return Ee(this,void 0,void 0,function*(){try{yield vv(E),s&&tl(m,s.largeStores=s.largeStores.filter(O=>O.slug!==E),s)}catch(O){p.set(`Failed to delete ${E}: ${O.message}`)}})}Rt(()=>{g()});let C=()=>{t(1,y=!y),g()},L=()=>{t(1,y=!y),g()},T=E=>v(E.slug);return o.$$set=E=>{"plugin"in E&&t(12,f=E.plugin)},o.$$.update=()=>{if(o.$$.dirty&8193){e:t(14,r=t(13,c=s==null?void 0:s.largeStores.reduce((E,O)=>{let I=O.relay||"local";return E[I]||(E[I]=[]),E[I].push(O),E},{}))!==null&&c!==void 0?c:{})}if(o.$$.dirty&16384){e:t(2,n=Object.entries(r).sort(([E],[O])=>E==="local"?-1:O==="local"?1:E.localeCompare(O)))}},[s,y,n,i,a,l,u,d,m,p,g,v,f,c,r,C,L,T]}var sm=class extends K{constructor(e){super(),G(this,e,KA,jA,j,{plugin:12},NA)}},Cv=sm;var xc=class extends Lv.Modal{constructor(t,r){super(t);this.plugin=r}onOpen(){let{contentEl:t}=this;this.component=new Cv({target:t,props:{plugin:this.plugin}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var tw=require("obsidian");var{Boolean:Nv}=An;function GA(o){_e(o,"svelte-18bqwhy",".file-name.svelte-18bqwhy{display:flex;align-items:center;gap:6px;font-size:0.9rem;flex:1;min-width:0}.details-container.svelte-18bqwhy{margin-left:auto;text-align:right;padding-left:8px;padding-right:8px}.details.svelte-18bqwhy{font-size:0.75rem;color:var(--text-muted)}.error-message.svelte-18bqwhy{color:var(--text-error);margin-top:2px;text-align:right}.more-files.svelte-18bqwhy{font-size:0.8rem;color:var(--text-muted);text-align:center}button.mod-warning.svelte-18bqwhy{display:flex;align-items:center;gap:4px;background-color:var(--background-modifier-error);color:var(--text-error)}.mod-primary{color:var(--interactive-accent)}.mod-success{color:var(--interactive-success)}.mod-warning{color:var(--text-warning)}.show-more-link.svelte-18bqwhy{color:var(--text-accent);cursor:pointer;font-size:0.8rem}.show-more-link.svelte-18bqwhy:hover{text-decoration:underline}")}function Tv(o,e,t){let r=o.slice();return r[20]=e[t],r}function Av(o,e,t){let r=o.slice();return r[23]=e[t],r}function JA(o){return{c:q,m:q,p:q,i:q,o:q,d:q}}function YA(o){let e,t,r=Se($v(o[19].documents)),n=[];for(let i=0;i<r.length;i+=1)n[i]=Rv(Tv(o,r,i));let s=i=>k(n[i],1,1,()=>{n[i]=null});return{c(){for(let i=0;i<n.length;i+=1)n[i].c();e=ve()},m(i,a){for(let l=0;l<n.length;l+=1)n[l]&&n[l].m(i,a);_(i,e,a),t=!0},p(i,a){if(a&8311){r=Se($v(i[19].documents));let l;for(l=0;l<r.length;l+=1){let c=Tv(i,r,l);n[l]?(n[l].p(c,a),x(n[l],1)):(n[l]=Rv(c),n[l].c(),x(n[l],1),n[l].m(e.parentNode,e))}for(ie(),l=r.length;l<n.length;l+=1)s(l);ae()}},i(i){if(!t){for(let a=0;a<r.length;a+=1)x(n[a]);t=!0}},o(i){n=n.filter(Nv);for(let a=0;a<n.length;a+=1)k(n[a]);t=!1},d(i){i&&w(e),Je(n,i)}}}function Mv(o){let e,t=Ov(o[23].queueState.timestamp)+"",r;return{c(){e=B("\u2022 "),r=B(t)},m(n,s){_(n,e,s),_(n,r,s)},p(n,s){s&3&&t!==(t=Ov(n[23].queueState.timestamp)+"")&&Y(r,t)},d(n){n&&(w(e),w(r))}}}function Ev(o){let e,t=o[23].queueState.error+"",r;return{c(){e=S("div"),r=B(t),h(e,"class","error-message svelte-18bqwhy")},m(n,s){_(n,e,s),b(e,r)},p(n,s){s&3&&t!==(t=n[23].queueState.error+"")&&Y(r,t)},d(n){n&&w(e)}}}function Pv(o){let e,t,r,n,s,i;t=new ed({props:{size:14,class:"svg-icon lucide-refresh-cw"}});function a(){return o[10](o[23])}return{c(){e=S("button"),R(t.$$.fragment),r=B(`
							Retry`),h(e,"class","mod-warning svelte-18bqwhy")},m(l,c){_(l,e,c),D(t,e,null),b(e,r),n=!0,s||(i=z(e,"click",a),s=!0)},p(l,c){o=l},i(l){n||(x(t.$$.fragment,l),n=!0)},o(l){k(t.$$.fragment,l),n=!1},d(l){l&&w(e),F(t),s=!1,i()}}}function QA(o){var m,p,y;let e,t,r=o[5](o[23]).text+"",n,s,i,a,l,c,f=((m=o[23].queueState)==null?void 0:m.timestamp)&&Mv(o),u=((p=o[23].queueState)==null?void 0:p.error)&&Ev(o),d=((y=o[23].queueState)==null?void 0:y.status)==="failed"&&Pv(o);return{c(){e=S("div"),t=S("span"),n=B(r),s=M(),f&&f.c(),i=M(),u&&u.c(),a=M(),d&&d.c(),l=ve(),h(t,"class","details svelte-18bqwhy"),h(e,"class","details-container svelte-18bqwhy")},m(g,v){_(g,e,v),b(e,t),b(t,n),b(t,s),f&&f.m(t,null),b(t,i),u&&u.m(t,null),_(g,a,v),d&&d.m(g,v),_(g,l,v),c=!0},p(g,v){var C,L,T;(!c||v&3)&&r!==(r=g[5](g[23]).text+"")&&Y(n,r),(C=g[23].queueState)!=null&&C.timestamp?f?f.p(g,v):(f=Mv(g),f.c(),f.m(t,i)):f&&(f.d(1),f=null),(L=g[23].queueState)!=null&&L.error?u?u.p(g,v):(u=Ev(g),u.c(),u.m(t,null)):u&&(u.d(1),u=null),((T=g[23].queueState)==null?void 0:T.status)==="failed"?d?(d.p(g,v),v&3&&x(d,1)):(d=Pv(g),d.c(),x(d,1),d.m(l.parentNode,l)):d&&(ie(),k(d,1,1,()=>{d=null}),ae())},i(g){c||(x(d),c=!0)},o(g){k(d),c=!1},d(g){g&&(w(e),w(a),w(l)),f&&f.d(),u&&u.d(),d&&d.d(g)}}}function ZA(o){let e,t=o[9].default,r=me(t,o,o[13],null),n=r||QA(o);return{c(){n&&n.c()},m(s,i){n&&n.m(s,i),e=!0},p(s,i){r?r.p&&(!e||i&8192)&&ge(r,t,s,s[13],e?he(t,s[13],i,null):ye(s[13]),null):n&&n.p&&(!e||i&3)&&n.p(s,e?i:-1)},i(s){e||(x(n,s),e=!0)},o(s){k(n,s),e=!1},d(s){n&&n.d(s)}}}function XA(o){let e,t,r,n,s=o[23].path.split("/").pop()+"",i,a;var l=o[5](o[23]).icon;function c(f,u){return{props:{size:16,class:"svg-icon "+f[5](f[23]).iconClass}}}return l&&(t=Ts(l,c(o))),{c(){e=S("span"),t&&R(t.$$.fragment),r=M(),n=S("span"),i=B(s),h(e,"slot","name"),h(e,"class","file-name svelte-18bqwhy")},m(f,u){_(f,e,u),t&&D(t,e,null),b(e,r),b(e,n),b(n,i),a=!0},p(f,u){if(u&3&&l!==(l=f[5](f[23]).icon)){if(t){ie();let d=t;k(d.$$.fragment,1,0,()=>{F(d,1)}),ae()}l?(t=Ts(l,c(f,u)),R(t.$$.fragment),x(t.$$.fragment,1),D(t,e,r)):t=null}else if(l){let d={};u&3&&(d.class="svg-icon "+f[5](f[23]).iconClass),t.$set(d)}(!a||u&3)&&s!==(s=f[23].path.split("/").pop()+"")&&Y(i,s)},i(f){a||(t&&x(t.$$.fragment,f),a=!0)},o(f){t&&k(t.$$.fragment,f),a=!1},d(f){f&&w(e),t&&F(t)}}}function Dv(o){let e,t;return e=new ht({props:{$$slots:{name:[XA],default:[ZA]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n&8195&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(x(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function Fv(o){let e,t;return e=new ht({props:{$$slots:{name:[eM]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n&8195&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(x(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function eM(o){let e,t,r=Uv(o[1](o[20]).remainingCount)+"",n,s,i=o[20].title.toLowerCase()+"",a,l,c,f,u,d,m,p;function y(){return o[11](o[20])}function g(...v){return o[12](o[20],...v)}return{c(){var v;e=S("span"),t=B("...and "),n=B(r),s=B(` more
					`),a=B(i),l=M(),c=S("span"),f=B("(show more)"),d=M(),h(c,"class","show-more-link svelte-18bqwhy"),h(c,"role","button"),h(c,"tabindex","0"),h(c,"aria-label",u=`Show ${((v=o[2][o[20].title])==null?void 0:v.incrementCount)||o[2].default.incrementCount} more ${o[20].title.toLowerCase()}`),h(e,"slot","name"),h(e,"class","more-files svelte-18bqwhy")},m(v,C){_(v,e,C),b(e,t),b(e,n),b(e,s),b(e,a),b(e,l),b(e,c),b(c,f),b(e,d),m||(p=[z(c,"click",y),z(c,"keydown",g)],m=!0)},p(v,C){var L;o=v,C&3&&r!==(r=Uv(o[1](o[20]).remainingCount)+"")&&Y(n,r),C&1&&i!==(i=o[20].title.toLowerCase()+"")&&Y(a,i),C&1&&u!==(u=`Show ${((L=o[2][o[20].title])==null?void 0:L.incrementCount)||o[2].default.incrementCount} more ${o[20].title.toLowerCase()}`)&&h(c,"aria-label",u)},d(v){v&&w(e),m=!1,we(p)}}}function Rv(o){let e,t,r,n=o[1](o[20]).remainingCount>0,s,i;e=new qe({props:{name:o[20].title}});let a=Se(o[1](o[20]).visibleDocs),l=[];for(let u=0;u<a.length;u+=1)l[u]=Dv(Av(o,a,u));let c=u=>k(l[u],1,1,()=>{l[u]=null}),f=n&&Fv(o);return{c(){R(e.$$.fragment),t=M();for(let u=0;u<l.length;u+=1)l[u].c();r=M(),f&&f.c(),s=ve()},m(u,d){D(e,u,d),_(u,t,d);for(let m=0;m<l.length;m+=1)l[m]&&l[m].m(u,d);_(u,r,d),f&&f.m(u,d),_(u,s,d),i=!0},p(u,d){let m={};if(d&1&&(m.name=u[20].title),e.$set(m),d&8291){a=Se(u[1](u[20]).visibleDocs);let p;for(p=0;p<a.length;p+=1){let y=Av(u,a,p);l[p]?(l[p].p(y,d),x(l[p],1)):(l[p]=Dv(y),l[p].c(),x(l[p],1),l[p].m(r.parentNode,r))}for(ie(),p=a.length;p<l.length;p+=1)c(p);ae()}d&3&&(n=u[1](u[20]).remainingCount>0),n?f?(f.p(u,d),d&3&&x(f,1)):(f=Fv(u),f.c(),x(f,1),f.m(s.parentNode,s)):f&&(ie(),k(f,1,1,()=>{f=null}),ae())},i(u){if(!i){x(e.$$.fragment,u);for(let d=0;d<a.length;d+=1)x(l[d]);x(f),i=!0}},o(u){k(e.$$.fragment,u),l=l.filter(Nv);for(let d=0;d<l.length;d+=1)k(l[d]);k(f),i=!1},d(u){u&&(w(t),w(r),w(s)),F(e,u),Je(l,u),f&&f.d(u)}}}function tM(o){let e;return{c(){e=S("div"),e.textContent="Loading...",h(e,"class","loading")},m(t,r){_(t,e,r)},p:q,i:q,o:q,d(t){t&&w(e)}}}function rM(o){let e,t,r,n={ctx:o,current:null,token:null,hasCatch:!1,pending:tM,then:YA,catch:JA,value:19,blocks:[,,,]};return Lo(t=o[0],n),{c(){e=ve(),n.block.c()},m(s,i){_(s,e,i),n.block.m(s,n.anchor=i),n.mount=()=>e.parentNode,n.anchor=e,r=!0},p(s,[i]){o=s,n.ctx=o,i&1&&t!==(t=o[0])&&Lo(t,n)||Es(n,o,i)},i(s){r||(x(n.block),r=!0)},o(s){for(let i=0;i<3;i+=1){let a=n.blocks[i];k(a)}r=!1},d(s){s&&w(e),n.block.d(s),n.token=null,n=null}}}function Uv(o){return new Intl.NumberFormat().format(o)}function Ov(o){let e=new Date(o),r=new Date().getTime()-e.getTime(),n=Math.floor(r/(1e3*60));if(n<1)return"just now";if(n===1)return"1 minute ago";if(n<60)return`${n} minutes ago`;let s=Math.floor(n/60);if(s===1)return"1 hour ago";if(s<24)return`${s} hours ago`;let i=Math.floor(s/24);return i===1?"yesterday":`${i} days ago`}function $v(o){let e=o.filter(s=>{var i;return((i=s.queueState)===null||i===void 0?void 0:i.status)==="running"}),t=o.filter(s=>{var i;return((i=s.queueState)===null||i===void 0?void 0:i.status)==="failed"}),r=o.filter(s=>{var i;return((i=s.queueState)===null||i===void 0?void 0:i.status)==="pending"}),n=o.filter(s=>{var i;return((i=s.queueState)===null||i===void 0?void 0:i.status)==="completed"});return[e.length>0&&{title:"Active Files",documents:e},t.length>0&&{title:"Stuck Files",documents:t},r.length>0&&{title:"Queued Files",documents:r},n.length>0&&{title:"Completed Files",documents:n}].filter(Boolean)}function oM(o,e,t){let r,n,s,i,a,{$$slots:l={},$$scope:c}=e,{folder:f}=e,{backgroundSync:u}=e,d={"Active Files":{initialCount:1/0,incrementCount:100},"Stuck Files":{initialCount:1/0,incrementCount:100},"Queued Files":{initialCount:10,incrementCount:100},"Completed Files":{initialCount:5,incrementCount:100},default:{initialCount:1/0,incrementCount:100}},m=xe({}),p=Ot(m,O=>I=>{let A=d[I.title]||d.default,U=O[I.title]||A.initialCount,W=I.documents.slice(0,U),J=I.documents.length-U;return{visibleCount:U,visibleDocs:W,remainingCount:J}});ce(o,p,O=>t(1,a=O));function y(O){let I=d[O]||d.default;m.update(A=>Object.assign(Object.assign({},A),{[O]:(A[O]||I.initialCount)+I.incrementCount}))}function g(O){return Ee(this,void 0,void 0,function*(){var I;let A=[],U=Array.from(O.docs.values());for(let W of U){let J=yield W.getOrigin(),H=yield W.getServerSynced(),P={guid:W.guid,path:O.getPath(W.path),doc:W,origin:J||"unknown",serverSynced:H},V=Array.from(r).find(le=>le.guid===W.guid),fe=Array.from(n).find(le=>le.guid===W.guid),de=s.find(le=>le.guid===W.guid);if(V||fe||de){let le=V||fe||de;P.queueState={status:le.status,type:"type"in le?le.type:"sync",error:"error"in le?le.error:void 0,timestamp:"timestamp"in le?le.timestamp:Date.now()}}else J==="local"&&!H?P.queueState={status:"pending",type:"sync",timestamp:Date.now()}:H?P.queueState={status:"completed",type:"sync",timestamp:Date.now()}:P.queueState={status:"pending",type:"sync",timestamp:Date.now()};A.push(P)}return{folder:O,documents:A,progress:((I=u.getGroupProgress(O))===null||I===void 0?void 0:I.percent)||0}})}function v(O){let{origin:I,serverSynced:A,queueState:U}=O,W=(U==null?void 0:U.status)||"completed",J=(U==null?void 0:U.type)||"sync";return I==="remote"&&!A&&W==="running"&&J==="download"?{text:"Downloading",description:"Initial acquisition",icon:Nu,iconClass:"mod-primary"}:I==="remote"&&!A&&W==="pending"&&J==="download"?{text:"Queued for Download",description:"Waiting to download",icon:$i,iconClass:""}:I==="remote"&&!A&&W==="failed"&&J==="download"?{text:"Download stuck",description:"Needs retry",icon:Ni,iconClass:"mod-warning"}:I==="local"&&!A&&W==="running"&&J==="sync"?{text:"Uploading",description:"First-time upload",icon:ld,iconClass:"mod-primary"}:I==="local"&&!A&&W==="pending"&&J==="sync"?{text:"Queued for Upload",description:"Waiting to upload",icon:$i,iconClass:""}:I==="local"&&!A&&W==="failed"&&J==="sync"?{text:"Upload stuck",description:"Needs retry",icon:Ni,iconClass:"mod-warning"}:A&&W==="running"&&J==="sync"?{text:"Syncing",description:"Collaborative update",icon:Lu,iconClass:"mod-primary"}:A&&W==="pending"&&J==="sync"?{text:"Queued for Sync",description:"Waiting to sync",icon:$i,iconClass:""}:A&&W==="failed"&&J==="sync"?{text:"Sync stuck",description:"Needs retry",icon:Ni,iconClass:"mod-warning"}:A&&W==="completed"?{text:"Complete",description:"Fully synchronized",icon:Ru,iconClass:"mod-success"}:{text:"Unknown",description:"Status unknown",icon:qu,iconClass:""}}function C(O){return Ee(this,void 0,void 0,function*(){var I,A;let U={id:O.guid,guid:O.guid,path:O.path,timestamp:((I=O.queueState)===null||I===void 0?void 0:I.timestamp)||Date.now(),type:((A=O.queueState)===null||A===void 0?void 0:A.type)||"sync",status:"failed",sharedFolderGuid:O.doc.sharedFolder.guid};yield u.retryLogItem(U)})}let L=O=>C(O),T=O=>{y(O.title)},E=(O,I)=>I.key==="Enter"&&y(O.title);return o.$$set=O=>{"folder"in O&&t(7,f=O.folder),"backgroundSync"in O&&t(8,u=O.backgroundSync),"$$scope"in O&&t(13,c=O.$$scope)},o.$$.update=()=>{if(o.$$.dirty&256){e:r=new Set(u.activeSync.items())}if(o.$$.dirty&256){e:n=new Set(u.activeDownloads.items())}if(o.$$.dirty&256){e:s=u.getSyncLog()}if(o.$$.dirty&128){e:t(0,i=g(f))}},[i,a,d,p,y,v,C,f,u,l,L,T,E,c]}var im=class extends K{constructor(e){super(),G(this,e,oM,rM,j,{folder:7,backgroundSync:8},GA)}},am=im;var{Map:nM}=An;function sM(o){_e(o,"svelte-ztgdsf",".folder-header.svelte-ztgdsf{display:flex;align-items:center;cursor:pointer;background:none;border:none;padding:0;width:100%;text-align:left;color:inherit;font:inherit}.arrow.svelte-ztgdsf{margin-right:8px;font-size:0.8em;transition:transform 0.15s ease}.arrow.is-expanded.svelte-ztgdsf{transform:rotate(90deg)}.sync-stats.svelte-ztgdsf{margin-left:8px;display:flex;gap:4px}.tag.svelte-ztgdsf{font-size:0.7em;padding:2px 6px;border-radius:4px;background-color:var(--background-modifier-border);color:var(--text-muted)}.tag.mod-success.svelte-ztgdsf{background-color:var(--interactive-success);color:var(--text-on-accent)}.tag.mod-warning.svelte-ztgdsf{background-color:var(--text-warning);color:var(--text-on-accent)}.progress-container.svelte-ztgdsf{display:flex;align-items:center;margin-top:4px;width:100%}.progress-bar.svelte-ztgdsf{flex:1;height:6px;background-color:var(--background-modifier-border);border-radius:3px;overflow:hidden;margin-right:8px}.progress-value.svelte-ztgdsf{height:100%;background-color:var(--interactive-accent);border-radius:3px}.progress-text.svelte-ztgdsf{font-size:0.75rem;color:var(--text-muted)}")}function Bv(o,e,t){let r=o.slice();r[25]=e[t];let n=r[4].get(r[25].guid);return r[26]=n,r}function Vv(o){let e,t;return e=new qe({props:{name:"Sync Status"}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},i(r){t||(x(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function Hv(o){let e,t;return e=new Pe({props:{name:o[11]?"Sync in Progress":o[10]?"Queued Files":"Sync Complete",description:`${o[2]} active \u2022 ${o[7]} stuck \u2022 ${o[3]} queued \u2022 ${o[8]} complete`,$$slots:{default:[lM]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n&3072&&(s.name=r[11]?"Sync in Progress":r[10]?"Queued Files":"Sync Complete"),n&396&&(s.description=`${r[2]} active \u2022 ${r[7]} stuck \u2022 ${r[3]} queued \u2022 ${r[8]} complete`),n&536874496&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(x(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function qv(o){let e,t,r,n,s,i,a=[aM,iM],l=[];function c(f,u){return f[9]?0:1}return t=c(o,-1),r=l[t]=a[t](o),{c(){e=S("button"),r.c(),h(e,"class","mod-cta")},m(f,u){_(f,e,u),l[t].m(e,null),n=!0,s||(i=z(e,"click",o[16]),s=!0)},p(f,u){let d=t;t=c(f,u),t!==d&&(ie(),k(l[d],1,1,()=>{l[d]=null}),ae(),r=l[t],r||(r=l[t]=a[t](f),r.c()),x(r,1),r.m(e,null))},i(f){n||(x(r),n=!0)},o(f){k(r),n=!1},d(f){f&&w(e),l[t].d(),s=!1,i()}}}function iM(o){let e,t,r;return e=new Yu({props:{size:16,class:"svg-icon lucide-pause",style:"margin-right: 8px;"}}),{c(){R(e.$$.fragment),t=B(`
						Pause`)},m(n,s){D(e,n,s),_(n,t,s),r=!0},i(n){r||(x(e.$$.fragment,n),r=!0)},o(n){k(e.$$.fragment,n),r=!1},d(n){n&&w(t),F(e,n)}}}function aM(o){let e,t,r;return e=new Zu({props:{size:16,class:"svg-icon lucide-play",style:"margin-right: 8px;"}}),{c(){R(e.$$.fragment),t=B(`
						Resume`)},m(n,s){D(e,n,s),_(n,t,s),r=!0},i(n){r||(x(e.$$.fragment,n),r=!0)},o(n){k(e.$$.fragment,n),r=!1},d(n){n&&w(t),F(e,n)}}}function lM(o){let e,t,r=(o[11]||o[10])&&qv(o);return{c(){r&&r.c(),e=ve()},m(n,s){r&&r.m(n,s),_(n,e,s),t=!0},p(n,s){n[11]||n[10]?r?(r.p(n,s),s&3072&&x(r,1)):(r=qv(n),r.c(),x(r,1),r.m(e.parentNode,e)):r&&(ie(),k(r,1,1,()=>{r=null}),ae())},i(n){t||(x(r),t=!0)},o(n){k(r),t=!1},d(n){n&&w(e),r&&r.d(n)}}}function cM(o){let e=[],t=new nM,r,n,s=Se(o[6]),i=a=>a[25].guid;for(let a=0;a<s.length;a+=1){let l=Bv(o,s,a),c=i(l);t.set(c,e[a]=Jv(c,l))}return{c(){for(let a=0;a<e.length;a+=1)e[a].c();r=ve()},m(a,l){for(let c=0;c<e.length;c+=1)e[c]&&e[c].m(a,l);_(a,r,l),n=!0},p(a,l){l&32851&&(s=Se(a[6]),ie(),e=Pn(e,l,i,1,a,s,t,r.parentNode,fl,Jv,r,Bv),ae())},i(a){if(!n){for(let l=0;l<s.length;l+=1)x(e[l]);n=!0}},o(a){for(let l=0;l<e.length;l+=1)k(e[l]);n=!1},d(a){a&&w(r);for(let l=0;l<e.length;l+=1)e[l].d(a)}}}function fM(o){let e,t,r,n;return e=new qe({props:{$$slots:{name:[gM],default:[mM]},$$scope:{ctx:o}}}),r=new am({props:{folder:o[5],backgroundSync:o[0]}}),{c(){R(e.$$.fragment),t=M(),R(r.$$.fragment)},m(s,i){D(e,s,i),_(s,t,i),D(r,s,i),n=!0},p(s,i){let a={};i&536875040&&(a.$$scope={dirty:i,ctx:s}),e.$set(a);let l={};i&32&&(l.folder=s[5]),i&1&&(l.backgroundSync=s[0]),r.$set(l)},i(s){n||(x(e.$$.fragment,s),x(r.$$.fragment,s),n=!0)},o(s){k(e.$$.fragment,s),k(r.$$.fragment,s),n=!1},d(s){s&&w(t),F(e,s),F(r,s)}}}function zv(o){let e,t,r,n,s,i=o[26].progress+"",a,l;return{c(){e=S("div"),t=S("div"),r=S("div"),n=M(),s=S("span"),a=B(i),l=B("%"),h(r,"class","progress-value svelte-ztgdsf"),ue(r,"width",o[26].progress+"%"),h(t,"class","progress-bar svelte-ztgdsf"),h(s,"class","progress-text svelte-ztgdsf"),h(e,"class","progress-container svelte-ztgdsf")},m(c,f){_(c,e,f),b(e,t),b(t,r),b(e,n),b(e,s),b(s,a),b(s,l)},p(c,f){f&80&&ue(r,"width",c[26].progress+"%"),f&80&&i!==(i=c[26].progress+"")&&Y(a,i)},d(c){c&&w(e)}}}function uM(o){let e,t=o[26]&&(o[26].running>0||o[26].failed>0)&&zv(o);return{c(){t&&t.c(),e=ve()},m(r,n){t&&t.m(r,n),_(r,e,n)},p(r,n){r[26]&&(r[26].running>0||r[26].failed>0)?t?t.p(r,n):(t=zv(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&w(e),t&&t.d(r)}}}function Wv(o){let e,t=o[26].running+"",r,n;return{c(){e=S("span"),r=B(t),n=B(" active"),h(e,"class","tag mod-success svelte-ztgdsf")},m(s,i){_(s,e,i),b(e,r),b(e,n)},p(s,i){i&80&&t!==(t=s[26].running+"")&&Y(r,t)},d(s){s&&w(e)}}}function jv(o){let e,t=o[26].failed+"",r,n;return{c(){e=S("span"),r=B(t),n=B(" stuck"),h(e,"class","tag mod-warning svelte-ztgdsf")},m(s,i){_(s,e,i),b(e,r),b(e,n)},p(s,i){i&80&&t!==(t=s[26].failed+"")&&Y(r,t)},d(s){s&&w(e)}}}function Kv(o){let e,t=o[26].pending+"",r,n;return{c(){e=S("span"),r=B(t),n=B(" queued"),h(e,"class","tag svelte-ztgdsf")},m(s,i){_(s,e,i),b(e,r),b(e,n)},p(s,i){i&80&&t!==(t=s[26].pending+"")&&Y(r,t)},d(s){s&&w(e)}}}function dM(o){var T,E,O;let e,t,r,n,s,i=o[25].name+"",a,l,c,f,u,d,m,p,y=((T=o[26])==null?void 0:T.running)>0&&Wv(o),g=((E=o[26])==null?void 0:E.failed)>0&&jv(o),v=((O=o[26])==null?void 0:O.pending)>0&&Kv(o);function C(){return o[22](o[25])}function L(...I){return o[23](o[25],...I)}return{c(){e=S("div"),t=S("span"),r=B("\u25B6"),s=M(),a=B(i),l=M(),c=S("span"),y&&y.c(),f=M(),g&&g.c(),u=M(),v&&v.c(),h(t,"class",n="arrow "+(o[1][o[25].guid]?"is-expanded":"")+" svelte-ztgdsf"),h(c,"class","sync-stats svelte-ztgdsf"),h(e,"class","folder-header svelte-ztgdsf"),h(e,"role","button"),h(e,"tabindex","0"),h(e,"aria-expanded",d=!!o[1][o[25].guid])},m(I,A){_(I,e,A),b(e,t),b(t,r),b(e,s),b(e,a),b(e,l),b(e,c),y&&y.m(c,null),b(c,f),g&&g.m(c,null),b(c,u),v&&v.m(c,null),m||(p=[z(e,"click",C),z(e,"keydown",L)],m=!0)},p(I,A){var U,W,J;o=I,A&66&&n!==(n="arrow "+(o[1][o[25].guid]?"is-expanded":"")+" svelte-ztgdsf")&&h(t,"class",n),A&64&&i!==(i=o[25].name+"")&&Y(a,i),((U=o[26])==null?void 0:U.running)>0?y?y.p(o,A):(y=Wv(o),y.c(),y.m(c,f)):y&&(y.d(1),y=null),((W=o[26])==null?void 0:W.failed)>0?g?g.p(o,A):(g=jv(o),g.c(),g.m(c,u)):g&&(g.d(1),g=null),((J=o[26])==null?void 0:J.pending)>0?v?v.p(o,A):(v=Kv(o),v.c(),v.m(c,null)):v&&(v.d(1),v=null),A&66&&d!==(d=!!o[1][o[25].guid])&&h(e,"aria-expanded",d)},d(I){I&&w(e),y&&y.d(),g&&g.d(),v&&v.d(),m=!1,we(p)}}}function pM(o){let e,t;return e=new oo({props:{folder:o[25],$$slots:{default:[dM]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n&64&&(s.folder=r[25]),n&536870994&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(x(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function Gv(o){let e,t;return e=new am({props:{folder:o[25],backgroundSync:o[0]}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n&64&&(s.folder=r[25]),n&1&&(s.backgroundSync=r[0]),e.$set(s)},i(r){t||(x(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function Jv(o,e){let t,r,n,s,i;r=new qe({props:{$$slots:{name:[pM],default:[uM]},$$scope:{ctx:e}}});let a=e[1][e[25].guid]&&Gv(e);return{key:o,first:null,c(){t=ve(),R(r.$$.fragment),n=M(),a&&a.c(),s=ve(),this.first=t},m(l,c){_(l,t,c),D(r,l,c),_(l,n,c),a&&a.m(l,c),_(l,s,c),i=!0},p(l,c){e=l;let f={};c&536870994&&(f.$$scope={dirty:c,ctx:e}),r.$set(f),e[1][e[25].guid]?a?(a.p(e,c),c&66&&x(a,1)):(a=Gv(e),a.c(),x(a,1),a.m(s.parentNode,s)):a&&(ie(),k(a,1,1,()=>{a=null}),ae())},i(l){i||(x(r.$$.fragment,l),x(a),i=!0)},o(l){k(r.$$.fragment,l),k(a),i=!1},d(l){l&&(w(t),w(n),w(s)),F(r,l),a&&a.d(l)}}}function Yv(o){let e,t,r,n,s,i=o[12].progress+"",a,l;return{c(){e=S("div"),t=S("div"),r=S("div"),n=M(),s=S("span"),a=B(i),l=B("%"),h(r,"class","progress-value svelte-ztgdsf"),ue(r,"width",o[12].progress+"%"),h(t,"class","progress-bar svelte-ztgdsf"),h(s,"class","progress-text svelte-ztgdsf"),h(e,"class","progress-container svelte-ztgdsf")},m(c,f){_(c,e,f),b(e,t),b(t,r),b(e,n),b(e,s),b(s,a),b(s,l)},p(c,f){f&4096&&ue(r,"width",c[12].progress+"%"),f&4096&&i!==(i=c[12].progress+"")&&Y(a,i)},d(c){c&&w(e)}}}function mM(o){let e,t=(o[12].running>0||o[12].failed>0)&&Yv(o);return{c(){t&&t.c(),e=ve()},m(r,n){t&&t.m(r,n),_(r,e,n)},p(r,n){r[12].running>0||r[12].failed>0?t?t.p(r,n):(t=Yv(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&w(e),t&&t.d(r)}}}function Qv(o){let e,t=o[12].running+"",r,n;return{c(){e=S("span"),r=B(t),n=B(" active"),h(e,"class","tag mod-success svelte-ztgdsf")},m(s,i){_(s,e,i),b(e,r),b(e,n)},p(s,i){i&4096&&t!==(t=s[12].running+"")&&Y(r,t)},d(s){s&&w(e)}}}function Zv(o){let e,t=o[12].failed+"",r,n;return{c(){e=S("span"),r=B(t),n=B(" stuck"),h(e,"class","tag mod-warning svelte-ztgdsf")},m(s,i){_(s,e,i),b(e,r),b(e,n)},p(s,i){i&4096&&t!==(t=s[12].failed+"")&&Y(r,t)},d(s){s&&w(e)}}}function Xv(o){let e,t=o[12].pending+"",r,n;return{c(){e=S("span"),r=B(t),n=B(" queued"),h(e,"class","tag svelte-ztgdsf")},m(s,i){_(s,e,i),b(e,r),b(e,n)},p(s,i){i&4096&&t!==(t=s[12].pending+"")&&Y(r,t)},d(s){s&&w(e)}}}function hM(o){let e,t=o[5].name+"",r,n,s,i,a,l=o[12].running>0&&Qv(o),c=o[12].failed>0&&Zv(o),f=o[12].pending>0&&Xv(o);return{c(){e=S("div"),r=B(t),n=M(),s=S("span"),l&&l.c(),i=M(),c&&c.c(),a=M(),f&&f.c(),h(s,"class","sync-stats svelte-ztgdsf"),h(e,"class","folder-header svelte-ztgdsf")},m(u,d){_(u,e,d),b(e,r),b(e,n),b(e,s),l&&l.m(s,null),b(s,i),c&&c.m(s,null),b(s,a),f&&f.m(s,null)},p(u,d){d&32&&t!==(t=u[5].name+"")&&Y(r,t),u[12].running>0?l?l.p(u,d):(l=Qv(u),l.c(),l.m(s,i)):l&&(l.d(1),l=null),u[12].failed>0?c?c.p(u,d):(c=Zv(u),c.c(),c.m(s,a)):c&&(c.d(1),c=null),u[12].pending>0?f?f.p(u,d):(f=Xv(u),f.c(),f.m(s,null)):f&&(f.d(1),f=null)},d(u){u&&w(e),l&&l.d(),c&&c.d(),f&&f.d()}}}function gM(o){let e,t;return e=new oo({props:{folder:o[5],$$slots:{default:[hM]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n&32&&(s.folder=r[5]),n&536875040&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(x(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function yM(o){let e,t,r,n,s,i,a=!o[5]&&Vv(o),l=!o[5]&&Hv(o),c=[fM,cM],f=[];function u(d,m){return d[5]&&d[12]?0:1}return n=u(o,-1),s=f[n]=c[n](o),{c(){e=S("div"),a&&a.c(),t=M(),l&&l.c(),r=M(),s.c(),h(e,"class","setting-item-container")},m(d,m){_(d,e,m),a&&a.m(e,null),b(e,t),l&&l.m(e,null),b(e,r),f[n].m(e,null),i=!0},p(d,[m]){d[5]?a&&(ie(),k(a,1,1,()=>{a=null}),ae()):a?m&32&&x(a,1):(a=Vv(d),a.c(),x(a,1),a.m(e,t)),d[5]?l&&(ie(),k(l,1,1,()=>{l=null}),ae()):l?(l.p(d,m),m&32&&x(l,1)):(l=Hv(d),l.c(),x(l,1),l.m(e,r));let p=n;n=u(d,m),n===p?f[n].p(d,m):(ie(),k(f[p],1,1,()=>{f[p]=null}),ae(),s=f[n],s?s.p(d,m):(s=f[n]=c[n](d),s.c()),x(s,1),s.m(e,null))},i(d){i||(x(a),x(l),x(s),i=!0)},o(d){k(a),k(l),k(s),i=!1},d(d){d&&w(e),a&&a.d(),l&&l.d(),f[n].d()}}}function xM(o,e,t){let r,n,s,i,a,l,c,f,u,d,m,{backgroundSync:p}=e,{sharedFolders:y}=e,{focusedFolderGuid:g}=e,v={},C=0,L=0,T=0,E=0,{activeSync:O,activeDownloads:I}=p;ce(o,O,H=>t(21,m=H)),ce(o,I,H=>t(20,d=H));function A(H){t(1,v[H]=!v[H],v),t(1,v),t(6,r),t(17,y)}function U(){l?p.resume():p.pause()}let W=H=>A(H.guid),J=(H,P)=>P.key==="Enter"&&A(H.guid);return o.$$set=H=>{"backgroundSync"in H&&t(0,p=H.backgroundSync),"sharedFolders"in H&&t(17,y=H.sharedFolders),"focusedFolderGuid"in H&&t(18,g=H.focusedFolderGuid)},o.$$.update=()=>{if(o.$$.dirty&131072){e:t(6,r=y.items().sort((H,P)=>H.name.localeCompare(P.name)))}if(o.$$.dirty&66){e:r.forEach(H=>{H.guid in v||t(1,v[H.guid]=!0,v)}),t(1,v),t(6,r),t(17,y)}if(o.$$.dirty&393216){e:t(5,n=g?y.items().find(H=>H.guid===g):void 0)}if(o.$$.dirty&3145793){e:t(4,s=new Map(r.map(H=>{var P,V;return[H.guid,{progress:((P=p.getGroupProgress(H))===null||P===void 0?void 0:P.percent)||0,running:[...m.items(),...d.items()].filter(fe=>fe.sharedFolder.guid===H.guid).length,failed:((V=p.syncGroups.get(H))===null||V===void 0?void 0:V.status)==="failed"?1:0,pending:[...p.pendingSyncs,...p.pendingDownloads].filter(fe=>fe.sharedFolder.guid===H.guid).length,completed:(()=>{let fe=p.syncGroups.get(H);return((fe==null?void 0:fe.completedSyncs)||0)+((fe==null?void 0:fe.completedDownloads)||0)})(),sharedFolder:H}]})))}if(o.$$.dirty&48){e:t(12,i=n?s.get(n.guid):void 0)}if(o.$$.dirty&1){e:t(19,a=p.getQueueStatus())}if(o.$$.dirty&524288){e:t(9,l=a.isPaused)}if(o.$$.dirty&524288){e:c=a.syncsActive>0||a.downloadsActive>0}if(o.$$.dirty&16){e:{let H=0,P=0,V=0,fe=0;for(let de of s.values())H+=de.running,P+=de.failed,V+=de.pending,fe+=de.completed;t(2,C=H),t(7,L=P),t(3,T=V),t(8,E=fe)}}if(o.$$.dirty&4){e:t(11,f=C>0)}if(o.$$.dirty&8){e:t(10,u=T>0)}},[p,v,C,T,s,n,r,L,E,l,u,f,i,O,I,A,U,y,g,a,d,m,W,J]}var lm=class extends K{constructor(e){super(),G(this,e,xM,yM,j,{backgroundSync:0,sharedFolders:17,focusedFolderGuid:18},sM)}},ew=lm;var Ji=class extends tw.Modal{constructor(t,r,n,s){super(t);this.backgroundSync=r;this.sharedFolders=n;this.focusedFolderGuid=s}onOpen(){let{contentEl:t}=this;t.empty(),this.component=new ew({target:t,props:{backgroundSync:this.backgroundSync,sharedFolders:this.sharedFolders,focusedFolderGuid:this.focusedFolderGuid,closeModal:()=>this.close()}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};function cm(o){return o.startsWith("v")?o.slice(1):o}function bM(o,e){return o.map((t,r)=>[t,e[r]])}function vM(o,e){try{let t=cm(o).split(".").map(parseInt),r=cm(e).split(".").map(parseInt);for(let[n,s]of bM(t,r))if(n>s)return!0}catch(t){}return!1}var bc=class extends et{constructor(t,r,n){super("UpdateManager");this.plugin=t;this.timeProvider=r;this.releaseSettings=n;this.updateCheckInterval=null;this.lastReleaseCheck=0;this.lastChannelCheck=0;this.CHECK_INTERVAL=1e3*60*60*24;this.githubReleases=new ko("system3-relay/releases"),this.releaseChannels=new ko("system3-relay/releaseChannels")}get releases(){return[...this.githubReleases.values()].sort((t,r)=>r.tag_name.localeCompare(t.tag_name,void 0,{numeric:!0,sensitivity:"base"}))}get beta(){return this.releaseChannels.get("beta")}get stable(){return this.releaseChannels.get("stable")}async fetchReleases(){let r=await ot("https://api.github.com/repos/No-Instructions/Relay/releases",{headers:{Accept:"application/vnd.github.v3+json","User-Agent":"Relay-Obsidian-Plugin"}});if(!r.ok)throw new Error(`GitHub API error: ${r.status}`);let n=await r.json();return Ve().enableNetworkLogging&&this.debug("GitHub releases fetched:",n),n}async fetchLatestRelease(){try{let n="https://api.github.com/repos/No-Instructions/Relay/releases/latest";this.debug(`Fetching latest release from: ${n}`);let s=await ot(n,{headers:{"User-Agent":"Relay-Obsidian-Plugin"}});if(!s.ok)throw new Error(`GitHub API error: ${s.status}`);return await s.json()}catch(t){return this.error("Failed to fetch latest release:",t),null}}async fetchLatestTagFromChannel(t){try{let r={beta:"manifest-beta.json",stable:"manifest.json"}[t],n=r?await this.fetchRepoManifest(r):null;return n?(this.debug("repo manifest",n),n.version):null}catch(r){this.error("Failed to check for updates:",r)}return null}async getReleases(){try{let t=Date.now();if(t-this.lastReleaseCheck<5*60*1e3&&this.githubReleases.size>0)return[...this.githubReleases.values()];this.lastReleaseCheck=t;let r=await this.fetchReleases(),n=new Set([...this.githubReleases.keys()]),s=new Set;r.forEach(a=>{this.githubReleases.set(a.tag_name,a),s.add(a.tag_name)}),n.forEach(a=>{s.has(a)||this.githubReleases.delete(a)});let i=await this.fetchLatestRelease();i&&(i.latest=!0,this.githubReleases.set(i.tag_name,i)),this.notifyListeners()}catch(t){this.error("Failed to fetch GitHub releases:",t)}return[...this.githubReleases.values()]}async getChannelRelease(){let t=Date.now(),r=this.releaseChannels.get(this.releaseSettings.get().channel);if(t-this.lastChannelCheck<5*60*1e3&&r)return r;this.lastReleaseCheck=t;let n=await this.getReleases();if(n.length===0)return this.debug("No releases found"),null;let s=this.releaseSettings.get().channel;if(!s)return null;let i=await this.fetchLatestTagFromChannel(s);if(!i)return null;let a=n.find(l=>cm(l.tag_name)===i);return a?(this.releaseChannels.set(s,a),this.notifyListeners(),a):null}async update(){await this.getReleases(),await this.getChannelRelease()}start(){this.update(),this.updateCheckInterval=this.timeProvider.setInterval(()=>this.update(),this.CHECK_INTERVAL)}stop(){this.updateCheckInterval!==null&&(this.timeProvider.clearInterval(this.updateCheckInterval),this.updateCheckInterval=null)}async fetchRepoManifest(t,r="main"){try{let i=`https://raw.githubusercontent.com/No-Instructions/Relay/${r}/${t}`;this.debug(`Fetching ${i}`);let a=await ot(i);if(!a.ok)throw new Error("unable to fetch manifest");return await a.json()}catch(n){return this.error("Failed to fetch:",n),null}}async fetchReleaseManifest(t){try{let r=t.assets.find(i=>i.name==="manifest.json");if(!r)return this.debug("No manifest found in release assets"),null;this.debug("Fetching manifest from release asset:",r.browser_download_url);let n=await ot(r.browser_download_url,{headers:{Accept:"application/octet-stream","User-Agent":"Relay-Obsidian-Plugin"}});if(!n.ok)throw new Error(`Failed to fetch manifest asset: ${n.status}`);let s=await n.json();return Ve().enableNetworkLogging&&this.debug("manifest fetched:",s),s}catch(r){return this.error("Failed to fetch manifest for release:",t,r),null}}getNewRelease(){let t=this.releaseChannels.get(this.releaseSettings.get().channel);if(t&&vM(t.tag_name,this.plugin.version))return t}async installUpdate(t){let r=await this.fetchReleaseManifest(t);try{this.debug(`Installing update from v${this.plugin.version} to v${r.version}...`,r),await this.plugin.app.plugins.installPlugin("No-Instructions/Relay",r.version,r),this.notifyListeners(),this.debug("Update complete. Reloading plugin...");let n="system3-relay",s=this.plugin.app.plugins;return await s.disablePlugin(n),await s.enablePlugin(n),!0}catch(n){return this.error("Failed to install update:",n),!1}}destroy(){this.stop(),this.githubReleases=null,this.releaseChannels=null,super.destroy()}};var bw=require("obsidian");var yw=require("obsidian");function wM(o){_e(o,"svelte-12doke6",'.modal-content.svelte-12doke6.svelte-12doke6{padding:0;display:flex;flex-direction:column;height:100%}.settings-container.svelte-12doke6.svelte-12doke6{margin:0 1rem;border-bottom:1px solid var(--background-modifier-border);margin-bottom:1rem}.settings-spacer.svelte-12doke6.svelte-12doke6{height:0.5rem}.checkbox-container.svelte-12doke6.svelte-12doke6{cursor:pointer}.loading-text.svelte-12doke6.svelte-12doke6,.no-releases-text.svelte-12doke6.svelte-12doke6{padding:12px;text-align:center;color:var(--text-muted);font-style:italic}.release-tags-container.svelte-12doke6.svelte-12doke6{display:flex;flex-wrap:wrap;column-gap:8px;row-gap:4px;padding:0 1rem 1rem;max-height:160px;overflow-y:auto}.release-tag-item.svelte-12doke6.svelte-12doke6{display:flex;justify-content:center;align-items:center;background-color:var(--background-secondary);border:1px solid var(--background-modifier-border);border-radius:4px;padding:4px 8px;height:24px;cursor:pointer;opacity:0.7;position:relative}.release-tag-item.svelte-12doke6.svelte-12doke6:hover{background-color:var(--background-modifier-hover);opacity:0.9}.release-tag-item[aria-selected="true"].svelte-12doke6.svelte-12doke6{background-color:var(--color-accent);border-color:var(--background-modifier-border);border-bottom-width:2px;opacity:1}.release-tag-item.current-version.svelte-12doke6.svelte-12doke6{border-width:1px}.release-tag-item.development-version.svelte-12doke6.svelte-12doke6{border-width:1px}.release-tag-item.main-branch-version.svelte-12doke6.svelte-12doke6{border-width:1px}.release-tag-item.beta-version.svelte-12doke6.svelte-12doke6{font-weight:bold}.release-tag-item.stable-version.svelte-12doke6.svelte-12doke6{font-weight:bold}.prerelease-badge.svelte-12doke6.svelte-12doke6{font-size:0.7em;color:var(--text-on-accent);border-radius:4px;padding:2px 6px;margin-left:8px;vertical-align:middle;text-transform:uppercase}.channel-badge.svelte-12doke6.svelte-12doke6{font-size:0.7em;border-radius:4px;padding:2px 6px;margin-left:8px;vertical-align:middle;text-transform:uppercase}.beta-badge.svelte-12doke6.svelte-12doke6{background-color:var(--background-modifier-hover);color:var(--text-normal)}.stable-badge.svelte-12doke6.svelte-12doke6{background-color:var(--background-modifier-hover);color:var(--text-normal)}.tag-name.svelte-12doke6.svelte-12doke6{font-weight:bold;font-size:0.8em;display:flex;align-items:center}.manifest-container.svelte-12doke6.svelte-12doke6{flex:1;display:flex;flex-direction:column;border:1px solid var(--background-modifier-border);border-radius:8px;background-color:var(--background-secondary);margin:0 1rem 1rem;overflow:hidden}.manifest-header.svelte-12doke6.svelte-12doke6{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;background-color:var(--background-secondary-alt);border-bottom:1px solid var(--background-modifier-border)}.manifest-header.svelte-12doke6 h3.svelte-12doke6{margin:0;font-size:1.1em;color:var(--text-normal);display:flex;align-items:center}.manifest-header-actions.svelte-12doke6.svelte-12doke6{display:flex;align-items:center;gap:10px}.manifest-close-btn.svelte-12doke6.svelte-12doke6{cursor:pointer;font-size:1.2em;background:transparent;border:none;color:var(--text-normal)}.manifest-content.svelte-12doke6.svelte-12doke6{padding:16px;border-top:1px solid var(--background-modifier-border)}.manifest-field.svelte-12doke6.svelte-12doke6{margin-bottom:8px;display:flex;align-items:flex-start}.manifest-label.svelte-12doke6.svelte-12doke6{font-weight:bold;min-width:120px;color:var(--text-normal)}.manifest-value.svelte-12doke6.svelte-12doke6{flex:1}.manifest-version-mismatch.svelte-12doke6.svelte-12doke6{margin-left:10px;color:var(--text-error);font-size:0.85em;display:flex;align-items:center;gap:4px}.manifest-version-mismatch-icon.svelte-12doke6.svelte-12doke6{font-size:1.2em}.release-changelog.svelte-12doke6.svelte-12doke6{padding:16px;overflow:hidden;display:flex;flex-direction:column;height:320px}.release-changelog-content.svelte-12doke6.svelte-12doke6{overflow-x:auto;margin:0;font-size:0.85em;flex:1;overflow-y:auto;line-height:1.4}.currently-installed.svelte-12doke6.svelte-12doke6{color:var(--interactive-accent);font-weight:bold;padding:4px 8px;border-radius:4px}.install-version-btn.svelte-12doke6.svelte-12doke6{font-size:0.9em;padding:4px 12px;cursor:pointer}.manifest-error.svelte-12doke6.svelte-12doke6{padding:16px;text-align:center;background-color:var(--background-modifier-error);border-radius:6px;color:var(--text-on-accent);margin:0 1rem 1rem}.manifest-error-message.svelte-12doke6.svelte-12doke6{margin-bottom:12px}')}function rw(o,e,t){let r=o.slice();return r[66]=e[t],r}function ow(o){let e,t;return e=new ht({props:{name:"Show all releases",$$slots:{default:[_M]},$$scope:{ctx:o}}}),{c(){R(e.$$.fragment)},m(r,n){D(e,r,n),t=!0},p(r,n){let s={};n[0]&64|n[2]&128&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(x(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function _M(o){let e,t,r,n,s,i;return{c(){e=S("div"),t=S("input"),r=M(),n=S("div"),h(t,"type","checkbox"),t.checked=o[6],h(n,"class","checkbox-toggle"),h(e,"class","checkbox-container svelte-12doke6"),h(e,"role","checkbox"),h(e,"aria-checked",o[6]),h(e,"tabindex","0"),Me(e,"is-enabled",o[6])},m(a,l){_(a,e,l),b(e,t),b(e,r),b(e,n),s||(i=[z(e,"click",o[41]),z(e,"keydown",o[42])],s=!0)},p(a,l){l[0]&64&&(t.checked=a[6]),l[0]&64&&h(e,"aria-checked",a[6]),l[0]&64&&Me(e,"is-enabled",a[6])},d(a){a&&w(e),s=!1,we(i)}}}function SM(o){let e,t,r=!o[1]&&nw(o);function n(a,l){if(a[11])return TM;if(a[16])return LM}let s=n(o,[-1,-1,-1]),i=s&&s(o);return{c(){r&&r.c(),e=M(),i&&i.c(),t=ve()},m(a,l){r&&r.m(a,l),_(a,e,l),i&&i.m(a,l),_(a,t,l)},p(a,l){a[1]?r&&(r.d(1),r=null):r?r.p(a,l):(r=nw(a),r.c(),r.m(e.parentNode,e)),s===(s=n(a,l))&&i?i.p(a,l):(i&&i.d(1),i=s&&s(a),i&&(i.c(),i.m(t.parentNode,t)))},d(a){a&&(w(e),w(t)),r&&r.d(a),i&&i.d(a)}}}function kM(o){let e;return{c(){e=S("div"),e.textContent="No matching releases found with the current filter",h(e,"class","no-releases-text svelte-12doke6")},m(t,r){_(t,e,r)},p:q,d(t){t&&w(e)}}}function IM(o){let e;return{c(){e=S("div"),e.textContent="No GitHub releases found",h(e,"class","no-releases-text svelte-12doke6")},m(t,r){_(t,e,r)},p:q,d(t){t&&w(e)}}}function CM(o){let e;return{c(){e=S("div"),e.textContent="Loading GitHub releases...",h(e,"class","loading-text svelte-12doke6")},m(t,r){_(t,e,r)},p:q,d(t){t&&w(e)}}}function nw(o){let e,t,r,n=!o[8].some(o[40]),s,i=o[5]&&sw(o),a=o[4]&&iw(o),l=n&&aw(o),c=!o[1]&&lw(o);return{c(){e=S("div"),i&&i.c(),t=M(),a&&a.c(),r=M(),l&&l.c(),s=M(),c&&c.c(),h(e,"class","release-tags-container svelte-12doke6")},m(f,u){_(f,e,u),i&&i.m(e,null),b(e,t),a&&a.m(e,null),b(e,r),l&&l.m(e,null),b(e,s),c&&c.m(e,null)},p(f,u){f[5]?i?i.p(f,u):(i=sw(f),i.c(),i.m(e,t)):i&&(i.d(1),i=null),f[4]?a?a.p(f,u):(a=iw(f),a.c(),a.m(e,r)):a&&(a.d(1),a=null),u[0]&256&&(n=!f[8].some(f[40])),n?l?l.p(f,u):(l=aw(f),l.c(),l.m(e,s)):l&&(l.d(1),l=null),f[1]?c&&(c.d(1),c=null):c?c.p(f,u):(c=lw(f),c.c(),c.m(e,null))},d(f){f&&w(e),i&&i.d(),a&&a.d(),l&&l.d(),c&&c.d()}}}function sw(o){let e,t,r,n,s;return{c(){e=S("div"),t=S("div"),t.textContent="Stable",h(t,"class","tag-name svelte-12doke6"),h(e,"class","release-tag-item main-branch-version stable-version svelte-12doke6"),h(e,"role","tab"),h(e,"aria-selected",r=o[9]==="stable"),h(e,"tabindex","0")},m(i,a){_(i,e,a),b(e,t),n||(s=[z(e,"click",o[43]),z(e,"keydown",o[44])],n=!0)},p(i,a){a[0]&512&&r!==(r=i[9]==="stable")&&h(e,"aria-selected",r)},d(i){i&&w(e),n=!1,we(s)}}}function iw(o){let e,t,r,n,s;return{c(){e=S("div"),t=S("div"),t.textContent="Beta",h(t,"class","tag-name svelte-12doke6"),h(e,"class","release-tag-item main-branch-version beta-version svelte-12doke6"),h(e,"role","tab"),h(e,"aria-selected",r=o[9]==="beta"),h(e,"tabindex","0")},m(i,a){_(i,e,a),b(e,t),n||(s=[z(e,"click",o[45]),z(e,"keydown",o[46])],n=!0)},p(i,a){a[0]&512&&r!==(r=i[9]==="beta")&&h(e,"aria-selected",r)},d(i){i&&w(e),n=!1,we(s)}}}function aw(o){let e,t,r,n,s;return{c(){e=S("div"),t=S("div"),t.textContent="Dev",h(t,"class","tag-name svelte-12doke6"),h(e,"class","release-tag-item development-version svelte-12doke6"),h(e,"role","tab"),h(e,"aria-selected",r=o[10]===o[0].version),h(e,"tabindex","0")},m(i,a){_(i,e,a),b(e,t),n||(s=[z(e,"click",o[47]),z(e,"keydown",o[48])],n=!0)},p(i,a){a[0]&1025&&r!==(r=i[10]===i[0].version)&&h(e,"aria-selected",r)},d(i){i&&w(e),n=!1,we(s)}}}function lw(o){let e,t=Se(o[8]),r=[];for(let n=0;n<t.length;n+=1)r[n]=cw(rw(o,t,n));return{c(){for(let n=0;n<r.length;n+=1)r[n].c();e=ve()},m(n,s){for(let i=0;i<r.length;i+=1)r[i]&&r[i].m(n,s);_(n,e,s)},p(n,s){if(s[0]&268436736|s[1]&17){t=Se(n[8]);let i;for(i=0;i<t.length;i+=1){let a=rw(n,t,i);r[i]?r[i].p(a,s):(r[i]=cw(a),r[i].c(),r[i].m(e.parentNode,e))}for(;i<r.length;i+=1)r[i].d(1);r.length=t.length}},d(n){n&&w(e),Je(r,n)}}}function cw(o){let e,t,r=o[66].tag_name+"",n,s,i,a,l,c;function f(){return o[49](o[66])}function u(...d){return o[50](o[66],...d)}return{c(){e=S("div"),t=S("div"),n=B(r),s=M(),h(t,"class","tag-name svelte-12doke6"),h(e,"class",i="release-tag-item "+(o[28](o[66].tag_name)?"current-version":"")+" "+(gw(o[66])?"pre-release":"")+" svelte-12doke6"),h(e,"role","tab"),h(e,"aria-selected",a=o[10]===o[66].tag_name),h(e,"tabindex","0")},m(d,m){_(d,e,m),b(e,t),b(t,n),b(e,s),l||(c=[z(e,"click",f),z(e,"keydown",u)],l=!0)},p(d,m){o=d,m[0]&256&&r!==(r=o[66].tag_name+"")&&Y(n,r),m[0]&256&&i!==(i="release-tag-item "+(o[28](o[66].tag_name)?"current-version":"")+" "+(gw(o[66])?"pre-release":"")+" svelte-12doke6")&&h(e,"class",i),m[0]&1280&&a!==(a=o[10]===o[66].tag_name)&&h(e,"aria-selected",a)},d(d){d&&w(e),l=!1,we(c)}}}function LM(o){let e,t,r,n,s,i,a;return{c(){e=S("div"),t=S("div"),r=B(o[16]),n=M(),s=S("button"),s.textContent="Close",h(t,"class","manifest-error-message svelte-12doke6"),h(s,"class","manifest-close-btn svelte-12doke6"),h(e,"class","manifest-error svelte-12doke6")},m(l,c){_(l,e,c),b(e,t),b(t,r),b(e,n),b(e,s),i||(a=z(s,"click",o[37]),i=!0)},p(l,c){c[0]&65536&&Y(r,l[16])},d(l){l&&w(e),i=!1,a()}}}function TM(o){var H;let e,t,r,n,s,i,a=(H=o[38](o[10]))==null?void 0:H.prerelease,l,c,f,u,d,m,p,y,g,v,C=a&&fw(o),L=o[12][o[10]]==="beta-alias"&&uw(o),T=o[12][o[10]]==="stable-alias"&&dw(o);function E(P,V){if(V[0]&9216&&(d=null),V[0]&1024&&(m=null),d==null&&(d=!!((P[38](P[10])||P[13][P[10]]==="stable-alias"||P[13][P[10]]==="beta-alias")&&!P[28](P[10]))),d)return MM;if(m==null&&(m=!!P[28](P[10])),m)return AM}let O=E(o,[-1,-1,-1]),I=O&&O(o);function A(P,V){return P[13][P[10]]==="stable-alias"||P[13][P[10]]==="beta-alias"||P[9]==="development"?RM:P[10]?FM:DM}let U=A(o,[-1,-1,-1]),W=U(o),J=o[15]&&pw(o);return{c(){e=S("div"),t=S("div"),r=S("h3"),n=B("Release Details: "),s=B(o[10]),i=M(),C&&C.c(),l=M(),L&&L.c(),c=M(),T&&T.c(),f=M(),u=S("div"),I&&I.c(),p=M(),y=S("div"),g=S("div"),W.c(),v=M(),J&&J.c(),h(r,"class","svelte-12doke6"),h(u,"class","manifest-header-actions svelte-12doke6"),h(t,"class","manifest-header svelte-12doke6"),h(g,"class","release-changelog-content svelte-12doke6"),h(y,"class","release-changelog svelte-12doke6"),h(e,"class","manifest-container svelte-12doke6")},m(P,V){_(P,e,V),b(e,t),b(t,r),b(r,n),b(r,s),b(r,i),C&&C.m(r,null),b(r,l),L&&L.m(r,null),b(r,c),T&&T.m(r,null),b(t,f),b(t,u),I&&I.m(u,null),b(e,p),b(e,y),b(y,g),W.m(g,null),b(e,v),J&&J.m(e,null)},p(P,V){var fe;V[0]&1024&&Y(s,P[10]),V[0]&1024&&(a=(fe=P[38](P[10]))==null?void 0:fe.prerelease),a?C||(C=fw(P),C.c(),C.m(r,l)):C&&(C.d(1),C=null),P[12][P[10]]==="beta-alias"?L||(L=uw(P),L.c(),L.m(r,c)):L&&(L.d(1),L=null),P[12][P[10]]==="stable-alias"?T||(T=dw(P),T.c(),T.m(r,null)):T&&(T.d(1),T=null),O===(O=E(P,V))&&I?I.p(P,V):(I&&I.d(1),I=O&&O(P),I&&(I.c(),I.m(u,null))),U===(U=A(P,V))&&W?W.p(P,V):(W.d(1),W=U(P),W&&(W.c(),W.m(g,null))),P[15]?J?J.p(P,V):(J=pw(P),J.c(),J.m(e,null)):J&&(J.d(1),J=null)},d(P){P&&w(e),C&&C.d(),L&&L.d(),T&&T.d(),I&&I.d(),W.d(),J&&J.d()}}}function fw(o){let e;return{c(){e=S("span"),e.textContent="Pre-release",h(e,"class","prerelease-badge svelte-12doke6")},m(t,r){_(t,e,r)},d(t){t&&w(e)}}}function uw(o){let e;return{c(){e=S("span"),e.textContent="Beta",h(e,"class","channel-badge beta-badge svelte-12doke6")},m(t,r){_(t,e,r)},d(t){t&&w(e)}}}function dw(o){let e;return{c(){e=S("span"),e.textContent="Stable",h(e,"class","channel-badge stable-badge svelte-12doke6")},m(t,r){_(t,e,r)},d(t){t&&w(e)}}}function AM(o){let e;return{c(){e=S("span"),e.textContent="Installed",h(e,"class","currently-installed svelte-12doke6")},m(t,r){_(t,e,r)},p:q,d(t){t&&w(e)}}}function MM(o){let e,t,r,n;function s(l,c){return l[14]===l[10]?PM:EM}let i=s(o,[-1,-1,-1]),a=i(o);return{c(){e=S("button"),a.c(),h(e,"class","install-version-btn mod-cta svelte-12doke6"),e.disabled=t=o[14]===o[10]||o[2]},m(l,c){_(l,e,c),a.m(e,null),r||(n=z(e,"click",o[51]),r=!0)},p(l,c){i!==(i=s(l,c))&&(a.d(1),a=i(l),a&&(a.c(),a.m(e,null))),c[0]&17412&&t!==(t=l[14]===l[10]||l[2])&&(e.disabled=t)},d(l){l&&w(e),a.d(),r=!1,n()}}}function EM(o){let e;return{c(){e=B("Install")},m(t,r){_(t,e,r)},d(t){t&&w(e)}}}function PM(o){let e;return{c(){e=B("Installing...")},m(t,r){_(t,e,r)},d(t){t&&w(e)}}}function DM(o){let e;return{c(){e=B('"No changelog available"')},m(t,r){_(t,e,r)},p:q,d(t){t&&w(e)}}}function FM(o){var n;let e,t,r={ctx:o,current:null,token:null,hasCatch:!1,pending:$M,then:OM,catch:UM,value:65};return Lo(t=o[34](((n=o[38](o[10]))==null?void 0:n.body)||"No changelog available"),r),{c(){e=ve(),r.block.c()},m(s,i){_(s,e,i),r.block.m(s,r.anchor=i),r.mount=()=>e.parentNode,r.anchor=e},p(s,i){var a;o=s,r.ctx=o,i[0]&1024&&t!==(t=o[34](((a=o[38](o[10]))==null?void 0:a.body)||"No changelog available"))&&Lo(t,r)||Es(r,o,i)},d(s){s&&w(e),r.block.d(s),r.token=null,r=null}}}function RM(o){let e;function t(s,i){if(s[13][s[10]]==="stable-alias")return VM;if(s[13][s[10]]==="beta-alias")return BM;if(s[10]===s[0].version)return NM}let r=t(o,[-1,-1,-1]),n=r&&r(o);return{c(){n&&n.c(),e=ve()},m(s,i){n&&n.m(s,i),_(s,e,i)},p(s,i){r!==(r=t(s,i))&&(n&&n.d(1),n=r&&r(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&w(e),n&&n.d(s)}}}function UM(o){return{c:q,m:q,p:q,d:q}}function OM(o){let e,t=o[65]+"",r;return{c(){e=new en(!1),r=ve(),e.a=r},m(n,s){e.m(t,n,s),_(n,r,s)},p(n,s){s[0]&1024&&t!==(t=n[65]+"")&&e.p(t)},d(n){n&&(w(r),e.d())}}}function $M(o){let e;return{c(){e=B('"loading..."')},m(t,r){_(t,e,r)},p:q,d(t){t&&w(e)}}}function NM(o){let e;return{c(){e=S("p"),e.textContent="Current development version"},m(t,r){_(t,e,r)},d(t){t&&w(e)}}}function BM(o){let e;return{c(){e=S("p"),e.textContent="Current beta release from main branch manifest-beta.json"},m(t,r){_(t,e,r)},d(t){t&&w(e)}}}function VM(o){let e;return{c(){e=S("p"),e.textContent="Current stable release from main branch manifest.json"},m(t,r){_(t,e,r)},d(t){t&&w(e)}}}function pw(o){let e,t,r,n,s,i=o[11].version+"",a,l,c=o[10]!==o[11].version&&!o[10].startsWith("v"+o[11].version),f,u,d,m,p,y=o[11].name+"",g,v,C,L,T,E,O=o[11].author+"",I,A,U,W,J,H,P=o[11].description+"",V,fe,de,le,ee,re,$=o[11].isDesktopOnly?"Yes":"No",N,pe,Q,Ie,Ue,Ne,te=o[11].minAppVersion+"",Oe,We=c&&mw(o);return{c(){e=S("div"),t=S("div"),r=S("span"),r.textContent="Version:",n=M(),s=S("span"),a=B(i),l=M(),We&&We.c(),f=M(),u=S("div"),d=S("span"),d.textContent="Name:",m=M(),p=S("span"),g=B(y),v=M(),C=S("div"),L=S("span"),L.textContent="Author:",T=M(),E=S("span"),I=B(O),A=M(),U=S("div"),W=S("span"),W.textContent="Description:",J=M(),H=S("span"),V=B(P),fe=M(),de=S("div"),le=S("span"),le.textContent="isDesktopOnly:",ee=M(),re=S("span"),N=B($),pe=M(),Q=S("div"),Ie=S("span"),Ie.textContent="minAppVersion:",Ue=M(),Ne=S("span"),Oe=B(te),h(r,"class","manifest-label svelte-12doke6"),h(s,"class","manifest-value svelte-12doke6"),h(t,"class","manifest-field svelte-12doke6"),h(d,"class","manifest-label svelte-12doke6"),h(p,"class","manifest-value svelte-12doke6"),h(u,"class","manifest-field svelte-12doke6"),h(L,"class","manifest-label svelte-12doke6"),h(E,"class","manifest-value svelte-12doke6"),h(C,"class","manifest-field svelte-12doke6"),h(W,"class","manifest-label svelte-12doke6"),h(H,"class","manifest-value svelte-12doke6"),h(U,"class","manifest-field svelte-12doke6"),h(le,"class","manifest-label svelte-12doke6"),h(re,"class","manifest-value svelte-12doke6"),h(de,"class","manifest-field svelte-12doke6"),h(Ie,"class","manifest-label svelte-12doke6"),h(Ne,"class","manifest-value svelte-12doke6"),h(Q,"class","manifest-field svelte-12doke6"),h(e,"class","manifest-content svelte-12doke6")},m(st,Ye){_(st,e,Ye),b(e,t),b(t,r),b(t,n),b(t,s),b(s,a),b(t,l),We&&We.m(t,null),b(e,f),b(e,u),b(u,d),b(u,m),b(u,p),b(p,g),b(e,v),b(e,C),b(C,L),b(C,T),b(C,E),b(E,I),b(e,A),b(e,U),b(U,W),b(U,J),b(U,H),b(H,V),b(e,fe),b(e,de),b(de,le),b(de,ee),b(de,re),b(re,N),b(e,pe),b(e,Q),b(Q,Ie),b(Q,Ue),b(Q,Ne),b(Ne,Oe)},p(st,Ye){Ye[0]&2048&&i!==(i=st[11].version+"")&&Y(a,i),Ye[0]&3072&&(c=st[10]!==st[11].version&&!st[10].startsWith("v"+st[11].version)),c?We||(We=mw(st),We.c(),We.m(t,null)):We&&(We.d(1),We=null),Ye[0]&2048&&y!==(y=st[11].name+"")&&Y(g,y),Ye[0]&2048&&O!==(O=st[11].author+"")&&Y(I,O),Ye[0]&2048&&P!==(P=st[11].description+"")&&Y(V,P),Ye[0]&2048&&$!==($=st[11].isDesktopOnly?"Yes":"No")&&Y(N,$),Ye[0]&2048&&te!==(te=st[11].minAppVersion+"")&&Y(Oe,te)},d(st){st&&w(e),We&&We.d()}}}function mw(o){let e;return{c(){e=S("span"),e.innerHTML=`<span class="manifest-version-mismatch-icon svelte-12doke6">\u26A0\uFE0F</span>
									Version mismatch`,h(e,"class","manifest-version-mismatch svelte-12doke6")},m(t,r){_(t,e,r)},d(t){t&&w(e)}}}function HM(o){let e,t=o[1]?"Relay installer":"Relay releases",r,n,s,i,a,l,c,f,u=!o[1]&&ow(o);function d(y,g){return y[7]?CM:y[3].length===0?IM:y[8].length===0?kM:SM}let m=d(o,[-1,-1,-1]),p=m(o);return{c(){e=S("div"),r=B(t),n=M(),s=S("div"),i=S("div"),a=M(),l=S("div"),u&&u.c(),c=M(),p.c(),h(e,"class","modal-title"),h(i,"class","settings-spacer svelte-12doke6"),h(l,"class","settings-container svelte-12doke6"),h(s,"class","modal-content svelte-12doke6")},m(y,g){_(y,e,g),b(e,r),_(y,n,g),_(y,s,g),b(s,i),b(s,a),b(s,l),u&&u.m(l,null),b(s,c),p.m(s,null),f=!0},p(y,g){(!f||g[0]&2)&&t!==(t=y[1]?"Relay installer":"Relay releases")&&Y(r,t),y[1]?u&&(ie(),k(u,1,1,()=>{u=null}),ae()):u?(u.p(y,g),g[0]&2&&x(u,1)):(u=ow(y),u.c(),x(u,1),u.m(l,null)),m===(m=d(y,g))&&p?p.p(y,g):(p.d(1),p=m(y),p&&(p.c(),p.m(s,null)))},i(y){f||(x(u),f=!0)},o(y){k(u),f=!1},d(y){y&&(w(e),w(n),w(s)),u&&u.d(),p.d()}}}var hw="system3-relay";function Nn(o){return o.startsWith("v")?o.substring(1):o}function gw(o){return(o==null?void 0:o.prerelease)===!0}function qM(o,e,t){let r,n,s,i,a,l,c,f,u,d,m,p,y,g,v,C,{plugin:L}=e,{version:T}=e,E=xe(L.manifest.version),O=xe(!1),I=xe(""),A=xe(""),U=xe(!1);ce(o,U,Z=>t(7,c=Z));let W=xe(!1);ce(o,W,Z=>t(6,l=Z));let J=xe(null);ce(o,J,Z=>t(11,m=Z));let H=xe("");ce(o,H,Z=>t(10,d=Z));let P=xe(null),V=xe(null);ce(o,V,Z=>t(16,C=Z));let fe=xe(!1);ce(o,fe,Z=>t(15,v=Z));let de=xe(null);ce(o,de,Z=>t(5,s=Z));let le=xe(null);ce(o,le,Z=>t(4,n=Z));let ee=xe(null);ce(o,ee,Z=>t(53,a=Z));let re=xe(null);ce(o,re,Z=>t(52,i=Z));let $=xe(!1),N=!1,pe=xe(null);ce(o,pe,Z=>t(14,g=Z));let Q=L.app;function Ie(Z){let Ce=Nn(Z),ut=Nn(L.version);return Ce===ut}let Ue=xe({});ce(o,Ue,Z=>t(13,y=Z));let Ne=xe({});ce(o,Ne,Z=>t(12,p=Z));let te=xe(L.releaseSettings.get().channel);ce(o,te,Z=>t(9,u=Z)),Rt(()=>{Ye(),Oe(),!T&&!r.some(Z=>{Z.tag_name,L.version})?te.set(null):te.set(L.releaseSettings.get().channel),J.set({version:T||L.version,name:L.manifest.name,author:L.manifest.author,description:L.manifest.description,isDesktopOnly:L.manifest.isDesktopOnly,minAppVersion:L.manifest.minAppVersion}),H.set(T||L.version)});function Oe(){return Ee(this,void 0,void 0,function*(){$.set(!0);try{let Z=yield L.updateManager.fetchRepoManifest("manifest.json");Z&&(de.set(Z),ee.set(Z.version));let Ce=yield L.updateManager.fetchRepoManifest("manifest-beta.json");Ce&&(le.set(Ce),re.set(Ce.version))}catch(Z){L.error("Error fetching main branch manifests:",Z)}finally{$.set(!1)}})}let We=Ot(L.updateManager,()=>L.updateManager.releases);ce(o,We,Z=>t(3,r=Z));let st=Ot([We,W],()=>r&&r.length>0?Fo(l).sort():[]);ce(o,st,Z=>t(8,f=Z)),r.forEach(Z=>Ee(void 0,void 0,void 0,function*(){try{let Ce=yield L.updateManager.fetchReleaseManifest(Z);Ce&&Ue.update(ut=>Object.assign(Object.assign({},ut),{[Z.tag_name]:Ce.version}))}catch(Ce){}}));function Ye(){return Ee(this,void 0,void 0,function*(){U.set(!0);try{yield L.updateManager.getReleases(),Fo(l)}catch(Z){L.error("Error refreshing GitHub releases:",Z)}finally{U.set(!1)}})}function ao(Z){return Ee(this,void 0,void 0,function*(){let Ce=document.createElement("div");return yield yw.MarkdownRenderer.render(L.app,Z,Ce,"",L),Ce.innerHTML})}function Fo(Z){return Z?r:T?r.filter(Ce=>T===Nn(Ce.tag_name)):r.filter(Ce=>{let ut=Ce.tag_name;return zs(Ce)})}function zs(Z){if(Z.prerelease||Z.draft)return!1;if(Z.latest||Nn(Z.tag_name)===a||Nn(Z.tag_name)===i)return!0;let Ce=new Date(Z.created_at),ut=new Date;return ut.setMonth(ut.getMonth()-3),Ce>ut}function fn(Z){return Ee(this,void 0,void 0,function*(){V.set(null),P.set(Z);try{let Ce=Bn(Z);if(!Ce){V.set(`Could not find release for ${Z}`);return}let ut=yield L.updateManager.fetchReleaseManifest(Ce);ut?(J.set(ut),H.set(Z),fe.set(!1),Ue.update(Ro=>Object.assign(Object.assign({},Ro),{[Z]:ut.version}))):V.set(`Could not find manifest for ${Z}`)}catch(Ce){L.error("Error fetching manifest:",Ce),V.set(`Error fetching manifest: ${Ce.message||"Unknown error"}`)}finally{P.set(null)}})}function nr(Z){let Ce=Z==="stable"?s:n;if(Ce){let ut=Ce.version;te.set(Z);let Ro=[...r.values()].find(Tr=>Nn(Tr.tag_name)===Nn(ut));Ro?(Z==="stable"?Ne.update(Tr=>Object.assign(Object.assign({},Tr),{[Ro.tag_name]:"stable-alias"})):Ne.update(Tr=>Object.assign(Object.assign({},Tr),{[Ro.tag_name]:"beta-alias"})),fn(Ro.tag_name)):(J.set(Ce),H.set(ut),Z==="stable"?Ne.update(Tr=>Object.assign(Object.assign({},Tr),{[ut]:"stable-alias"})):Ne.update(Tr=>Object.assign(Object.assign({},Tr),{[ut]:"beta-alias"})),fe.set(!1))}else V.set(`Could not find ${Z} manifest`)}function lo(){J.set(null),H.set(""),V.set(null)}function Bn(Z){return[...r.values()].find(Ce=>Ce.tag_name===Z)}function un(Z){return Ee(this,void 0,void 0,function*(){try{pe.set(Z);let Ce=Bn(Z);if(!Ce)throw new Error(`Could not find release for ${Z}`);let ut=yield L.updateManager.fetchReleaseManifest(Ce);if(!ut)throw new Error(`Could not find manifest for ${Z}`);t(2,N=!0),yield Q.plugins.installPlugin(L.repo,Z,ut),yield Q.plugins.disablePlugin(hw),yield Q.plugins.enablePlugin(hw)}catch(Ce){console.error(`Error installing version ${Z}:`,Ce),L&&L.error(`Error installing version ${Z}:`,Ce)}finally{L&&(t(2,N=!1),pe.set(null))}})}let Ws=Z=>Ie(Z.tag_name),Vn=()=>{W.update(Z=>!Z)},js=Z=>{(Z.key==="Enter"||Z.key===" ")&&W.update(Ce=>!Ce)},Ks=()=>{L.releaseSettings.update(Z=>({...Z,channel:"stable"})),te.set("stable"),nr("stable")},Gs=Z=>{(Z.key==="Enter"||Z.key===" ")&&(L.releaseSettings.update(Ce=>({...Ce,channel:"stable"})),te.set("stable"),nr("stable"))},Js=()=>{L.releaseSettings.update(Z=>({...Z,channel:"beta"})),te.set("beta"),nr("beta")},se=Z=>{(Z.key==="Enter"||Z.key===" ")&&(L.releaseSettings.update(Ce=>({...Ce,channel:"beta"})),te.set("beta"),nr("beta"))},He=()=>{te.set(null),J.set({version:L.manifest.version,name:L.manifest.name,author:L.manifest.author,description:L.manifest.description,isDesktopOnly:L.manifest.isDesktopOnly,minAppVersion:L.manifest.minAppVersion}),H.set(L.version),fe.set(!1)},Qe=Z=>{(Z.key==="Enter"||Z.key===" ")&&(te.set(null),J.set({version:L.manifest.version,name:L.manifest.name,author:L.manifest.author,description:L.manifest.description,isDesktopOnly:L.manifest.isDesktopOnly,minAppVersion:L.manifest.minAppVersion}),H.set(L.version),fe.set(!1))},qr=Z=>{te.set(null),fn(Z.tag_name)},Hn=(Z,Ce)=>{(Ce.key==="Enter"||Ce.key===" ")&&(te.set(null),fn(Z.tag_name))},wc=async()=>{un(d)};return o.$$set=Z=>{"plugin"in Z&&t(0,L=Z.plugin),"version"in Z&&t(1,T=Z.version)},[L,T,N,r,n,s,l,c,f,u,d,m,p,y,g,v,C,U,W,J,H,V,fe,de,le,ee,re,pe,Ie,Ue,Ne,te,We,st,ao,fn,nr,lo,Bn,un,Ws,Vn,js,Ks,Gs,Js,se,He,Qe,qr,Hn,wc]}var fm=class extends K{constructor(e){super(),G(this,e,qM,HM,j,{plugin:0,version:1},wM,[-1,-1,-1])}},xw=fm;var Yi=class extends bw.Modal{constructor(t,r,n){super(t);this.plugin=r;this.version=n}onOpen(){let{contentEl:t}=this;this.component=new xw({target:t,props:{plugin:this.plugin,version:this.version}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var zM={debugging:!1},WM={release:{channel:"stable"},sharedFolders:[],endpoints:{},...Si,...zM},vc=class extends _w.Plugin{constructor(){super(...arguments);this.webviewerPatched=!1;this.openModals=[];this.interceptedUrls=[];this.fileDiffMergeWarningKey="file-diff-merge-warning";this.version="0.5.13";this.repo="No-Instructions/Relay"}enableDebugging(t){Ua(!0),console.warn("RelayInstances",Ct),t&&this.debugSettings.update(r=>({...r,debugging:!0}))}disableDebugging(t){Ua(!1),t&&this.debugSettings.update(r=>({...r,debugging:!1}))}toggleDebugging(t){let r=!this.debugSettings.get().debugging;return Ua(r),t&&this.debugSettings.update(n=>({...n,debugging:r})),r}buildApiUrl(t){return this.loginManager.getEndpointManager().getApiUrl()+t}openEndpointConfigurationModal(){new ic(this.app,this,()=>{this.reload()}).open()}async validateAndApplyEndpoints(){var n;let t=this.endpointSettings.get();if(!t.activeTenantId||!((n=t.tenants)!=null&&n.length)){new Ke.Notice("Please configure an enterprise tenant first",4e3);return}let r=new Ke.Notice("Validating endpoints...",0);try{let s=await this.loginManager.validateAndApplyEndpoints();r.hide(),s.success?(await this.endpointSettings.update(i=>({...i,_lastValidationError:void 0,_lastValidationAttempt:void 0})),new Ke.Notice("\u2713 Endpoints validated and applied successfully!",5e3),s.licenseInfo&&console.log("License validation successful:",s.licenseInfo)):(await this.endpointSettings.update(i=>({...i,_lastValidationError:s.error,_lastValidationAttempt:Date.now()})),new Ke.Notice(`\u274C Validation failed: ${s.error}`,8e3))}catch(s){r.hide();let i=s instanceof Error?s.message:"Unknown error";await this.endpointSettings.update(a=>({...a,_lastValidationError:i,_lastValidationAttempt:Date.now()})),new Ke.Notice(`\u274C Validation error: ${i}`,8e3)}}resetToDefaultEndpoints(){this.loginManager.getEndpointManager().clearValidatedEndpoints(),this.endpointSettings.update(()=>({})),new Ke.Notice("Reset to default endpoints",3e3)}async validateEndpointsOnStartup(){var n;let t=this.endpointSettings.get();if(!t.activeTenantId||!((n=t.tenants)!=null&&n.length)){this.log("No active enterprise tenant configured, using defaults");return}let r=t.tenants.find(s=>s.id===t.activeTenantId);if(!r){this.log("Active tenant not found, using defaults");return}this.log("Enterprise tenant configured, validating on startup...",{tenantId:r.id,tenantUrl:r.tenantUrl,tenantName:r.name});try{let s=await this.loginManager.validateAndApplyEndpoints(5e3);s.success?(await this.endpointSettings.update(i=>({...i,_lastValidationError:void 0,_lastValidationAttempt:void 0})),this.log("\u2713 Enterprise tenant validated and applied on startup",{licenseInfo:s.licenseInfo})):(this.error("\u274C Enterprise tenant validation failed on startup",s.error),await this.endpointSettings.update(i=>({...i,_lastValidationError:s.error,_lastValidationAttempt:Date.now()})),new Ke.Notice(`\u274C Custom endpoints failed validation: ${s.error}`,8e3))}catch(s){let i=s instanceof Error?s.message:"Unknown error";this.error("Startup endpoint validation error:",i),await this.endpointSettings.update(a=>({...a,_lastValidationError:i,_lastValidationAttempt:Date.now()})),new Ke.Notice(`\u274C Endpoint validation error: ${i}`,8e3)}}async onload(){this.appId=this.app.appId;let t=Ke.moment.now();Ct.set(this,"plugin"),this.timeProvider=new _s,this.register(()=>{this.timeProvider.destroy()}),Tg(new gc(this.app.vault),this.timeProvider,".obsidian/plugins/system3-relay/relay.log",{maxFileSize:5*1024*1024,maxBackups:3,disableConsole:!1}),this.notifier=new hc,this.debug=ke("[System 3][Relay]","debug"),this.log=ke("[System 3][Relay]","log"),this.warn=ke("[System 3][Relay]","warn"),this.error=ke("[System 3][Relay]","error"),this.settings=new Ja(this,WM),await this.settings.load(),this.featureSettings=new zt(this.settings,"(enable*)"),this.debugSettings=new zt(this.settings,"(debugging)"),this.folderSettings=new zt(this.settings,"sharedFolders"),this.releaseSettings=new zt(this.settings,"release"),this.loginSettings=new zt(this.settings,"login"),this.endpointSettings=new zt(this.settings,"endpoints"),xt.getInstance().setSettings(this.featureSettings),this.settingsTab=new Bl(this.app,this),this.addRibbonIcon("satellite","Relay",()=>{this.openSettings()}),this.updateManager=new bc(this,this.timeProvider,this.releaseSettings),this.debugSettings.subscribe(i=>{i.debugging?(this.enableDebugging(),this.removeCommand("enable-debugging"),this.addCommand({id:"toggle-feature-flags",name:"Show feature flags",callback:()=>{let a=new pc(this.app,()=>{this.reload()});this.openModals.push(a),a.open()}}),this.addCommand({id:"send-bug-report",name:"Send bug report",callback:()=>{let a=new yc(this.app,this);this.openModals.push(a),a.open()}}),this.addCommand({id:"show-debug-info",name:"Show debug info",callback:()=>{let a=new mc(this.app,this);this.openModals.push(a),a.open()}}),this.addCommand({id:"show-release-manager",name:"Show releases",callback:()=>{let a=new Yi(this.app,this);this.openModals.push(a),a.open()}}),this.addCommand({id:"analyze-indexeddb",name:"Analyze database",callback:()=>{let a=new xc(this.app,this);this.openModals.push(a),a.open()}}),this.addCommand({id:"disable-debugging",name:"Disable debugging",callback:()=>{this.disableDebugging(!0)}}),this.addCommand({id:"show-sync-status",name:"Sync status",callback:()=>{let a=new Ji(this.app,this.backgroundSync,this.sharedFolders);this.openModals.push(a),a.open()}})):(this.removeCommand("toggle-feature-flags"),this.removeCommand("send-bug-report"),this.removeCommand("show-debug-info"),this.removeCommand("show-sync-status"),this.removeCommand("show-release-manager"),this.removeCommand("disable-debugging"),this.addCommand({id:"enable-debugging",name:"Enable debugging",callback:()=>{this.enableDebugging(!0)}}))});let n=`async function() {
			const app = window.app;
			await app.plugins.disablePlugin("system3-relay");
			await app.plugins.enablePlugin("system3-relay");
		}`;this.app.reloadRelay=new Function("return "+n),this.addCommand({id:"reload",name:"Reload Relay",callback:this.app.reloadRelay()}),this.addCommand({id:"configure-endpoints",name:"Configure enterprise tenant",callback:()=>{this.openEndpointConfigurationModal()}}),this.updateManager.subscribe(()=>{let i=this.updateManager.getNewRelease();i?(this.removeCommand("update-plugin"),this.addCommand({id:"update-plugin",name:`Update Plugin (${this.version} \u2192 ${i.tag_name})`,callback:async()=>{await this.updateManager.installUpdate(i)}}),this.log(`Update available: v${this.version} \u2192 ${i.tag_name}`)):this.removeCommand("update-plugin")}),this.vault=this.app.vault;let s=this.vault.getName();this.fileManager=this.app.fileManager,this.hashStore=new Ya(this.appId),this.loginManager=new sc(this.vault.getName(),this.openSettings.bind(this),this.timeProvider,this.patchWebviewer.bind(this),this.loginSettings,this.endpointSettings),await this.validateEndpointsOnStartup(),this.relayManager=new uc(this.loginManager),this.sharedFolders=new Za(this.relayManager,this.vault,this._createSharedFolder.bind(this),this.folderSettings),this.tokenStore=new lc(this.loginManager,this.timeProvider,s,3),this.networkStatus=new Wb(this.timeProvider,"https://api.system3.md/health?version=0.5.13"),this.backgroundSync=new dc(this.loginManager,this.timeProvider,this.sharedFolders),this.loginManager.setup()||new Ke.Notice("Please sign in to use relay"),this.app.workspace.onLayoutReady(()=>{this.sharedFolders.load(),this._liveViews=new Sl(this.app,this.sharedFolders,this.loginManager,this.networkStatus),this.registerEditorExtension(this._liveViews.extensions),this.register(this.loginManager.on(()=>{this.loginManager.loggedIn?this._onLogin():this._onLogout()})),this.tokenStore.start(),vw.Platform.isIosApp||(this.networkStatus.addEventListener("offline",()=>{this.tokenStore.stop(),this.sharedFolders.forEach(i=>i.disconnect()),this._liveViews.goOffline()}),this.networkStatus.addEventListener("online",()=>{this.tokenStore.start(),this.relayManager.subscribe(),this.relayManager.update(),this._liveViews.goOnline()}),this.networkStatus.start()),this.registerView(Ds,i=>new xl(i)),this.registerEvent(this.app.workspace.on("file-menu",(i,a)=>{if(a instanceof Ke.TFolder){let l=this.sharedFolders.find(c=>c.path===a.path);if(!l)return;l.relayId&&(i.addItem(c=>{c.setTitle("Relay settings").setIcon("gear").onClick(()=>{this.openSettings(`/relays?id=${l.relayId}`)})}),i.addItem(c=>{c.setTitle("Folder settings").setIcon("gear").onClick(()=>{this.openSettings(`/shared-folders?id=${l.guid}&relay=${l.relayId}`)})}),i.addItem(c=>{c.setTitle(l.connected?"Disconnect":"Connect").setIcon("satellite").onClick(()=>{l.connected?(l.shouldConnect=!1,l.disconnect()):(l.shouldConnect=!0,l.connect()),this._liveViews.refresh("folder connection toggle")})})),l.relayId&&Ve().enableSyncModal&&i.addItem(c=>{c.setTitle("Sync Status").setIcon("list-checks").onClick(()=>{let f=new Ji(this.app,this.backgroundSync,this.sharedFolders,l.guid);this.openModals.push(f),f.open()})}),Ve().enableSyncMenu&&l.relayId&&l.connected&&i.addItem(c=>{c.setTitle("Sync").setIcon("folder-sync").onClick(()=>{l.netSync()})})}else if(a instanceof Ke.TFile){let l=this.sharedFolders.lookup(a.path),c=l==null?void 0:l.getFile(a);c&&kr(c)&&(i.addItem(f=>{f.setTitle("Download").setIcon("cloud-download").onClick(async()=>{await c.pull(),new Ke.Notice(`Download complete: ${c.name}`)})}),this.debugSettings.get().debugging&&i.addItem(f=>{f.setTitle("Verify upload").setIcon("search-check").onClick(async()=>{let u=await c.verifyUpload();new Ke.Notice(`${c.name} ${u?"on server":"missing from server"}`)})}),i.addItem(f=>{f.setTitle("Upload").setIcon("cloud-upload").onClick(async()=>{await c.push(!0);let u=await c.verifyUpload();new Ke.Notice(`${u?"File uploaded:":"File upload failed:"} ${c.name}`)})}))}})),this.setup(),this._liveViews.refresh("init"),this.loadTime=Ke.moment.now()-t})}async reload(){this.app.reloadRelay()()}_createSharedFolder(t,r,n,s){let i=new zt(this.settings,`sharedFolders/[guid=${r}]`),a={guid:r,path:t};return n&&(a.relay=n),i.update(c=>({...c,path:t,guid:r,...n?{relay:n}:{},sync:c.sync?c.sync:Qo.defaultFlags}),!0),new Qa(this.appId,r,t,this.loginManager,this.vault,this.fileManager,this.tokenStore,this.relayManager,this.hashStore,this.backgroundSync,i,n,s)}_onLogout(){var t,r;(t=this.tokenStore)==null||t.clear(),(r=this.relayManager)==null||r.logout(),this._liveViews.refresh("logout")}_onLogin(){var t;this.sharedFolders.load(),(t=this.relayManager)==null||t.login(),this._liveViews.refresh("login")}async openSettings(t="/"){let r=this.app.setting;await r.open(),await r.openTabById("system3-relay"),this.settingsTab.navigateTo(t)}patchWebviewer(){var r,n,s;let t=this;try{if(this.webviewerPatched)return;let i=(n=(r=this.app.internalPlugins)==null?void 0:r.plugins)==null?void 0:n.webviewer;if(!((s=i==null?void 0:i.instance)!=null&&s.options)||!i.enabled){this.warn("Webviewer plugin not found or not initialized");return}let a=i.instance.options,l=Object.getOwnPropertyDescriptor(a,"openExternalURLs");if(!l){this.warn("Could not find openExternalURLs property");return}Object.defineProperty(a,"openExternalURLs",{get(){var m;let d=window.event;if((d==null?void 0:d.type)==="open-url"&&((m=d==null?void 0:d.detail)!=null&&m.url)){let p=d.detail.url;for(let y of t.interceptedUrls)if(typeof y=="string"&&p.startsWith(y)||y instanceof RegExp&&y.test(p))return t.log("Intercepted webviewer, opening in default browser",d.detail.url),!1}return l.value},set(d){l.value=d},configurable:!0}),this.register(()=>{Object.defineProperty(a,"openExternalURLs",l)}),this.loginManager.getWebviewIntercepts().forEach(d=>{this.debug("Intercepting Webviewer for URL pattern",d.source),this.interceptedUrls.push(d)});let f=this.loginManager.getEndpointManager().getApiUrl(),u=new RegExp(f.replace("/","\\/")+".*");this.debug("Intercepting Webviewer for URL pattern",u.source),this.interceptedUrls.push(u),this.webviewerPatched=!0,this.debug("patched webviewer options")}catch(i){this.error("Failed to patch webviewer:",i)}}setup(){this.folderNavDecorations=new Cl(this.vault,this.app.workspace,this.sharedFolders,this.backgroundSync),this.folderNavDecorations.refresh(),this.addSettingTab(this.settingsTab);let t=ke("[Live][Workspace]","log");this.registerEvent(this.app.workspace.on("file-open",c=>{t("file-open"),i._liveViews.refresh("file-open")})),this.registerEvent(this.app.workspace.on("layout-change",()=>{t("layout-change"),this._liveViews.refresh("layout-change")}));let r=ke("[System 3][Relay][Vault]","log"),n=c=>{},s=c=>n(c);window.addEventListener("unhandledrejection",s,!0),this.register(()=>window.removeEventListener("unhandledrejection",s,!0)),this.registerEvent(this.app.vault.on("create",c=>{let f=this.sharedFolders.lookup(c.path);f&&(f.placeHold([c]).length>0?f.uploadFile(c):f.whenReady().then(d=>{d.getFile(c)}))})),this.registerEvent(this.app.vault.on("delete",c=>{if(c instanceof Ke.TFolder){let u=this.sharedFolders.find(d=>d.path===c.path);if(u){this.sharedFolders.delete(u);return}}let f=this.sharedFolders.lookup(c.path);f&&(r("Delete",c.path),f.whenReady().then(u=>{u.proxy.deleteFile(c.path)}))})),this.registerEvent(this.app.vault.on("rename",(c,f)=>{if(c instanceof Ke.TFolder){let p=this.sharedFolders.find(y=>y.path==f);if(p){p.move(c.path),this.sharedFolders.update();return}}let u=this.sharedFolders.lookup(f),d=this.sharedFolders.lookup(c.path),m=u||d;u&&d?(r("Rename",c.path,f),u.renameFile(c,f),d.renameFile(c,f),this._liveViews.refresh("rename"),this.folderNavDecorations.quickRefresh()):m&&(r("Rename",c.path,f),m.renameFile(c,f),this._liveViews.refresh("rename"),this.folderNavDecorations.refresh())})),this.registerEvent(this.app.vault.on("modify",c=>{let f=this.sharedFolders.lookup(c.path);if(f){r("Modify",c.path);let u=f.proxy.getFile(c);u&&kr(u)&&u.sync(),this.timeProvider.setTimeout(()=>{this.app.metadataCache.trigger("resolve",u)},10)}}));let i=this,a=Ao(Ke.MarkdownView.prototype,{onUnloadFile(c){return function(f){return i._liveViews.wipe(),c.call(this,f)}}});this.register(a);let l=Ao(this.app.vault,{process(c){return function(f,u,d){try{let m=i.sharedFolders.lookup(f.path);if(m){let p=m.proxy.getFile(f);f instanceof Ke.TFile&&p&&ar(p)&&p.process(u)}}catch(m){i.log(m)}return c.call(this,f,u,d)}}});this.register(l),this.patchWebviewer(),jo(wo.enableNewLinkFormat,()=>{let c=Ao(Ke.MetadataCache.prototype,{fileToLinktext(f){return function(u,d,m){if(i.sharedFolders.lookup(u.path)){m===void 0&&(m=!0);let y=u.extension==="md"&&m?u.basename:u.name,g=(0,Ke.normalizePath)(u.name),v=i.app.metadataCache.uniqueFileLookup.get(g.toLowerCase());if(v&&v.length===1&&v[0]===u)return y;{let C=u.extension==="md"&&m?u.path.slice(0,u.path.length-3):u.path,L=(0,ww.relative)(d,C);return L==="../"+y?"./"+y:L}}return f.call(this,u,d,m)}}});this.register(c)}),this.registerObsidianProtocolHandler("relay/settings/relays",async c=>{let f=c,u=new URLSearchParams({...f}).toString(),d=`/${f.action.split("/").slice(-1)}?${u}`;this.openSettings(d)}),this.registerObsidianProtocolHandler("relay/settings/shared-folders",async c=>{let f=c,u=new URLSearchParams({...f}).toString(),d=`/${f.action.split("/").slice(-1)}?${u}`;this.openSettings(d)}),this.registerObsidianProtocolHandler("relay/upgrade",async c=>{var d;let u=(d=c.version)==null?void 0:d.trim();this.installVersion(u)}),this.backgroundSync.start(),this.updateManager.start()}installVersion(t){let r=new Yi(this.app,this,t);this.app.setting.close(),this.openModals.push(r),r.open()}removeCommand(t){if((0,Ke.requireApiVersion)("1.7.2"))super.removeCommand(t);else{let r=this.app,n=r.commands,s=`system3-relay:${t}`;(n.commands.hasOwnProperty(s)||r.hotkeyManager.removeDefaultHotkeys(s))&&(delete n.commands[s],delete n.editorCommands[s])}}onunload(){var t,r,n,s,i,a,l,c,f,u,d,m,p,y;(t=this.timeProvider)==null||t.destroy(),(r=this.folderNavDecorations)==null||r.destroy(),this.app.workspace.detachLeavesOfType(Ds),this.updateManager&&(this.updateManager.destroy(),this.updateManager=null),(n=this._liveViews)==null||n.destroy(),this._liveViews=null,(s=this.relayManager)==null||s.destroy(),this.relayManager=null,(i=this.tokenStore)==null||i.stop(),(a=this.tokenStore)==null||a.clearState(),(l=this.tokenStore)==null||l.destroy(),this.tokenStore=null,(c=this.networkStatus)==null||c.stop(),(f=this.networkStatus)==null||f.destroy(),this.networkStatus=null,this.openModals.forEach(g=>{g.close()}),this.openModals.length=0,(u=this.sharedFolders)==null||u.destroy(),this.sharedFolders=null,(d=this.settingsTab)==null||d.destroy(),this.settingsTab=null,(m=this.loginManager)==null||m.destroy(),this.loginManager=null,(p=this.backgroundSync)==null||p.destroy(),this.backgroundSync=null,this.hashStore.destroy(),this.hashStore=null,(y=this.app)==null||y.workspace.updateOptions(),this.app.reloadRelay=void 0,this.app=null,this.fileManager=null,this.manifest=null,this.vault=null,this.debugSettings.destroy(),this.debugSettings=null,this.folderSettings.destroy(),this.folderSettings=null,this.featureSettings.destroy(),this.featureSettings=null,this.releaseSettings.destroy(),this.releaseSettings=null,this.loginSettings.destroy(),this.loginSettings=null,this.interceptedUrls.length=0,xt.destroy(),Sr.destroy(),this.notifier=null,Eg(),Nf()}async loadSettings(){this.settings.load()}async saveSettings(){await this.settings.save()}};
/*! Bundled license information:

lucide-svelte/dist/defaultAttributes.js:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/arrow-right-left.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/arrow-up-down.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/check.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/chevron-left.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/chevron-right.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/circle-check-big.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/circle-help.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/clock.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/download.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/folder.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/info.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/layers.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/lock.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/message-square-heart.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/pause.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/play.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/refresh-cw.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/satellite.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/settings.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/square-pen.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/triangle-alert.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/upload.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/index.js:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/aliases.js:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)
*/

/* nosourcemap */